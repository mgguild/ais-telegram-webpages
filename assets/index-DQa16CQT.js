(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))a(h);new MutationObserver(h=>{for(const u of h)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function r(h){const u={};return h.integrity&&(u.integrity=h.integrity),h.referrerPolicy&&(u.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?u.credentials="include":h.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(h){if(h.ep)return;h.ep=!0;const u=r(h);fetch(h.href,u)}})();function sl(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xg={exports:{}},nl={},Cg={exports:{}},xt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var go=Symbol.for("react.element"),N0=Symbol.for("react.portal"),H0=Symbol.for("react.fragment"),W0=Symbol.for("react.strict_mode"),j0=Symbol.for("react.profiler"),G0=Symbol.for("react.provider"),V0=Symbol.for("react.context"),X0=Symbol.for("react.forward_ref"),$0=Symbol.for("react.suspense"),Y0=Symbol.for("react.memo"),Q0=Symbol.for("react.lazy"),Zf=Symbol.iterator;function Z0(e){return e===null||typeof e!="object"?null:(e=Zf&&e[Zf]||e["@@iterator"],typeof e=="function"?e:null)}var bg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ag=Object.assign,Sg={};function or(e,s,r){this.props=e,this.context=s,this.refs=Sg,this.updater=r||bg}or.prototype.isReactComponent={};or.prototype.setState=function(e,s){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,s,"setState")};or.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Eg(){}Eg.prototype=or.prototype;function pu(e,s,r){this.props=e,this.context=s,this.refs=Sg,this.updater=r||bg}var gu=pu.prototype=new Eg;gu.constructor=pu;Ag(gu,or.prototype);gu.isPureReactComponent=!0;var qf=Array.isArray,Tg=Object.prototype.hasOwnProperty,mu={current:null},Pg={key:!0,ref:!0,__self:!0,__source:!0};function Ig(e,s,r){var a,h={},u=null,p=null;if(s!=null)for(a in s.ref!==void 0&&(p=s.ref),s.key!==void 0&&(u=""+s.key),s)Tg.call(s,a)&&!Pg.hasOwnProperty(a)&&(h[a]=s[a]);var m=arguments.length-2;if(m===1)h.children=r;else if(1<m){for(var _=Array(m),y=0;y<m;y++)_[y]=arguments[y+2];h.children=_}if(e&&e.defaultProps)for(a in m=e.defaultProps,m)h[a]===void 0&&(h[a]=m[a]);return{$$typeof:go,type:e,key:u,ref:p,props:h,_owner:mu.current}}function q0(e,s){return{$$typeof:go,type:e.type,key:s,ref:e.ref,props:e.props,_owner:e._owner}}function _u(e){return typeof e=="object"&&e!==null&&e.$$typeof===go}function K0(e){var s={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return s[r]})}var Kf=/\/+/g;function zh(e,s){return typeof e=="object"&&e!==null&&e.key!=null?K0(""+e.key):s.toString(36)}function _a(e,s,r,a,h){var u=typeof e;(u==="undefined"||u==="boolean")&&(e=null);var p=!1;if(e===null)p=!0;else switch(u){case"string":case"number":p=!0;break;case"object":switch(e.$$typeof){case go:case N0:p=!0}}if(p)return p=e,h=h(p),e=a===""?"."+zh(p,0):a,qf(h)?(r="",e!=null&&(r=e.replace(Kf,"$&/")+"/"),_a(h,s,r,"",function(y){return y})):h!=null&&(_u(h)&&(h=q0(h,r+(!h.key||p&&p.key===h.key?"":(""+h.key).replace(Kf,"$&/")+"/")+e)),s.push(h)),1;if(p=0,a=a===""?".":a+":",qf(e))for(var m=0;m<e.length;m++){u=e[m];var _=a+zh(u,m);p+=_a(u,s,r,_,h)}else if(_=Z0(e),typeof _=="function")for(e=_.call(e),m=0;!(u=e.next()).done;)u=u.value,_=a+zh(u,m++),p+=_a(u,s,r,_,h);else if(u==="object")throw s=String(e),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return p}function Ko(e,s,r){if(e==null)return e;var a=[],h=0;return _a(e,a,"","",function(u){return s.call(r,u,h++)}),a}function J0(e){if(e._status===-1){var s=e._result;s=s(),s.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=s)}if(e._status===1)return e._result.default;throw e._result}var ze={current:null},va={transition:null},ty={ReactCurrentDispatcher:ze,ReactCurrentBatchConfig:va,ReactCurrentOwner:mu};function Rg(){throw Error("act(...) is not supported in production builds of React.")}xt.Children={map:Ko,forEach:function(e,s,r){Ko(e,function(){s.apply(this,arguments)},r)},count:function(e){var s=0;return Ko(e,function(){s++}),s},toArray:function(e){return Ko(e,function(s){return s})||[]},only:function(e){if(!_u(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};xt.Component=or;xt.Fragment=H0;xt.Profiler=j0;xt.PureComponent=pu;xt.StrictMode=W0;xt.Suspense=$0;xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ty;xt.act=Rg;xt.cloneElement=function(e,s,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=Ag({},e.props),h=e.key,u=e.ref,p=e._owner;if(s!=null){if(s.ref!==void 0&&(u=s.ref,p=mu.current),s.key!==void 0&&(h=""+s.key),e.type&&e.type.defaultProps)var m=e.type.defaultProps;for(_ in s)Tg.call(s,_)&&!Pg.hasOwnProperty(_)&&(a[_]=s[_]===void 0&&m!==void 0?m[_]:s[_])}var _=arguments.length-2;if(_===1)a.children=r;else if(1<_){m=Array(_);for(var y=0;y<_;y++)m[y]=arguments[y+2];a.children=m}return{$$typeof:go,type:e.type,key:h,ref:u,props:a,_owner:p}};xt.createContext=function(e){return e={$$typeof:V0,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:G0,_context:e},e.Consumer=e};xt.createElement=Ig;xt.createFactory=function(e){var s=Ig.bind(null,e);return s.type=e,s};xt.createRef=function(){return{current:null}};xt.forwardRef=function(e){return{$$typeof:X0,render:e}};xt.isValidElement=_u;xt.lazy=function(e){return{$$typeof:Q0,_payload:{_status:-1,_result:e},_init:J0}};xt.memo=function(e,s){return{$$typeof:Y0,type:e,compare:s===void 0?null:s}};xt.startTransition=function(e){var s=va.transition;va.transition={};try{e()}finally{va.transition=s}};xt.unstable_act=Rg;xt.useCallback=function(e,s){return ze.current.useCallback(e,s)};xt.useContext=function(e){return ze.current.useContext(e)};xt.useDebugValue=function(){};xt.useDeferredValue=function(e){return ze.current.useDeferredValue(e)};xt.useEffect=function(e,s){return ze.current.useEffect(e,s)};xt.useId=function(){return ze.current.useId()};xt.useImperativeHandle=function(e,s,r){return ze.current.useImperativeHandle(e,s,r)};xt.useInsertionEffect=function(e,s){return ze.current.useInsertionEffect(e,s)};xt.useLayoutEffect=function(e,s){return ze.current.useLayoutEffect(e,s)};xt.useMemo=function(e,s){return ze.current.useMemo(e,s)};xt.useReducer=function(e,s,r){return ze.current.useReducer(e,s,r)};xt.useRef=function(e){return ze.current.useRef(e)};xt.useState=function(e){return ze.current.useState(e)};xt.useSyncExternalStore=function(e,s,r){return ze.current.useSyncExternalStore(e,s,r)};xt.useTransition=function(){return ze.current.useTransition()};xt.version="18.3.1";Cg.exports=xt;var ht=Cg.exports;const At=sl(ht);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ey=ht,iy=Symbol.for("react.element"),sy=Symbol.for("react.fragment"),ny=Object.prototype.hasOwnProperty,ry=ey.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,oy={key:!0,ref:!0,__self:!0,__source:!0};function Dg(e,s,r){var a,h={},u=null,p=null;r!==void 0&&(u=""+r),s.key!==void 0&&(u=""+s.key),s.ref!==void 0&&(p=s.ref);for(a in s)ny.call(s,a)&&!oy.hasOwnProperty(a)&&(h[a]=s[a]);if(e&&e.defaultProps)for(a in s=e.defaultProps,s)h[a]===void 0&&(h[a]=s[a]);return{$$typeof:iy,type:e,key:u,ref:p,props:h,_owner:ry.current}}nl.Fragment=sy;nl.jsx=Dg;nl.jsxs=Dg;xg.exports=nl;var Q=xg.exports,vc={},kg={exports:{}},li={},Fg={exports:{}},Bg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function s(et,q){var Z=et.length;et.push(q);t:for(;0<Z;){var lt=Z-1>>>1,at=et[lt];if(0<h(at,q))et[lt]=q,et[Z]=at,Z=lt;else break t}}function r(et){return et.length===0?null:et[0]}function a(et){if(et.length===0)return null;var q=et[0],Z=et.pop();if(Z!==q){et[0]=Z;t:for(var lt=0,at=et.length,Ct=at>>>1;lt<Ct;){var Tt=2*(lt+1)-1,bt=et[Tt],gt=Tt+1,Zt=et[gt];if(0>h(bt,Z))gt<at&&0>h(Zt,bt)?(et[lt]=Zt,et[gt]=Z,lt=gt):(et[lt]=bt,et[Tt]=Z,lt=Tt);else if(gt<at&&0>h(Zt,Z))et[lt]=Zt,et[gt]=Z,lt=gt;else break t}}return q}function h(et,q){var Z=et.sortIndex-q.sortIndex;return Z!==0?Z:et.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var p=Date,m=p.now();e.unstable_now=function(){return p.now()-m}}var _=[],y=[],A=1,E=null,S=3,R=!1,M=!1,U=!1,$=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function F(et){for(var q=r(y);q!==null;){if(q.callback===null)a(y);else if(q.startTime<=et)a(y),q.sortIndex=q.expirationTime,s(_,q);else break;q=r(y)}}function j(et){if(U=!1,F(et),!M)if(r(_)!==null)M=!0,tt(W);else{var q=r(y);q!==null&&Pe(j,q.startTime-et)}}function W(et,q){M=!1,U&&(U=!1,I(D),D=-1),R=!0;var Z=S;try{for(F(q),E=r(_);E!==null&&(!(E.expirationTime>q)||et&&!rt());){var lt=E.callback;if(typeof lt=="function"){E.callback=null,S=E.priorityLevel;var at=lt(E.expirationTime<=q);q=e.unstable_now(),typeof at=="function"?E.callback=at:E===r(_)&&a(_),F(q)}else a(_);E=r(_)}if(E!==null)var Ct=!0;else{var Tt=r(y);Tt!==null&&Pe(j,Tt.startTime-q),Ct=!1}return Ct}finally{E=null,S=Z,R=!1}}var Y=!1,C=null,D=-1,N=5,it=-1;function rt(){return!(e.unstable_now()-it<N)}function K(){if(C!==null){var et=e.unstable_now();it=et;var q=!0;try{q=C(!0,et)}finally{q?Pt():(Y=!1,C=null)}}else Y=!1}var Pt;if(typeof P=="function")Pt=function(){P(K)};else if(typeof MessageChannel<"u"){var St=new MessageChannel,ut=St.port2;St.port1.onmessage=K,Pt=function(){ut.postMessage(null)}}else Pt=function(){$(K,0)};function tt(et){C=et,Y||(Y=!0,Pt())}function Pe(et,q){D=$(function(){et(e.unstable_now())},q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(et){et.callback=null},e.unstable_continueExecution=function(){M||R||(M=!0,tt(W))},e.unstable_forceFrameRate=function(et){0>et||125<et?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<et?Math.floor(1e3/et):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return r(_)},e.unstable_next=function(et){switch(S){case 1:case 2:case 3:var q=3;break;default:q=S}var Z=S;S=q;try{return et()}finally{S=Z}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(et,q){switch(et){case 1:case 2:case 3:case 4:case 5:break;default:et=3}var Z=S;S=et;try{return q()}finally{S=Z}},e.unstable_scheduleCallback=function(et,q,Z){var lt=e.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?lt+Z:lt):Z=lt,et){case 1:var at=-1;break;case 2:at=250;break;case 5:at=1073741823;break;case 4:at=1e4;break;default:at=5e3}return at=Z+at,et={id:A++,callback:q,priorityLevel:et,startTime:Z,expirationTime:at,sortIndex:-1},Z>lt?(et.sortIndex=Z,s(y,et),r(_)===null&&et===r(y)&&(U?(I(D),D=-1):U=!0,Pe(j,Z-lt))):(et.sortIndex=at,s(_,et),M||R||(M=!0,tt(W))),et},e.unstable_shouldYield=rt,e.unstable_wrapCallback=function(et){var q=S;return function(){var Z=S;S=q;try{return et.apply(this,arguments)}finally{S=Z}}}})(Bg);Fg.exports=Bg;var ay=Fg.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ly=ht,ai=ay;function J(e){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)s+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Mg=new Set,qr={};function cn(e,s){qn(e,s),qn(e+"Capture",s)}function qn(e,s){for(qr[e]=s,e=0;e<s.length;e++)Mg.add(s[e])}var es=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),yc=Object.prototype.hasOwnProperty,hy=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Jf={},tp={};function cy(e){return yc.call(tp,e)?!0:yc.call(Jf,e)?!1:hy.test(e)?tp[e]=!0:(Jf[e]=!0,!1)}function uy(e,s,r,a){if(r!==null&&r.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return a?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function dy(e,s,r,a){if(s===null||typeof s>"u"||uy(e,s,r,a))return!0;if(a)return!1;if(r!==null)switch(r.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Oe(e,s,r,a,h,u,p){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=a,this.attributeNamespace=h,this.mustUseProperty=r,this.propertyName=e,this.type=s,this.sanitizeURL=u,this.removeEmptyString=p}var Ce={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ce[e]=new Oe(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var s=e[0];Ce[s]=new Oe(s,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ce[e]=new Oe(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ce[e]=new Oe(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ce[e]=new Oe(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ce[e]=new Oe(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ce[e]=new Oe(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ce[e]=new Oe(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ce[e]=new Oe(e,5,!1,e.toLowerCase(),null,!1,!1)});var vu=/[\-:]([a-z])/g;function yu(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var s=e.replace(vu,yu);Ce[s]=new Oe(s,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var s=e.replace(vu,yu);Ce[s]=new Oe(s,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var s=e.replace(vu,yu);Ce[s]=new Oe(s,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ce[e]=new Oe(e,1,!1,e.toLowerCase(),null,!1,!1)});Ce.xlinkHref=new Oe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ce[e]=new Oe(e,1,!1,e.toLowerCase(),null,!0,!0)});function wu(e,s,r,a){var h=Ce.hasOwnProperty(s)?Ce[s]:null;(h!==null?h.type!==0:a||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(dy(s,r,h,a)&&(r=null),a||h===null?cy(s)&&(r===null?e.removeAttribute(s):e.setAttribute(s,""+r)):h.mustUseProperty?e[h.propertyName]=r===null?h.type===3?!1:"":r:(s=h.attributeName,a=h.attributeNamespace,r===null?e.removeAttribute(s):(h=h.type,r=h===3||h===4&&r===!0?"":""+r,a?e.setAttributeNS(a,s,r):e.setAttribute(s,r))))}var rs=ly.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Jo=Symbol.for("react.element"),Fn=Symbol.for("react.portal"),Bn=Symbol.for("react.fragment"),xu=Symbol.for("react.strict_mode"),wc=Symbol.for("react.profiler"),Lg=Symbol.for("react.provider"),zg=Symbol.for("react.context"),Cu=Symbol.for("react.forward_ref"),xc=Symbol.for("react.suspense"),Cc=Symbol.for("react.suspense_list"),bu=Symbol.for("react.memo"),ds=Symbol.for("react.lazy"),Og=Symbol.for("react.offscreen"),ep=Symbol.iterator;function Pr(e){return e===null||typeof e!="object"?null:(e=ep&&e[ep]||e["@@iterator"],typeof e=="function"?e:null)}var Vt=Object.assign,Oh;function zr(e){if(Oh===void 0)try{throw Error()}catch(r){var s=r.stack.trim().match(/\n( *(at )?)/);Oh=s&&s[1]||""}return`
`+Oh+e}var Uh=!1;function Nh(e,s){if(!e||Uh)return"";Uh=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(y){var a=y}Reflect.construct(e,[],s)}else{try{s.call()}catch(y){a=y}e.call(s.prototype)}else{try{throw Error()}catch(y){a=y}e()}}catch(y){if(y&&a&&typeof y.stack=="string"){for(var h=y.stack.split(`
`),u=a.stack.split(`
`),p=h.length-1,m=u.length-1;1<=p&&0<=m&&h[p]!==u[m];)m--;for(;1<=p&&0<=m;p--,m--)if(h[p]!==u[m]){if(p!==1||m!==1)do if(p--,m--,0>m||h[p]!==u[m]){var _=`
`+h[p].replace(" at new "," at ");return e.displayName&&_.includes("<anonymous>")&&(_=_.replace("<anonymous>",e.displayName)),_}while(1<=p&&0<=m);break}}}finally{Uh=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?zr(e):""}function fy(e){switch(e.tag){case 5:return zr(e.type);case 16:return zr("Lazy");case 13:return zr("Suspense");case 19:return zr("SuspenseList");case 0:case 2:case 15:return e=Nh(e.type,!1),e;case 11:return e=Nh(e.type.render,!1),e;case 1:return e=Nh(e.type,!0),e;default:return""}}function bc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Bn:return"Fragment";case Fn:return"Portal";case wc:return"Profiler";case xu:return"StrictMode";case xc:return"Suspense";case Cc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case zg:return(e.displayName||"Context")+".Consumer";case Lg:return(e._context.displayName||"Context")+".Provider";case Cu:var s=e.render;return e=e.displayName,e||(e=s.displayName||s.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case bu:return s=e.displayName||null,s!==null?s:bc(e.type)||"Memo";case ds:s=e._payload,e=e._init;try{return bc(e(s))}catch{}}return null}function py(e){var s=e.type;switch(e.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=s.render,e=e.displayName||e.name||"",s.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return bc(s);case 8:return s===xu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Es(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ug(e){var s=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function gy(e){var s=Ug(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,s),a=""+e[s];if(!e.hasOwnProperty(s)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var h=r.get,u=r.set;return Object.defineProperty(e,s,{configurable:!0,get:function(){return h.call(this)},set:function(p){a=""+p,u.call(this,p)}}),Object.defineProperty(e,s,{enumerable:r.enumerable}),{getValue:function(){return a},setValue:function(p){a=""+p},stopTracking:function(){e._valueTracker=null,delete e[s]}}}}function ta(e){e._valueTracker||(e._valueTracker=gy(e))}function Ng(e){if(!e)return!1;var s=e._valueTracker;if(!s)return!0;var r=s.getValue(),a="";return e&&(a=Ug(e)?e.checked?"true":"false":e.value),e=a,e!==r?(s.setValue(e),!0):!1}function Ra(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ac(e,s){var r=s.checked;return Vt({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function ip(e,s){var r=s.defaultValue==null?"":s.defaultValue,a=s.checked!=null?s.checked:s.defaultChecked;r=Es(s.value!=null?s.value:r),e._wrapperState={initialChecked:a,initialValue:r,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function Hg(e,s){s=s.checked,s!=null&&wu(e,"checked",s,!1)}function Sc(e,s){Hg(e,s);var r=Es(s.value),a=s.type;if(r!=null)a==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}s.hasOwnProperty("value")?Ec(e,s.type,r):s.hasOwnProperty("defaultValue")&&Ec(e,s.type,Es(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(e.defaultChecked=!!s.defaultChecked)}function sp(e,s,r){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var a=s.type;if(!(a!=="submit"&&a!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+e._wrapperState.initialValue,r||s===e.value||(e.value=s),e.defaultValue=s}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Ec(e,s,r){(s!=="number"||Ra(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Or=Array.isArray;function Vn(e,s,r,a){if(e=e.options,s){s={};for(var h=0;h<r.length;h++)s["$"+r[h]]=!0;for(r=0;r<e.length;r++)h=s.hasOwnProperty("$"+e[r].value),e[r].selected!==h&&(e[r].selected=h),h&&a&&(e[r].defaultSelected=!0)}else{for(r=""+Es(r),s=null,h=0;h<e.length;h++){if(e[h].value===r){e[h].selected=!0,a&&(e[h].defaultSelected=!0);return}s!==null||e[h].disabled||(s=e[h])}s!==null&&(s.selected=!0)}}function Tc(e,s){if(s.dangerouslySetInnerHTML!=null)throw Error(J(91));return Vt({},s,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function np(e,s){var r=s.value;if(r==null){if(r=s.children,s=s.defaultValue,r!=null){if(s!=null)throw Error(J(92));if(Or(r)){if(1<r.length)throw Error(J(93));r=r[0]}s=r}s==null&&(s=""),r=s}e._wrapperState={initialValue:Es(r)}}function Wg(e,s){var r=Es(s.value),a=Es(s.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),s.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),a!=null&&(e.defaultValue=""+a)}function rp(e){var s=e.textContent;s===e._wrapperState.initialValue&&s!==""&&s!==null&&(e.value=s)}function jg(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pc(e,s){return e==null||e==="http://www.w3.org/1999/xhtml"?jg(s):e==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var ea,Gg=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,r,a,h){MSApp.execUnsafeLocalFunction(function(){return e(s,r,a,h)})}:e}(function(e,s){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=s;else{for(ea=ea||document.createElement("div"),ea.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=ea.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;s.firstChild;)e.appendChild(s.firstChild)}});function Kr(e,s){if(s){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=s;return}}e.textContent=s}var Hr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},my=["Webkit","ms","Moz","O"];Object.keys(Hr).forEach(function(e){my.forEach(function(s){s=s+e.charAt(0).toUpperCase()+e.substring(1),Hr[s]=Hr[e]})});function Vg(e,s,r){return s==null||typeof s=="boolean"||s===""?"":r||typeof s!="number"||s===0||Hr.hasOwnProperty(e)&&Hr[e]?(""+s).trim():s+"px"}function Xg(e,s){e=e.style;for(var r in s)if(s.hasOwnProperty(r)){var a=r.indexOf("--")===0,h=Vg(r,s[r],a);r==="float"&&(r="cssFloat"),a?e.setProperty(r,h):e[r]=h}}var _y=Vt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ic(e,s){if(s){if(_y[e]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(J(137,e));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(J(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(J(61))}if(s.style!=null&&typeof s.style!="object")throw Error(J(62))}}function Rc(e,s){if(e.indexOf("-")===-1)return typeof s.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dc=null;function Au(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var kc=null,Xn=null,$n=null;function op(e){if(e=vo(e)){if(typeof kc!="function")throw Error(J(280));var s=e.stateNode;s&&(s=hl(s),kc(e.stateNode,e.type,s))}}function $g(e){Xn?$n?$n.push(e):$n=[e]:Xn=e}function Yg(){if(Xn){var e=Xn,s=$n;if($n=Xn=null,op(e),s)for(e=0;e<s.length;e++)op(s[e])}}function Qg(e,s){return e(s)}function Zg(){}var Hh=!1;function qg(e,s,r){if(Hh)return e(s,r);Hh=!0;try{return Qg(e,s,r)}finally{Hh=!1,(Xn!==null||$n!==null)&&(Zg(),Yg())}}function Jr(e,s){var r=e.stateNode;if(r===null)return null;var a=hl(r);if(a===null)return null;r=a[s];t:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break t;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(J(231,s,typeof r));return r}var Fc=!1;if(es)try{var Ir={};Object.defineProperty(Ir,"passive",{get:function(){Fc=!0}}),window.addEventListener("test",Ir,Ir),window.removeEventListener("test",Ir,Ir)}catch{Fc=!1}function vy(e,s,r,a,h,u,p,m,_){var y=Array.prototype.slice.call(arguments,3);try{s.apply(r,y)}catch(A){this.onError(A)}}var Wr=!1,Da=null,ka=!1,Bc=null,yy={onError:function(e){Wr=!0,Da=e}};function wy(e,s,r,a,h,u,p,m,_){Wr=!1,Da=null,vy.apply(yy,arguments)}function xy(e,s,r,a,h,u,p,m,_){if(wy.apply(this,arguments),Wr){if(Wr){var y=Da;Wr=!1,Da=null}else throw Error(J(198));ka||(ka=!0,Bc=y)}}function un(e){var s=e,r=e;if(e.alternate)for(;s.return;)s=s.return;else{e=s;do s=e,s.flags&4098&&(r=s.return),e=s.return;while(e)}return s.tag===3?r:null}function Kg(e){if(e.tag===13){var s=e.memoizedState;if(s===null&&(e=e.alternate,e!==null&&(s=e.memoizedState)),s!==null)return s.dehydrated}return null}function ap(e){if(un(e)!==e)throw Error(J(188))}function Cy(e){var s=e.alternate;if(!s){if(s=un(e),s===null)throw Error(J(188));return s!==e?null:e}for(var r=e,a=s;;){var h=r.return;if(h===null)break;var u=h.alternate;if(u===null){if(a=h.return,a!==null){r=a;continue}break}if(h.child===u.child){for(u=h.child;u;){if(u===r)return ap(h),e;if(u===a)return ap(h),s;u=u.sibling}throw Error(J(188))}if(r.return!==a.return)r=h,a=u;else{for(var p=!1,m=h.child;m;){if(m===r){p=!0,r=h,a=u;break}if(m===a){p=!0,a=h,r=u;break}m=m.sibling}if(!p){for(m=u.child;m;){if(m===r){p=!0,r=u,a=h;break}if(m===a){p=!0,a=u,r=h;break}m=m.sibling}if(!p)throw Error(J(189))}}if(r.alternate!==a)throw Error(J(190))}if(r.tag!==3)throw Error(J(188));return r.stateNode.current===r?e:s}function Jg(e){return e=Cy(e),e!==null?tm(e):null}function tm(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var s=tm(e);if(s!==null)return s;e=e.sibling}return null}var em=ai.unstable_scheduleCallback,lp=ai.unstable_cancelCallback,by=ai.unstable_shouldYield,Ay=ai.unstable_requestPaint,qt=ai.unstable_now,Sy=ai.unstable_getCurrentPriorityLevel,Su=ai.unstable_ImmediatePriority,im=ai.unstable_UserBlockingPriority,Fa=ai.unstable_NormalPriority,Ey=ai.unstable_LowPriority,sm=ai.unstable_IdlePriority,rl=null,Hi=null;function Ty(e){if(Hi&&typeof Hi.onCommitFiberRoot=="function")try{Hi.onCommitFiberRoot(rl,e,void 0,(e.current.flags&128)===128)}catch{}}var Ei=Math.clz32?Math.clz32:Ry,Py=Math.log,Iy=Math.LN2;function Ry(e){return e>>>=0,e===0?32:31-(Py(e)/Iy|0)|0}var ia=64,sa=4194304;function Ur(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ba(e,s){var r=e.pendingLanes;if(r===0)return 0;var a=0,h=e.suspendedLanes,u=e.pingedLanes,p=r&268435455;if(p!==0){var m=p&~h;m!==0?a=Ur(m):(u&=p,u!==0&&(a=Ur(u)))}else p=r&~h,p!==0?a=Ur(p):u!==0&&(a=Ur(u));if(a===0)return 0;if(s!==0&&s!==a&&!(s&h)&&(h=a&-a,u=s&-s,h>=u||h===16&&(u&4194240)!==0))return s;if(a&4&&(a|=r&16),s=e.entangledLanes,s!==0)for(e=e.entanglements,s&=a;0<s;)r=31-Ei(s),h=1<<r,a|=e[r],s&=~h;return a}function Dy(e,s){switch(e){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ky(e,s){for(var r=e.suspendedLanes,a=e.pingedLanes,h=e.expirationTimes,u=e.pendingLanes;0<u;){var p=31-Ei(u),m=1<<p,_=h[p];_===-1?(!(m&r)||m&a)&&(h[p]=Dy(m,s)):_<=s&&(e.expiredLanes|=m),u&=~m}}function Mc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function nm(){var e=ia;return ia<<=1,!(ia&4194240)&&(ia=64),e}function Wh(e){for(var s=[],r=0;31>r;r++)s.push(e);return s}function mo(e,s,r){e.pendingLanes|=s,s!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,s=31-Ei(s),e[s]=r}function Fy(e,s){var r=e.pendingLanes&~s;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=s,e.mutableReadLanes&=s,e.entangledLanes&=s,s=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<r;){var h=31-Ei(r),u=1<<h;s[h]=0,a[h]=-1,e[h]=-1,r&=~u}}function Eu(e,s){var r=e.entangledLanes|=s;for(e=e.entanglements;r;){var a=31-Ei(r),h=1<<a;h&s|e[a]&s&&(e[a]|=s),r&=~h}}var Rt=0;function rm(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var om,Tu,am,lm,hm,Lc=!1,na=[],vs=null,ys=null,ws=null,to=new Map,eo=new Map,ps=[],By="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hp(e,s){switch(e){case"focusin":case"focusout":vs=null;break;case"dragenter":case"dragleave":ys=null;break;case"mouseover":case"mouseout":ws=null;break;case"pointerover":case"pointerout":to.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":eo.delete(s.pointerId)}}function Rr(e,s,r,a,h,u){return e===null||e.nativeEvent!==u?(e={blockedOn:s,domEventName:r,eventSystemFlags:a,nativeEvent:u,targetContainers:[h]},s!==null&&(s=vo(s),s!==null&&Tu(s)),e):(e.eventSystemFlags|=a,s=e.targetContainers,h!==null&&s.indexOf(h)===-1&&s.push(h),e)}function My(e,s,r,a,h){switch(s){case"focusin":return vs=Rr(vs,e,s,r,a,h),!0;case"dragenter":return ys=Rr(ys,e,s,r,a,h),!0;case"mouseover":return ws=Rr(ws,e,s,r,a,h),!0;case"pointerover":var u=h.pointerId;return to.set(u,Rr(to.get(u)||null,e,s,r,a,h)),!0;case"gotpointercapture":return u=h.pointerId,eo.set(u,Rr(eo.get(u)||null,e,s,r,a,h)),!0}return!1}function cm(e){var s=Js(e.target);if(s!==null){var r=un(s);if(r!==null){if(s=r.tag,s===13){if(s=Kg(r),s!==null){e.blockedOn=s,hm(e.priority,function(){am(r)});return}}else if(s===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ya(e){if(e.blockedOn!==null)return!1;for(var s=e.targetContainers;0<s.length;){var r=zc(e.domEventName,e.eventSystemFlags,s[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var a=new r.constructor(r.type,r);Dc=a,r.target.dispatchEvent(a),Dc=null}else return s=vo(r),s!==null&&Tu(s),e.blockedOn=r,!1;s.shift()}return!0}function cp(e,s,r){ya(e)&&r.delete(s)}function Ly(){Lc=!1,vs!==null&&ya(vs)&&(vs=null),ys!==null&&ya(ys)&&(ys=null),ws!==null&&ya(ws)&&(ws=null),to.forEach(cp),eo.forEach(cp)}function Dr(e,s){e.blockedOn===s&&(e.blockedOn=null,Lc||(Lc=!0,ai.unstable_scheduleCallback(ai.unstable_NormalPriority,Ly)))}function io(e){function s(h){return Dr(h,e)}if(0<na.length){Dr(na[0],e);for(var r=1;r<na.length;r++){var a=na[r];a.blockedOn===e&&(a.blockedOn=null)}}for(vs!==null&&Dr(vs,e),ys!==null&&Dr(ys,e),ws!==null&&Dr(ws,e),to.forEach(s),eo.forEach(s),r=0;r<ps.length;r++)a=ps[r],a.blockedOn===e&&(a.blockedOn=null);for(;0<ps.length&&(r=ps[0],r.blockedOn===null);)cm(r),r.blockedOn===null&&ps.shift()}var Yn=rs.ReactCurrentBatchConfig,Ma=!0;function zy(e,s,r,a){var h=Rt,u=Yn.transition;Yn.transition=null;try{Rt=1,Pu(e,s,r,a)}finally{Rt=h,Yn.transition=u}}function Oy(e,s,r,a){var h=Rt,u=Yn.transition;Yn.transition=null;try{Rt=4,Pu(e,s,r,a)}finally{Rt=h,Yn.transition=u}}function Pu(e,s,r,a){if(Ma){var h=zc(e,s,r,a);if(h===null)Kh(e,s,a,La,r),hp(e,a);else if(My(h,e,s,r,a))a.stopPropagation();else if(hp(e,a),s&4&&-1<By.indexOf(e)){for(;h!==null;){var u=vo(h);if(u!==null&&om(u),u=zc(e,s,r,a),u===null&&Kh(e,s,a,La,r),u===h)break;h=u}h!==null&&a.stopPropagation()}else Kh(e,s,a,null,r)}}var La=null;function zc(e,s,r,a){if(La=null,e=Au(a),e=Js(e),e!==null)if(s=un(e),s===null)e=null;else if(r=s.tag,r===13){if(e=Kg(s),e!==null)return e;e=null}else if(r===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;e=null}else s!==e&&(e=null);return La=e,null}function um(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Sy()){case Su:return 1;case im:return 4;case Fa:case Ey:return 16;case sm:return 536870912;default:return 16}default:return 16}}var ms=null,Iu=null,wa=null;function dm(){if(wa)return wa;var e,s=Iu,r=s.length,a,h="value"in ms?ms.value:ms.textContent,u=h.length;for(e=0;e<r&&s[e]===h[e];e++);var p=r-e;for(a=1;a<=p&&s[r-a]===h[u-a];a++);return wa=h.slice(e,1<a?1-a:void 0)}function xa(e){var s=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&s===13&&(e=13)):e=s,e===10&&(e=13),32<=e||e===13?e:0}function ra(){return!0}function up(){return!1}function hi(e){function s(r,a,h,u,p){this._reactName=r,this._targetInst=h,this.type=a,this.nativeEvent=u,this.target=p,this.currentTarget=null;for(var m in e)e.hasOwnProperty(m)&&(r=e[m],this[m]=r?r(u):u[m]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?ra:up,this.isPropagationStopped=up,this}return Vt(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=ra)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=ra)},persist:function(){},isPersistent:ra}),s}var ar={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ru=hi(ar),_o=Vt({},ar,{view:0,detail:0}),Uy=hi(_o),jh,Gh,kr,ol=Vt({},_o,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Du,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==kr&&(kr&&e.type==="mousemove"?(jh=e.screenX-kr.screenX,Gh=e.screenY-kr.screenY):Gh=jh=0,kr=e),jh)},movementY:function(e){return"movementY"in e?e.movementY:Gh}}),dp=hi(ol),Ny=Vt({},ol,{dataTransfer:0}),Hy=hi(Ny),Wy=Vt({},_o,{relatedTarget:0}),Vh=hi(Wy),jy=Vt({},ar,{animationName:0,elapsedTime:0,pseudoElement:0}),Gy=hi(jy),Vy=Vt({},ar,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Xy=hi(Vy),$y=Vt({},ar,{data:0}),fp=hi($y),Yy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qy(e){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(e):(e=Zy[e])?!!s[e]:!1}function Du(){return qy}var Ky=Vt({},_o,{key:function(e){if(e.key){var s=Yy[e.key]||e.key;if(s!=="Unidentified")return s}return e.type==="keypress"?(e=xa(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Qy[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Du,charCode:function(e){return e.type==="keypress"?xa(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?xa(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Jy=hi(Ky),tw=Vt({},ol,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pp=hi(tw),ew=Vt({},_o,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Du}),iw=hi(ew),sw=Vt({},ar,{propertyName:0,elapsedTime:0,pseudoElement:0}),nw=hi(sw),rw=Vt({},ol,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ow=hi(rw),aw=[9,13,27,32],ku=es&&"CompositionEvent"in window,jr=null;es&&"documentMode"in document&&(jr=document.documentMode);var lw=es&&"TextEvent"in window&&!jr,fm=es&&(!ku||jr&&8<jr&&11>=jr),gp=" ",mp=!1;function pm(e,s){switch(e){case"keyup":return aw.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Mn=!1;function hw(e,s){switch(e){case"compositionend":return gm(s);case"keypress":return s.which!==32?null:(mp=!0,gp);case"textInput":return e=s.data,e===gp&&mp?null:e;default:return null}}function cw(e,s){if(Mn)return e==="compositionend"||!ku&&pm(e,s)?(e=dm(),wa=Iu=ms=null,Mn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return fm&&s.locale!=="ko"?null:s.data;default:return null}}var uw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _p(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s==="input"?!!uw[e.type]:s==="textarea"}function mm(e,s,r,a){$g(a),s=za(s,"onChange"),0<s.length&&(r=new Ru("onChange","change",null,r,a),e.push({event:r,listeners:s}))}var Gr=null,so=null;function dw(e){Tm(e,0)}function al(e){var s=On(e);if(Ng(s))return e}function fw(e,s){if(e==="change")return s}var _m=!1;if(es){var Xh;if(es){var $h="oninput"in document;if(!$h){var vp=document.createElement("div");vp.setAttribute("oninput","return;"),$h=typeof vp.oninput=="function"}Xh=$h}else Xh=!1;_m=Xh&&(!document.documentMode||9<document.documentMode)}function yp(){Gr&&(Gr.detachEvent("onpropertychange",vm),so=Gr=null)}function vm(e){if(e.propertyName==="value"&&al(so)){var s=[];mm(s,so,e,Au(e)),qg(dw,s)}}function pw(e,s,r){e==="focusin"?(yp(),Gr=s,so=r,Gr.attachEvent("onpropertychange",vm)):e==="focusout"&&yp()}function gw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return al(so)}function mw(e,s){if(e==="click")return al(s)}function _w(e,s){if(e==="input"||e==="change")return al(s)}function vw(e,s){return e===s&&(e!==0||1/e===1/s)||e!==e&&s!==s}var Pi=typeof Object.is=="function"?Object.is:vw;function no(e,s){if(Pi(e,s))return!0;if(typeof e!="object"||e===null||typeof s!="object"||s===null)return!1;var r=Object.keys(e),a=Object.keys(s);if(r.length!==a.length)return!1;for(a=0;a<r.length;a++){var h=r[a];if(!yc.call(s,h)||!Pi(e[h],s[h]))return!1}return!0}function wp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function xp(e,s){var r=wp(e);e=0;for(var a;r;){if(r.nodeType===3){if(a=e+r.textContent.length,e<=s&&a>=s)return{node:r,offset:s-e};e=a}t:{for(;r;){if(r.nextSibling){r=r.nextSibling;break t}r=r.parentNode}r=void 0}r=wp(r)}}function ym(e,s){return e&&s?e===s?!0:e&&e.nodeType===3?!1:s&&s.nodeType===3?ym(e,s.parentNode):"contains"in e?e.contains(s):e.compareDocumentPosition?!!(e.compareDocumentPosition(s)&16):!1:!1}function wm(){for(var e=window,s=Ra();s instanceof e.HTMLIFrameElement;){try{var r=typeof s.contentWindow.location.href=="string"}catch{r=!1}if(r)e=s.contentWindow;else break;s=Ra(e.document)}return s}function Fu(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s&&(s==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||s==="textarea"||e.contentEditable==="true")}function yw(e){var s=wm(),r=e.focusedElem,a=e.selectionRange;if(s!==r&&r&&r.ownerDocument&&ym(r.ownerDocument.documentElement,r)){if(a!==null&&Fu(r)){if(s=a.start,e=a.end,e===void 0&&(e=s),"selectionStart"in r)r.selectionStart=s,r.selectionEnd=Math.min(e,r.value.length);else if(e=(s=r.ownerDocument||document)&&s.defaultView||window,e.getSelection){e=e.getSelection();var h=r.textContent.length,u=Math.min(a.start,h);a=a.end===void 0?u:Math.min(a.end,h),!e.extend&&u>a&&(h=a,a=u,u=h),h=xp(r,u);var p=xp(r,a);h&&p&&(e.rangeCount!==1||e.anchorNode!==h.node||e.anchorOffset!==h.offset||e.focusNode!==p.node||e.focusOffset!==p.offset)&&(s=s.createRange(),s.setStart(h.node,h.offset),e.removeAllRanges(),u>a?(e.addRange(s),e.extend(p.node,p.offset)):(s.setEnd(p.node,p.offset),e.addRange(s)))}}for(s=[],e=r;e=e.parentNode;)e.nodeType===1&&s.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<s.length;r++)e=s[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ww=es&&"documentMode"in document&&11>=document.documentMode,Ln=null,Oc=null,Vr=null,Uc=!1;function Cp(e,s,r){var a=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Uc||Ln==null||Ln!==Ra(a)||(a=Ln,"selectionStart"in a&&Fu(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Vr&&no(Vr,a)||(Vr=a,a=za(Oc,"onSelect"),0<a.length&&(s=new Ru("onSelect","select",null,s,r),e.push({event:s,listeners:a}),s.target=Ln)))}function oa(e,s){var r={};return r[e.toLowerCase()]=s.toLowerCase(),r["Webkit"+e]="webkit"+s,r["Moz"+e]="moz"+s,r}var zn={animationend:oa("Animation","AnimationEnd"),animationiteration:oa("Animation","AnimationIteration"),animationstart:oa("Animation","AnimationStart"),transitionend:oa("Transition","TransitionEnd")},Yh={},xm={};es&&(xm=document.createElement("div").style,"AnimationEvent"in window||(delete zn.animationend.animation,delete zn.animationiteration.animation,delete zn.animationstart.animation),"TransitionEvent"in window||delete zn.transitionend.transition);function ll(e){if(Yh[e])return Yh[e];if(!zn[e])return e;var s=zn[e],r;for(r in s)if(s.hasOwnProperty(r)&&r in xm)return Yh[e]=s[r];return e}var Cm=ll("animationend"),bm=ll("animationiteration"),Am=ll("animationstart"),Sm=ll("transitionend"),Em=new Map,bp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ps(e,s){Em.set(e,s),cn(s,[e])}for(var Qh=0;Qh<bp.length;Qh++){var Zh=bp[Qh],xw=Zh.toLowerCase(),Cw=Zh[0].toUpperCase()+Zh.slice(1);Ps(xw,"on"+Cw)}Ps(Cm,"onAnimationEnd");Ps(bm,"onAnimationIteration");Ps(Am,"onAnimationStart");Ps("dblclick","onDoubleClick");Ps("focusin","onFocus");Ps("focusout","onBlur");Ps(Sm,"onTransitionEnd");qn("onMouseEnter",["mouseout","mouseover"]);qn("onMouseLeave",["mouseout","mouseover"]);qn("onPointerEnter",["pointerout","pointerover"]);qn("onPointerLeave",["pointerout","pointerover"]);cn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));cn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));cn("onBeforeInput",["compositionend","keypress","textInput","paste"]);cn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));cn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));cn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bw=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nr));function Ap(e,s,r){var a=e.type||"unknown-event";e.currentTarget=r,xy(a,s,void 0,e),e.currentTarget=null}function Tm(e,s){s=(s&4)!==0;for(var r=0;r<e.length;r++){var a=e[r],h=a.event;a=a.listeners;t:{var u=void 0;if(s)for(var p=a.length-1;0<=p;p--){var m=a[p],_=m.instance,y=m.currentTarget;if(m=m.listener,_!==u&&h.isPropagationStopped())break t;Ap(h,m,y),u=_}else for(p=0;p<a.length;p++){if(m=a[p],_=m.instance,y=m.currentTarget,m=m.listener,_!==u&&h.isPropagationStopped())break t;Ap(h,m,y),u=_}}}if(ka)throw e=Bc,ka=!1,Bc=null,e}function Ft(e,s){var r=s[Gc];r===void 0&&(r=s[Gc]=new Set);var a=e+"__bubble";r.has(a)||(Pm(s,e,2,!1),r.add(a))}function qh(e,s,r){var a=0;s&&(a|=4),Pm(r,e,a,s)}var aa="_reactListening"+Math.random().toString(36).slice(2);function ro(e){if(!e[aa]){e[aa]=!0,Mg.forEach(function(r){r!=="selectionchange"&&(bw.has(r)||qh(r,!1,e),qh(r,!0,e))});var s=e.nodeType===9?e:e.ownerDocument;s===null||s[aa]||(s[aa]=!0,qh("selectionchange",!1,s))}}function Pm(e,s,r,a){switch(um(s)){case 1:var h=zy;break;case 4:h=Oy;break;default:h=Pu}r=h.bind(null,s,r,e),h=void 0,!Fc||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(h=!0),a?h!==void 0?e.addEventListener(s,r,{capture:!0,passive:h}):e.addEventListener(s,r,!0):h!==void 0?e.addEventListener(s,r,{passive:h}):e.addEventListener(s,r,!1)}function Kh(e,s,r,a,h){var u=a;if(!(s&1)&&!(s&2)&&a!==null)t:for(;;){if(a===null)return;var p=a.tag;if(p===3||p===4){var m=a.stateNode.containerInfo;if(m===h||m.nodeType===8&&m.parentNode===h)break;if(p===4)for(p=a.return;p!==null;){var _=p.tag;if((_===3||_===4)&&(_=p.stateNode.containerInfo,_===h||_.nodeType===8&&_.parentNode===h))return;p=p.return}for(;m!==null;){if(p=Js(m),p===null)return;if(_=p.tag,_===5||_===6){a=u=p;continue t}m=m.parentNode}}a=a.return}qg(function(){var y=u,A=Au(r),E=[];t:{var S=Em.get(e);if(S!==void 0){var R=Ru,M=e;switch(e){case"keypress":if(xa(r)===0)break t;case"keydown":case"keyup":R=Jy;break;case"focusin":M="focus",R=Vh;break;case"focusout":M="blur",R=Vh;break;case"beforeblur":case"afterblur":R=Vh;break;case"click":if(r.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":R=dp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":R=Hy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":R=iw;break;case Cm:case bm:case Am:R=Gy;break;case Sm:R=nw;break;case"scroll":R=Uy;break;case"wheel":R=ow;break;case"copy":case"cut":case"paste":R=Xy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":R=pp}var U=(s&4)!==0,$=!U&&e==="scroll",I=U?S!==null?S+"Capture":null:S;U=[];for(var P=y,F;P!==null;){F=P;var j=F.stateNode;if(F.tag===5&&j!==null&&(F=j,I!==null&&(j=Jr(P,I),j!=null&&U.push(oo(P,j,F)))),$)break;P=P.return}0<U.length&&(S=new R(S,M,null,r,A),E.push({event:S,listeners:U}))}}if(!(s&7)){t:{if(S=e==="mouseover"||e==="pointerover",R=e==="mouseout"||e==="pointerout",S&&r!==Dc&&(M=r.relatedTarget||r.fromElement)&&(Js(M)||M[is]))break t;if((R||S)&&(S=A.window===A?A:(S=A.ownerDocument)?S.defaultView||S.parentWindow:window,R?(M=r.relatedTarget||r.toElement,R=y,M=M?Js(M):null,M!==null&&($=un(M),M!==$||M.tag!==5&&M.tag!==6)&&(M=null)):(R=null,M=y),R!==M)){if(U=dp,j="onMouseLeave",I="onMouseEnter",P="mouse",(e==="pointerout"||e==="pointerover")&&(U=pp,j="onPointerLeave",I="onPointerEnter",P="pointer"),$=R==null?S:On(R),F=M==null?S:On(M),S=new U(j,P+"leave",R,r,A),S.target=$,S.relatedTarget=F,j=null,Js(A)===y&&(U=new U(I,P+"enter",M,r,A),U.target=F,U.relatedTarget=$,j=U),$=j,R&&M)e:{for(U=R,I=M,P=0,F=U;F;F=kn(F))P++;for(F=0,j=I;j;j=kn(j))F++;for(;0<P-F;)U=kn(U),P--;for(;0<F-P;)I=kn(I),F--;for(;P--;){if(U===I||I!==null&&U===I.alternate)break e;U=kn(U),I=kn(I)}U=null}else U=null;R!==null&&Sp(E,S,R,U,!1),M!==null&&$!==null&&Sp(E,$,M,U,!0)}}t:{if(S=y?On(y):window,R=S.nodeName&&S.nodeName.toLowerCase(),R==="select"||R==="input"&&S.type==="file")var W=fw;else if(_p(S))if(_m)W=_w;else{W=gw;var Y=pw}else(R=S.nodeName)&&R.toLowerCase()==="input"&&(S.type==="checkbox"||S.type==="radio")&&(W=mw);if(W&&(W=W(e,y))){mm(E,W,r,A);break t}Y&&Y(e,S,y),e==="focusout"&&(Y=S._wrapperState)&&Y.controlled&&S.type==="number"&&Ec(S,"number",S.value)}switch(Y=y?On(y):window,e){case"focusin":(_p(Y)||Y.contentEditable==="true")&&(Ln=Y,Oc=y,Vr=null);break;case"focusout":Vr=Oc=Ln=null;break;case"mousedown":Uc=!0;break;case"contextmenu":case"mouseup":case"dragend":Uc=!1,Cp(E,r,A);break;case"selectionchange":if(ww)break;case"keydown":case"keyup":Cp(E,r,A)}var C;if(ku)t:{switch(e){case"compositionstart":var D="onCompositionStart";break t;case"compositionend":D="onCompositionEnd";break t;case"compositionupdate":D="onCompositionUpdate";break t}D=void 0}else Mn?pm(e,r)&&(D="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(D="onCompositionStart");D&&(fm&&r.locale!=="ko"&&(Mn||D!=="onCompositionStart"?D==="onCompositionEnd"&&Mn&&(C=dm()):(ms=A,Iu="value"in ms?ms.value:ms.textContent,Mn=!0)),Y=za(y,D),0<Y.length&&(D=new fp(D,e,null,r,A),E.push({event:D,listeners:Y}),C?D.data=C:(C=gm(r),C!==null&&(D.data=C)))),(C=lw?hw(e,r):cw(e,r))&&(y=za(y,"onBeforeInput"),0<y.length&&(A=new fp("onBeforeInput","beforeinput",null,r,A),E.push({event:A,listeners:y}),A.data=C))}Tm(E,s)})}function oo(e,s,r){return{instance:e,listener:s,currentTarget:r}}function za(e,s){for(var r=s+"Capture",a=[];e!==null;){var h=e,u=h.stateNode;h.tag===5&&u!==null&&(h=u,u=Jr(e,r),u!=null&&a.unshift(oo(e,u,h)),u=Jr(e,s),u!=null&&a.push(oo(e,u,h))),e=e.return}return a}function kn(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Sp(e,s,r,a,h){for(var u=s._reactName,p=[];r!==null&&r!==a;){var m=r,_=m.alternate,y=m.stateNode;if(_!==null&&_===a)break;m.tag===5&&y!==null&&(m=y,h?(_=Jr(r,u),_!=null&&p.unshift(oo(r,_,m))):h||(_=Jr(r,u),_!=null&&p.push(oo(r,_,m)))),r=r.return}p.length!==0&&e.push({event:s,listeners:p})}var Aw=/\r\n?/g,Sw=/\u0000|\uFFFD/g;function Ep(e){return(typeof e=="string"?e:""+e).replace(Aw,`
`).replace(Sw,"")}function la(e,s,r){if(s=Ep(s),Ep(e)!==s&&r)throw Error(J(425))}function Oa(){}var Nc=null,Hc=null;function Wc(e,s){return e==="textarea"||e==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var jc=typeof setTimeout=="function"?setTimeout:void 0,Ew=typeof clearTimeout=="function"?clearTimeout:void 0,Tp=typeof Promise=="function"?Promise:void 0,Tw=typeof queueMicrotask=="function"?queueMicrotask:typeof Tp<"u"?function(e){return Tp.resolve(null).then(e).catch(Pw)}:jc;function Pw(e){setTimeout(function(){throw e})}function Jh(e,s){var r=s,a=0;do{var h=r.nextSibling;if(e.removeChild(r),h&&h.nodeType===8)if(r=h.data,r==="/$"){if(a===0){e.removeChild(h),io(s);return}a--}else r!=="$"&&r!=="$?"&&r!=="$!"||a++;r=h}while(r);io(s)}function xs(e){for(;e!=null;e=e.nextSibling){var s=e.nodeType;if(s===1||s===3)break;if(s===8){if(s=e.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return e}function Pp(e){e=e.previousSibling;for(var s=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(s===0)return e;s--}else r==="/$"&&s++}e=e.previousSibling}return null}var lr=Math.random().toString(36).slice(2),Ni="__reactFiber$"+lr,ao="__reactProps$"+lr,is="__reactContainer$"+lr,Gc="__reactEvents$"+lr,Iw="__reactListeners$"+lr,Rw="__reactHandles$"+lr;function Js(e){var s=e[Ni];if(s)return s;for(var r=e.parentNode;r;){if(s=r[is]||r[Ni]){if(r=s.alternate,s.child!==null||r!==null&&r.child!==null)for(e=Pp(e);e!==null;){if(r=e[Ni])return r;e=Pp(e)}return s}e=r,r=e.parentNode}return null}function vo(e){return e=e[Ni]||e[is],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function On(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(J(33))}function hl(e){return e[ao]||null}var Vc=[],Un=-1;function Is(e){return{current:e}}function Bt(e){0>Un||(e.current=Vc[Un],Vc[Un]=null,Un--)}function kt(e,s){Un++,Vc[Un]=e.current,e.current=s}var Ts={},Te=Is(Ts),Qe=Is(!1),rn=Ts;function Kn(e,s){var r=e.type.contextTypes;if(!r)return Ts;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===s)return a.__reactInternalMemoizedMaskedChildContext;var h={},u;for(u in r)h[u]=s[u];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=h),h}function Ze(e){return e=e.childContextTypes,e!=null}function Ua(){Bt(Qe),Bt(Te)}function Ip(e,s,r){if(Te.current!==Ts)throw Error(J(168));kt(Te,s),kt(Qe,r)}function Im(e,s,r){var a=e.stateNode;if(s=s.childContextTypes,typeof a.getChildContext!="function")return r;a=a.getChildContext();for(var h in a)if(!(h in s))throw Error(J(108,py(e)||"Unknown",h));return Vt({},r,a)}function Na(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ts,rn=Te.current,kt(Te,e),kt(Qe,Qe.current),!0}function Rp(e,s,r){var a=e.stateNode;if(!a)throw Error(J(169));r?(e=Im(e,s,rn),a.__reactInternalMemoizedMergedChildContext=e,Bt(Qe),Bt(Te),kt(Te,e)):Bt(Qe),kt(Qe,r)}var qi=null,cl=!1,tc=!1;function Rm(e){qi===null?qi=[e]:qi.push(e)}function Dw(e){cl=!0,Rm(e)}function Rs(){if(!tc&&qi!==null){tc=!0;var e=0,s=Rt;try{var r=qi;for(Rt=1;e<r.length;e++){var a=r[e];do a=a(!0);while(a!==null)}qi=null,cl=!1}catch(h){throw qi!==null&&(qi=qi.slice(e+1)),em(Su,Rs),h}finally{Rt=s,tc=!1}}return null}var Nn=[],Hn=0,Ha=null,Wa=0,fi=[],pi=0,on=null,Ki=1,Ji="";function Zs(e,s){Nn[Hn++]=Wa,Nn[Hn++]=Ha,Ha=e,Wa=s}function Dm(e,s,r){fi[pi++]=Ki,fi[pi++]=Ji,fi[pi++]=on,on=e;var a=Ki;e=Ji;var h=32-Ei(a)-1;a&=~(1<<h),r+=1;var u=32-Ei(s)+h;if(30<u){var p=h-h%5;u=(a&(1<<p)-1).toString(32),a>>=p,h-=p,Ki=1<<32-Ei(s)+h|r<<h|a,Ji=u+e}else Ki=1<<u|r<<h|a,Ji=e}function Bu(e){e.return!==null&&(Zs(e,1),Dm(e,1,0))}function Mu(e){for(;e===Ha;)Ha=Nn[--Hn],Nn[Hn]=null,Wa=Nn[--Hn],Nn[Hn]=null;for(;e===on;)on=fi[--pi],fi[pi]=null,Ji=fi[--pi],fi[pi]=null,Ki=fi[--pi],fi[pi]=null}var oi=null,ni=null,Ut=!1,Si=null;function km(e,s){var r=gi(5,null,null,0);r.elementType="DELETED",r.stateNode=s,r.return=e,s=e.deletions,s===null?(e.deletions=[r],e.flags|=16):s.push(r)}function Dp(e,s){switch(e.tag){case 5:var r=e.type;return s=s.nodeType!==1||r.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(e.stateNode=s,oi=e,ni=xs(s.firstChild),!0):!1;case 6:return s=e.pendingProps===""||s.nodeType!==3?null:s,s!==null?(e.stateNode=s,oi=e,ni=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(r=on!==null?{id:Ki,overflow:Ji}:null,e.memoizedState={dehydrated:s,treeContext:r,retryLane:1073741824},r=gi(18,null,null,0),r.stateNode=s,r.return=e,e.child=r,oi=e,ni=null,!0):!1;default:return!1}}function Xc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function $c(e){if(Ut){var s=ni;if(s){var r=s;if(!Dp(e,s)){if(Xc(e))throw Error(J(418));s=xs(r.nextSibling);var a=oi;s&&Dp(e,s)?km(a,r):(e.flags=e.flags&-4097|2,Ut=!1,oi=e)}}else{if(Xc(e))throw Error(J(418));e.flags=e.flags&-4097|2,Ut=!1,oi=e}}}function kp(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;oi=e}function ha(e){if(e!==oi)return!1;if(!Ut)return kp(e),Ut=!0,!1;var s;if((s=e.tag!==3)&&!(s=e.tag!==5)&&(s=e.type,s=s!=="head"&&s!=="body"&&!Wc(e.type,e.memoizedProps)),s&&(s=ni)){if(Xc(e))throw Fm(),Error(J(418));for(;s;)km(e,s),s=xs(s.nextSibling)}if(kp(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(J(317));t:{for(e=e.nextSibling,s=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(s===0){ni=xs(e.nextSibling);break t}s--}else r!=="$"&&r!=="$!"&&r!=="$?"||s++}e=e.nextSibling}ni=null}}else ni=oi?xs(e.stateNode.nextSibling):null;return!0}function Fm(){for(var e=ni;e;)e=xs(e.nextSibling)}function Jn(){ni=oi=null,Ut=!1}function Lu(e){Si===null?Si=[e]:Si.push(e)}var kw=rs.ReactCurrentBatchConfig;function Fr(e,s,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(J(309));var a=r.stateNode}if(!a)throw Error(J(147,e));var h=a,u=""+e;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===u?s.ref:(s=function(p){var m=h.refs;p===null?delete m[u]:m[u]=p},s._stringRef=u,s)}if(typeof e!="string")throw Error(J(284));if(!r._owner)throw Error(J(290,e))}return e}function ca(e,s){throw e=Object.prototype.toString.call(s),Error(J(31,e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e))}function Fp(e){var s=e._init;return s(e._payload)}function Bm(e){function s(I,P){if(e){var F=I.deletions;F===null?(I.deletions=[P],I.flags|=16):F.push(P)}}function r(I,P){if(!e)return null;for(;P!==null;)s(I,P),P=P.sibling;return null}function a(I,P){for(I=new Map;P!==null;)P.key!==null?I.set(P.key,P):I.set(P.index,P),P=P.sibling;return I}function h(I,P){return I=Ss(I,P),I.index=0,I.sibling=null,I}function u(I,P,F){return I.index=F,e?(F=I.alternate,F!==null?(F=F.index,F<P?(I.flags|=2,P):F):(I.flags|=2,P)):(I.flags|=1048576,P)}function p(I){return e&&I.alternate===null&&(I.flags|=2),I}function m(I,P,F,j){return P===null||P.tag!==6?(P=ac(F,I.mode,j),P.return=I,P):(P=h(P,F),P.return=I,P)}function _(I,P,F,j){var W=F.type;return W===Bn?A(I,P,F.props.children,j,F.key):P!==null&&(P.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===ds&&Fp(W)===P.type)?(j=h(P,F.props),j.ref=Fr(I,P,F),j.return=I,j):(j=Pa(F.type,F.key,F.props,null,I.mode,j),j.ref=Fr(I,P,F),j.return=I,j)}function y(I,P,F,j){return P===null||P.tag!==4||P.stateNode.containerInfo!==F.containerInfo||P.stateNode.implementation!==F.implementation?(P=lc(F,I.mode,j),P.return=I,P):(P=h(P,F.children||[]),P.return=I,P)}function A(I,P,F,j,W){return P===null||P.tag!==7?(P=nn(F,I.mode,j,W),P.return=I,P):(P=h(P,F),P.return=I,P)}function E(I,P,F){if(typeof P=="string"&&P!==""||typeof P=="number")return P=ac(""+P,I.mode,F),P.return=I,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case Jo:return F=Pa(P.type,P.key,P.props,null,I.mode,F),F.ref=Fr(I,null,P),F.return=I,F;case Fn:return P=lc(P,I.mode,F),P.return=I,P;case ds:var j=P._init;return E(I,j(P._payload),F)}if(Or(P)||Pr(P))return P=nn(P,I.mode,F,null),P.return=I,P;ca(I,P)}return null}function S(I,P,F,j){var W=P!==null?P.key:null;if(typeof F=="string"&&F!==""||typeof F=="number")return W!==null?null:m(I,P,""+F,j);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case Jo:return F.key===W?_(I,P,F,j):null;case Fn:return F.key===W?y(I,P,F,j):null;case ds:return W=F._init,S(I,P,W(F._payload),j)}if(Or(F)||Pr(F))return W!==null?null:A(I,P,F,j,null);ca(I,F)}return null}function R(I,P,F,j,W){if(typeof j=="string"&&j!==""||typeof j=="number")return I=I.get(F)||null,m(P,I,""+j,W);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Jo:return I=I.get(j.key===null?F:j.key)||null,_(P,I,j,W);case Fn:return I=I.get(j.key===null?F:j.key)||null,y(P,I,j,W);case ds:var Y=j._init;return R(I,P,F,Y(j._payload),W)}if(Or(j)||Pr(j))return I=I.get(F)||null,A(P,I,j,W,null);ca(P,j)}return null}function M(I,P,F,j){for(var W=null,Y=null,C=P,D=P=0,N=null;C!==null&&D<F.length;D++){C.index>D?(N=C,C=null):N=C.sibling;var it=S(I,C,F[D],j);if(it===null){C===null&&(C=N);break}e&&C&&it.alternate===null&&s(I,C),P=u(it,P,D),Y===null?W=it:Y.sibling=it,Y=it,C=N}if(D===F.length)return r(I,C),Ut&&Zs(I,D),W;if(C===null){for(;D<F.length;D++)C=E(I,F[D],j),C!==null&&(P=u(C,P,D),Y===null?W=C:Y.sibling=C,Y=C);return Ut&&Zs(I,D),W}for(C=a(I,C);D<F.length;D++)N=R(C,I,D,F[D],j),N!==null&&(e&&N.alternate!==null&&C.delete(N.key===null?D:N.key),P=u(N,P,D),Y===null?W=N:Y.sibling=N,Y=N);return e&&C.forEach(function(rt){return s(I,rt)}),Ut&&Zs(I,D),W}function U(I,P,F,j){var W=Pr(F);if(typeof W!="function")throw Error(J(150));if(F=W.call(F),F==null)throw Error(J(151));for(var Y=W=null,C=P,D=P=0,N=null,it=F.next();C!==null&&!it.done;D++,it=F.next()){C.index>D?(N=C,C=null):N=C.sibling;var rt=S(I,C,it.value,j);if(rt===null){C===null&&(C=N);break}e&&C&&rt.alternate===null&&s(I,C),P=u(rt,P,D),Y===null?W=rt:Y.sibling=rt,Y=rt,C=N}if(it.done)return r(I,C),Ut&&Zs(I,D),W;if(C===null){for(;!it.done;D++,it=F.next())it=E(I,it.value,j),it!==null&&(P=u(it,P,D),Y===null?W=it:Y.sibling=it,Y=it);return Ut&&Zs(I,D),W}for(C=a(I,C);!it.done;D++,it=F.next())it=R(C,I,D,it.value,j),it!==null&&(e&&it.alternate!==null&&C.delete(it.key===null?D:it.key),P=u(it,P,D),Y===null?W=it:Y.sibling=it,Y=it);return e&&C.forEach(function(K){return s(I,K)}),Ut&&Zs(I,D),W}function $(I,P,F,j){if(typeof F=="object"&&F!==null&&F.type===Bn&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case Jo:t:{for(var W=F.key,Y=P;Y!==null;){if(Y.key===W){if(W=F.type,W===Bn){if(Y.tag===7){r(I,Y.sibling),P=h(Y,F.props.children),P.return=I,I=P;break t}}else if(Y.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===ds&&Fp(W)===Y.type){r(I,Y.sibling),P=h(Y,F.props),P.ref=Fr(I,Y,F),P.return=I,I=P;break t}r(I,Y);break}else s(I,Y);Y=Y.sibling}F.type===Bn?(P=nn(F.props.children,I.mode,j,F.key),P.return=I,I=P):(j=Pa(F.type,F.key,F.props,null,I.mode,j),j.ref=Fr(I,P,F),j.return=I,I=j)}return p(I);case Fn:t:{for(Y=F.key;P!==null;){if(P.key===Y)if(P.tag===4&&P.stateNode.containerInfo===F.containerInfo&&P.stateNode.implementation===F.implementation){r(I,P.sibling),P=h(P,F.children||[]),P.return=I,I=P;break t}else{r(I,P);break}else s(I,P);P=P.sibling}P=lc(F,I.mode,j),P.return=I,I=P}return p(I);case ds:return Y=F._init,$(I,P,Y(F._payload),j)}if(Or(F))return M(I,P,F,j);if(Pr(F))return U(I,P,F,j);ca(I,F)}return typeof F=="string"&&F!==""||typeof F=="number"?(F=""+F,P!==null&&P.tag===6?(r(I,P.sibling),P=h(P,F),P.return=I,I=P):(r(I,P),P=ac(F,I.mode,j),P.return=I,I=P),p(I)):r(I,P)}return $}var tr=Bm(!0),Mm=Bm(!1),ja=Is(null),Ga=null,Wn=null,zu=null;function Ou(){zu=Wn=Ga=null}function Uu(e){var s=ja.current;Bt(ja),e._currentValue=s}function Yc(e,s,r){for(;e!==null;){var a=e.alternate;if((e.childLanes&s)!==s?(e.childLanes|=s,a!==null&&(a.childLanes|=s)):a!==null&&(a.childLanes&s)!==s&&(a.childLanes|=s),e===r)break;e=e.return}}function Qn(e,s){Ga=e,zu=Wn=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&s&&(Ye=!0),e.firstContext=null)}function _i(e){var s=e._currentValue;if(zu!==e)if(e={context:e,memoizedValue:s,next:null},Wn===null){if(Ga===null)throw Error(J(308));Wn=e,Ga.dependencies={lanes:0,firstContext:e}}else Wn=Wn.next=e;return s}var tn=null;function Nu(e){tn===null?tn=[e]:tn.push(e)}function Lm(e,s,r,a){var h=s.interleaved;return h===null?(r.next=r,Nu(s)):(r.next=h.next,h.next=r),s.interleaved=r,ss(e,a)}function ss(e,s){e.lanes|=s;var r=e.alternate;for(r!==null&&(r.lanes|=s),r=e,e=e.return;e!==null;)e.childLanes|=s,r=e.alternate,r!==null&&(r.childLanes|=s),r=e,e=e.return;return r.tag===3?r.stateNode:null}var fs=!1;function Hu(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zm(e,s){e=e.updateQueue,s.updateQueue===e&&(s.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ts(e,s){return{eventTime:e,lane:s,tag:0,payload:null,callback:null,next:null}}function Cs(e,s,r){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,Et&2){var h=a.pending;return h===null?s.next=s:(s.next=h.next,h.next=s),a.pending=s,ss(e,r)}return h=a.interleaved,h===null?(s.next=s,Nu(a)):(s.next=h.next,h.next=s),a.interleaved=s,ss(e,r)}function Ca(e,s,r){if(s=s.updateQueue,s!==null&&(s=s.shared,(r&4194240)!==0)){var a=s.lanes;a&=e.pendingLanes,r|=a,s.lanes=r,Eu(e,r)}}function Bp(e,s){var r=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,r===a)){var h=null,u=null;if(r=r.firstBaseUpdate,r!==null){do{var p={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};u===null?h=u=p:u=u.next=p,r=r.next}while(r!==null);u===null?h=u=s:u=u.next=s}else h=u=s;r={baseState:a.baseState,firstBaseUpdate:h,lastBaseUpdate:u,shared:a.shared,effects:a.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=s:e.next=s,r.lastBaseUpdate=s}function Va(e,s,r,a){var h=e.updateQueue;fs=!1;var u=h.firstBaseUpdate,p=h.lastBaseUpdate,m=h.shared.pending;if(m!==null){h.shared.pending=null;var _=m,y=_.next;_.next=null,p===null?u=y:p.next=y,p=_;var A=e.alternate;A!==null&&(A=A.updateQueue,m=A.lastBaseUpdate,m!==p&&(m===null?A.firstBaseUpdate=y:m.next=y,A.lastBaseUpdate=_))}if(u!==null){var E=h.baseState;p=0,A=y=_=null,m=u;do{var S=m.lane,R=m.eventTime;if((a&S)===S){A!==null&&(A=A.next={eventTime:R,lane:0,tag:m.tag,payload:m.payload,callback:m.callback,next:null});t:{var M=e,U=m;switch(S=s,R=r,U.tag){case 1:if(M=U.payload,typeof M=="function"){E=M.call(R,E,S);break t}E=M;break t;case 3:M.flags=M.flags&-65537|128;case 0:if(M=U.payload,S=typeof M=="function"?M.call(R,E,S):M,S==null)break t;E=Vt({},E,S);break t;case 2:fs=!0}}m.callback!==null&&m.lane!==0&&(e.flags|=64,S=h.effects,S===null?h.effects=[m]:S.push(m))}else R={eventTime:R,lane:S,tag:m.tag,payload:m.payload,callback:m.callback,next:null},A===null?(y=A=R,_=E):A=A.next=R,p|=S;if(m=m.next,m===null){if(m=h.shared.pending,m===null)break;S=m,m=S.next,S.next=null,h.lastBaseUpdate=S,h.shared.pending=null}}while(!0);if(A===null&&(_=E),h.baseState=_,h.firstBaseUpdate=y,h.lastBaseUpdate=A,s=h.shared.interleaved,s!==null){h=s;do p|=h.lane,h=h.next;while(h!==s)}else u===null&&(h.shared.lanes=0);ln|=p,e.lanes=p,e.memoizedState=E}}function Mp(e,s,r){if(e=s.effects,s.effects=null,e!==null)for(s=0;s<e.length;s++){var a=e[s],h=a.callback;if(h!==null){if(a.callback=null,a=r,typeof h!="function")throw Error(J(191,h));h.call(a)}}}var yo={},Wi=Is(yo),lo=Is(yo),ho=Is(yo);function en(e){if(e===yo)throw Error(J(174));return e}function Wu(e,s){switch(kt(ho,s),kt(lo,e),kt(Wi,yo),e=s.nodeType,e){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Pc(null,"");break;default:e=e===8?s.parentNode:s,s=e.namespaceURI||null,e=e.tagName,s=Pc(s,e)}Bt(Wi),kt(Wi,s)}function er(){Bt(Wi),Bt(lo),Bt(ho)}function Om(e){en(ho.current);var s=en(Wi.current),r=Pc(s,e.type);s!==r&&(kt(lo,e),kt(Wi,r))}function ju(e){lo.current===e&&(Bt(Wi),Bt(lo))}var jt=Is(0);function Xa(e){for(var s=e;s!==null;){if(s.tag===13){var r=s.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var ec=[];function Gu(){for(var e=0;e<ec.length;e++)ec[e]._workInProgressVersionPrimary=null;ec.length=0}var ba=rs.ReactCurrentDispatcher,ic=rs.ReactCurrentBatchConfig,an=0,Gt=null,ae=null,ue=null,$a=!1,Xr=!1,co=0,Fw=0;function Ae(){throw Error(J(321))}function Vu(e,s){if(s===null)return!1;for(var r=0;r<s.length&&r<e.length;r++)if(!Pi(e[r],s[r]))return!1;return!0}function Xu(e,s,r,a,h,u){if(an=u,Gt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,ba.current=e===null||e.memoizedState===null?zw:Ow,e=r(a,h),Xr){u=0;do{if(Xr=!1,co=0,25<=u)throw Error(J(301));u+=1,ue=ae=null,s.updateQueue=null,ba.current=Uw,e=r(a,h)}while(Xr)}if(ba.current=Ya,s=ae!==null&&ae.next!==null,an=0,ue=ae=Gt=null,$a=!1,s)throw Error(J(300));return e}function $u(){var e=co!==0;return co=0,e}function Ui(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ue===null?Gt.memoizedState=ue=e:ue=ue.next=e,ue}function vi(){if(ae===null){var e=Gt.alternate;e=e!==null?e.memoizedState:null}else e=ae.next;var s=ue===null?Gt.memoizedState:ue.next;if(s!==null)ue=s,ae=e;else{if(e===null)throw Error(J(310));ae=e,e={memoizedState:ae.memoizedState,baseState:ae.baseState,baseQueue:ae.baseQueue,queue:ae.queue,next:null},ue===null?Gt.memoizedState=ue=e:ue=ue.next=e}return ue}function uo(e,s){return typeof s=="function"?s(e):s}function sc(e){var s=vi(),r=s.queue;if(r===null)throw Error(J(311));r.lastRenderedReducer=e;var a=ae,h=a.baseQueue,u=r.pending;if(u!==null){if(h!==null){var p=h.next;h.next=u.next,u.next=p}a.baseQueue=h=u,r.pending=null}if(h!==null){u=h.next,a=a.baseState;var m=p=null,_=null,y=u;do{var A=y.lane;if((an&A)===A)_!==null&&(_=_.next={lane:0,action:y.action,hasEagerState:y.hasEagerState,eagerState:y.eagerState,next:null}),a=y.hasEagerState?y.eagerState:e(a,y.action);else{var E={lane:A,action:y.action,hasEagerState:y.hasEagerState,eagerState:y.eagerState,next:null};_===null?(m=_=E,p=a):_=_.next=E,Gt.lanes|=A,ln|=A}y=y.next}while(y!==null&&y!==u);_===null?p=a:_.next=m,Pi(a,s.memoizedState)||(Ye=!0),s.memoizedState=a,s.baseState=p,s.baseQueue=_,r.lastRenderedState=a}if(e=r.interleaved,e!==null){h=e;do u=h.lane,Gt.lanes|=u,ln|=u,h=h.next;while(h!==e)}else h===null&&(r.lanes=0);return[s.memoizedState,r.dispatch]}function nc(e){var s=vi(),r=s.queue;if(r===null)throw Error(J(311));r.lastRenderedReducer=e;var a=r.dispatch,h=r.pending,u=s.memoizedState;if(h!==null){r.pending=null;var p=h=h.next;do u=e(u,p.action),p=p.next;while(p!==h);Pi(u,s.memoizedState)||(Ye=!0),s.memoizedState=u,s.baseQueue===null&&(s.baseState=u),r.lastRenderedState=u}return[u,a]}function Um(){}function Nm(e,s){var r=Gt,a=vi(),h=s(),u=!Pi(a.memoizedState,h);if(u&&(a.memoizedState=h,Ye=!0),a=a.queue,Yu(jm.bind(null,r,a,e),[e]),a.getSnapshot!==s||u||ue!==null&&ue.memoizedState.tag&1){if(r.flags|=2048,fo(9,Wm.bind(null,r,a,h,s),void 0,null),de===null)throw Error(J(349));an&30||Hm(r,s,h)}return h}function Hm(e,s,r){e.flags|=16384,e={getSnapshot:s,value:r},s=Gt.updateQueue,s===null?(s={lastEffect:null,stores:null},Gt.updateQueue=s,s.stores=[e]):(r=s.stores,r===null?s.stores=[e]:r.push(e))}function Wm(e,s,r,a){s.value=r,s.getSnapshot=a,Gm(s)&&Vm(e)}function jm(e,s,r){return r(function(){Gm(s)&&Vm(e)})}function Gm(e){var s=e.getSnapshot;e=e.value;try{var r=s();return!Pi(e,r)}catch{return!0}}function Vm(e){var s=ss(e,1);s!==null&&Ti(s,e,1,-1)}function Lp(e){var s=Ui();return typeof e=="function"&&(e=e()),s.memoizedState=s.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uo,lastRenderedState:e},s.queue=e,e=e.dispatch=Lw.bind(null,Gt,e),[s.memoizedState,e]}function fo(e,s,r,a){return e={tag:e,create:s,destroy:r,deps:a,next:null},s=Gt.updateQueue,s===null?(s={lastEffect:null,stores:null},Gt.updateQueue=s,s.lastEffect=e.next=e):(r=s.lastEffect,r===null?s.lastEffect=e.next=e:(a=r.next,r.next=e,e.next=a,s.lastEffect=e)),e}function Xm(){return vi().memoizedState}function Aa(e,s,r,a){var h=Ui();Gt.flags|=e,h.memoizedState=fo(1|s,r,void 0,a===void 0?null:a)}function ul(e,s,r,a){var h=vi();a=a===void 0?null:a;var u=void 0;if(ae!==null){var p=ae.memoizedState;if(u=p.destroy,a!==null&&Vu(a,p.deps)){h.memoizedState=fo(s,r,u,a);return}}Gt.flags|=e,h.memoizedState=fo(1|s,r,u,a)}function zp(e,s){return Aa(8390656,8,e,s)}function Yu(e,s){return ul(2048,8,e,s)}function $m(e,s){return ul(4,2,e,s)}function Ym(e,s){return ul(4,4,e,s)}function Qm(e,s){if(typeof s=="function")return e=e(),s(e),function(){s(null)};if(s!=null)return e=e(),s.current=e,function(){s.current=null}}function Zm(e,s,r){return r=r!=null?r.concat([e]):null,ul(4,4,Qm.bind(null,s,e),r)}function Qu(){}function qm(e,s){var r=vi();s=s===void 0?null:s;var a=r.memoizedState;return a!==null&&s!==null&&Vu(s,a[1])?a[0]:(r.memoizedState=[e,s],e)}function Km(e,s){var r=vi();s=s===void 0?null:s;var a=r.memoizedState;return a!==null&&s!==null&&Vu(s,a[1])?a[0]:(e=e(),r.memoizedState=[e,s],e)}function Jm(e,s,r){return an&21?(Pi(r,s)||(r=nm(),Gt.lanes|=r,ln|=r,e.baseState=!0),s):(e.baseState&&(e.baseState=!1,Ye=!0),e.memoizedState=r)}function Bw(e,s){var r=Rt;Rt=r!==0&&4>r?r:4,e(!0);var a=ic.transition;ic.transition={};try{e(!1),s()}finally{Rt=r,ic.transition=a}}function t_(){return vi().memoizedState}function Mw(e,s,r){var a=As(e);if(r={lane:a,action:r,hasEagerState:!1,eagerState:null,next:null},e_(e))i_(s,r);else if(r=Lm(e,s,r,a),r!==null){var h=Me();Ti(r,e,a,h),s_(r,s,a)}}function Lw(e,s,r){var a=As(e),h={lane:a,action:r,hasEagerState:!1,eagerState:null,next:null};if(e_(e))i_(s,h);else{var u=e.alternate;if(e.lanes===0&&(u===null||u.lanes===0)&&(u=s.lastRenderedReducer,u!==null))try{var p=s.lastRenderedState,m=u(p,r);if(h.hasEagerState=!0,h.eagerState=m,Pi(m,p)){var _=s.interleaved;_===null?(h.next=h,Nu(s)):(h.next=_.next,_.next=h),s.interleaved=h;return}}catch{}finally{}r=Lm(e,s,h,a),r!==null&&(h=Me(),Ti(r,e,a,h),s_(r,s,a))}}function e_(e){var s=e.alternate;return e===Gt||s!==null&&s===Gt}function i_(e,s){Xr=$a=!0;var r=e.pending;r===null?s.next=s:(s.next=r.next,r.next=s),e.pending=s}function s_(e,s,r){if(r&4194240){var a=s.lanes;a&=e.pendingLanes,r|=a,s.lanes=r,Eu(e,r)}}var Ya={readContext:_i,useCallback:Ae,useContext:Ae,useEffect:Ae,useImperativeHandle:Ae,useInsertionEffect:Ae,useLayoutEffect:Ae,useMemo:Ae,useReducer:Ae,useRef:Ae,useState:Ae,useDebugValue:Ae,useDeferredValue:Ae,useTransition:Ae,useMutableSource:Ae,useSyncExternalStore:Ae,useId:Ae,unstable_isNewReconciler:!1},zw={readContext:_i,useCallback:function(e,s){return Ui().memoizedState=[e,s===void 0?null:s],e},useContext:_i,useEffect:zp,useImperativeHandle:function(e,s,r){return r=r!=null?r.concat([e]):null,Aa(4194308,4,Qm.bind(null,s,e),r)},useLayoutEffect:function(e,s){return Aa(4194308,4,e,s)},useInsertionEffect:function(e,s){return Aa(4,2,e,s)},useMemo:function(e,s){var r=Ui();return s=s===void 0?null:s,e=e(),r.memoizedState=[e,s],e},useReducer:function(e,s,r){var a=Ui();return s=r!==void 0?r(s):s,a.memoizedState=a.baseState=s,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:s},a.queue=e,e=e.dispatch=Mw.bind(null,Gt,e),[a.memoizedState,e]},useRef:function(e){var s=Ui();return e={current:e},s.memoizedState=e},useState:Lp,useDebugValue:Qu,useDeferredValue:function(e){return Ui().memoizedState=e},useTransition:function(){var e=Lp(!1),s=e[0];return e=Bw.bind(null,e[1]),Ui().memoizedState=e,[s,e]},useMutableSource:function(){},useSyncExternalStore:function(e,s,r){var a=Gt,h=Ui();if(Ut){if(r===void 0)throw Error(J(407));r=r()}else{if(r=s(),de===null)throw Error(J(349));an&30||Hm(a,s,r)}h.memoizedState=r;var u={value:r,getSnapshot:s};return h.queue=u,zp(jm.bind(null,a,u,e),[e]),a.flags|=2048,fo(9,Wm.bind(null,a,u,r,s),void 0,null),r},useId:function(){var e=Ui(),s=de.identifierPrefix;if(Ut){var r=Ji,a=Ki;r=(a&~(1<<32-Ei(a)-1)).toString(32)+r,s=":"+s+"R"+r,r=co++,0<r&&(s+="H"+r.toString(32)),s+=":"}else r=Fw++,s=":"+s+"r"+r.toString(32)+":";return e.memoizedState=s},unstable_isNewReconciler:!1},Ow={readContext:_i,useCallback:qm,useContext:_i,useEffect:Yu,useImperativeHandle:Zm,useInsertionEffect:$m,useLayoutEffect:Ym,useMemo:Km,useReducer:sc,useRef:Xm,useState:function(){return sc(uo)},useDebugValue:Qu,useDeferredValue:function(e){var s=vi();return Jm(s,ae.memoizedState,e)},useTransition:function(){var e=sc(uo)[0],s=vi().memoizedState;return[e,s]},useMutableSource:Um,useSyncExternalStore:Nm,useId:t_,unstable_isNewReconciler:!1},Uw={readContext:_i,useCallback:qm,useContext:_i,useEffect:Yu,useImperativeHandle:Zm,useInsertionEffect:$m,useLayoutEffect:Ym,useMemo:Km,useReducer:nc,useRef:Xm,useState:function(){return nc(uo)},useDebugValue:Qu,useDeferredValue:function(e){var s=vi();return ae===null?s.memoizedState=e:Jm(s,ae.memoizedState,e)},useTransition:function(){var e=nc(uo)[0],s=vi().memoizedState;return[e,s]},useMutableSource:Um,useSyncExternalStore:Nm,useId:t_,unstable_isNewReconciler:!1};function bi(e,s){if(e&&e.defaultProps){s=Vt({},s),e=e.defaultProps;for(var r in e)s[r]===void 0&&(s[r]=e[r]);return s}return s}function Qc(e,s,r,a){s=e.memoizedState,r=r(a,s),r=r==null?s:Vt({},s,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var dl={isMounted:function(e){return(e=e._reactInternals)?un(e)===e:!1},enqueueSetState:function(e,s,r){e=e._reactInternals;var a=Me(),h=As(e),u=ts(a,h);u.payload=s,r!=null&&(u.callback=r),s=Cs(e,u,h),s!==null&&(Ti(s,e,h,a),Ca(s,e,h))},enqueueReplaceState:function(e,s,r){e=e._reactInternals;var a=Me(),h=As(e),u=ts(a,h);u.tag=1,u.payload=s,r!=null&&(u.callback=r),s=Cs(e,u,h),s!==null&&(Ti(s,e,h,a),Ca(s,e,h))},enqueueForceUpdate:function(e,s){e=e._reactInternals;var r=Me(),a=As(e),h=ts(r,a);h.tag=2,s!=null&&(h.callback=s),s=Cs(e,h,a),s!==null&&(Ti(s,e,a,r),Ca(s,e,a))}};function Op(e,s,r,a,h,u,p){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,u,p):s.prototype&&s.prototype.isPureReactComponent?!no(r,a)||!no(h,u):!0}function n_(e,s,r){var a=!1,h=Ts,u=s.contextType;return typeof u=="object"&&u!==null?u=_i(u):(h=Ze(s)?rn:Te.current,a=s.contextTypes,u=(a=a!=null)?Kn(e,h):Ts),s=new s(r,u),e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=dl,e.stateNode=s,s._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=h,e.__reactInternalMemoizedMaskedChildContext=u),s}function Up(e,s,r,a){e=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(r,a),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(r,a),s.state!==e&&dl.enqueueReplaceState(s,s.state,null)}function Zc(e,s,r,a){var h=e.stateNode;h.props=r,h.state=e.memoizedState,h.refs={},Hu(e);var u=s.contextType;typeof u=="object"&&u!==null?h.context=_i(u):(u=Ze(s)?rn:Te.current,h.context=Kn(e,u)),h.state=e.memoizedState,u=s.getDerivedStateFromProps,typeof u=="function"&&(Qc(e,s,u,r),h.state=e.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(s=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),s!==h.state&&dl.enqueueReplaceState(h,h.state,null),Va(e,r,h,a),h.state=e.memoizedState),typeof h.componentDidMount=="function"&&(e.flags|=4194308)}function ir(e,s){try{var r="",a=s;do r+=fy(a),a=a.return;while(a);var h=r}catch(u){h=`
Error generating stack: `+u.message+`
`+u.stack}return{value:e,source:s,stack:h,digest:null}}function rc(e,s,r){return{value:e,source:null,stack:r??null,digest:s??null}}function qc(e,s){try{console.error(s.value)}catch(r){setTimeout(function(){throw r})}}var Nw=typeof WeakMap=="function"?WeakMap:Map;function r_(e,s,r){r=ts(-1,r),r.tag=3,r.payload={element:null};var a=s.value;return r.callback=function(){Za||(Za=!0,au=a),qc(e,s)},r}function o_(e,s,r){r=ts(-1,r),r.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var h=s.value;r.payload=function(){return a(h)},r.callback=function(){qc(e,s)}}var u=e.stateNode;return u!==null&&typeof u.componentDidCatch=="function"&&(r.callback=function(){qc(e,s),typeof a!="function"&&(bs===null?bs=new Set([this]):bs.add(this));var p=s.stack;this.componentDidCatch(s.value,{componentStack:p!==null?p:""})}),r}function Np(e,s,r){var a=e.pingCache;if(a===null){a=e.pingCache=new Nw;var h=new Set;a.set(s,h)}else h=a.get(s),h===void 0&&(h=new Set,a.set(s,h));h.has(r)||(h.add(r),e=tx.bind(null,e,s,r),s.then(e,e))}function Hp(e){do{var s;if((s=e.tag===13)&&(s=e.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return e;e=e.return}while(e!==null);return null}function Wp(e,s,r,a,h){return e.mode&1?(e.flags|=65536,e.lanes=h,e):(e===s?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(s=ts(-1,1),s.tag=2,Cs(r,s,1))),r.lanes|=1),e)}var Hw=rs.ReactCurrentOwner,Ye=!1;function Be(e,s,r,a){s.child=e===null?Mm(s,null,r,a):tr(s,e.child,r,a)}function jp(e,s,r,a,h){r=r.render;var u=s.ref;return Qn(s,h),a=Xu(e,s,r,a,u,h),r=$u(),e!==null&&!Ye?(s.updateQueue=e.updateQueue,s.flags&=-2053,e.lanes&=~h,ns(e,s,h)):(Ut&&r&&Bu(s),s.flags|=1,Be(e,s,a,h),s.child)}function Gp(e,s,r,a,h){if(e===null){var u=r.type;return typeof u=="function"&&!sd(u)&&u.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(s.tag=15,s.type=u,a_(e,s,u,a,h)):(e=Pa(r.type,null,a,s,s.mode,h),e.ref=s.ref,e.return=s,s.child=e)}if(u=e.child,!(e.lanes&h)){var p=u.memoizedProps;if(r=r.compare,r=r!==null?r:no,r(p,a)&&e.ref===s.ref)return ns(e,s,h)}return s.flags|=1,e=Ss(u,a),e.ref=s.ref,e.return=s,s.child=e}function a_(e,s,r,a,h){if(e!==null){var u=e.memoizedProps;if(no(u,a)&&e.ref===s.ref)if(Ye=!1,s.pendingProps=a=u,(e.lanes&h)!==0)e.flags&131072&&(Ye=!0);else return s.lanes=e.lanes,ns(e,s,h)}return Kc(e,s,r,a,h)}function l_(e,s,r){var a=s.pendingProps,h=a.children,u=e!==null?e.memoizedState:null;if(a.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},kt(Gn,si),si|=r;else{if(!(r&1073741824))return e=u!==null?u.baseLanes|r:r,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:e,cachePool:null,transitions:null},s.updateQueue=null,kt(Gn,si),si|=e,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=u!==null?u.baseLanes:r,kt(Gn,si),si|=a}else u!==null?(a=u.baseLanes|r,s.memoizedState=null):a=r,kt(Gn,si),si|=a;return Be(e,s,h,r),s.child}function h_(e,s){var r=s.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(s.flags|=512,s.flags|=2097152)}function Kc(e,s,r,a,h){var u=Ze(r)?rn:Te.current;return u=Kn(s,u),Qn(s,h),r=Xu(e,s,r,a,u,h),a=$u(),e!==null&&!Ye?(s.updateQueue=e.updateQueue,s.flags&=-2053,e.lanes&=~h,ns(e,s,h)):(Ut&&a&&Bu(s),s.flags|=1,Be(e,s,r,h),s.child)}function Vp(e,s,r,a,h){if(Ze(r)){var u=!0;Na(s)}else u=!1;if(Qn(s,h),s.stateNode===null)Sa(e,s),n_(s,r,a),Zc(s,r,a,h),a=!0;else if(e===null){var p=s.stateNode,m=s.memoizedProps;p.props=m;var _=p.context,y=r.contextType;typeof y=="object"&&y!==null?y=_i(y):(y=Ze(r)?rn:Te.current,y=Kn(s,y));var A=r.getDerivedStateFromProps,E=typeof A=="function"||typeof p.getSnapshotBeforeUpdate=="function";E||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(m!==a||_!==y)&&Up(s,p,a,y),fs=!1;var S=s.memoizedState;p.state=S,Va(s,a,p,h),_=s.memoizedState,m!==a||S!==_||Qe.current||fs?(typeof A=="function"&&(Qc(s,r,A,a),_=s.memoizedState),(m=fs||Op(s,r,m,a,S,_,y))?(E||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(s.flags|=4194308)):(typeof p.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=a,s.memoizedState=_),p.props=a,p.state=_,p.context=y,a=m):(typeof p.componentDidMount=="function"&&(s.flags|=4194308),a=!1)}else{p=s.stateNode,zm(e,s),m=s.memoizedProps,y=s.type===s.elementType?m:bi(s.type,m),p.props=y,E=s.pendingProps,S=p.context,_=r.contextType,typeof _=="object"&&_!==null?_=_i(_):(_=Ze(r)?rn:Te.current,_=Kn(s,_));var R=r.getDerivedStateFromProps;(A=typeof R=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(m!==E||S!==_)&&Up(s,p,a,_),fs=!1,S=s.memoizedState,p.state=S,Va(s,a,p,h);var M=s.memoizedState;m!==E||S!==M||Qe.current||fs?(typeof R=="function"&&(Qc(s,r,R,a),M=s.memoizedState),(y=fs||Op(s,r,y,a,S,M,_)||!1)?(A||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(a,M,_),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(a,M,_)),typeof p.componentDidUpdate=="function"&&(s.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof p.componentDidUpdate!="function"||m===e.memoizedProps&&S===e.memoizedState||(s.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||m===e.memoizedProps&&S===e.memoizedState||(s.flags|=1024),s.memoizedProps=a,s.memoizedState=M),p.props=a,p.state=M,p.context=_,a=y):(typeof p.componentDidUpdate!="function"||m===e.memoizedProps&&S===e.memoizedState||(s.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||m===e.memoizedProps&&S===e.memoizedState||(s.flags|=1024),a=!1)}return Jc(e,s,r,a,u,h)}function Jc(e,s,r,a,h,u){h_(e,s);var p=(s.flags&128)!==0;if(!a&&!p)return h&&Rp(s,r,!1),ns(e,s,u);a=s.stateNode,Hw.current=s;var m=p&&typeof r.getDerivedStateFromError!="function"?null:a.render();return s.flags|=1,e!==null&&p?(s.child=tr(s,e.child,null,u),s.child=tr(s,null,m,u)):Be(e,s,m,u),s.memoizedState=a.state,h&&Rp(s,r,!0),s.child}function c_(e){var s=e.stateNode;s.pendingContext?Ip(e,s.pendingContext,s.pendingContext!==s.context):s.context&&Ip(e,s.context,!1),Wu(e,s.containerInfo)}function Xp(e,s,r,a,h){return Jn(),Lu(h),s.flags|=256,Be(e,s,r,a),s.child}var tu={dehydrated:null,treeContext:null,retryLane:0};function eu(e){return{baseLanes:e,cachePool:null,transitions:null}}function u_(e,s,r){var a=s.pendingProps,h=jt.current,u=!1,p=(s.flags&128)!==0,m;if((m=p)||(m=e!==null&&e.memoizedState===null?!1:(h&2)!==0),m?(u=!0,s.flags&=-129):(e===null||e.memoizedState!==null)&&(h|=1),kt(jt,h&1),e===null)return $c(s),e=s.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(s.mode&1?e.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(p=a.children,e=a.fallback,u?(a=s.mode,u=s.child,p={mode:"hidden",children:p},!(a&1)&&u!==null?(u.childLanes=0,u.pendingProps=p):u=gl(p,a,0,null),e=nn(e,a,r,null),u.return=s,e.return=s,u.sibling=e,s.child=u,s.child.memoizedState=eu(r),s.memoizedState=tu,e):Zu(s,p));if(h=e.memoizedState,h!==null&&(m=h.dehydrated,m!==null))return Ww(e,s,p,a,m,h,r);if(u){u=a.fallback,p=s.mode,h=e.child,m=h.sibling;var _={mode:"hidden",children:a.children};return!(p&1)&&s.child!==h?(a=s.child,a.childLanes=0,a.pendingProps=_,s.deletions=null):(a=Ss(h,_),a.subtreeFlags=h.subtreeFlags&14680064),m!==null?u=Ss(m,u):(u=nn(u,p,r,null),u.flags|=2),u.return=s,a.return=s,a.sibling=u,s.child=a,a=u,u=s.child,p=e.child.memoizedState,p=p===null?eu(r):{baseLanes:p.baseLanes|r,cachePool:null,transitions:p.transitions},u.memoizedState=p,u.childLanes=e.childLanes&~r,s.memoizedState=tu,a}return u=e.child,e=u.sibling,a=Ss(u,{mode:"visible",children:a.children}),!(s.mode&1)&&(a.lanes=r),a.return=s,a.sibling=null,e!==null&&(r=s.deletions,r===null?(s.deletions=[e],s.flags|=16):r.push(e)),s.child=a,s.memoizedState=null,a}function Zu(e,s){return s=gl({mode:"visible",children:s},e.mode,0,null),s.return=e,e.child=s}function ua(e,s,r,a){return a!==null&&Lu(a),tr(s,e.child,null,r),e=Zu(s,s.pendingProps.children),e.flags|=2,s.memoizedState=null,e}function Ww(e,s,r,a,h,u,p){if(r)return s.flags&256?(s.flags&=-257,a=rc(Error(J(422))),ua(e,s,p,a)):s.memoizedState!==null?(s.child=e.child,s.flags|=128,null):(u=a.fallback,h=s.mode,a=gl({mode:"visible",children:a.children},h,0,null),u=nn(u,h,p,null),u.flags|=2,a.return=s,u.return=s,a.sibling=u,s.child=a,s.mode&1&&tr(s,e.child,null,p),s.child.memoizedState=eu(p),s.memoizedState=tu,u);if(!(s.mode&1))return ua(e,s,p,null);if(h.data==="$!"){if(a=h.nextSibling&&h.nextSibling.dataset,a)var m=a.dgst;return a=m,u=Error(J(419)),a=rc(u,a,void 0),ua(e,s,p,a)}if(m=(p&e.childLanes)!==0,Ye||m){if(a=de,a!==null){switch(p&-p){case 4:h=2;break;case 16:h=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:h=32;break;case 536870912:h=268435456;break;default:h=0}h=h&(a.suspendedLanes|p)?0:h,h!==0&&h!==u.retryLane&&(u.retryLane=h,ss(e,h),Ti(a,e,h,-1))}return id(),a=rc(Error(J(421))),ua(e,s,p,a)}return h.data==="$?"?(s.flags|=128,s.child=e.child,s=ex.bind(null,e),h._reactRetry=s,null):(e=u.treeContext,ni=xs(h.nextSibling),oi=s,Ut=!0,Si=null,e!==null&&(fi[pi++]=Ki,fi[pi++]=Ji,fi[pi++]=on,Ki=e.id,Ji=e.overflow,on=s),s=Zu(s,a.children),s.flags|=4096,s)}function $p(e,s,r){e.lanes|=s;var a=e.alternate;a!==null&&(a.lanes|=s),Yc(e.return,s,r)}function oc(e,s,r,a,h){var u=e.memoizedState;u===null?e.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:a,tail:r,tailMode:h}:(u.isBackwards=s,u.rendering=null,u.renderingStartTime=0,u.last=a,u.tail=r,u.tailMode=h)}function d_(e,s,r){var a=s.pendingProps,h=a.revealOrder,u=a.tail;if(Be(e,s,a.children,r),a=jt.current,a&2)a=a&1|2,s.flags|=128;else{if(e!==null&&e.flags&128)t:for(e=s.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&$p(e,r,s);else if(e.tag===19)$p(e,r,s);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break t;for(;e.sibling===null;){if(e.return===null||e.return===s)break t;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(kt(jt,a),!(s.mode&1))s.memoizedState=null;else switch(h){case"forwards":for(r=s.child,h=null;r!==null;)e=r.alternate,e!==null&&Xa(e)===null&&(h=r),r=r.sibling;r=h,r===null?(h=s.child,s.child=null):(h=r.sibling,r.sibling=null),oc(s,!1,h,r,u);break;case"backwards":for(r=null,h=s.child,s.child=null;h!==null;){if(e=h.alternate,e!==null&&Xa(e)===null){s.child=h;break}e=h.sibling,h.sibling=r,r=h,h=e}oc(s,!0,r,null,u);break;case"together":oc(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Sa(e,s){!(s.mode&1)&&e!==null&&(e.alternate=null,s.alternate=null,s.flags|=2)}function ns(e,s,r){if(e!==null&&(s.dependencies=e.dependencies),ln|=s.lanes,!(r&s.childLanes))return null;if(e!==null&&s.child!==e.child)throw Error(J(153));if(s.child!==null){for(e=s.child,r=Ss(e,e.pendingProps),s.child=r,r.return=s;e.sibling!==null;)e=e.sibling,r=r.sibling=Ss(e,e.pendingProps),r.return=s;r.sibling=null}return s.child}function jw(e,s,r){switch(s.tag){case 3:c_(s),Jn();break;case 5:Om(s);break;case 1:Ze(s.type)&&Na(s);break;case 4:Wu(s,s.stateNode.containerInfo);break;case 10:var a=s.type._context,h=s.memoizedProps.value;kt(ja,a._currentValue),a._currentValue=h;break;case 13:if(a=s.memoizedState,a!==null)return a.dehydrated!==null?(kt(jt,jt.current&1),s.flags|=128,null):r&s.child.childLanes?u_(e,s,r):(kt(jt,jt.current&1),e=ns(e,s,r),e!==null?e.sibling:null);kt(jt,jt.current&1);break;case 19:if(a=(r&s.childLanes)!==0,e.flags&128){if(a)return d_(e,s,r);s.flags|=128}if(h=s.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),kt(jt,jt.current),a)break;return null;case 22:case 23:return s.lanes=0,l_(e,s,r)}return ns(e,s,r)}var f_,iu,p_,g_;f_=function(e,s){for(var r=s.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};iu=function(){};p_=function(e,s,r,a){var h=e.memoizedProps;if(h!==a){e=s.stateNode,en(Wi.current);var u=null;switch(r){case"input":h=Ac(e,h),a=Ac(e,a),u=[];break;case"select":h=Vt({},h,{value:void 0}),a=Vt({},a,{value:void 0}),u=[];break;case"textarea":h=Tc(e,h),a=Tc(e,a),u=[];break;default:typeof h.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=Oa)}Ic(r,a);var p;r=null;for(y in h)if(!a.hasOwnProperty(y)&&h.hasOwnProperty(y)&&h[y]!=null)if(y==="style"){var m=h[y];for(p in m)m.hasOwnProperty(p)&&(r||(r={}),r[p]="")}else y!=="dangerouslySetInnerHTML"&&y!=="children"&&y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(qr.hasOwnProperty(y)?u||(u=[]):(u=u||[]).push(y,null));for(y in a){var _=a[y];if(m=h!=null?h[y]:void 0,a.hasOwnProperty(y)&&_!==m&&(_!=null||m!=null))if(y==="style")if(m){for(p in m)!m.hasOwnProperty(p)||_&&_.hasOwnProperty(p)||(r||(r={}),r[p]="");for(p in _)_.hasOwnProperty(p)&&m[p]!==_[p]&&(r||(r={}),r[p]=_[p])}else r||(u||(u=[]),u.push(y,r)),r=_;else y==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,m=m?m.__html:void 0,_!=null&&m!==_&&(u=u||[]).push(y,_)):y==="children"?typeof _!="string"&&typeof _!="number"||(u=u||[]).push(y,""+_):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&(qr.hasOwnProperty(y)?(_!=null&&y==="onScroll"&&Ft("scroll",e),u||m===_||(u=[])):(u=u||[]).push(y,_))}r&&(u=u||[]).push("style",r);var y=u;(s.updateQueue=y)&&(s.flags|=4)}};g_=function(e,s,r,a){r!==a&&(s.flags|=4)};function Br(e,s){if(!Ut)switch(e.tailMode){case"hidden":s=e.tail;for(var r=null;s!==null;)s.alternate!==null&&(r=s),s=s.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?s||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function Se(e){var s=e.alternate!==null&&e.alternate.child===e.child,r=0,a=0;if(s)for(var h=e.child;h!==null;)r|=h.lanes|h.childLanes,a|=h.subtreeFlags&14680064,a|=h.flags&14680064,h.return=e,h=h.sibling;else for(h=e.child;h!==null;)r|=h.lanes|h.childLanes,a|=h.subtreeFlags,a|=h.flags,h.return=e,h=h.sibling;return e.subtreeFlags|=a,e.childLanes=r,s}function Gw(e,s,r){var a=s.pendingProps;switch(Mu(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Se(s),null;case 1:return Ze(s.type)&&Ua(),Se(s),null;case 3:return a=s.stateNode,er(),Bt(Qe),Bt(Te),Gu(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(ha(s)?s.flags|=4:e===null||e.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Si!==null&&(cu(Si),Si=null))),iu(e,s),Se(s),null;case 5:ju(s);var h=en(ho.current);if(r=s.type,e!==null&&s.stateNode!=null)p_(e,s,r,a,h),e.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!a){if(s.stateNode===null)throw Error(J(166));return Se(s),null}if(e=en(Wi.current),ha(s)){a=s.stateNode,r=s.type;var u=s.memoizedProps;switch(a[Ni]=s,a[ao]=u,e=(s.mode&1)!==0,r){case"dialog":Ft("cancel",a),Ft("close",a);break;case"iframe":case"object":case"embed":Ft("load",a);break;case"video":case"audio":for(h=0;h<Nr.length;h++)Ft(Nr[h],a);break;case"source":Ft("error",a);break;case"img":case"image":case"link":Ft("error",a),Ft("load",a);break;case"details":Ft("toggle",a);break;case"input":ip(a,u),Ft("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!u.multiple},Ft("invalid",a);break;case"textarea":np(a,u),Ft("invalid",a)}Ic(r,u),h=null;for(var p in u)if(u.hasOwnProperty(p)){var m=u[p];p==="children"?typeof m=="string"?a.textContent!==m&&(u.suppressHydrationWarning!==!0&&la(a.textContent,m,e),h=["children",m]):typeof m=="number"&&a.textContent!==""+m&&(u.suppressHydrationWarning!==!0&&la(a.textContent,m,e),h=["children",""+m]):qr.hasOwnProperty(p)&&m!=null&&p==="onScroll"&&Ft("scroll",a)}switch(r){case"input":ta(a),sp(a,u,!0);break;case"textarea":ta(a),rp(a);break;case"select":case"option":break;default:typeof u.onClick=="function"&&(a.onclick=Oa)}a=h,s.updateQueue=a,a!==null&&(s.flags|=4)}else{p=h.nodeType===9?h:h.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=jg(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=p.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=p.createElement(r,{is:a.is}):(e=p.createElement(r),r==="select"&&(p=e,a.multiple?p.multiple=!0:a.size&&(p.size=a.size))):e=p.createElementNS(e,r),e[Ni]=s,e[ao]=a,f_(e,s,!1,!1),s.stateNode=e;t:{switch(p=Rc(r,a),r){case"dialog":Ft("cancel",e),Ft("close",e),h=a;break;case"iframe":case"object":case"embed":Ft("load",e),h=a;break;case"video":case"audio":for(h=0;h<Nr.length;h++)Ft(Nr[h],e);h=a;break;case"source":Ft("error",e),h=a;break;case"img":case"image":case"link":Ft("error",e),Ft("load",e),h=a;break;case"details":Ft("toggle",e),h=a;break;case"input":ip(e,a),h=Ac(e,a),Ft("invalid",e);break;case"option":h=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},h=Vt({},a,{value:void 0}),Ft("invalid",e);break;case"textarea":np(e,a),h=Tc(e,a),Ft("invalid",e);break;default:h=a}Ic(r,h),m=h;for(u in m)if(m.hasOwnProperty(u)){var _=m[u];u==="style"?Xg(e,_):u==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,_!=null&&Gg(e,_)):u==="children"?typeof _=="string"?(r!=="textarea"||_!=="")&&Kr(e,_):typeof _=="number"&&Kr(e,""+_):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(qr.hasOwnProperty(u)?_!=null&&u==="onScroll"&&Ft("scroll",e):_!=null&&wu(e,u,_,p))}switch(r){case"input":ta(e),sp(e,a,!1);break;case"textarea":ta(e),rp(e);break;case"option":a.value!=null&&e.setAttribute("value",""+Es(a.value));break;case"select":e.multiple=!!a.multiple,u=a.value,u!=null?Vn(e,!!a.multiple,u,!1):a.defaultValue!=null&&Vn(e,!!a.multiple,a.defaultValue,!0);break;default:typeof h.onClick=="function"&&(e.onclick=Oa)}switch(r){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break t;case"img":a=!0;break t;default:a=!1}}a&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Se(s),null;case 6:if(e&&s.stateNode!=null)g_(e,s,e.memoizedProps,a);else{if(typeof a!="string"&&s.stateNode===null)throw Error(J(166));if(r=en(ho.current),en(Wi.current),ha(s)){if(a=s.stateNode,r=s.memoizedProps,a[Ni]=s,(u=a.nodeValue!==r)&&(e=oi,e!==null))switch(e.tag){case 3:la(a.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&la(a.nodeValue,r,(e.mode&1)!==0)}u&&(s.flags|=4)}else a=(r.nodeType===9?r:r.ownerDocument).createTextNode(a),a[Ni]=s,s.stateNode=a}return Se(s),null;case 13:if(Bt(jt),a=s.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ut&&ni!==null&&s.mode&1&&!(s.flags&128))Fm(),Jn(),s.flags|=98560,u=!1;else if(u=ha(s),a!==null&&a.dehydrated!==null){if(e===null){if(!u)throw Error(J(318));if(u=s.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(J(317));u[Ni]=s}else Jn(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Se(s),u=!1}else Si!==null&&(cu(Si),Si=null),u=!0;if(!u)return s.flags&65536?s:null}return s.flags&128?(s.lanes=r,s):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(s.child.flags|=8192,s.mode&1&&(e===null||jt.current&1?le===0&&(le=3):id())),s.updateQueue!==null&&(s.flags|=4),Se(s),null);case 4:return er(),iu(e,s),e===null&&ro(s.stateNode.containerInfo),Se(s),null;case 10:return Uu(s.type._context),Se(s),null;case 17:return Ze(s.type)&&Ua(),Se(s),null;case 19:if(Bt(jt),u=s.memoizedState,u===null)return Se(s),null;if(a=(s.flags&128)!==0,p=u.rendering,p===null)if(a)Br(u,!1);else{if(le!==0||e!==null&&e.flags&128)for(e=s.child;e!==null;){if(p=Xa(e),p!==null){for(s.flags|=128,Br(u,!1),a=p.updateQueue,a!==null&&(s.updateQueue=a,s.flags|=4),s.subtreeFlags=0,a=r,r=s.child;r!==null;)u=r,e=a,u.flags&=14680066,p=u.alternate,p===null?(u.childLanes=0,u.lanes=e,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=p.childLanes,u.lanes=p.lanes,u.child=p.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=p.memoizedProps,u.memoizedState=p.memoizedState,u.updateQueue=p.updateQueue,u.type=p.type,e=p.dependencies,u.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return kt(jt,jt.current&1|2),s.child}e=e.sibling}u.tail!==null&&qt()>sr&&(s.flags|=128,a=!0,Br(u,!1),s.lanes=4194304)}else{if(!a)if(e=Xa(p),e!==null){if(s.flags|=128,a=!0,r=e.updateQueue,r!==null&&(s.updateQueue=r,s.flags|=4),Br(u,!0),u.tail===null&&u.tailMode==="hidden"&&!p.alternate&&!Ut)return Se(s),null}else 2*qt()-u.renderingStartTime>sr&&r!==1073741824&&(s.flags|=128,a=!0,Br(u,!1),s.lanes=4194304);u.isBackwards?(p.sibling=s.child,s.child=p):(r=u.last,r!==null?r.sibling=p:s.child=p,u.last=p)}return u.tail!==null?(s=u.tail,u.rendering=s,u.tail=s.sibling,u.renderingStartTime=qt(),s.sibling=null,r=jt.current,kt(jt,a?r&1|2:r&1),s):(Se(s),null);case 22:case 23:return ed(),a=s.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(s.flags|=8192),a&&s.mode&1?si&1073741824&&(Se(s),s.subtreeFlags&6&&(s.flags|=8192)):Se(s),null;case 24:return null;case 25:return null}throw Error(J(156,s.tag))}function Vw(e,s){switch(Mu(s),s.tag){case 1:return Ze(s.type)&&Ua(),e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 3:return er(),Bt(Qe),Bt(Te),Gu(),e=s.flags,e&65536&&!(e&128)?(s.flags=e&-65537|128,s):null;case 5:return ju(s),null;case 13:if(Bt(jt),e=s.memoizedState,e!==null&&e.dehydrated!==null){if(s.alternate===null)throw Error(J(340));Jn()}return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 19:return Bt(jt),null;case 4:return er(),null;case 10:return Uu(s.type._context),null;case 22:case 23:return ed(),null;case 24:return null;default:return null}}var da=!1,Ee=!1,Xw=typeof WeakSet=="function"?WeakSet:Set,ot=null;function jn(e,s){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(a){Qt(e,s,a)}else r.current=null}function su(e,s,r){try{r()}catch(a){Qt(e,s,a)}}var Yp=!1;function $w(e,s){if(Nc=Ma,e=wm(),Fu(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else t:{r=(r=e.ownerDocument)&&r.defaultView||window;var a=r.getSelection&&r.getSelection();if(a&&a.rangeCount!==0){r=a.anchorNode;var h=a.anchorOffset,u=a.focusNode;a=a.focusOffset;try{r.nodeType,u.nodeType}catch{r=null;break t}var p=0,m=-1,_=-1,y=0,A=0,E=e,S=null;e:for(;;){for(var R;E!==r||h!==0&&E.nodeType!==3||(m=p+h),E!==u||a!==0&&E.nodeType!==3||(_=p+a),E.nodeType===3&&(p+=E.nodeValue.length),(R=E.firstChild)!==null;)S=E,E=R;for(;;){if(E===e)break e;if(S===r&&++y===h&&(m=p),S===u&&++A===a&&(_=p),(R=E.nextSibling)!==null)break;E=S,S=E.parentNode}E=R}r=m===-1||_===-1?null:{start:m,end:_}}else r=null}r=r||{start:0,end:0}}else r=null;for(Hc={focusedElem:e,selectionRange:r},Ma=!1,ot=s;ot!==null;)if(s=ot,e=s.child,(s.subtreeFlags&1028)!==0&&e!==null)e.return=s,ot=e;else for(;ot!==null;){s=ot;try{var M=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var U=M.memoizedProps,$=M.memoizedState,I=s.stateNode,P=I.getSnapshotBeforeUpdate(s.elementType===s.type?U:bi(s.type,U),$);I.__reactInternalSnapshotBeforeUpdate=P}break;case 3:var F=s.stateNode.containerInfo;F.nodeType===1?F.textContent="":F.nodeType===9&&F.documentElement&&F.removeChild(F.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(j){Qt(s,s.return,j)}if(e=s.sibling,e!==null){e.return=s.return,ot=e;break}ot=s.return}return M=Yp,Yp=!1,M}function $r(e,s,r){var a=s.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var h=a=a.next;do{if((h.tag&e)===e){var u=h.destroy;h.destroy=void 0,u!==void 0&&su(s,r,u)}h=h.next}while(h!==a)}}function fl(e,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&e)===e){var a=r.create;r.destroy=a()}r=r.next}while(r!==s)}}function nu(e){var s=e.ref;if(s!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof s=="function"?s(e):s.current=e}}function m_(e){var s=e.alternate;s!==null&&(e.alternate=null,m_(s)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(s=e.stateNode,s!==null&&(delete s[Ni],delete s[ao],delete s[Gc],delete s[Iw],delete s[Rw])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function __(e){return e.tag===5||e.tag===3||e.tag===4}function Qp(e){t:for(;;){for(;e.sibling===null;){if(e.return===null||__(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue t;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ru(e,s,r){var a=e.tag;if(a===5||a===6)e=e.stateNode,s?r.nodeType===8?r.parentNode.insertBefore(e,s):r.insertBefore(e,s):(r.nodeType===8?(s=r.parentNode,s.insertBefore(e,r)):(s=r,s.appendChild(e)),r=r._reactRootContainer,r!=null||s.onclick!==null||(s.onclick=Oa));else if(a!==4&&(e=e.child,e!==null))for(ru(e,s,r),e=e.sibling;e!==null;)ru(e,s,r),e=e.sibling}function ou(e,s,r){var a=e.tag;if(a===5||a===6)e=e.stateNode,s?r.insertBefore(e,s):r.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(ou(e,s,r),e=e.sibling;e!==null;)ou(e,s,r),e=e.sibling}var we=null,Ai=!1;function us(e,s,r){for(r=r.child;r!==null;)v_(e,s,r),r=r.sibling}function v_(e,s,r){if(Hi&&typeof Hi.onCommitFiberUnmount=="function")try{Hi.onCommitFiberUnmount(rl,r)}catch{}switch(r.tag){case 5:Ee||jn(r,s);case 6:var a=we,h=Ai;we=null,us(e,s,r),we=a,Ai=h,we!==null&&(Ai?(e=we,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):we.removeChild(r.stateNode));break;case 18:we!==null&&(Ai?(e=we,r=r.stateNode,e.nodeType===8?Jh(e.parentNode,r):e.nodeType===1&&Jh(e,r),io(e)):Jh(we,r.stateNode));break;case 4:a=we,h=Ai,we=r.stateNode.containerInfo,Ai=!0,us(e,s,r),we=a,Ai=h;break;case 0:case 11:case 14:case 15:if(!Ee&&(a=r.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){h=a=a.next;do{var u=h,p=u.destroy;u=u.tag,p!==void 0&&(u&2||u&4)&&su(r,s,p),h=h.next}while(h!==a)}us(e,s,r);break;case 1:if(!Ee&&(jn(r,s),a=r.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=r.memoizedProps,a.state=r.memoizedState,a.componentWillUnmount()}catch(m){Qt(r,s,m)}us(e,s,r);break;case 21:us(e,s,r);break;case 22:r.mode&1?(Ee=(a=Ee)||r.memoizedState!==null,us(e,s,r),Ee=a):us(e,s,r);break;default:us(e,s,r)}}function Zp(e){var s=e.updateQueue;if(s!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Xw),s.forEach(function(a){var h=ix.bind(null,e,a);r.has(a)||(r.add(a),a.then(h,h))})}}function Ci(e,s){var r=s.deletions;if(r!==null)for(var a=0;a<r.length;a++){var h=r[a];try{var u=e,p=s,m=p;t:for(;m!==null;){switch(m.tag){case 5:we=m.stateNode,Ai=!1;break t;case 3:we=m.stateNode.containerInfo,Ai=!0;break t;case 4:we=m.stateNode.containerInfo,Ai=!0;break t}m=m.return}if(we===null)throw Error(J(160));v_(u,p,h),we=null,Ai=!1;var _=h.alternate;_!==null&&(_.return=null),h.return=null}catch(y){Qt(h,s,y)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)y_(s,e),s=s.sibling}function y_(e,s){var r=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Ci(s,e),Oi(e),a&4){try{$r(3,e,e.return),fl(3,e)}catch(U){Qt(e,e.return,U)}try{$r(5,e,e.return)}catch(U){Qt(e,e.return,U)}}break;case 1:Ci(s,e),Oi(e),a&512&&r!==null&&jn(r,r.return);break;case 5:if(Ci(s,e),Oi(e),a&512&&r!==null&&jn(r,r.return),e.flags&32){var h=e.stateNode;try{Kr(h,"")}catch(U){Qt(e,e.return,U)}}if(a&4&&(h=e.stateNode,h!=null)){var u=e.memoizedProps,p=r!==null?r.memoizedProps:u,m=e.type,_=e.updateQueue;if(e.updateQueue=null,_!==null)try{m==="input"&&u.type==="radio"&&u.name!=null&&Hg(h,u),Rc(m,p);var y=Rc(m,u);for(p=0;p<_.length;p+=2){var A=_[p],E=_[p+1];A==="style"?Xg(h,E):A==="dangerouslySetInnerHTML"?Gg(h,E):A==="children"?Kr(h,E):wu(h,A,E,y)}switch(m){case"input":Sc(h,u);break;case"textarea":Wg(h,u);break;case"select":var S=h._wrapperState.wasMultiple;h._wrapperState.wasMultiple=!!u.multiple;var R=u.value;R!=null?Vn(h,!!u.multiple,R,!1):S!==!!u.multiple&&(u.defaultValue!=null?Vn(h,!!u.multiple,u.defaultValue,!0):Vn(h,!!u.multiple,u.multiple?[]:"",!1))}h[ao]=u}catch(U){Qt(e,e.return,U)}}break;case 6:if(Ci(s,e),Oi(e),a&4){if(e.stateNode===null)throw Error(J(162));h=e.stateNode,u=e.memoizedProps;try{h.nodeValue=u}catch(U){Qt(e,e.return,U)}}break;case 3:if(Ci(s,e),Oi(e),a&4&&r!==null&&r.memoizedState.isDehydrated)try{io(s.containerInfo)}catch(U){Qt(e,e.return,U)}break;case 4:Ci(s,e),Oi(e);break;case 13:Ci(s,e),Oi(e),h=e.child,h.flags&8192&&(u=h.memoizedState!==null,h.stateNode.isHidden=u,!u||h.alternate!==null&&h.alternate.memoizedState!==null||(Ju=qt())),a&4&&Zp(e);break;case 22:if(A=r!==null&&r.memoizedState!==null,e.mode&1?(Ee=(y=Ee)||A,Ci(s,e),Ee=y):Ci(s,e),Oi(e),a&8192){if(y=e.memoizedState!==null,(e.stateNode.isHidden=y)&&!A&&e.mode&1)for(ot=e,A=e.child;A!==null;){for(E=ot=A;ot!==null;){switch(S=ot,R=S.child,S.tag){case 0:case 11:case 14:case 15:$r(4,S,S.return);break;case 1:jn(S,S.return);var M=S.stateNode;if(typeof M.componentWillUnmount=="function"){a=S,r=S.return;try{s=a,M.props=s.memoizedProps,M.state=s.memoizedState,M.componentWillUnmount()}catch(U){Qt(a,r,U)}}break;case 5:jn(S,S.return);break;case 22:if(S.memoizedState!==null){Kp(E);continue}}R!==null?(R.return=S,ot=R):Kp(E)}A=A.sibling}t:for(A=null,E=e;;){if(E.tag===5){if(A===null){A=E;try{h=E.stateNode,y?(u=h.style,typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"):(m=E.stateNode,_=E.memoizedProps.style,p=_!=null&&_.hasOwnProperty("display")?_.display:null,m.style.display=Vg("display",p))}catch(U){Qt(e,e.return,U)}}}else if(E.tag===6){if(A===null)try{E.stateNode.nodeValue=y?"":E.memoizedProps}catch(U){Qt(e,e.return,U)}}else if((E.tag!==22&&E.tag!==23||E.memoizedState===null||E===e)&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===e)break t;for(;E.sibling===null;){if(E.return===null||E.return===e)break t;A===E&&(A=null),E=E.return}A===E&&(A=null),E.sibling.return=E.return,E=E.sibling}}break;case 19:Ci(s,e),Oi(e),a&4&&Zp(e);break;case 21:break;default:Ci(s,e),Oi(e)}}function Oi(e){var s=e.flags;if(s&2){try{t:{for(var r=e.return;r!==null;){if(__(r)){var a=r;break t}r=r.return}throw Error(J(160))}switch(a.tag){case 5:var h=a.stateNode;a.flags&32&&(Kr(h,""),a.flags&=-33);var u=Qp(e);ou(e,u,h);break;case 3:case 4:var p=a.stateNode.containerInfo,m=Qp(e);ru(e,m,p);break;default:throw Error(J(161))}}catch(_){Qt(e,e.return,_)}e.flags&=-3}s&4096&&(e.flags&=-4097)}function Yw(e,s,r){ot=e,w_(e)}function w_(e,s,r){for(var a=(e.mode&1)!==0;ot!==null;){var h=ot,u=h.child;if(h.tag===22&&a){var p=h.memoizedState!==null||da;if(!p){var m=h.alternate,_=m!==null&&m.memoizedState!==null||Ee;m=da;var y=Ee;if(da=p,(Ee=_)&&!y)for(ot=h;ot!==null;)p=ot,_=p.child,p.tag===22&&p.memoizedState!==null?Jp(h):_!==null?(_.return=p,ot=_):Jp(h);for(;u!==null;)ot=u,w_(u),u=u.sibling;ot=h,da=m,Ee=y}qp(e)}else h.subtreeFlags&8772&&u!==null?(u.return=h,ot=u):qp(e)}}function qp(e){for(;ot!==null;){var s=ot;if(s.flags&8772){var r=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:Ee||fl(5,s);break;case 1:var a=s.stateNode;if(s.flags&4&&!Ee)if(r===null)a.componentDidMount();else{var h=s.elementType===s.type?r.memoizedProps:bi(s.type,r.memoizedProps);a.componentDidUpdate(h,r.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var u=s.updateQueue;u!==null&&Mp(s,u,a);break;case 3:var p=s.updateQueue;if(p!==null){if(r=null,s.child!==null)switch(s.child.tag){case 5:r=s.child.stateNode;break;case 1:r=s.child.stateNode}Mp(s,p,r)}break;case 5:var m=s.stateNode;if(r===null&&s.flags&4){r=m;var _=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":_.autoFocus&&r.focus();break;case"img":_.src&&(r.src=_.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var y=s.alternate;if(y!==null){var A=y.memoizedState;if(A!==null){var E=A.dehydrated;E!==null&&io(E)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}Ee||s.flags&512&&nu(s)}catch(S){Qt(s,s.return,S)}}if(s===e){ot=null;break}if(r=s.sibling,r!==null){r.return=s.return,ot=r;break}ot=s.return}}function Kp(e){for(;ot!==null;){var s=ot;if(s===e){ot=null;break}var r=s.sibling;if(r!==null){r.return=s.return,ot=r;break}ot=s.return}}function Jp(e){for(;ot!==null;){var s=ot;try{switch(s.tag){case 0:case 11:case 15:var r=s.return;try{fl(4,s)}catch(_){Qt(s,r,_)}break;case 1:var a=s.stateNode;if(typeof a.componentDidMount=="function"){var h=s.return;try{a.componentDidMount()}catch(_){Qt(s,h,_)}}var u=s.return;try{nu(s)}catch(_){Qt(s,u,_)}break;case 5:var p=s.return;try{nu(s)}catch(_){Qt(s,p,_)}}}catch(_){Qt(s,s.return,_)}if(s===e){ot=null;break}var m=s.sibling;if(m!==null){m.return=s.return,ot=m;break}ot=s.return}}var Qw=Math.ceil,Qa=rs.ReactCurrentDispatcher,qu=rs.ReactCurrentOwner,mi=rs.ReactCurrentBatchConfig,Et=0,de=null,te=null,xe=0,si=0,Gn=Is(0),le=0,po=null,ln=0,pl=0,Ku=0,Yr=null,$e=null,Ju=0,sr=1/0,Zi=null,Za=!1,au=null,bs=null,fa=!1,_s=null,qa=0,Qr=0,lu=null,Ea=-1,Ta=0;function Me(){return Et&6?qt():Ea!==-1?Ea:Ea=qt()}function As(e){return e.mode&1?Et&2&&xe!==0?xe&-xe:kw.transition!==null?(Ta===0&&(Ta=nm()),Ta):(e=Rt,e!==0||(e=window.event,e=e===void 0?16:um(e.type)),e):1}function Ti(e,s,r,a){if(50<Qr)throw Qr=0,lu=null,Error(J(185));mo(e,r,a),(!(Et&2)||e!==de)&&(e===de&&(!(Et&2)&&(pl|=r),le===4&&gs(e,xe)),qe(e,a),r===1&&Et===0&&!(s.mode&1)&&(sr=qt()+500,cl&&Rs()))}function qe(e,s){var r=e.callbackNode;ky(e,s);var a=Ba(e,e===de?xe:0);if(a===0)r!==null&&lp(r),e.callbackNode=null,e.callbackPriority=0;else if(s=a&-a,e.callbackPriority!==s){if(r!=null&&lp(r),s===1)e.tag===0?Dw(tg.bind(null,e)):Rm(tg.bind(null,e)),Tw(function(){!(Et&6)&&Rs()}),r=null;else{switch(rm(a)){case 1:r=Su;break;case 4:r=im;break;case 16:r=Fa;break;case 536870912:r=sm;break;default:r=Fa}r=P_(r,x_.bind(null,e))}e.callbackPriority=s,e.callbackNode=r}}function x_(e,s){if(Ea=-1,Ta=0,Et&6)throw Error(J(327));var r=e.callbackNode;if(Zn()&&e.callbackNode!==r)return null;var a=Ba(e,e===de?xe:0);if(a===0)return null;if(a&30||a&e.expiredLanes||s)s=Ka(e,a);else{s=a;var h=Et;Et|=2;var u=b_();(de!==e||xe!==s)&&(Zi=null,sr=qt()+500,sn(e,s));do try{Kw();break}catch(m){C_(e,m)}while(!0);Ou(),Qa.current=u,Et=h,te!==null?s=0:(de=null,xe=0,s=le)}if(s!==0){if(s===2&&(h=Mc(e),h!==0&&(a=h,s=hu(e,h))),s===1)throw r=po,sn(e,0),gs(e,a),qe(e,qt()),r;if(s===6)gs(e,a);else{if(h=e.current.alternate,!(a&30)&&!Zw(h)&&(s=Ka(e,a),s===2&&(u=Mc(e),u!==0&&(a=u,s=hu(e,u))),s===1))throw r=po,sn(e,0),gs(e,a),qe(e,qt()),r;switch(e.finishedWork=h,e.finishedLanes=a,s){case 0:case 1:throw Error(J(345));case 2:qs(e,$e,Zi);break;case 3:if(gs(e,a),(a&130023424)===a&&(s=Ju+500-qt(),10<s)){if(Ba(e,0)!==0)break;if(h=e.suspendedLanes,(h&a)!==a){Me(),e.pingedLanes|=e.suspendedLanes&h;break}e.timeoutHandle=jc(qs.bind(null,e,$e,Zi),s);break}qs(e,$e,Zi);break;case 4:if(gs(e,a),(a&4194240)===a)break;for(s=e.eventTimes,h=-1;0<a;){var p=31-Ei(a);u=1<<p,p=s[p],p>h&&(h=p),a&=~u}if(a=h,a=qt()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*Qw(a/1960))-a,10<a){e.timeoutHandle=jc(qs.bind(null,e,$e,Zi),a);break}qs(e,$e,Zi);break;case 5:qs(e,$e,Zi);break;default:throw Error(J(329))}}}return qe(e,qt()),e.callbackNode===r?x_.bind(null,e):null}function hu(e,s){var r=Yr;return e.current.memoizedState.isDehydrated&&(sn(e,s).flags|=256),e=Ka(e,s),e!==2&&(s=$e,$e=r,s!==null&&cu(s)),e}function cu(e){$e===null?$e=e:$e.push.apply($e,e)}function Zw(e){for(var s=e;;){if(s.flags&16384){var r=s.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var a=0;a<r.length;a++){var h=r[a],u=h.getSnapshot;h=h.value;try{if(!Pi(u(),h))return!1}catch{return!1}}}if(r=s.child,s.subtreeFlags&16384&&r!==null)r.return=s,s=r;else{if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function gs(e,s){for(s&=~Ku,s&=~pl,e.suspendedLanes|=s,e.pingedLanes&=~s,e=e.expirationTimes;0<s;){var r=31-Ei(s),a=1<<r;e[r]=-1,s&=~a}}function tg(e){if(Et&6)throw Error(J(327));Zn();var s=Ba(e,0);if(!(s&1))return qe(e,qt()),null;var r=Ka(e,s);if(e.tag!==0&&r===2){var a=Mc(e);a!==0&&(s=a,r=hu(e,a))}if(r===1)throw r=po,sn(e,0),gs(e,s),qe(e,qt()),r;if(r===6)throw Error(J(345));return e.finishedWork=e.current.alternate,e.finishedLanes=s,qs(e,$e,Zi),qe(e,qt()),null}function td(e,s){var r=Et;Et|=1;try{return e(s)}finally{Et=r,Et===0&&(sr=qt()+500,cl&&Rs())}}function hn(e){_s!==null&&_s.tag===0&&!(Et&6)&&Zn();var s=Et;Et|=1;var r=mi.transition,a=Rt;try{if(mi.transition=null,Rt=1,e)return e()}finally{Rt=a,mi.transition=r,Et=s,!(Et&6)&&Rs()}}function ed(){si=Gn.current,Bt(Gn)}function sn(e,s){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Ew(r)),te!==null)for(r=te.return;r!==null;){var a=r;switch(Mu(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&Ua();break;case 3:er(),Bt(Qe),Bt(Te),Gu();break;case 5:ju(a);break;case 4:er();break;case 13:Bt(jt);break;case 19:Bt(jt);break;case 10:Uu(a.type._context);break;case 22:case 23:ed()}r=r.return}if(de=e,te=e=Ss(e.current,null),xe=si=s,le=0,po=null,Ku=pl=ln=0,$e=Yr=null,tn!==null){for(s=0;s<tn.length;s++)if(r=tn[s],a=r.interleaved,a!==null){r.interleaved=null;var h=a.next,u=r.pending;if(u!==null){var p=u.next;u.next=h,a.next=p}r.pending=a}tn=null}return e}function C_(e,s){do{var r=te;try{if(Ou(),ba.current=Ya,$a){for(var a=Gt.memoizedState;a!==null;){var h=a.queue;h!==null&&(h.pending=null),a=a.next}$a=!1}if(an=0,ue=ae=Gt=null,Xr=!1,co=0,qu.current=null,r===null||r.return===null){le=1,po=s,te=null;break}t:{var u=e,p=r.return,m=r,_=s;if(s=xe,m.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){var y=_,A=m,E=A.tag;if(!(A.mode&1)&&(E===0||E===11||E===15)){var S=A.alternate;S?(A.updateQueue=S.updateQueue,A.memoizedState=S.memoizedState,A.lanes=S.lanes):(A.updateQueue=null,A.memoizedState=null)}var R=Hp(p);if(R!==null){R.flags&=-257,Wp(R,p,m,u,s),R.mode&1&&Np(u,y,s),s=R,_=y;var M=s.updateQueue;if(M===null){var U=new Set;U.add(_),s.updateQueue=U}else M.add(_);break t}else{if(!(s&1)){Np(u,y,s),id();break t}_=Error(J(426))}}else if(Ut&&m.mode&1){var $=Hp(p);if($!==null){!($.flags&65536)&&($.flags|=256),Wp($,p,m,u,s),Lu(ir(_,m));break t}}u=_=ir(_,m),le!==4&&(le=2),Yr===null?Yr=[u]:Yr.push(u),u=p;do{switch(u.tag){case 3:u.flags|=65536,s&=-s,u.lanes|=s;var I=r_(u,_,s);Bp(u,I);break t;case 1:m=_;var P=u.type,F=u.stateNode;if(!(u.flags&128)&&(typeof P.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(bs===null||!bs.has(F)))){u.flags|=65536,s&=-s,u.lanes|=s;var j=o_(u,m,s);Bp(u,j);break t}}u=u.return}while(u!==null)}S_(r)}catch(W){s=W,te===r&&r!==null&&(te=r=r.return);continue}break}while(!0)}function b_(){var e=Qa.current;return Qa.current=Ya,e===null?Ya:e}function id(){(le===0||le===3||le===2)&&(le=4),de===null||!(ln&268435455)&&!(pl&268435455)||gs(de,xe)}function Ka(e,s){var r=Et;Et|=2;var a=b_();(de!==e||xe!==s)&&(Zi=null,sn(e,s));do try{qw();break}catch(h){C_(e,h)}while(!0);if(Ou(),Et=r,Qa.current=a,te!==null)throw Error(J(261));return de=null,xe=0,le}function qw(){for(;te!==null;)A_(te)}function Kw(){for(;te!==null&&!by();)A_(te)}function A_(e){var s=T_(e.alternate,e,si);e.memoizedProps=e.pendingProps,s===null?S_(e):te=s,qu.current=null}function S_(e){var s=e;do{var r=s.alternate;if(e=s.return,s.flags&32768){if(r=Vw(r,s),r!==null){r.flags&=32767,te=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{le=6,te=null;return}}else if(r=Gw(r,s,si),r!==null){te=r;return}if(s=s.sibling,s!==null){te=s;return}te=s=e}while(s!==null);le===0&&(le=5)}function qs(e,s,r){var a=Rt,h=mi.transition;try{mi.transition=null,Rt=1,Jw(e,s,r,a)}finally{mi.transition=h,Rt=a}return null}function Jw(e,s,r,a){do Zn();while(_s!==null);if(Et&6)throw Error(J(327));r=e.finishedWork;var h=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(J(177));e.callbackNode=null,e.callbackPriority=0;var u=r.lanes|r.childLanes;if(Fy(e,u),e===de&&(te=de=null,xe=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||fa||(fa=!0,P_(Fa,function(){return Zn(),null})),u=(r.flags&15990)!==0,r.subtreeFlags&15990||u){u=mi.transition,mi.transition=null;var p=Rt;Rt=1;var m=Et;Et|=4,qu.current=null,$w(e,r),y_(r,e),yw(Hc),Ma=!!Nc,Hc=Nc=null,e.current=r,Yw(r),Ay(),Et=m,Rt=p,mi.transition=u}else e.current=r;if(fa&&(fa=!1,_s=e,qa=h),u=e.pendingLanes,u===0&&(bs=null),Ty(r.stateNode),qe(e,qt()),s!==null)for(a=e.onRecoverableError,r=0;r<s.length;r++)h=s[r],a(h.value,{componentStack:h.stack,digest:h.digest});if(Za)throw Za=!1,e=au,au=null,e;return qa&1&&e.tag!==0&&Zn(),u=e.pendingLanes,u&1?e===lu?Qr++:(Qr=0,lu=e):Qr=0,Rs(),null}function Zn(){if(_s!==null){var e=rm(qa),s=mi.transition,r=Rt;try{if(mi.transition=null,Rt=16>e?16:e,_s===null)var a=!1;else{if(e=_s,_s=null,qa=0,Et&6)throw Error(J(331));var h=Et;for(Et|=4,ot=e.current;ot!==null;){var u=ot,p=u.child;if(ot.flags&16){var m=u.deletions;if(m!==null){for(var _=0;_<m.length;_++){var y=m[_];for(ot=y;ot!==null;){var A=ot;switch(A.tag){case 0:case 11:case 15:$r(8,A,u)}var E=A.child;if(E!==null)E.return=A,ot=E;else for(;ot!==null;){A=ot;var S=A.sibling,R=A.return;if(m_(A),A===y){ot=null;break}if(S!==null){S.return=R,ot=S;break}ot=R}}}var M=u.alternate;if(M!==null){var U=M.child;if(U!==null){M.child=null;do{var $=U.sibling;U.sibling=null,U=$}while(U!==null)}}ot=u}}if(u.subtreeFlags&2064&&p!==null)p.return=u,ot=p;else t:for(;ot!==null;){if(u=ot,u.flags&2048)switch(u.tag){case 0:case 11:case 15:$r(9,u,u.return)}var I=u.sibling;if(I!==null){I.return=u.return,ot=I;break t}ot=u.return}}var P=e.current;for(ot=P;ot!==null;){p=ot;var F=p.child;if(p.subtreeFlags&2064&&F!==null)F.return=p,ot=F;else t:for(p=P;ot!==null;){if(m=ot,m.flags&2048)try{switch(m.tag){case 0:case 11:case 15:fl(9,m)}}catch(W){Qt(m,m.return,W)}if(m===p){ot=null;break t}var j=m.sibling;if(j!==null){j.return=m.return,ot=j;break t}ot=m.return}}if(Et=h,Rs(),Hi&&typeof Hi.onPostCommitFiberRoot=="function")try{Hi.onPostCommitFiberRoot(rl,e)}catch{}a=!0}return a}finally{Rt=r,mi.transition=s}}return!1}function eg(e,s,r){s=ir(r,s),s=r_(e,s,1),e=Cs(e,s,1),s=Me(),e!==null&&(mo(e,1,s),qe(e,s))}function Qt(e,s,r){if(e.tag===3)eg(e,e,r);else for(;s!==null;){if(s.tag===3){eg(s,e,r);break}else if(s.tag===1){var a=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(bs===null||!bs.has(a))){e=ir(r,e),e=o_(s,e,1),s=Cs(s,e,1),e=Me(),s!==null&&(mo(s,1,e),qe(s,e));break}}s=s.return}}function tx(e,s,r){var a=e.pingCache;a!==null&&a.delete(s),s=Me(),e.pingedLanes|=e.suspendedLanes&r,de===e&&(xe&r)===r&&(le===4||le===3&&(xe&130023424)===xe&&500>qt()-Ju?sn(e,0):Ku|=r),qe(e,s)}function E_(e,s){s===0&&(e.mode&1?(s=sa,sa<<=1,!(sa&130023424)&&(sa=4194304)):s=1);var r=Me();e=ss(e,s),e!==null&&(mo(e,s,r),qe(e,r))}function ex(e){var s=e.memoizedState,r=0;s!==null&&(r=s.retryLane),E_(e,r)}function ix(e,s){var r=0;switch(e.tag){case 13:var a=e.stateNode,h=e.memoizedState;h!==null&&(r=h.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(J(314))}a!==null&&a.delete(s),E_(e,r)}var T_;T_=function(e,s,r){if(e!==null)if(e.memoizedProps!==s.pendingProps||Qe.current)Ye=!0;else{if(!(e.lanes&r)&&!(s.flags&128))return Ye=!1,jw(e,s,r);Ye=!!(e.flags&131072)}else Ye=!1,Ut&&s.flags&1048576&&Dm(s,Wa,s.index);switch(s.lanes=0,s.tag){case 2:var a=s.type;Sa(e,s),e=s.pendingProps;var h=Kn(s,Te.current);Qn(s,r),h=Xu(null,s,a,e,h,r);var u=$u();return s.flags|=1,typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Ze(a)?(u=!0,Na(s)):u=!1,s.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,Hu(s),h.updater=dl,s.stateNode=h,h._reactInternals=s,Zc(s,a,e,r),s=Jc(null,s,a,!0,u,r)):(s.tag=0,Ut&&u&&Bu(s),Be(null,s,h,r),s=s.child),s;case 16:a=s.elementType;t:{switch(Sa(e,s),e=s.pendingProps,h=a._init,a=h(a._payload),s.type=a,h=s.tag=nx(a),e=bi(a,e),h){case 0:s=Kc(null,s,a,e,r);break t;case 1:s=Vp(null,s,a,e,r);break t;case 11:s=jp(null,s,a,e,r);break t;case 14:s=Gp(null,s,a,bi(a.type,e),r);break t}throw Error(J(306,a,""))}return s;case 0:return a=s.type,h=s.pendingProps,h=s.elementType===a?h:bi(a,h),Kc(e,s,a,h,r);case 1:return a=s.type,h=s.pendingProps,h=s.elementType===a?h:bi(a,h),Vp(e,s,a,h,r);case 3:t:{if(c_(s),e===null)throw Error(J(387));a=s.pendingProps,u=s.memoizedState,h=u.element,zm(e,s),Va(s,a,null,r);var p=s.memoizedState;if(a=p.element,u.isDehydrated)if(u={element:a,isDehydrated:!1,cache:p.cache,pendingSuspenseBoundaries:p.pendingSuspenseBoundaries,transitions:p.transitions},s.updateQueue.baseState=u,s.memoizedState=u,s.flags&256){h=ir(Error(J(423)),s),s=Xp(e,s,a,r,h);break t}else if(a!==h){h=ir(Error(J(424)),s),s=Xp(e,s,a,r,h);break t}else for(ni=xs(s.stateNode.containerInfo.firstChild),oi=s,Ut=!0,Si=null,r=Mm(s,null,a,r),s.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Jn(),a===h){s=ns(e,s,r);break t}Be(e,s,a,r)}s=s.child}return s;case 5:return Om(s),e===null&&$c(s),a=s.type,h=s.pendingProps,u=e!==null?e.memoizedProps:null,p=h.children,Wc(a,h)?p=null:u!==null&&Wc(a,u)&&(s.flags|=32),h_(e,s),Be(e,s,p,r),s.child;case 6:return e===null&&$c(s),null;case 13:return u_(e,s,r);case 4:return Wu(s,s.stateNode.containerInfo),a=s.pendingProps,e===null?s.child=tr(s,null,a,r):Be(e,s,a,r),s.child;case 11:return a=s.type,h=s.pendingProps,h=s.elementType===a?h:bi(a,h),jp(e,s,a,h,r);case 7:return Be(e,s,s.pendingProps,r),s.child;case 8:return Be(e,s,s.pendingProps.children,r),s.child;case 12:return Be(e,s,s.pendingProps.children,r),s.child;case 10:t:{if(a=s.type._context,h=s.pendingProps,u=s.memoizedProps,p=h.value,kt(ja,a._currentValue),a._currentValue=p,u!==null)if(Pi(u.value,p)){if(u.children===h.children&&!Qe.current){s=ns(e,s,r);break t}}else for(u=s.child,u!==null&&(u.return=s);u!==null;){var m=u.dependencies;if(m!==null){p=u.child;for(var _=m.firstContext;_!==null;){if(_.context===a){if(u.tag===1){_=ts(-1,r&-r),_.tag=2;var y=u.updateQueue;if(y!==null){y=y.shared;var A=y.pending;A===null?_.next=_:(_.next=A.next,A.next=_),y.pending=_}}u.lanes|=r,_=u.alternate,_!==null&&(_.lanes|=r),Yc(u.return,r,s),m.lanes|=r;break}_=_.next}}else if(u.tag===10)p=u.type===s.type?null:u.child;else if(u.tag===18){if(p=u.return,p===null)throw Error(J(341));p.lanes|=r,m=p.alternate,m!==null&&(m.lanes|=r),Yc(p,r,s),p=u.sibling}else p=u.child;if(p!==null)p.return=u;else for(p=u;p!==null;){if(p===s){p=null;break}if(u=p.sibling,u!==null){u.return=p.return,p=u;break}p=p.return}u=p}Be(e,s,h.children,r),s=s.child}return s;case 9:return h=s.type,a=s.pendingProps.children,Qn(s,r),h=_i(h),a=a(h),s.flags|=1,Be(e,s,a,r),s.child;case 14:return a=s.type,h=bi(a,s.pendingProps),h=bi(a.type,h),Gp(e,s,a,h,r);case 15:return a_(e,s,s.type,s.pendingProps,r);case 17:return a=s.type,h=s.pendingProps,h=s.elementType===a?h:bi(a,h),Sa(e,s),s.tag=1,Ze(a)?(e=!0,Na(s)):e=!1,Qn(s,r),n_(s,a,h),Zc(s,a,h,r),Jc(null,s,a,!0,e,r);case 19:return d_(e,s,r);case 22:return l_(e,s,r)}throw Error(J(156,s.tag))};function P_(e,s){return em(e,s)}function sx(e,s,r,a){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(e,s,r,a){return new sx(e,s,r,a)}function sd(e){return e=e.prototype,!(!e||!e.isReactComponent)}function nx(e){if(typeof e=="function")return sd(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Cu)return 11;if(e===bu)return 14}return 2}function Ss(e,s){var r=e.alternate;return r===null?(r=gi(e.tag,s,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=s,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,s=e.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Pa(e,s,r,a,h,u){var p=2;if(a=e,typeof e=="function")sd(e)&&(p=1);else if(typeof e=="string")p=5;else t:switch(e){case Bn:return nn(r.children,h,u,s);case xu:p=8,h|=8;break;case wc:return e=gi(12,r,s,h|2),e.elementType=wc,e.lanes=u,e;case xc:return e=gi(13,r,s,h),e.elementType=xc,e.lanes=u,e;case Cc:return e=gi(19,r,s,h),e.elementType=Cc,e.lanes=u,e;case Og:return gl(r,h,u,s);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Lg:p=10;break t;case zg:p=9;break t;case Cu:p=11;break t;case bu:p=14;break t;case ds:p=16,a=null;break t}throw Error(J(130,e==null?e:typeof e,""))}return s=gi(p,r,s,h),s.elementType=e,s.type=a,s.lanes=u,s}function nn(e,s,r,a){return e=gi(7,e,a,s),e.lanes=r,e}function gl(e,s,r,a){return e=gi(22,e,a,s),e.elementType=Og,e.lanes=r,e.stateNode={isHidden:!1},e}function ac(e,s,r){return e=gi(6,e,null,s),e.lanes=r,e}function lc(e,s,r){return s=gi(4,e.children!==null?e.children:[],e.key,s),s.lanes=r,s.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},s}function rx(e,s,r,a,h){this.tag=s,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Wh(0),this.expirationTimes=Wh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wh(0),this.identifierPrefix=a,this.onRecoverableError=h,this.mutableSourceEagerHydrationData=null}function nd(e,s,r,a,h,u,p,m,_){return e=new rx(e,s,r,m,_),s===1?(s=1,u===!0&&(s|=8)):s=0,u=gi(3,null,null,s),e.current=u,u.stateNode=e,u.memoizedState={element:a,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Hu(u),e}function ox(e,s,r){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fn,key:a==null?null:""+a,children:e,containerInfo:s,implementation:r}}function I_(e){if(!e)return Ts;e=e._reactInternals;t:{if(un(e)!==e||e.tag!==1)throw Error(J(170));var s=e;do{switch(s.tag){case 3:s=s.stateNode.context;break t;case 1:if(Ze(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break t}}s=s.return}while(s!==null);throw Error(J(171))}if(e.tag===1){var r=e.type;if(Ze(r))return Im(e,r,s)}return s}function R_(e,s,r,a,h,u,p,m,_){return e=nd(r,a,!0,e,h,u,p,m,_),e.context=I_(null),r=e.current,a=Me(),h=As(r),u=ts(a,h),u.callback=s??null,Cs(r,u,h),e.current.lanes=h,mo(e,h,a),qe(e,a),e}function ml(e,s,r,a){var h=s.current,u=Me(),p=As(h);return r=I_(r),s.context===null?s.context=r:s.pendingContext=r,s=ts(u,p),s.payload={element:e},a=a===void 0?null:a,a!==null&&(s.callback=a),e=Cs(h,s,p),e!==null&&(Ti(e,h,p,u),Ca(e,h,p)),p}function Ja(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function ig(e,s){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<s?r:s}}function rd(e,s){ig(e,s),(e=e.alternate)&&ig(e,s)}function ax(){return null}var D_=typeof reportError=="function"?reportError:function(e){console.error(e)};function od(e){this._internalRoot=e}_l.prototype.render=od.prototype.render=function(e){var s=this._internalRoot;if(s===null)throw Error(J(409));ml(e,s,null,null)};_l.prototype.unmount=od.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var s=e.containerInfo;hn(function(){ml(null,e,null,null)}),s[is]=null}};function _l(e){this._internalRoot=e}_l.prototype.unstable_scheduleHydration=function(e){if(e){var s=lm();e={blockedOn:null,target:e,priority:s};for(var r=0;r<ps.length&&s!==0&&s<ps[r].priority;r++);ps.splice(r,0,e),r===0&&cm(e)}};function ad(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function vl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function sg(){}function lx(e,s,r,a,h){if(h){if(typeof a=="function"){var u=a;a=function(){var y=Ja(p);u.call(y)}}var p=R_(s,a,e,0,null,!1,!1,"",sg);return e._reactRootContainer=p,e[is]=p.current,ro(e.nodeType===8?e.parentNode:e),hn(),p}for(;h=e.lastChild;)e.removeChild(h);if(typeof a=="function"){var m=a;a=function(){var y=Ja(_);m.call(y)}}var _=nd(e,0,!1,null,null,!1,!1,"",sg);return e._reactRootContainer=_,e[is]=_.current,ro(e.nodeType===8?e.parentNode:e),hn(function(){ml(s,_,r,a)}),_}function yl(e,s,r,a,h){var u=r._reactRootContainer;if(u){var p=u;if(typeof h=="function"){var m=h;h=function(){var _=Ja(p);m.call(_)}}ml(s,p,e,h)}else p=lx(r,s,e,h,a);return Ja(p)}om=function(e){switch(e.tag){case 3:var s=e.stateNode;if(s.current.memoizedState.isDehydrated){var r=Ur(s.pendingLanes);r!==0&&(Eu(s,r|1),qe(s,qt()),!(Et&6)&&(sr=qt()+500,Rs()))}break;case 13:hn(function(){var a=ss(e,1);if(a!==null){var h=Me();Ti(a,e,1,h)}}),rd(e,1)}};Tu=function(e){if(e.tag===13){var s=ss(e,134217728);if(s!==null){var r=Me();Ti(s,e,134217728,r)}rd(e,134217728)}};am=function(e){if(e.tag===13){var s=As(e),r=ss(e,s);if(r!==null){var a=Me();Ti(r,e,s,a)}rd(e,s)}};lm=function(){return Rt};hm=function(e,s){var r=Rt;try{return Rt=e,s()}finally{Rt=r}};kc=function(e,s,r){switch(s){case"input":if(Sc(e,r),s=r.name,r.type==="radio"&&s!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<r.length;s++){var a=r[s];if(a!==e&&a.form===e.form){var h=hl(a);if(!h)throw Error(J(90));Ng(a),Sc(a,h)}}}break;case"textarea":Wg(e,r);break;case"select":s=r.value,s!=null&&Vn(e,!!r.multiple,s,!1)}};Qg=td;Zg=hn;var hx={usingClientEntryPoint:!1,Events:[vo,On,hl,$g,Yg,td]},Mr={findFiberByHostInstance:Js,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},cx={bundleType:Mr.bundleType,version:Mr.version,rendererPackageName:Mr.rendererPackageName,rendererConfig:Mr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:rs.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Jg(e),e===null?null:e.stateNode},findFiberByHostInstance:Mr.findFiberByHostInstance||ax,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pa=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pa.isDisabled&&pa.supportsFiber)try{rl=pa.inject(cx),Hi=pa}catch{}}li.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hx;li.createPortal=function(e,s){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ad(s))throw Error(J(200));return ox(e,s,null,r)};li.createRoot=function(e,s){if(!ad(e))throw Error(J(299));var r=!1,a="",h=D_;return s!=null&&(s.unstable_strictMode===!0&&(r=!0),s.identifierPrefix!==void 0&&(a=s.identifierPrefix),s.onRecoverableError!==void 0&&(h=s.onRecoverableError)),s=nd(e,1,!1,null,null,r,!1,a,h),e[is]=s.current,ro(e.nodeType===8?e.parentNode:e),new od(s)};li.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var s=e._reactInternals;if(s===void 0)throw typeof e.render=="function"?Error(J(188)):(e=Object.keys(e).join(","),Error(J(268,e)));return e=Jg(s),e=e===null?null:e.stateNode,e};li.flushSync=function(e){return hn(e)};li.hydrate=function(e,s,r){if(!vl(s))throw Error(J(200));return yl(null,e,s,!0,r)};li.hydrateRoot=function(e,s,r){if(!ad(e))throw Error(J(405));var a=r!=null&&r.hydratedSources||null,h=!1,u="",p=D_;if(r!=null&&(r.unstable_strictMode===!0&&(h=!0),r.identifierPrefix!==void 0&&(u=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),s=R_(s,null,e,1,r??null,h,!1,u,p),e[is]=s.current,ro(e),a)for(e=0;e<a.length;e++)r=a[e],h=r._getVersion,h=h(r._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[r,h]:s.mutableSourceEagerHydrationData.push(r,h);return new _l(s)};li.render=function(e,s,r){if(!vl(s))throw Error(J(200));return yl(null,e,s,!1,r)};li.unmountComponentAtNode=function(e){if(!vl(e))throw Error(J(40));return e._reactRootContainer?(hn(function(){yl(null,null,e,!1,function(){e._reactRootContainer=null,e[is]=null})}),!0):!1};li.unstable_batchedUpdates=td;li.unstable_renderSubtreeIntoContainer=function(e,s,r,a){if(!vl(r))throw Error(J(200));if(e==null||e._reactInternals===void 0)throw Error(J(38));return yl(e,s,r,!1,a)};li.version="18.3.1-next-f1338f8080-20240426";function k_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(k_)}catch(e){console.error(e)}}k_(),kg.exports=li;var ux=kg.exports,ng=ux;vc.createRoot=ng.createRoot,vc.hydrateRoot=ng.hydrateRoot;const dx="modulepreload",fx=function(e){return"/ais-telegram-webpages/"+e},rg={},px=function(s,r,a){let h=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),p=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));h=Promise.all(r.map(m=>{if(m=fx(m),m in rg)return;rg[m]=!0;const _=m.endsWith(".css"),y=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${y}`))return;const A=document.createElement("link");if(A.rel=_?"stylesheet":dx,_||(A.as="script",A.crossOrigin=""),A.href=m,p&&A.setAttribute("nonce",p),document.head.appendChild(A),_)return new Promise((E,S)=>{A.addEventListener("load",E),A.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${m}`)))})}))}return h.then(()=>s()).catch(u=>{const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=u,window.dispatchEvent(p),!p.defaultPrevented)throw u})};var F_={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var s={}.hasOwnProperty;function r(){for(var u="",p=0;p<arguments.length;p++){var m=arguments[p];m&&(u=h(u,a(m)))}return u}function a(u){if(typeof u=="string"||typeof u=="number")return u;if(typeof u!="object")return"";if(Array.isArray(u))return r.apply(null,u);if(u.toString!==Object.prototype.toString&&!u.toString.toString().includes("[native code]"))return u.toString();var p="";for(var m in u)s.call(u,m)&&u[m]&&(p=h(p,m));return p}function h(u,p){return p?u?u+" "+p:u+p:u}e.exports?(r.default=r,e.exports=r):window.classNames=r})()})(F_);var gx=F_.exports;const Ue=sl(gx);function Le(){return Le=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},Le.apply(null,arguments)}function wl(e,s){if(e==null)return{};var r={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(s.includes(a))continue;r[a]=e[a]}return r}function uu(e,s){return uu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,a){return r.__proto__=a,r},uu(e,s)}function ji(e,s){e.prototype=Object.create(s.prototype),e.prototype.constructor=e,uu(e,s)}const mx=["xxl","xl","lg","md","sm","xs"],_x="xs",vx=ht.createContext({prefixes:{},breakpoints:mx,minBreakpoint:_x});function ci(e,s){const{prefixes:r}=ht.useContext(vx);return e||r[s]||s}var B_={exports:{}},yx="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",wx=yx,xx=wx;function M_(){}function L_(){}L_.resetWarningCache=M_;var Cx=function(){function e(a,h,u,p,m,_){if(_!==xx){var y=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw y.name="Invariant Violation",y}}e.isRequired=e;function s(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:s,element:e,elementType:e,instanceOf:s,node:e,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:L_,resetWarningCache:M_};return r.PropTypes=r,r};B_.exports=Cx();var bx=B_.exports;const Ks=sl(bx),z_=e=>ht.forwardRef((s,r)=>Q.jsx("div",{...s,ref:r,className:Ue(s.className,e)})),Ax=["as","disabled"];function Sx(e,s){if(e==null)return{};var r={},a=Object.keys(e),h,u;for(u=0;u<a.length;u++)h=a[u],!(s.indexOf(h)>=0)&&(r[h]=e[h]);return r}function Ex(e){return!e||e.trim()==="#"}function O_({tagName:e,disabled:s,href:r,target:a,rel:h,role:u,onClick:p,tabIndex:m=0,type:_}){e||(r!=null||a!=null||h!=null?e="a":e="button");const y={tagName:e};if(e==="button")return[{type:_||"button",disabled:s},y];const A=S=>{if((s||e==="a"&&Ex(r))&&S.preventDefault(),s){S.stopPropagation();return}p==null||p(S)},E=S=>{S.key===" "&&(S.preventDefault(),A(S))};return e==="a"&&(r||(r="#"),s&&(r=void 0)),[{role:u??"button",disabled:void 0,tabIndex:s?void 0:m,href:r,target:e==="a"?a:void 0,"aria-disabled":s||void 0,rel:e==="a"?h:void 0,onClick:A,onKeyDown:E},y]}const Tx=ht.forwardRef((e,s)=>{let{as:r,disabled:a}=e,h=Sx(e,Ax);const[u,{tagName:p}]=O_(Object.assign({tagName:r,disabled:a},h));return Q.jsx(p,Object.assign({},h,u,{ref:s}))});Tx.displayName="Button";const ld=ht.forwardRef(({as:e,bsPrefix:s,variant:r="primary",size:a,active:h=!1,disabled:u=!1,className:p,...m},_)=>{const y=ci(s,"btn"),[A,{tagName:E}]=O_({tagName:e,disabled:u,...m}),S=E;return Q.jsx(S,{...A,...m,ref:_,disabled:u,className:Ue(p,y,h&&"active",r&&`${y}-${r}`,a&&`${y}-${a}`,m.href&&u&&"disabled")})});ld.displayName="Button";const hd=ht.forwardRef(({className:e,bsPrefix:s,as:r="div",...a},h)=>(s=ci(s,"card-body"),Q.jsx(r,{ref:h,className:Ue(e,s),...a})));hd.displayName="CardBody";const U_=ht.forwardRef(({className:e,bsPrefix:s,as:r="div",...a},h)=>(s=ci(s,"card-footer"),Q.jsx(r,{ref:h,className:Ue(e,s),...a})));U_.displayName="CardFooter";const N_=ht.createContext(null);N_.displayName="CardHeaderContext";const H_=ht.forwardRef(({bsPrefix:e,className:s,as:r="div",...a},h)=>{const u=ci(e,"card-header"),p=ht.useMemo(()=>({cardHeaderBsPrefix:u}),[u]);return Q.jsx(N_.Provider,{value:p,children:Q.jsx(r,{ref:h,...a,className:Ue(s,u)})})});H_.displayName="CardHeader";const W_=ht.forwardRef(({bsPrefix:e,className:s,variant:r,as:a="img",...h},u)=>{const p=ci(e,"card-img");return Q.jsx(a,{ref:u,className:Ue(r?`${p}-${r}`:p,s),...h})});W_.displayName="CardImg";const j_=ht.forwardRef(({className:e,bsPrefix:s,as:r="div",...a},h)=>(s=ci(s,"card-img-overlay"),Q.jsx(r,{ref:h,className:Ue(e,s),...a})));j_.displayName="CardImgOverlay";const G_=ht.forwardRef(({className:e,bsPrefix:s,as:r="a",...a},h)=>(s=ci(s,"card-link"),Q.jsx(r,{ref:h,className:Ue(e,s),...a})));G_.displayName="CardLink";const Px=z_("h6"),V_=ht.forwardRef(({className:e,bsPrefix:s,as:r=Px,...a},h)=>(s=ci(s,"card-subtitle"),Q.jsx(r,{ref:h,className:Ue(e,s),...a})));V_.displayName="CardSubtitle";const X_=ht.forwardRef(({className:e,bsPrefix:s,as:r="p",...a},h)=>(s=ci(s,"card-text"),Q.jsx(r,{ref:h,className:Ue(e,s),...a})));X_.displayName="CardText";const Ix=z_("h5"),$_=ht.forwardRef(({className:e,bsPrefix:s,as:r=Ix,...a},h)=>(s=ci(s,"card-title"),Q.jsx(r,{ref:h,className:Ue(e,s),...a})));$_.displayName="CardTitle";const Y_=ht.forwardRef(({bsPrefix:e,className:s,bg:r,text:a,border:h,body:u=!1,children:p,as:m="div",..._},y)=>{const A=ci(e,"card");return Q.jsx(m,{ref:y,..._,className:Ue(s,A,r&&`bg-${r}`,a&&`text-${a}`,h&&`border-${h}`),children:u?Q.jsx(hd,{children:p}):p})});Y_.displayName="Card";const tl=Object.assign(Y_,{Img:W_,Title:$_,Subtitle:V_,Body:hd,Link:G_,Text:X_,Header:H_,Footer:U_,ImgOverlay:j_});function Rx(e,s){let r=0;return ht.Children.map(e,a=>ht.isValidElement(a)?s(a,r++):a)}Ks.string,Ks.bool,Ks.bool,Ks.bool,Ks.bool;const Ds=ht.forwardRef(({bsPrefix:e,className:s,fluid:r=!1,rounded:a=!1,roundedCircle:h=!1,thumbnail:u=!1,...p},m)=>(e=ci(e,"img"),Q.jsx("img",{ref:m,...p,className:Ue(s,r&&`${e}-fluid`,a&&"rounded",h&&"rounded-circle",u&&`${e}-thumbnail`)})));Ds.displayName="Image";const og=1e3;function Dx(e,s,r){const a=(e-s)/(r-s)*100;return Math.round(a*og)/og}function ag({min:e,now:s,max:r,label:a,visuallyHidden:h,striped:u,animated:p,className:m,style:_,variant:y,bsPrefix:A,...E},S){return Q.jsx("div",{ref:S,...E,role:"progressbar",className:Ue(m,`${A}-bar`,{[`bg-${y}`]:y,[`${A}-bar-animated`]:p,[`${A}-bar-striped`]:p||u}),style:{width:`${Dx(s,e,r)}%`,..._},"aria-valuenow":s,"aria-valuemin":e,"aria-valuemax":r,children:h?Q.jsx("span",{className:"visually-hidden",children:a}):a})}const Q_=ht.forwardRef(({isChild:e=!1,...s},r)=>{const a={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...s};if(a.bsPrefix=ci(a.bsPrefix,"progress"),e)return ag(a,r);const{min:h,now:u,max:p,label:m,visuallyHidden:_,striped:y,animated:A,bsPrefix:E,variant:S,className:R,children:M,...U}=a;return Q.jsx("div",{ref:r,...U,className:Ue(R,E),children:M?Rx(M,$=>ht.cloneElement($,{isChild:!0})):ag({min:h,now:u,max:p,label:m,visuallyHidden:_,striped:y,animated:A,bsPrefix:E,variant:S},r)})});Q_.displayName="ProgressBar";const kx="/ais-telegram-webpages/assets/DiggerButton-CiwoLz5n.png";function Fx({onTap:e,children:s}){const r=ht.useRef(null),[a,h]=ht.useState(!1);ht.useEffect(()=>{if(a){const _=setTimeout(()=>h(!1),100);return()=>clearTimeout(_)}},[a]);const u=(_,y)=>{const A=r.current;if(A){const E=A.getBoundingClientRect();return[_-E.left,y-E.top]}return[_,y]},p=_=>{h(!0);const y=_.touches;for(let A=0;A<y.length;A++){const E=y[A],[S,R]=u(E.clientX,E.clientY);e(S,R)}},m=_=>{if(!a){const[y,A]=u(_.clientX,_.clientY);e(y,A)}};return Q.jsxs("div",{ref:r,className:"flex justify-center relative",onTouchStart:p,onMouseDown:m,children:[Q.jsx(Ds,{src:kx,className:"img-fluid tap-button",rounded:!0,draggable:"false"}),s]})}const Z_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAArCAYAAADhXXHAAAAABHNCSVQICAgIfAhkiAAABHFJREFUWEfVWVFO20AQnbWd/paegPxWVQn8VW0Q4QTQE5AbEE5AOAHhBA0naDhBjaBV/0ioqv7CCQq/je3pm107cRw7sZNg2pWiRIl39+3szJs3E0UrGny7vUMcVMlSVWJq6GUZnxVVU7dg7uO3B/z2gPc+nu2T7d+rN9/6WZDUolj5prFGlneAjQBM7S+6ztQ81uB7OLiral/P478XBqtB2v4pFmmuDGDWQgLc4o56e30ijxQCyz/fb5Jnf8GstScHGt9AXCZwdouBHWz/Lh3oGPRFbrDaqr59U6pFJ6xLj7nB6uC+rSNSVe1ZADOfFQOrg8vrAfBOqYAFaO26VQhsBBCcCibgVglWPifFXbCBW5gNktY07KAapIRnV2BtpkfNsUQuVYauev39bimenXX9/OtdlTynSkGYwZSq4gbwShmMrCXZixhciuzlOX215UpGmxo8+HBAZLUXcoMy/FUf/I+zhxtrRSn7nwE70hbK2iRmca3NpFFyg9UnHVbWR2IlzbyB5HUtSB5nCZJwrTZcYB2Wa+S9qUywOngCa08rKMYpF0qxjCgGeASM2ri6iIMKhVAbhzvMCfZ8AqxewPEOKVDNTGmXc+XpKAnVVGV4Eo9yQ4P0ac6yF8iezRFYPYnpdDELFj5BB5Y+imYh2hFElii5xOBL4GlP8CyAysnkhOWNSEmFdDVO5QDI3KMXfm+KZ7NPVQZu7qmN64+yk7hgJs/+qCNu6FjxoH6TRhNlQNV7+ParNJAmAId7wIYbN4wBsNtSRrwsDVxyI9vfimgO7ghwDJ7VpZIGGB8KD3TxBdLZMwzme6iparQzsPAsFMrUVJ5bgoKaxCGixfEb8eQxB6zh2bAIFAsjF5cxeEB20ExmuWywYAjf2Z9MCibq2iuRe2lnxrUjYNrgWDHM1JgCm3he2OAQfnMWn2l0qiVZTBx9uTLGbAg3I9DUlWjV0WAxjhU8xAIMPgurM/SsE3STlpcAkwdcADuJMsXEgiYFQydEGjV8Hz8kZflYh0Y6VQSNb7uptGRE0THmwSC8m7ZvmuVDsKN4dJE9uslOyKq8WFuSlTBPc7Tm4mDDJXQLB9Y213E5S+7NOogR0PYO8r7EAjRqSt9rabDpwRE20tQdDnKXCpIVXEKT+lrurFgQrDh9SZSVOCK4VtWucreioqTwHL2Ae7jYfhEXS+hZFuWOUuMJh2Qu4g4abZ0slZW1+1RZoyM2IOm37q8MeKwfkJUQ8pgH1FX/TBXvKCl0ZXJY5qRzrKnLYmoNKXHEgGFPQLi2MuzPWFvqr8tFeLaLqvSsiA/lsUbymbARcoA6T/oBYI2Fk4KYk0BN4Fe0ycnhwbLgw7JbUja4NqUfsBTYdAJ1zde4VoV2T3xIr8BKdMLHf4DML+ELgv3veBaWW1JdFXXgFPE9b4kxzw7q7bAJ9rT1WERjvt1anmdNh0SEB3h2RYWkAWiCNqh0i4KMLD6zMRf+6YF/DCFOdFePJY/jleEyWmiDTTRJA5wyoicvj85zg7/ODzdd40KoLAAAAABJRU5ErkJggg==";function Bx({score:e}){return Q.jsxs("section",{className:"flex items-center justify-center gap-3 py-4",children:[Q.jsx("div",{className:"score-icon",children:Q.jsx(Ds,{src:Z_})}),Q.jsx("span",{className:"text-5xl font-bold",children:e.toLocaleString()})]})}const Mx=({number:e,x:s,y:r,onAnimationEnd:a})=>{const h=ht.useRef(null),[u,p]=ht.useState({x:s,y:r});return ht.useLayoutEffect(()=>{if(h.current){const m=s-h.current.clientWidth/2,_=r-h.current.clientHeight/2;p({x:m,y:_})}},[s,r]),ht.useEffect(()=>{const m=setTimeout(()=>{a()},1e3);return()=>clearTimeout(m)},[a]),Q.jsxs("div",{ref:h,className:"floating-number",style:{left:`${u.x}px`,top:`${u.y}px`},children:["+",e]})};function q_({size:e=1,className:s=""}){return Q.jsx("span",{className:`absolute top-[-3px] right-[-3px] bg-red-500 
                 rounded-full p-${e} ${s}`})}function hc({caption:e,onClick:s,disabled:r,children:a}){return Q.jsxs("div",{className:"captioned-button",children:[Q.jsxs(ld,{className:"button group",onClick:s,disabled:r,children:[a,Q.jsx(q_,{className:"group-disabled:hidden"})]}),Q.jsx("div",{className:"text",children:e})]})}const cd="/ais-telegram-webpages/assets/mgg-jRCbbsf_.png";function ga({title:e,timer:s}){return Q.jsx(tl,{className:"dailies-card basis-full",children:Q.jsxs(tl.Body,{children:[Q.jsx(Ds,{src:cd,className:"img-fluid",draggable:"false"}),Q.jsx("div",{className:"title",children:e}),Q.jsx("div",{className:"timer",children:s}),Q.jsx(q_,{size:1.5})]})})}const Lx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAcCAYAAABlL09dAAAABHNCSVQICAgIfAhkiAAAAiBJREFUSEullU1OAkEQhatA3MoNHJfGKLgzOkQ8gXgC9QTqCdQTiCcQTyCeQAho3OFgjEvxBOJWA2X1AP033STOzGpoqr9+XfWqBiHjQ1FlCAhLEkPwjaVOEbNwqV+p8f47i3GMG51GVnCToftKLX1iqRuI3wkwvW8F8FtYdt2ElbRn69O4DyvugGPEYQ5wP2zx8m4STG3c6FYlONo5BcxdqTjzf0OxR8Vkb+F3BVefBwocDgBR3QxpD9e7LGrymOAovODgc0cabvmKRxL6tl2GUb6ncgtDyFFdQte7lzbYVCEi2T4wzge42RpKcL/S4PdDhwCxdM8iahJMr2EVCB8SwUSXXOkLfT3hXXmiEqHALhUOtfbBFBm5Nl1BvWoRcqMPznjR2hib3XNlIDPXRh1ixdxBojA3BoCU2b3g2S05FsYLZb0OU7DDuwRcSBooKH6LojhzbVlNxOBc7xqU8RmWHqWl5C2Jrrm4p/atkJPv864eG1vIOKdfaQJR2U7BLAbjk4kCuQmxzO/aYHH4eDJPuNhmt+kHJ4eQUKKDAaSFpF3FnAAs2v72gmPb5UdfWkAiBVMXNe3UJHJsVlmbWJ7miA9f/Alw7enFZ8PYFWZBQg7G0nQtkYJ5IK9iq4ucKUgHjsI6j8wT1zT7D1DaTVVafm0zpcAAy6+tp4tSK2bw3C5KBZbendNF6cCTLgpcgyQNUJ8VTf4wHumzNAtwtvcPuoUeLFmI7gkAAAAASUVORK5CYII=";function zx({energy:e,limit:s}){return Q.jsxs("section",{className:"flex w-auto items-center justify-center gap-1",children:[Q.jsx(Ds,{src:Lx}),Q.jsxs("span",{children:[e," / ",s]})]})}function Ox({token:e}){const s=r=>r>=1e9?`+${(r/1e9).toFixed(2)}K`:r>=1e6?`+${(r/1e6).toFixed(2)}K`:r>=1e3?`+${(r/1e3).toFixed(2)}K`:`+${r}`;return Q.jsxs("div",{className:"flex flex-col items-end justify-between",children:[Q.jsx("div",{className:"label",children:"Token Per Hour"}),Q.jsxs("div",{className:"flex flex-row items-center justify-end gap-2",children:[Q.jsx(Ds,{src:Z_,className:"h-6"}),Q.jsx("span",{className:"text-3xl",children:s(e)})]})]})}function Ux({tokens:e}){const[s,r]=ht.useState(0),a=["Bronze","Silver","Gold","Platinum","Diamond","Epic","Legendary","Master","Grandmaster","Lord","Creator"],h=[0,5e3,25e3,1e5,1e6,2e6,1e7,5e7,1e8,1e9,18e8],u=()=>{if(s>=a.length-1)return 100;const p=h[s],m=h[s+1],_=(e-p)/(m-p)*100;return Math.min(_,100)};return ht.useEffect(()=>{const p=h[s],m=h[s+1];e>=m&&s<a.length-1?r(s+1):e<p&&s>0&&r(s-1)},[e,s,h,a.length]),Q.jsxs("section",{className:"mt-1 flex flex-col justify-between",children:[Q.jsxs("div",{className:"level",children:[a[s]," ",s," / ",h.length]}),Q.jsx(Q_,{now:u(),className:"progress-gradient h-2"})]})}function Nx(){var Ke;const p=ht.useContext(fv),[m,_]=ht.useState(6e3),[y,A]=ht.useState(0),[E,S]=ht.useState(1),[R,M]=ht.useState(1e3),[U,$]=ht.useState(R),[I,P]=ht.useState(R),[F,j]=ht.useState(6),[W,Y]=ht.useState(25),[C,D]=ht.useState(1e3),[N,it]=ht.useState([]),[rt,K]=ht.useState(""),[Pt,St]=ht.useState(""),[ut,tt]=ht.useState(""),Pe=y<W,et=y<C,q=I==0||U>=R,Z=q?F==6||U>=R?"Energy Full":`${F}/6`:`${F}/6`,lt=vt=>{const ee=new Date,Mt=new Date(ee);Mt.setUTCHours(vt,0,0,0),ee.getUTCHours()>=vt&&Mt.setUTCDate(Mt.getUTCDate()+1);const cr=Mt.getTime()-ee.getTime(),kl=Math.floor(cr/(1e3*60*60)),wo=Math.floor(cr%(1e3*60*60)/(1e3*60)),Lt=kl.toString().padStart(2,"0"),Gi=wo.toString().padStart(2,"0");return`${Lt}:${Gi}`},at=vt=>{it(ee=>ee.filter(Mt=>Mt.id!==vt))},Ct=(vt,ee)=>{U>=E&&(A(Mt=>Mt+E),$(Mt=>Mt-E),it(Mt=>[...Mt,{id:Date.now(),value:E,x:vt,y:ee}]))},Tt=()=>{U<R&&(j(vt=>vt-1),$(vt=>vt+R),P(vt=>vt-1))},bt=()=>{y>=C&&(M(vt=>vt+1e3),D(vt=>vt*2))},gt=()=>{y>=W&&(S(vt=>vt+1),A(vt=>vt-W),Y(vt=>vt*2),console.log(W))},Zt=vt=>()=>{_(ee=>ee+vt)};return ht.useEffect(()=>{const vt=()=>{K(lt(0)),St(lt(19)),tt(lt(12))};vt();const ee=setInterval(vt,6e4);return()=>clearInterval(ee)},[]),ht.useEffect(()=>{const vt=Math.floor(1.6666666666666667),ee=setInterval(()=>{A(Mt=>Mt+vt)},1e3);return()=>clearInterval(ee)},[6e3]),Q.jsxs("div",{className:"flex h-full grow flex-col justify-between text-white",children:[Q.jsx(Bx,{score:y}),Q.jsxs("section",{className:"align-center flex justify-center gap-2",children:[Q.jsx(hc,{caption:Z,onClick:Tt,disabled:q,children:"Refill Energy"}),Q.jsx(hc,{caption:`${C} pts to Upgrade`,onClick:bt,disabled:et,children:"Upgrade Energy Limit"}),Q.jsx(hc,{caption:`${W} pts to Upgrade`,onClick:gt,disabled:Pe,children:"Upgrade Tap Value"})]}),Q.jsx(zx,{energy:U,limit:R}),Q.jsx(Fx,{onTap:Ct,children:N.map(vt=>Q.jsx(Mx,{number:vt.value,x:vt.x,y:vt.y,onAnimationEnd:()=>at(vt.id)},vt.id))}),Q.jsxs("section",{className:"flex flex-row justify-between px-3",children:[Q.jsxs("div",{className:"level-progress",children:[Q.jsx("div",{className:"text-xl font-bold",children:((Ke=p==null?void 0:p.tgData)==null?void 0:Ke.user.first_name)??"Guest"}),Q.jsx(Ux,{tokens:y})]}),Q.jsx(Ox,{token:m})]}),Q.jsxs("section",{className:"flex gap-2 px-3 py-4",children:[Q.jsx(ga,{timer:rt,title:"Daily Reward",onClick:()=>Zt(1)()}),Q.jsx(ga,{timer:Pt,title:"Daily Cipher"}),Q.jsx(ga,{timer:ut,title:"Daily Combo"}),Q.jsx(ga,{timer:rt,title:"Mini game"})]})]})}/*!
 * excalibur - 0.29.3 - 2024-5-5
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2024 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */var Hx={8851:(e,s,r)=>{r.d(s,{A:()=>_});var a=r(2001),h=r.n(a),u=r(935),p=r.n(u),m=p()(h());m.push([e.id,`/* Buttons styles start */

button#excalibur-play {
  display: inline-block;
  position: relative;
  z-index: 999;
  border-radius: 6px;
  border: none;
  /*border: 3px solid;
    border-color: white;
    box-shadow: 0 0 10px #ccc;*/
  padding: 1rem 1.5rem 1rem 4rem;
  margin: 0;
  text-decoration: none;
  background: #00b233;
  color: #ffffff;
  font-family: sans-serif;
  font-size: 2rem;
  white-space: nowrap;
  line-height: 1;
  cursor: pointer;
  text-align: center;
  transition: background 250ms ease-in-out, transform 150ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;

  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */
  animation: excalibur-button-fadein 200ms;
}

/*
button#excalibur-play {
  display: none;
}*/

button#excalibur-play:after {
  position: absolute;
  content: '';
  border: 8px solid;
  border-color: transparent transparent transparent white;
  left: 35px;
  top: 24px;
  width: 0;
  height: 0;
}

button#excalibur-play:before {
  position: absolute;
  content: '';
  border: 3px solid;
  left: 19px;
  top: 14px;
  border-radius: 20px;
  width: 30px;
  height: 30px;
}

button#excalibur-play:hover,
button#excalibur-play:focus {
  background: #00982c;
}

button#excalibur-play:focus {
  outline: 1px solid #fff;
  outline-offset: -4px;
}

button#excalibur-play:active {
  transform: scale(0.99);
}

@keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
`,"",{version:3,sources:["webpack://./Director/Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:[`/* Buttons styles start */\r
\r
button#excalibur-play {\r
  display: inline-block;\r
  position: relative;\r
  z-index: 999;\r
  border-radius: 6px;\r
  border: none;\r
  /*border: 3px solid;\r
    border-color: white;\r
    box-shadow: 0 0 10px #ccc;*/\r
  padding: 1rem 1.5rem 1rem 4rem;\r
  margin: 0;\r
  text-decoration: none;\r
  background: #00b233;\r
  color: #ffffff;\r
  font-family: sans-serif;\r
  font-size: 2rem;\r
  white-space: nowrap;\r
  line-height: 1;\r
  cursor: pointer;\r
  text-align: center;\r
  transition: background 250ms ease-in-out, transform 150ms ease;\r
  -webkit-appearance: none;\r
  -moz-appearance: none;\r
\r
  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\r
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\r
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\r
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\r
  animation: excalibur-button-fadein 200ms;\r
}\r
\r
/*\r
button#excalibur-play {\r
  display: none;\r
}*/\r
\r
button#excalibur-play:after {\r
  position: absolute;\r
  content: '';\r
  border: 8px solid;\r
  border-color: transparent transparent transparent white;\r
  left: 35px;\r
  top: 24px;\r
  width: 0;\r
  height: 0;\r
}\r
\r
button#excalibur-play:before {\r
  position: absolute;\r
  content: '';\r
  border: 3px solid;\r
  left: 19px;\r
  top: 14px;\r
  border-radius: 20px;\r
  width: 30px;\r
  height: 30px;\r
}\r
\r
button#excalibur-play:hover,\r
button#excalibur-play:focus {\r
  background: #00982c;\r
}\r
\r
button#excalibur-play:focus {\r
  outline: 1px solid #fff;\r
  outline-offset: -4px;\r
}\r
\r
button#excalibur-play:active {\r
  transform: scale(0.99);\r
}\r
\r
@keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Firefox < 16 */\r
@-moz-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Safari, Chrome and Opera > 12.1 */\r
@-webkit-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Internet Explorer */\r
@-ms-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Opera < 12.1 */\r
@-o-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
`],sourceRoot:""}]);const _=m},4296:(e,s,r)=>{r.d(s,{A:()=>_});var a=r(2001),h=r.n(a),u=r(935),p=r.n(u),m=p()(h());m.push([e.id,`
#ex-toast-container {
  position: absolute;
  height: 0;
  min-width: 50%;
  left: 50%;
  top: 0;
}

.ex-toast-message {
  left: -50%;
  position: relative;
  display: flex;
  justify-content: space-between;


  padding: 10px;
  margin-top: 5px;
  font-size: 18px;
  font-family: sans-serif;
  border-radius: 6px;
  border: 3px solid #b7b779;
  background-color: rgb(253, 253, 192);
}


.ex-toast-message button {
  align-self: flex-start;
}`,"",{version:3,sources:["webpack://./Util/Toaster.css"],names:[],mappings:";AACA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;;EAG9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;;AAGA;EACE,sBAAsB;AACxB",sourcesContent:[`\r
#ex-toast-container {\r
  position: absolute;\r
  height: 0;\r
  min-width: 50%;\r
  left: 50%;\r
  top: 0;\r
}\r
\r
.ex-toast-message {\r
  left: -50%;\r
  position: relative;\r
  display: flex;\r
  justify-content: space-between;\r
\r
\r
  padding: 10px;\r
  margin-top: 5px;\r
  font-size: 18px;\r
  font-family: sans-serif;\r
  border-radius: 6px;\r
  border: 3px solid #b7b779;\r
  background-color: rgb(253, 253, 192);\r
}\r
\r
\r
.ex-toast-message button {\r
  align-self: flex-start;\r
}`],sourceRoot:""}]);const _=m},935:e=>{e.exports=function(s){var r=[];return r.toString=function(){return this.map(function(h){var u="",p=typeof h[5]<"u";return h[4]&&(u+="@supports (".concat(h[4],") {")),h[2]&&(u+="@media ".concat(h[2]," {")),p&&(u+="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {")),u+=s(h),p&&(u+="}"),h[2]&&(u+="}"),h[4]&&(u+="}"),u}).join("")},r.i=function(h,u,p,m,_){typeof h=="string"&&(h=[[null,h,void 0]]);var y={};if(p)for(var A=0;A<this.length;A++){var E=this[A][0];E!=null&&(y[E]=!0)}for(var S=0;S<h.length;S++){var R=[].concat(h[S]);p&&y[R[0]]||(typeof _<"u"&&(typeof R[5]>"u"||(R[1]="@layer".concat(R[5].length>0?" ".concat(R[5]):""," {").concat(R[1],"}")),R[5]=_),u&&(R[2]&&(R[1]="@media ".concat(R[2]," {").concat(R[1],"}")),R[2]=u),m&&(R[4]?(R[1]="@supports (".concat(R[4],") {").concat(R[1],"}"),R[4]=m):R[4]="".concat(m)),r.push(R))}},r}},2001:e=>{e.exports=function(s){var r=s[1],a=s[3];if(!a)return r;if(typeof btoa=="function"){var h=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),u="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(h),p="/*# ".concat(u," */");return[r].concat([p]).join(`
`)}return[r].join(`
`)}},9493:(e,s,r)=>{r(3975);var a=r(2564);e.exports=a("Array","sort")},311:(e,s,r)=>{r(8291);var a=r(9120);e.exports=a.Object.keys},4977:(e,s,r)=>{var a=r(4188),h=r(3174),u=TypeError;e.exports=function(p){if(a(p))return p;throw new u(h(p)+" is not a function")}},3770:(e,s,r)=>{var a=r(831),h=String,u=TypeError;e.exports=function(p){if(a(p))return p;throw new u(h(p)+" is not an object")}},1458:(e,s,r)=>{var a=r(380),h=r(675),u=r(9389),p=function(m){return function(_,y,A){var E=a(_),S=u(E);if(S===0)return!m&&-1;var R=h(A,S),M;if(m&&y!==y){for(;S>R;)if(M=E[R++],M!==M)return!0}else for(;S>R;R++)if((m||R in E)&&E[R]===y)return m||R||0;return!m&&-1}};e.exports={includes:p(!0),indexOf:p(!1)}},5397:(e,s,r)=>{var a=r(5234);e.exports=function(h,u){var p=[][h];return!!p&&a(function(){p.call(null,u||function(){return 1},1)})}},7825:(e,s,r)=>{var a=r(6881);e.exports=a([].slice)},9295:(e,s,r)=>{var a=r(7825),h=Math.floor,u=function(p,m){var _=p.length;if(_<8)for(var y=1,A,E;y<_;){for(E=y,A=p[y];E&&m(p[E-1],A)>0;)p[E]=p[--E];E!==y++&&(p[E]=A)}else for(var S=h(_/2),R=u(a(p,0,S),m),M=u(a(p,S),m),U=R.length,$=M.length,I=0,P=0;I<U||P<$;)p[I+P]=I<U&&P<$?m(R[I],M[P])<=0?R[I++]:M[P++]:I<U?R[I++]:M[P++];return p};e.exports=u},8689:(e,s,r)=>{var a=r(6881),h=a({}.toString),u=a("".slice);e.exports=function(p){return u(h(p),8,-1)}},5438:(e,s,r)=>{var a=r(9345),h=r(4188),u=r(8689),p=r(4282),m=p("toStringTag"),_=Object,y=u(function(){return arguments}())==="Arguments",A=function(E,S){try{return E[S]}catch{}};e.exports=a?u:function(E){var S,R,M;return E===void 0?"Undefined":E===null?"Null":typeof(R=A(S=_(E),m))=="string"?R:y?u(S):(M=u(S))==="Object"&&h(S.callee)?"Arguments":M}},8657:(e,s,r)=>{var a=r(4418),h=r(3168),u=r(9304),p=r(4466);e.exports=function(m,_,y){for(var A=h(_),E=p.f,S=u.f,R=0;R<A.length;R++){var M=A[R];!a(m,M)&&!(y&&a(y,M))&&E(m,M,S(_,M))}}},8088:(e,s,r)=>{var a=r(6893),h=r(4466),u=r(9123);e.exports=a?function(p,m,_){return h.f(p,m,u(1,_))}:function(p,m,_){return p[m]=_,p}},9123:e=>{e.exports=function(s,r){return{enumerable:!(s&1),configurable:!(s&2),writable:!(s&4),value:r}}},7509:(e,s,r)=>{var a=r(4188),h=r(4466),u=r(4530),p=r(4798);e.exports=function(m,_,y,A){A||(A={});var E=A.enumerable,S=A.name!==void 0?A.name:_;if(a(y)&&u(y,S,A),A.global)E?m[_]=y:p(_,y);else{try{A.unsafe?m[_]&&(E=!0):delete m[_]}catch{}E?m[_]=y:h.f(m,_,{value:y,enumerable:!1,configurable:!A.nonConfigurable,writable:!A.nonWritable})}return m}},4798:(e,s,r)=>{var a=r(1488),h=Object.defineProperty;e.exports=function(u,p){try{h(a,u,{value:p,configurable:!0,writable:!0})}catch{a[u]=p}return p}},1305:(e,s,r)=>{var a=r(3174),h=TypeError;e.exports=function(u,p){if(!delete u[p])throw new h("Cannot delete property "+a(p)+" of "+a(u))}},6893:(e,s,r)=>{var a=r(5234);e.exports=!a(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})},5926:(e,s,r)=>{var a=r(1488),h=r(831),u=a.document,p=h(u)&&h(u.createElement);e.exports=function(m){return p?u.createElement(m):{}}},8807:(e,s,r)=>{var a=r(4109),h=a.match(/firefox\/(\d+)/i);e.exports=!!h&&+h[1]},5661:(e,s,r)=>{var a=r(4109);e.exports=/MSIE|Trident/.test(a)},4109:e=>{e.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},3749:(e,s,r)=>{var a=r(1488),h=r(4109),u=a.process,p=a.Deno,m=u&&u.versions||p&&p.version,_=m&&m.v8,y,A;_&&(y=_.split("."),A=y[0]>0&&y[0]<4?1:+(y[0]+y[1])),!A&&h&&(y=h.match(/Edge\/(\d+)/),(!y||y[1]>=74)&&(y=h.match(/Chrome\/(\d+)/),y&&(A=+y[1]))),e.exports=A},3589:(e,s,r)=>{var a=r(4109),h=a.match(/AppleWebKit\/(\d+)\./);e.exports=!!h&&+h[1]},2564:(e,s,r)=>{var a=r(1488),h=r(6881);e.exports=function(u,p){return h(a[u].prototype[p])}},1274:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},5613:(e,s,r)=>{var a=r(1488),h=r(9304).f,u=r(8088),p=r(7509),m=r(4798),_=r(8657),y=r(8489);e.exports=function(A,E){var S=A.target,R=A.global,M=A.stat,U,$,I,P,F,j;if(R?$=a:M?$=a[S]||m(S,{}):$=a[S]&&a[S].prototype,$)for(I in E){if(F=E[I],A.dontCallGetSet?(j=h($,I),P=j&&j.value):P=$[I],U=y(R?I:S+(M?".":"#")+I,A.forced),!U&&P!==void 0){if(typeof F==typeof P)continue;_(F,P)}(A.sham||P&&P.sham)&&u(F,"sham",!0),p($,I,F,A)}}},5234:e=>{e.exports=function(s){try{return!!s()}catch{return!0}}},9055:(e,s,r)=>{var a=r(5234);e.exports=!a(function(){var h=(function(){}).bind();return typeof h!="function"||h.hasOwnProperty("prototype")})},9944:(e,s,r)=>{var a=r(9055),h=Function.prototype.call;e.exports=a?h.bind(h):function(){return h.apply(h,arguments)}},2735:(e,s,r)=>{var a=r(6893),h=r(4418),u=Function.prototype,p=a&&Object.getOwnPropertyDescriptor,m=h(u,"name"),_=m&&(function(){}).name==="something",y=m&&(!a||a&&p(u,"name").configurable);e.exports={EXISTS:m,PROPER:_,CONFIGURABLE:y}},6881:(e,s,r)=>{var a=r(9055),h=Function.prototype,u=h.call,p=a&&h.bind.bind(u,u);e.exports=a?p:function(m){return function(){return u.apply(m,arguments)}}},5604:(e,s,r)=>{var a=r(1488),h=r(4188),u=function(p){return h(p)?p:void 0};e.exports=function(p,m){return arguments.length<2?u(a[p]):a[p]&&a[p][m]}},2913:(e,s,r)=>{var a=r(4977),h=r(4318);e.exports=function(u,p){var m=u[p];return h(m)?void 0:a(m)}},1488:function(e,s,r){var a=function(h){return h&&h.Math===Math&&h};e.exports=a(typeof globalThis=="object"&&globalThis)||a(typeof window=="object"&&window)||a(typeof self=="object"&&self)||a(typeof r.g=="object"&&r.g)||a(typeof this=="object"&&this)||function(){return this}()||Function("return this")()},4418:(e,s,r)=>{var a=r(6881),h=r(3628),u=a({}.hasOwnProperty);e.exports=Object.hasOwn||function(m,_){return u(h(m),_)}},7588:e=>{e.exports={}},9622:(e,s,r)=>{var a=r(6893),h=r(5234),u=r(5926);e.exports=!a&&!h(function(){return Object.defineProperty(u("div"),"a",{get:function(){return 7}}).a!==7})},7568:(e,s,r)=>{var a=r(6881),h=r(5234),u=r(8689),p=Object,m=a("".split);e.exports=h(function(){return!p("z").propertyIsEnumerable(0)})?function(_){return u(_)==="String"?m(_,""):p(_)}:p},3029:(e,s,r)=>{var a=r(6881),h=r(4188),u=r(2694),p=a(Function.toString);h(u.inspectSource)||(u.inspectSource=function(m){return p(m)}),e.exports=u.inspectSource},3086:(e,s,r)=>{var a=r(5945),h=r(1488),u=r(831),p=r(8088),m=r(4418),_=r(2694),y=r(168),A=r(7588),E="Object already initialized",S=h.TypeError,R=h.WeakMap,M,U,$,I=function(W){return $(W)?U(W):M(W,{})},P=function(W){return function(Y){var C;if(!u(Y)||(C=U(Y)).type!==W)throw new S("Incompatible receiver, "+W+" required");return C}};if(a||_.state){var F=_.state||(_.state=new R);F.get=F.get,F.has=F.has,F.set=F.set,M=function(W,Y){if(F.has(W))throw new S(E);return Y.facade=W,F.set(W,Y),Y},U=function(W){return F.get(W)||{}},$=function(W){return F.has(W)}}else{var j=y("state");A[j]=!0,M=function(W,Y){if(m(W,j))throw new S(E);return Y.facade=W,p(W,j,Y),Y},U=function(W){return m(W,j)?W[j]:{}},$=function(W){return m(W,j)}}e.exports={set:M,get:U,has:$,enforce:I,getterFor:P}},4188:e=>{var s=typeof document=="object"&&document.all;e.exports=typeof s>"u"&&s!==void 0?function(r){return typeof r=="function"||r===s}:function(r){return typeof r=="function"}},8489:(e,s,r)=>{var a=r(5234),h=r(4188),u=/#|\.prototype\./,p=function(E,S){var R=_[m(E)];return R===A?!0:R===y?!1:h(S)?a(S):!!S},m=p.normalize=function(E){return String(E).replace(u,".").toLowerCase()},_=p.data={},y=p.NATIVE="N",A=p.POLYFILL="P";e.exports=p},4318:e=>{e.exports=function(s){return s==null}},831:(e,s,r)=>{var a=r(4188);e.exports=function(h){return typeof h=="object"?h!==null:a(h)}},1942:e=>{e.exports=!1},6032:(e,s,r)=>{var a=r(5604),h=r(4188),u=r(4578),p=r(9809),m=Object;e.exports=p?function(_){return typeof _=="symbol"}:function(_){var y=a("Symbol");return h(y)&&u(y.prototype,m(_))}},9389:(e,s,r)=>{var a=r(7611);e.exports=function(h){return a(h.length)}},4530:(e,s,r)=>{var a=r(6881),h=r(5234),u=r(4188),p=r(4418),m=r(6893),_=r(2735).CONFIGURABLE,y=r(3029),A=r(3086),E=A.enforce,S=A.get,R=String,M=Object.defineProperty,U=a("".slice),$=a("".replace),I=a([].join),P=m&&!h(function(){return M(function(){},"length",{value:8}).length!==8}),F=String(String).split("String"),j=e.exports=function(W,Y,C){U(R(Y),0,7)==="Symbol("&&(Y="["+$(R(Y),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),C&&C.getter&&(Y="get "+Y),C&&C.setter&&(Y="set "+Y),(!p(W,"name")||_&&W.name!==Y)&&(m?M(W,"name",{value:Y,configurable:!0}):W.name=Y),P&&C&&p(C,"arity")&&W.length!==C.arity&&M(W,"length",{value:C.arity});try{C&&p(C,"constructor")&&C.constructor?m&&M(W,"prototype",{writable:!1}):W.prototype&&(W.prototype=void 0)}catch{}var D=E(W);return p(D,"source")||(D.source=I(F,typeof Y=="string"?Y:"")),W};Function.prototype.toString=j(function(){return u(this)&&S(this).source||y(this)},"toString")},142:e=>{var s=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(h){var u=+h;return(u>0?r:s)(u)}},4466:(e,s,r)=>{var a=r(6893),h=r(9622),u=r(3315),p=r(3770),m=r(2344),_=TypeError,y=Object.defineProperty,A=Object.getOwnPropertyDescriptor,E="enumerable",S="configurable",R="writable";s.f=a?u?function(U,$,I){if(p(U),$=m($),p(I),typeof U=="function"&&$==="prototype"&&"value"in I&&R in I&&!I[R]){var P=A(U,$);P&&P[R]&&(U[$]=I.value,I={configurable:S in I?I[S]:P[S],enumerable:E in I?I[E]:P[E],writable:!1})}return y(U,$,I)}:y:function(U,$,I){if(p(U),$=m($),p(I),h)try{return y(U,$,I)}catch{}if("get"in I||"set"in I)throw new _("Accessors not supported");return"value"in I&&(U[$]=I.value),U}},9304:(e,s,r)=>{var a=r(6893),h=r(9944),u=r(4416),p=r(9123),m=r(380),_=r(2344),y=r(4418),A=r(9622),E=Object.getOwnPropertyDescriptor;s.f=a?E:function(R,M){if(R=m(R),M=_(M),A)try{return E(R,M)}catch{}if(y(R,M))return p(!h(u.f,R,M),R[M])}},5629:(e,s,r)=>{var a=r(1843),h=r(1274),u=h.concat("length","prototype");s.f=Object.getOwnPropertyNames||function(m){return a(m,u)}},156:(e,s)=>{s.f=Object.getOwnPropertySymbols},4578:(e,s,r)=>{var a=r(6881);e.exports=a({}.isPrototypeOf)},1843:(e,s,r)=>{var a=r(6881),h=r(4418),u=r(380),p=r(1458).indexOf,m=r(7588),_=a([].push);e.exports=function(y,A){var E=u(y),S=0,R=[],M;for(M in E)!h(m,M)&&h(E,M)&&_(R,M);for(;A.length>S;)h(E,M=A[S++])&&(~p(R,M)||_(R,M));return R}},7137:(e,s,r)=>{var a=r(1843),h=r(1274);e.exports=Object.keys||function(p){return a(p,h)}},4416:(e,s)=>{var r={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,h=a&&!r.call({1:2},1);s.f=h?function(p){var m=a(this,p);return!!m&&m.enumerable}:r},2287:(e,s,r)=>{var a=r(9944),h=r(4188),u=r(831),p=TypeError;e.exports=function(m,_){var y,A;if(_==="string"&&h(y=m.toString)&&!u(A=a(y,m))||h(y=m.valueOf)&&!u(A=a(y,m))||_!=="string"&&h(y=m.toString)&&!u(A=a(y,m)))return A;throw new p("Can't convert object to primitive value")}},3168:(e,s,r)=>{var a=r(5604),h=r(6881),u=r(5629),p=r(156),m=r(3770),_=h([].concat);e.exports=a("Reflect","ownKeys")||function(A){var E=u.f(m(A)),S=p.f;return S?_(E,S(A)):E}},9120:(e,s,r)=>{var a=r(1488);e.exports=a},9509:(e,s,r)=>{var a=r(4318),h=TypeError;e.exports=function(u){if(a(u))throw new h("Can't call method on "+u);return u}},168:(e,s,r)=>{var a=r(746),h=r(6209),u=a("keys");e.exports=function(p){return u[p]||(u[p]=h(p))}},2694:(e,s,r)=>{var a=r(1942),h=r(1488),u=r(4798),p="__core-js_shared__",m=e.exports=h[p]||u(p,{});(m.versions||(m.versions=[])).push({version:"3.36.1",mode:a?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.36.1/LICENSE",source:"https://github.com/zloirock/core-js"})},746:(e,s,r)=>{var a=r(2694);e.exports=function(h,u){return a[h]||(a[h]=u||{})}},8944:(e,s,r)=>{var a=r(3749),h=r(5234),u=r(1488),p=u.String;e.exports=!!Object.getOwnPropertySymbols&&!h(function(){var m=Symbol("symbol detection");return!p(m)||!(Object(m)instanceof Symbol)||!Symbol.sham&&a&&a<41})},675:(e,s,r)=>{var a=r(6744),h=Math.max,u=Math.min;e.exports=function(p,m){var _=a(p);return _<0?h(_+m,0):u(_,m)}},380:(e,s,r)=>{var a=r(7568),h=r(9509);e.exports=function(u){return a(h(u))}},6744:(e,s,r)=>{var a=r(142);e.exports=function(h){var u=+h;return u!==u||u===0?0:a(u)}},7611:(e,s,r)=>{var a=r(6744),h=Math.min;e.exports=function(u){var p=a(u);return p>0?h(p,9007199254740991):0}},3628:(e,s,r)=>{var a=r(9509),h=Object;e.exports=function(u){return h(a(u))}},290:(e,s,r)=>{var a=r(9944),h=r(831),u=r(6032),p=r(2913),m=r(2287),_=r(4282),y=TypeError,A=_("toPrimitive");e.exports=function(E,S){if(!h(E)||u(E))return E;var R=p(E,A),M;if(R){if(S===void 0&&(S="default"),M=a(R,E,S),!h(M)||u(M))return M;throw new y("Can't convert object to primitive value")}return S===void 0&&(S="number"),m(E,S)}},2344:(e,s,r)=>{var a=r(290),h=r(6032);e.exports=function(u){var p=a(u,"string");return h(p)?p:p+""}},9345:(e,s,r)=>{var a=r(4282),h=a("toStringTag"),u={};u[h]="z",e.exports=String(u)==="[object z]"},2618:(e,s,r)=>{var a=r(5438),h=String;e.exports=function(u){if(a(u)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return h(u)}},3174:e=>{var s=String;e.exports=function(r){try{return s(r)}catch{return"Object"}}},6209:(e,s,r)=>{var a=r(6881),h=0,u=Math.random(),p=a(1 .toString);e.exports=function(m){return"Symbol("+(m===void 0?"":m)+")_"+p(++h+u,36)}},9809:(e,s,r)=>{var a=r(8944);e.exports=a&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},3315:(e,s,r)=>{var a=r(6893),h=r(5234);e.exports=a&&h(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})},5945:(e,s,r)=>{var a=r(1488),h=r(4188),u=a.WeakMap;e.exports=h(u)&&/native code/.test(String(u))},4282:(e,s,r)=>{var a=r(1488),h=r(746),u=r(4418),p=r(6209),m=r(8944),_=r(9809),y=a.Symbol,A=h("wks"),E=_?y.for||y:y&&y.withoutSetter||p;e.exports=function(S){return u(A,S)||(A[S]=m&&u(y,S)?y[S]:E("Symbol."+S)),A[S]}},3975:(e,s,r)=>{var a=r(5613),h=r(6881),u=r(4977),p=r(3628),m=r(9389),_=r(1305),y=r(2618),A=r(5234),E=r(9295),S=r(5397),R=r(8807),M=r(5661),U=r(3749),$=r(3589),I=[],P=h(I.sort),F=h(I.push),j=A(function(){I.sort(void 0)}),W=A(function(){I.sort(null)}),Y=S("sort"),C=!A(function(){if(U)return U<70;if(!(R&&R>3)){if(M)return!0;if($)return $<603;var it="",rt,K,Pt,St;for(rt=65;rt<76;rt++){switch(K=String.fromCharCode(rt),rt){case 66:case 69:case 70:case 72:Pt=3;break;case 68:case 71:Pt=4;break;default:Pt=2}for(St=0;St<47;St++)I.push({k:K+St,v:Pt})}for(I.sort(function(ut,tt){return tt.v-ut.v}),St=0;St<I.length;St++)K=I[St].k.charAt(0),it.charAt(it.length-1)!==K&&(it+=K);return it!=="DGBEFHACIJK"}}),D=j||!W||!Y||!C,N=function(it){return function(rt,K){return K===void 0?-1:rt===void 0?1:it!==void 0?+it(rt,K)||0:y(rt)>y(K)?1:-1}};a({target:"Array",proto:!0,forced:D},{sort:function(rt){rt!==void 0&&u(rt);var K=p(this);if(C)return rt===void 0?P(K):P(K,rt);var Pt=[],St=m(K),ut,tt;for(tt=0;tt<St;tt++)tt in K&&F(Pt,K[tt]);for(E(Pt,N(rt)),ut=m(Pt),tt=0;tt<ut;)K[tt]=Pt[tt++];for(;tt<St;)_(K,tt++);return K}})},8291:(e,s,r)=>{var a=r(5613),h=r(3628),u=r(7137),p=r(5234),m=p(function(){u(1)});a({target:"Object",stat:!0,forced:m},{keys:function(y){return u(h(y))}})}},lg={};function Ot(e){var s=lg[e];if(s!==void 0)return s.exports;var r=lg[e]={id:e,exports:{}};return Hx[e].call(r.exports,r,r.exports,Ot),r.exports}Ot.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return Ot.d(s,{a:s}),s};Ot.d=(e,s)=>{for(var r in s)Ot.o(s,r)&&!Ot.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:s[r]})};Ot.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}();Ot.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s);Ot.r=e=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var b={};(()=>{Ot.d(b,{eKr:()=>ah,yVm:()=>vr,a7j:()=>zd,U_w:()=>Dh,JF2:()=>oh,htg:()=>wn,HXL:()=>Cf,mcg:()=>th,Agj:()=>He,u6S:()=>Qv,x7M:()=>gt,X55:()=>ki,m3M:()=>mr,aE5:()=>t0,YJU:()=>xi,eZi:()=>xh,GNv:()=>pn,Y56:()=>Sn,_0v:()=>Xo,vhs:()=>Ho,Z8b:()=>Qd,Yfw:()=>dt,IcQ:()=>tt,Rl2:()=>Mo,kgJ:()=>Ph,GTT:()=>kf,ypY:()=>An,i7d:()=>hf,fQ3:()=>i0,HlI:()=>So,jlt:()=>Oo,VQc:()=>ge,zD7:()=>Ih,I0I:()=>zo,AUF:()=>Di,JoF:()=>ls,MlA:()=>Yt,PZh:()=>Ws,qA:()=>fr,CrD:()=>Ns,dQK:()=>Ii,D3r:()=>wi,Qpo:()=>ko,D9n:()=>Do,b6v:()=>dr,mvh:()=>bh,Bpo:()=>pt,Q1f:()=>N,IKv:()=>Rf,fcV:()=>Xs,Glf:()=>If,uAl:()=>yi,ElT:()=>pe,MPu:()=>vf,Z8r:()=>Pt,QSL:()=>_f,sPV:()=>Ro,nAn:()=>Hs,zCU:()=>Io,QrV:()=>ne,fF9:()=>B0,xI8:()=>eh,yar:()=>re,SP7:()=>Df,oRy:()=>Vo,f5X:()=>xf,V1c:()=>Fl,Mlx:()=>Ff,ZCo:()=>pr,Vy3:()=>Ri,J5p:()=>Bf,mL_:()=>Re,Guw:()=>qd,VKx:()=>gh,N5j:()=>kd,pgY:()=>Kd,OP3:()=>jo,rl5:()=>Of,eod:()=>f0,q5Z:()=>se,YUC:()=>ph,saR:()=>Bo,hvr:()=>Lh,Qol:()=>Yd,Wf4:()=>$d,JCs:()=>zt,gJV:()=>Ne,fWD:()=>of,Va_:()=>Cn,N$8:()=>ke,_jQ:()=>m0,rxj:()=>nh,rhv:()=>sh,wCu:()=>_e,HAp:()=>Jv,Zy1:()=>uf,Qev:()=>_0,bkB:()=>y,wfL:()=>To,sVA:()=>s,$Gs:()=>zl,CJ0:()=>Ao,NWh:()=>$i,tWi:()=>rh,xAj:()=>ih,zWh:()=>Zd,i_4:()=>F0,iIx:()=>p,c9e:()=>vh,KQV:()=>js,weH:()=>It,jXp:()=>D0,zzY:()=>Wo,yRQ:()=>Uo,MtE:()=>Mf,rPj:()=>Tr,KLc:()=>_,Fir:()=>yt,V5f:()=>Nl,Xj7:()=>Hl,Wud:()=>Ar,FVg:()=>ql,g5Y:()=>Zl,YQB:()=>Yl,KPb:()=>Ql,nHK:()=>br,TX_:()=>I0,r3n:()=>Sr,vYh:()=>Lt,hnk:()=>oe,D2R:()=>yn,n1o:()=>wf,RLG:()=>Jl,fBU:()=>Md,Adb:()=>Kt,bEs:()=>fn,wCy:()=>ie,CbD:()=>Xt,x_C:()=>vn,pde:()=>a,pGf:()=>Th,ibQ:()=>Ef,QlN:()=>Lo,shR:()=>Cr,Yjk:()=>bf,_u1:()=>y0,OBI:()=>Uf,klh:()=>Tn,s3S:()=>Ah,D$R:()=>En,xth:()=>Po,JU7:()=>v0,h9x:()=>lf,N1A:()=>Bh,e_k:()=>Ie,aHM:()=>Os,tlv:()=>Wv,Vi9:()=>rf,ieR:()=>nf,$bb:()=>rt,VyI:()=>K,imn:()=>Ed,uqu:()=>bt,QnL:()=>Tt,vnc:()=>lh,wk_:()=>yh,GH0:()=>Ht,_1r:()=>mf,l0X:()=>Nd,HHX:()=>Hd,tjk:()=>Qi,rWe:()=>zs,j9l:()=>Id,NVp:()=>Ld,cPK:()=>be,XoL:()=>Af,RmF:()=>ti,DXI:()=>Go,tCD:()=>w0,oGn:()=>Hf,J3D:()=>$o,vCJ:()=>yf,f9l:()=>bn,AQx:()=>ft,v9m:()=>Qo,yRJ:()=>Sf,EU6:()=>Eh,m3O:()=>Mi,Ryz:()=>Fi,OxP:()=>Pn,LEs:()=>Er,Ec:()=>A,Pi5:()=>Yo,gmH:()=>Li,tS:()=>Mh,XxX:()=>he,bCz:()=>Sd,nYS:()=>Ls,yiT:()=>Vl,NHl:()=>_n,mO8:()=>$l,PXI:()=>Ul,bn5:()=>jl,Ywr:()=>as,cMd:()=>Ms,Bs6:()=>Gl,G0k:()=>mn,pyn:()=>Xl,QeM:()=>Ol,aPX:()=>h0,ITP:()=>Wl,BY0:()=>os,MFw:()=>gr,sBn:()=>ur,S3L:()=>In,XKQ:()=>wr,ESI:()=>df,uxz:()=>af,o8N:()=>S,u_r:()=>gn,RlV:()=>Yi,gVA:()=>Ch,M_G:()=>_r,GRB:()=>qv,kM6:()=>Od,dO8:()=>Ud,jgM:()=>Ml,FWq:()=>ee,s3j:()=>vt,hlw:()=>jd,B7e:()=>Wd,H_X:()=>ei,S_d:()=>Vd,U7E:()=>Gd,Z58:()=>ii,yh2:()=>c0,ff$:()=>Ll,cWi:()=>St,NBt:()=>wh,oNz:()=>Ov,QlU:()=>Pf,Xey:()=>cs,jft:()=>O0,Mtr:()=>Je,ypk:()=>me,mnM:()=>ut,bAZ:()=>hs,ABN:()=>Rd,VK6:()=>Hv,kxk:()=>Gi,DT1:()=>Co,FLG:()=>Fs,qN_:()=>Rh,Z37:()=>Eo,FtL:()=>sf,Z6X:()=>Nf,iQT:()=>di,ziO:()=>pf,OEF:()=>Bi,uuE:()=>We,tiv:()=>xr,T$Y:()=>Lf,EYj:()=>yr,nOB:()=>No,Tap:()=>Jt,FAs:()=>ef,B_P:()=>tf,aA5:()=>e0,M4G:()=>Gs,l$l:()=>zf,dLy:()=>Us,WZP:()=>nt,eB6:()=>Fh,nFK:()=>fh,l9z:()=>cf,YOF:()=>s0,yhB:()=>R,J0N:()=>h,Miz:()=>C,Bj4:()=>dh,Rcs:()=>Vi,vJ4:()=>Xi,TqC:()=>Bd,nM0:()=>Kl,X1u:()=>Bs,SpZ:()=>Pd,DX8:()=>Vs,Yx$:()=>Sh,HK4:()=>gf,SE$:()=>I,qE8:()=>$,Pz7:()=>jf,sX_:()=>m,JuI:()=>M,Nl$:()=>_h,OwT:()=>C0,P$G:()=>E0,mHV:()=>A0,Fx_:()=>P0,WFC:()=>T0,aDq:()=>x0,jIg:()=>S0,UH3:()=>b0,K6X:()=>Zv,C1Y:()=>Fd,Aw1:()=>hh,A8$:()=>Kv,hsx:()=>zi,l9E:()=>Jd,aSf:()=>ff,Zex:()=>Gf,mXP:()=>L0,vt$:()=>xo,hCA:()=>ks,pjR:()=>wt,U43:()=>W,pSZ:()=>Y,y17:()=>j,jVr:()=>M0,_SZ:()=>U,xWn:()=>P,ehJ:()=>F,t6s:()=>D,Eyn:()=>e});var e={};Ot.r(e),Ot.d(e,{getAttributeComponentSize:()=>bd,getAttributePointerType:()=>Ad,getGLTypeFromSource:()=>Cd,getGlTypeSizeBytes:()=>Bl,isAttributeInSource:()=>xd});var s={};Ot.r(s),Ot.d(s,{ActionCompleteEvent:()=>ah,ActionStartEvent:()=>oh,ActivateEvent:()=>th,CollisionEndEvent:()=>fr,CollisionPostSolveEvent:()=>ko,CollisionPreSolveEvent:()=>Do,CollisionStartEvent:()=>dr,ContactEndEvent:()=>Ro,ContactStartEvent:()=>Io,DeactivateEvent:()=>eh,EnterTriggerEvent:()=>nh,EnterViewPortEvent:()=>sh,EventTypes:()=>To,ExitTriggerEvent:()=>rh,ExitViewPortEvent:()=>ih,GameEvent:()=>yt,GameStartEvent:()=>Nl,GameStopEvent:()=>Hl,GamepadAxisEvent:()=>ql,GamepadButtonEvent:()=>Zl,GamepadConnectEvent:()=>Yl,GamepadDisconnectEvent:()=>Ql,HiddenEvent:()=>Jl,InitializeEvent:()=>vn,KillEvent:()=>Po,PostCollisionEvent:()=>Ls,PostDebugDrawEvent:()=>Vl,PostDrawEvent:()=>_n,PostFrameEvent:()=>$l,PostKillEvent:()=>Ul,PostTransformDrawEvent:()=>jl,PostUpdateEvent:()=>as,PreCollisionEvent:()=>Ms,PreDebugDrawEvent:()=>Gl,PreDrawEvent:()=>mn,PreFrameEvent:()=>Xl,PreKillEvent:()=>Ol,PreTransformDrawEvent:()=>Wl,PreUpdateEvent:()=>os,VisibleEvent:()=>Kl});var r={};Ot.r(r),Ot.d(r,{circle:()=>Vv,line:()=>ch,point:()=>jv,roundRect:()=>uh,vector:()=>Gv});var a={};Ot.r(a),Ot.d(a,{Axes:()=>Sn,Buttons:()=>An,Gamepad:()=>Ar,Gamepads:()=>br,KeyEvent:()=>Tn,Keyboard:()=>Ah,Keys:()=>En,NativePointerButton:()=>Qi,PointerButton:()=>Mi,PointerComponent:()=>Fi,PointerEvent:()=>Pn,PointerEventReceiver:()=>Er,PointerScope:()=>A,PointerSystem:()=>Yo,PointerType:()=>Li,WheelDeltaMode:()=>Vs,WheelEvent:()=>Sh});var h={};Ot.r(h),Ot.d(h,{ConsoleAppender:()=>Pt,DrawUtil:()=>r,EasingFunctions:()=>zt,LogLevel:()=>rt,Logger:()=>K,Observable:()=>be,ScreenAppender:()=>St,addItemToArray:()=>et,contains:()=>Z,delay:()=>at,fail:()=>lt,getPosition:()=>Pe,omit:()=>Ct,removeItemFromArray:()=>q}),Ot(9493),Ot(311);function u(){if(typeof window>"u"&&(window={audioContext:function(){}}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(c){window.setInterval(c,1e3/60)}),typeof window<"u"&&!window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),typeof window<"u"&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(i){return new Promise((n,o)=>{t.call(this,i,n,o)})}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}typeof window<"u"&&!window.devicePixelRatio&&(window.devicePixelRatio=window.devicePixelRatio||1)}class p{static useCanvasGraphicsContext(){p.enable("use-canvas-context")}static freeze(){p._FROZEN=!0}static _reset(){p._FROZEN=!1,p._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");p._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");p._FLAGS[t]=!1}static isEnabled(t){return!!p._FLAGS[t]}static show(){return Object.keys(p._FLAGS)}}p._FROZEN=!1,p._FLAGS={};function m(c,t){return{type:c,value:t}}class _{constructor(){this._isCompleted=!1,this.promise=new Promise((t,i)=>{this._resolver=t,this._rejecter=i})}get isCompleted(){return this._isCompleted}resolve(t){this._isCompleted||(this._isCompleted=!0,this._resolver(t))}reject(t){this._isCompleted||(this._isCompleted=!0,this._rejecter(t))}}class y{constructor(){this._paused=!1,this._listeners={},this._listenersOnce={},this._pipes=[]}clear(){this._listeners={},this._listenersOnce={},this._pipes.length=0}on(t,i){var n;return this._listeners[t]=(n=this._listeners[t])!==null&&n!==void 0?n:[],this._listeners[t].push(i),{close:()=>this.off(t,i)}}once(t,i){var n;return this._listenersOnce[t]=(n=this._listenersOnce[t])!==null&&n!==void 0?n:[],this._listenersOnce[t].push(i),{close:()=>this.off(t,i)}}off(t,i){var n,o;if(i){const l=(n=this._listeners[t])===null||n===void 0?void 0:n.filter(f=>f!==i);this._listeners[t]=l;const d=(o=this._listenersOnce[t])===null||o===void 0?void 0:o.filter(f=>f!==i);this._listenersOnce[t]=d}else delete this._listeners[t]}emit(t,i){var n;if(this._paused)return;(n=this._listeners[t])===null||n===void 0||n.forEach(l=>l(i));const o=this._listenersOnce[t];this._listenersOnce[t]=[],o&&o.forEach(l=>l(i)),this._pipes.forEach(l=>{l.emit(t,i)})}pipe(t){if(this===t)throw Error("Cannot pipe to self");return this._pipes.push(t),{close:()=>{const i=this._pipes.indexOf(t);i>-1&&this._pipes.splice(i,1)}}}unpipe(t){const i=this._pipes.indexOf(t);i>-1&&this._pipes.splice(i,1)}pause(){this._paused=!0}unpause(){this._paused=!1}}var A;(function(c){c.Canvas="Canvas",c.Document="Document"})(A||(A={}));const E=4294967295;class S{constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let i=1;i<this._n;i++){const n=this._mt[i-1]^this._mt[i-1]>>>this._w-2;this._mt[i]=(this._f*((n&4294901760)>>>16)<<16)+this._f*(n&65535)+i>>>0}this._index=this._n}_twist(){const t=[0,this._a];let i=0,n=0;for(;n<this._n-this._m;n++)i=this._mt[n]&this._upperMask|this._mt[n+1]&this._lowerMask,this._mt[n]=this._mt[n+this._m]^i>>>1^t[i&1]&E;for(;n<this._n-1;n++)i=this._mt[n]&this._upperMask|this._mt[n+1]&this._lowerMask,this._mt[n]=this._mt[n+(this._m-this._n)]^i>>>1^t[i&1]&E;i=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^i>>>1^t[i&1]&E,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,i){return(i-t)*this.next()+t}integer(t,i){return Math.floor((i-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,i,n=!1){return n?this._pickSetWithDuplicates(t,i):this._pickSetWithoutDuplicates(t,i)}_pickSetWithoutDuplicates(t,i){if(i>t.length||i<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(i===t.length)return t;const n=new Array(i);let o=0;const l=t.slice(0);for(;o<i;){const d=this.integer(0,l.length-1);n[o++]=l[d],l.splice(d,1)}return n}_pickSetWithDuplicates(t,i){if(i<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const n=new Array(i);for(let o=0;o<i;o++)n[o]=this.pickOne(t);return n}shuffle(t){const i=t.slice(0);let n=null;for(let o=0;o<i.length-2;o++){const l=this.integer(o,i.length-1);n=i[o],i[o]=i[l],i[l]=n}return i}range(t,i,n){const o=new Array(t);for(let l=0;l<t;l++)o[l]=this.integer(i,n);return o}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}const R=Math.PI*2;function M(c){return c>=0?c-Math.floor(c):c-Math.ceil(c)}function U(c){return c===0?0:c<0?-1:1}function $(c,t,i){return Math.min(Math.max(t,c),i)}function I(c){let t=c;if(c>R)for(;t>R;)t-=R;if(c<0)for(;t<0;)t+=R;return t}function P(c){return 180/Math.PI*c}function F(c){return c/180*Math.PI}const j=(c,t)=>Array.from(new Array(t-c+1),(i,n)=>n+c);function W(c,t,i=new S){return i?i.floating(c,t):c+Math.random()*(t-c)}function Y(c,t,i=new S){return i?i.integer(c,t):Math.round(W(c,t))}class C{static get Zero(){return new C(0,0)}static get One(){return new C(1,1)}static get Half(){return new C(.5,.5)}static get Up(){return new C(0,-1)}static get Down(){return new C(0,1)}static get Left(){return new C(-1,0)}static get Right(){return new C(1,0)}static fromAngle(t){return new C(Math.cos(t),Math.sin(t))}static isValid(t){return!(t==null||isNaN(t.x)||isNaN(t.y)||t.x===1/0||t.y===1/0||t.x===-1/0||t.y===-1/0)}static distance(t,i){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}static min(t,i){return new C(Math.min(t.x,i.x),Math.min(t.y,i.y))}static max(t,i){return new C(Math.max(t.x,i.x),Math.max(t.y,i.y))}constructor(t,i){this._x=0,this._y=0,this._x=t,this._y=i}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,i){this.x=t,this.y=i}equals(t,i=C.EQUALS_EPSILON){return Math.abs(this.x-t.x)<=i&&Math.abs(this.y-t.y)<=i}distance(t){if(!t)return Math.sqrt(this.x*this.x+this.y*this.y);const i=this.x-t.x,n=this.y-t.y;return Math.sqrt(i*i+n*n)}squareDistance(t){t||(t=C.Zero);const i=this.x-t.x,n=this.y-t.y;return i*i+n*n}clampMagnitude(t){const i=this.size,n=$(i,0,t);return this.size=n,this}get size(){return this.distance()}set size(t){const i=this.normalize().scale(t);this.setTo(i.x,i.y)}normalize(){const t=this.distance();return t>0?new C(this.x/t,this.y/t):new C(0,1)}average(t){return this.add(t).scale(.5)}scale(t,i){const n=i||new C(0,0);return t instanceof C?(n.x=this.x*t.x,n.y=this.y*t.y):(n.x=this.x*t,n.y=this.y*t),n}add(t,i){return i?(i.x=this.x+t.x,i.y=this.y+t.y,i):new C(this.x+t.x,this.y+t.y)}sub(t){return new C(this.x-t.x,this.y-t.y)}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){if(t instanceof C)return this.x*t.y-this.y*t.x;if(typeof t=="number")return new C(t*this.y,-t*this.x)}static cross(t,i){return new C(-t*i.y,t*i.x)}perpendicular(){return new C(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return I(Math.atan2(this.y,this.x))}rotate(t,i){i||(i=new C(0,0));const n=Math.sin(t),o=Math.cos(t),l=o*(this.x-i.x)-n*(this.y-i.y)+i.x,d=n*(this.x-i.x)+o*(this.y-i.y)+i.y;return new C(l,d)}clone(t){const i=t??new C(0,0);return i.x=this.x,i.y=this.y,i}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}}C.EQUALS_EPSILON=.001;function D(c,t){return new C(c,t)}class N{constructor(t,i,n,o){this.r=t,this.g=i,this.b=n,this.a=o??1}static fromRGB(t,i,n,o){return new N(t,i,n,o)}static fromRGBString(t){const i=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i;let n=null;if(n=t.match(i)){const o=parseInt(n[1],10),l=parseInt(n[2],10),d=parseInt(n[3],10);let f=1;return n[4]&&(f=parseFloat(n[4])),new N(o,l,d,f)}else throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){const i=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;let n=null;if(n=t.match(i)){const o=parseInt(n[1],16),l=parseInt(n[2],16),d=parseInt(n[3],16);let f=1;return n[4]&&(f=parseInt(n[4],16)/255),new N(o,l,d,f)}else throw new Error("Invalid hex string: "+t)}static fromHSL(t,i,n,o=1){return new it(t,i,n,o).toRGBA()}lighten(t=.1){const i=it.fromRGBA(this.r,this.g,this.b,this.a);return i.l+=(1-i.l)*t,i.toRGBA()}darken(t=.1){const i=it.fromRGBA(this.r,this.g,this.b,this.a);return i.l-=i.l*t,i.toRGBA()}saturate(t=.1){const i=it.fromRGBA(this.r,this.g,this.b,this.a);return i.s+=i.s*t,i.toRGBA()}desaturate(t=.1){const i=it.fromRGBA(this.r,this.g,this.b,this.a);return i.s-=i.s*t,i.toRGBA()}multiply(t){const i=t.r/255*this.r/255*255,n=t.g/255*this.g/255*255,o=t.b/255*this.b/255*255,l=t.a*this.a;return new N(i,n,o,l)}screen(t){const i=t.invert(),n=t.invert();return i.multiply(n).invert()}invert(){return new N(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const i=(t.r+this.r)/2,n=(t.g+this.g)/2,o=(t.b+this.b)/2,l=(t.a+this.a)/2;return new N(i,n,o,l)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const i=Math.max(Math.round(t),0).toString(16);return i.length===1?"0"+i:i}toHex(){let t="#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b);return this.a!==1&&(t+=this._componentToHex(this.a*255)),t}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return this.a!==void 0||this.a!==null?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return it.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(){return new N(this.r,this.g,this.b,this.a)}static get Black(){return N.fromHex("#000000")}static get White(){return N.fromHex("#FFFFFF")}static get Gray(){return N.fromHex("#808080")}static get LightGray(){return N.fromHex("#D3D3D3")}static get DarkGray(){return N.fromHex("#A9A9A9")}static get Yellow(){return N.fromHex("#FFFF00")}static get Orange(){return N.fromHex("#FFA500")}static get Red(){return N.fromHex("#FF0000")}static get Vermilion(){return N.fromHex("#FF5B31")}static get Rose(){return N.fromHex("#FF007F")}static get Magenta(){return N.fromHex("#FF00FF")}static get Violet(){return N.fromHex("#7F00FF")}static get Blue(){return N.fromHex("#0000FF")}static get Azure(){return N.fromHex("#007FFF")}static get Cyan(){return N.fromHex("#00FFFF")}static get Viridian(){return N.fromHex("#59978F")}static get Green(){return N.fromHex("#00FF00")}static get Chartreuse(){return N.fromHex("#7FFF00")}static get Transparent(){return N.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return N.fromHex("#176BAA")}}class it{constructor(t,i,n,o){this.h=t,this.s=i,this.l=n,this.a=o}static hue2rgb(t,i,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(i-t)*6*n:n<1/2?i:n<2/3?t+(i-t)*(2/3-n)*6:t}static fromRGBA(t,i,n,o){t/=255,i/=255,n/=255;const l=Math.max(t,i,n),d=Math.min(t,i,n);let f,g;const v=(l+d)/2;if(l===d)f=g=0;else{const w=l-d;switch(g=v>.5?w/(2-l-d):w/(l+d),l){case t:f=(i-n)/w+(i<n?6:0);break;case i:f=(n-t)/w+2;break;case n:f=(t-i)/w+4;break}f/=6}return new it(f,g,v,o)}toRGBA(){let t,i,n;if(this.s===0)t=i=n=this.l;else{const o=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,l=2*this.l-o;t=it.hue2rgb(l,o,this.h+1/3),i=it.hue2rgb(l,o,this.h),n=it.hue2rgb(l,o,this.h-1/3)}return new N(t*255,i*255,n*255,this.a)}toString(){const t=this.h.toFixed(0),i=this.s.toFixed(0),n=this.l.toFixed(0),o=this.a.toFixed(0);return`hsla(${t}, ${i}, ${n}, ${o})`}}var rt;(function(c){c[c.Debug=0]="Debug",c[c.Info=1]="Info",c[c.Warn=2]="Warn",c[c.Error=3]="Error",c[c.Fatal=4]="Fatal"})(rt||(rt={}));class K{constructor(){if(this._appenders=[],this.defaultLevel=rt.Info,this._logOnceSet=new Set,K._INSTANCE)throw new Error("Logger is a singleton");return K._INSTANCE=this,K._INSTANCE.addAppender(new Pt),K._INSTANCE}static getInstance(){return K._INSTANCE==null&&(K._INSTANCE=new K),K._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,i){t==null&&(t=this.defaultLevel);const n=this._appenders.length;for(let o=0;o<n;o++)t>=this.defaultLevel&&this._appenders[o].log(t,i)}_logOnce(t,i){const n=t+i.join("+");this._logOnceSet.has(n)||(this._logOnceSet.add(n),this._log(t,i))}debug(...t){this._log(rt.Debug,t)}debugOnce(...t){this._logOnce(rt.Debug,t)}info(...t){this._log(rt.Info,t)}infoOnce(...t){this._logOnce(rt.Info,t)}warn(...t){this._log(rt.Warn,t)}warnOnce(...t){this._logOnce(rt.Warn,t)}error(...t){this._log(rt.Error,t)}errorOnce(...t){this._logOnce(rt.Error,t)}fatal(...t){this._log(rt.Fatal,t)}fatalOnce(...t){this._logOnce(rt.Fatal,t)}}K._INSTANCE=null;class Pt{log(t,i){if(!console&&!console.log&&console.warn&&console.error)return;const n=[];n.unshift.apply(n,i),n.unshift("["+rt[t]+"] : "),t<rt.Warn?console.log.apply?console.log.apply(console,n):console.log(n.join(" ")):t<rt.Error?console.warn.apply?console.warn.apply(console,n):console.warn(n.join(" ")):console.error.apply?console.error.apply(console,n):console.error(n.join(" "))}}class St{constructor(t){var i,n;this._messages=[],this._pos=10,this._color=N.Black,this._options=t,this.canvas=document.createElement("canvas"),this._ctx=this.canvas.getContext("2d"),this.canvas.style.position="absolute",this.canvas.style.zIndex=(n=(i=t.zIndex)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:"99",document.body.appendChild(this.canvas),this._positionScreenAppenderCanvas(),t.engine.screen.events.on("resize",()=>{this._positionScreenAppenderCanvas()})}_positionScreenAppenderCanvas(){var t,i,n,o;const l=this._options;this.canvas.width=(t=l.width)!==null&&t!==void 0?t:l.engine.screen.resolution.width,this.canvas.height=(i=l.height)!==null&&i!==void 0?i:l.engine.screen.resolution.height,this.canvas.style.position="absolute";const d=l.engine.screen.screenToPageCoordinates(D(0,0));this.canvas.style.left=d.x+"px",this.canvas.style.top=d.y+"px",this._pos=(n=l.xPos)!==null&&n!==void 0?n:this._pos,this._color=(o=l.color)!==null&&o!==void 0?o:this._color}log(t,i){const n=i.join(",");this._ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._messages.unshift("["+rt[t]+"] : "+n);let o=10;this._messages=this._messages.slice(0,1e3);for(let l=0;l<this._messages.length;l++)this._ctx.fillStyle=this._color.toRGBA(),this._ctx.fillText(this._messages[l],this._pos,o),o+=10}}var ut;(function(c){c.None="None",c.Top="Top",c.Bottom="Bottom",c.Left="Left",c.Right="Right"})(ut||(ut={})),function(c){function t(n){return n===c.Top?c.Bottom:n===c.Bottom?c.Top:n===c.Left?c.Right:n===c.Right?c.Left:c.None}c.getOpposite=t;function i(n){const o=[C.Left,C.Right,C.Up,C.Down],l=[c.Left,c.Right,c.Top,c.Bottom];let d=-Number.MAX_VALUE,f=-1;for(let g=0;g<o.length;g++)o[g].dot(n)>d&&(d=o[g].dot(n),f=g);return l[f]}c.fromDirection=i}(ut||(ut={}));class tt{constructor(t=0,i=0,n=0,o=0){this._points=[],typeof t=="object"?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):typeof t=="number"&&(this.left=t,this.top=i,this.right=n,this.bottom=o)}clone(){return new tt(this.left,this.top,this.right,this.bottom)}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?ut.Right:ut.Left:t.y<0?ut.Bottom:ut.Top:ut.None}static fromPoints(t){let i=1/0,n=1/0,o=-1/0,l=-1/0;for(let d=0;d<t.length;d++)t[d].x<i&&(i=t[d].x),t[d].x>o&&(o=t[d].x),t[d].y<n&&(n=t[d].y),t[d].y>l&&(l=t[d].y);return new tt(i,n,o,l)}static fromDimension(t,i,n=C.Half,o=C.Zero){return new tt(-t*n.x+o.x,-i*n.y+o.y,t-t*n.x+o.x,i-i*n.y+o.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return this.width===0||this.height===0}get center(){return new C((this.left+this.right)/2,(this.top+this.bottom)/2)}get topLeft(){return new C(this.left,this.top)}get bottomRight(){return new C(this.right,this.bottom)}get topRight(){return new C(this.right,this.top)}get bottomLeft(){return new C(this.left,this.bottom)}translate(t){return new tt(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,i=C.Zero){const n=this.getPoints().map(o=>o.rotate(t,i));return tt.fromPoints(n)}scale(t,i=C.Zero){const n=this.translate(i);return new tt(n.left*t.x,n.top*t.y,n.right*t.x,n.bottom*t.y)}transform(t){const i=t.data[0]*this.left,n=t.data[1]*this.left,o=t.data[0]*this.right,l=t.data[1]*this.right,d=t.data[2]*this.top,f=t.data[3]*this.top,g=t.data[2]*this.bottom,v=t.data[3]*this.bottom,w=t.getPosition(),x=Math.min(i,o)+Math.min(d,g)+w.x,T=Math.min(n,l)+Math.min(f,v)+w.y,k=Math.max(i,o)+Math.max(d,g)+w.x,B=Math.max(n,l)+Math.max(f,v)+w.y;return new tt({left:x,top:T,right:k,bottom:B})}getPerimeter(){const t=this.width,i=this.height;return 2*(t+i)}getPoints(){return(this._left!==this.left||this._right!==this.right||this._top!==this.top||this._bottom!==this.bottom)&&(this._points.length=0,this._points.push(new C(this.left,this.top)),this._points.push(new C(this.right,this.top)),this._points.push(new C(this.right,this.bottom)),this._points.push(new C(this.left,this.bottom)),this._left=this.left,this._right=this.right,this._top=this.top,this._bottom=this.bottom),this._points}rayCast(t,i=1/0){let n=-1/0,o=1/0;const l=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,d=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,f=(this.left-t.pos.x)*l,g=(this.right-t.pos.x)*l;n=Math.min(f,g),o=Math.max(f,g);const v=(this.top-t.pos.y)*d,w=(this.bottom-t.pos.y)*d;return n=Math.max(n,Math.min(v,w)),o=Math.min(o,Math.max(v,w)),o>=Math.max(0,n)&&n<i}rayCastTime(t,i=1/0){let n=-1/0,o=1/0;const l=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,d=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,f=(this.left-t.pos.x)*l,g=(this.right-t.pos.x)*l;n=Math.min(f,g),o=Math.max(f,g);const v=(this.top-t.pos.y)*d,w=(this.bottom-t.pos.y)*d;return n=Math.max(n,Math.min(v,w)),o=Math.min(o,Math.max(v,w)),o>=Math.max(0,n)&&n<i?n:-1}contains(t){return t instanceof C?this.left<=t.x&&this.top<=t.y&&this.bottom>=t.y&&this.right>=t.x:t instanceof tt?this.left<=t.left&&this.top<=t.top&&t.bottom<=this.bottom&&t.right<=this.right:!1}combine(t){return new tt(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom))}get dimensions(){return new C(this.width,this.height)}overlaps(t,i){const n=i||0;if(t.hasZeroDimensions())return this.contains(t);if(this.hasZeroDimensions())return t.contains(this);const o=this.combine(t);return o.width+n<t.width+this.width&&o.height+n<t.height+this.height}intersect(t){const i=this.combine(t);if(i.width<t.width+this.width&&i.height<t.height+this.height&&!i.dimensions.equals(t.dimensions)&&!i.dimensions.equals(this.dimensions)){let n=0;this.right>=t.left&&this.right<=t.right?n=t.left-this.right:n=t.right-this.left;let o=0;return this.top<=t.bottom&&this.top>=t.top?o=t.bottom-this.top:o=t.top-this.bottom,Math.abs(n)<Math.abs(o)?new C(n,0):new C(0,o)}else if(i.dimensions.equals(t.dimensions)||i.dimensions.equals(this.dimensions)){let n=0;this.width-t.width>=0?this.right-t.right<=t.left-this.left?n=t.left-this.right:n=t.right-this.left:t.right-this.right<=this.left-t.left?n=this.left-t.right:n=this.right-t.left;let o=0;return this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?o=t.top-this.bottom:o=t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?o=this.top-t.bottom:o=this.bottom-t.top,Math.abs(n)<Math.abs(o)?new C(n,0):new C(0,o)}else return null}intersectWithSide(t){const i=this.intersect(t);return tt.getSideFromIntersection(i)}draw(t,i=N.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:i})}}function Pe(c){if(c){const t=c.getBoundingClientRect();return D(t.x+window.scrollX,t.y+window.scrollY)}return C.Zero}function et(c,t){return t.indexOf(c)===-1?(t.push(c),!0):!1}function q(c,t){let i=-1;return(i=t.indexOf(c))>-1?(t.splice(i,1),!0):!1}function Z(c,t){for(let i=0;i<c.length;i++)if(c[i]===t)return!0;return!1}function lt(c){throw new Error(c)}function at(c,t){var i;const n=new _;return((i=t==null?void 0:t.schedule.bind(t))!==null&&i!==void 0?i:setTimeout)(()=>{n.resolve()},c),n.promise}function Ct(c,t){const i={};for(const n in c)t.includes(n)||(i[n]=c[n]);return i}var Tt;(function(c){c[c.X=12]="X",c[c.Y=13]="Y"})(Tt||(Tt={}));class bt{constructor(){this.data=new Float32Array(16),this._scaleX=1,this._scaleSignX=1,this._scaleY=1,this._scaleSignY=1}static ortho(t,i,n,o,l,d){const f=new bt;return f.data[0]=2/(i-t),f.data[1]=0,f.data[2]=0,f.data[3]=0,f.data[4]=0,f.data[5]=2/(o-n),f.data[6]=0,f.data[7]=0,f.data[8]=0,f.data[9]=0,f.data[10]=-2/(d-l),f.data[11]=0,f.data[12]=-(i+t)/(i-t),f.data[13]=-(o+n)/(o-n),f.data[14]=-(d+l)/(d-l),f.data[15]=1,f}clone(t){const i=t||new bt;return i.data[0]=this.data[0],i.data[1]=this.data[1],i.data[2]=this.data[2],i.data[3]=this.data[3],i.data[4]=this.data[4],i.data[5]=this.data[5],i.data[6]=this.data[6],i.data[7]=this.data[7],i.data[8]=this.data[8],i.data[9]=this.data[9],i.data[10]=this.data[10],i.data[11]=this.data[11],i.data[12]=this.data[12],i.data[13]=this.data[13],i.data[14]=this.data[14],i.data[15]=this.data[15],i}toDOMMatrix(){return new DOMMatrix([...this.data])}static fromFloat32Array(t){const i=new bt;return i.data=t,i}static identity(){const t=new bt;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,i){const n=bt.identity();return n.data[12]=t,n.data[13]=i,n}static scale(t,i){const n=bt.identity();return n.data[0]=t,n.data[5]=i,n.data[10]=1,n.data[15]=1,n}static rotation(t){const i=bt.identity();return i.data[0]=Math.cos(t),i.data[4]=-Math.sin(t),i.data[1]=Math.sin(t),i.data[5]=Math.cos(t),i}multiply(t,i){if(t instanceof C){const n=i||new C(0,0),o=t,l=o.x*this.data[0]+o.y*this.data[4]+this.data[12],d=o.x*this.data[1]+o.y*this.data[5]+this.data[13];return n.x=l,n.y=d,n}else{const n=i||new bt,o=t,l=this.data[0],d=this.data[1],f=this.data[2],g=this.data[3],v=this.data[4],w=this.data[5],x=this.data[6],T=this.data[7],k=this.data[8],B=this.data[9],O=this.data[10],G=this.data[11],L=this.data[12],z=this.data[13],V=this.data[14],H=this.data[15],st=o.data[0],mt=o.data[1],X=o.data[2],_t=o.data[3],Wt=o.data[4],ce=o.data[5],je=o.data[6],Ge=o.data[7],Ve=o.data[8],Fe=o.data[9],ve=o.data[10],ye=o.data[11],ct=o.data[12],$s=o.data[13],Ys=o.data[14],Qs=o.data[15];n.data[0]=l*st+v*mt+k*X+L*_t,n.data[1]=d*st+w*mt+B*X+z*_t,n.data[2]=f*st+x*mt+O*X+V*_t,n.data[3]=g*st+T*mt+G*X+H*_t,n.data[4]=l*Wt+v*ce+k*je+L*Ge,n.data[5]=d*Wt+w*ce+B*je+z*Ge,n.data[6]=f*Wt+x*ce+O*je+V*Ge,n.data[7]=g*Wt+T*ce+G*je+H*Ge,n.data[8]=l*Ve+v*Fe+k*ve+L*ye,n.data[9]=d*Ve+w*Fe+B*ve+z*ye,n.data[10]=f*Ve+x*Fe+O*ve+V*ye,n.data[11]=g*Ve+T*Fe+G*ve+H*ye,n.data[12]=l*ct+v*$s+k*Ys+L*Qs,n.data[13]=d*ct+w*$s+B*Ys+z*Qs,n.data[14]=f*ct+x*$s+O*Ys+V*Qs,n.data[15]=g*ct+T*$s+G*Ys+H*Qs;const Dn=this.getScale();return n._scaleSignX=U(Dn.x)*U(n._scaleSignX),n._scaleSignY=U(Dn.y)*U(n._scaleSignY),n}}translate(t,i){const n=this.data[0],o=this.data[1],l=this.data[2],d=this.data[3],f=this.data[4],g=this.data[5],v=this.data[6],w=this.data[7],x=this.data[8],T=this.data[9],k=this.data[10],B=this.data[11],O=this.data[12],G=this.data[13],L=this.data[14],z=this.data[15],V=0,H=1;return this.data[12]=n*t+f*i+x*V+O*H,this.data[13]=o*t+g*i+T*V+G*H,this.data[14]=l*t+v*i+k*V+L*H,this.data[15]=d*t+w*i+B*V+z*H,this}setPosition(t,i){this.data[12]=t,this.data[13]=i}getPosition(){return D(this.data[12],this.data[13])}rotate(t){const i=this.data[0],n=this.data[1],o=this.data[2],l=this.data[3],d=this.data[4],f=this.data[5],g=this.data[6],v=this.data[7],w=Math.sin(t),x=Math.cos(t);return this.data[0]=x*i+w*d,this.data[1]=x*n+w*f,this.data[2]=x*o+w*g,this.data[3]=x*l+w*v,this.data[4]=x*d-w*i,this.data[5]=x*f-w*n,this.data[6]=x*g-w*o,this.data[7]=x*v-w*l,this}scale(t,i){const n=this.data[0],o=this.data[1],l=this.data[2],d=this.data[3],f=this.data[4],g=this.data[5],v=this.data[6],w=this.data[7];return this.data[0]=n*t,this.data[1]=o*t,this.data[2]=l*t,this.data[3]=d*t,this.data[4]=f*i,this.data[5]=g*i,this.data[6]=v*i,this.data[7]=w*i,this}setRotation(t){const i=this.getScale(),n=Math.sin(t),o=Math.cos(t);this.data[0]=o*i.x,this.data[1]=n*i.y,this.data[4]=-n*i.x,this.data[5]=o*i.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return I(t)}getScaleX(){const t=D(this.data[0],this.data[4]).size;return this._scaleSignX*t}getScaleY(){const t=D(this.data[1],this.data[5]).size;return this._scaleSignY*t}getScale(){return D(this.getScaleX(),this.getScaleY())}setScaleX(t){if(this._scaleX===t)return;this._scaleSignX=U(t);const i=D(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=i.x*t,this.data[4]=i.y*t,this._scaleX=t}setScaleY(t){if(this._scaleY===t)return;this._scaleSignY=U(t);const i=D(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=i.x*t,this.data[5]=i.y*t,this._scaleY=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){const n=1/this.getBasisDeterminant(),o=this.data[0],l=this.data[4],d=this.data[1],f=this.data[5],g=t||bt.identity();g.data[0]=f*n,g.data[1]=-d*n,g.data[4]=-l*n,g.data[5]=o*n;const v=this.data[12],w=this.data[13];return g.data[12]=-(v*g.data[0]+w*g.data[4]),g.data[13]=-(v*g.data[1]+w*g.data[5]),g}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===0&&this.data[4]===0&&this.data[5]===1&&this.data[6]===0&&this.data[7]===0&&this.data[8]===0&&this.data[9]===0&&this.data[10]===1&&this.data[11]===0&&this.data[12]===0&&this.data[13]===0&&this.data[14]===0&&this.data[15]===1}toString(){return`
[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]
[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]
[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]
[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]
`}}class gt{constructor(){this.data=new Float64Array(6),this._scale=new Float64Array([1,1]),this._scaleSignX=1,this._scaleSignY=1}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const t=new gt;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}static translation(t,i){const n=gt.identity();return n.data[4]=t,n.data[5]=i,n}static scale(t,i){const n=gt.identity();return n.data[0]=t,n.data[3]=i,n._scale[0]=t,n._scale[1]=i,n}static rotation(t){const i=gt.identity();return i.data[0]=Math.cos(t),i.data[1]=Math.sin(t),i.data[2]=-Math.sin(t),i.data[3]=Math.cos(t),i}setPosition(t,i){this.data[4]=t,this.data[5]=i}getPosition(){return D(this.data[4],this.data[5])}rotate(t){const i=this.data[0],n=this.data[1],o=this.data[2],l=this.data[3],d=Math.sin(t),f=Math.cos(t);return this.data[0]=f*i+d*o,this.data[1]=f*n+d*l,this.data[2]=f*o-d*i,this.data[3]=f*l-d*n,this}translate(t,i){const n=this.data[0],o=this.data[1],l=this.data[2],d=this.data[3],f=this.data[4],g=this.data[5];return this.data[4]=n*t+l*i+f,this.data[5]=o*t+d*i+g,this}scale(t,i){const n=this.data[0],o=this.data[1],l=this.data[2],d=this.data[3];return this.data[0]=n*t,this.data[1]=o*t,this.data[2]=l*i,this.data[3]=d*i,this._scale[0]=t,this._scale[1]=i,this}determinant(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}inverse(t){const n=1/this.determinant(),o=this.data[0],l=this.data[2],d=this.data[1],f=this.data[3],g=t||gt.identity();g.data[0]=f*n,g.data[1]=-d*n,g.data[2]=-l*n,g.data[3]=o*n;const v=this.data[4],w=this.data[5];return g.data[4]=-(v*g.data[0]+w*g.data[2]),g.data[5]=-(v*g.data[1]+w*g.data[3]),g}multiply(t,i){if(t instanceof C){const n=i||new C(0,0),o=t,l=o.x*this.data[0]+o.y*this.data[2]+this.data[4],d=o.x*this.data[1]+o.y*this.data[3]+this.data[5];return n.x=l,n.y=d,n}else{const n=i||new gt,o=t,l=this.data[0],d=this.data[1],f=this.data[2],g=this.data[3],v=this.data[4],w=this.data[5],x=o.data[0],T=o.data[1],k=o.data[2],B=o.data[3],O=o.data[4],G=o.data[5];n.data[0]=l*x+f*T,n.data[1]=d*x+g*T,n.data[2]=l*k+f*B,n.data[3]=d*k+g*B,n.data[4]=l*O+f*G+v,n.data[5]=d*O+g*G+w;const L=this.getScale();return n._scaleSignX=U(L.x)*U(n._scaleSignX),n._scaleSignY=U(L.y)*U(n._scaleSignY),n}}multiplyQuadInPlace(t){const i=t[0]*this.data[0]+t[1]*this.data[2]+this.data[4],n=t[0]*this.data[1]+t[1]*this.data[3]+this.data[5];t[0]=i,t[1]=n;const o=t[2]*this.data[0]+t[3]*this.data[2]+this.data[4],l=t[2]*this.data[1]+t[3]*this.data[3]+this.data[5];t[2]=o,t[3]=l;const d=t[4]*this.data[0]+t[5]*this.data[2]+this.data[4],f=t[4]*this.data[1]+t[5]*this.data[3]+this.data[5];t[4]=d,t[5]=f;const g=t[6]*this.data[0]+t[7]*this.data[2]+this.data[4],v=t[6]*this.data[1]+t[7]*this.data[3]+this.data[5];t[6]=g,t[7]=v}to4x4(){const t=new bt;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=0,t.data[3]=0,t.data[4]=this.data[2],t.data[5]=this.data[3],t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=this.data[4],t.data[13]=this.data[5],t.data[14]=0,t.data[15]=1,t}setRotation(t){const i=this.getScale(),n=Math.sin(t),o=Math.cos(t);this.data[0]=o*i.x,this.data[1]=n*i.y,this.data[2]=-n*i.x,this.data[3]=o*i.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return I(t)}getScaleX(){const t=D(this.data[0],this.data[2]).distance();return this._scaleSignX*t}getScaleY(){const t=D(this.data[1],this.data[3]).distance();return this._scaleSignY*t}getScale(){return D(this.getScaleX(),this.getScaleY())}setScaleX(t){if(t===this._scale[0])return;this._scaleSignX=U(t);const i=D(this.data[0]*this._scaleSignX,this.data[2]*this._scaleSignX).normalize();this.data[0]=i.x*t,this.data[2]=i.y*t,this._scale[0]=t}setScaleY(t){if(t===this._scale[1])return;this._scaleSignY=U(t);const i=D(this.data[1]*this._scaleSignY,this.data[3]*this._scaleSignY).normalize();this.data[1]=i.x*t,this.data[3]=i.y*t,this._scale[1]=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===1&&this.data[4]===0&&this.data[5]===0}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}clone(t){const i=t||new gt;return i.data.set(this.data),i}toString(){return`
[${this.data[0]} ${this.data[2]} ${this.data[4]}]
[${this.data[1]} ${this.data[3]} ${this.data[5]}]
[0 0 1]
`}}class Zt{constructor(){this._transforms=[],this._currentTransform=gt.identity()}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone()}restore(){this._currentTransform=this._transforms.pop()}translate(t,i){return this._currentTransform.translate(t,i)}rotate(t){return this._currentTransform.rotate(t)}scale(t,i){return this._currentTransform.scale(t,i)}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class Ke{constructor(){this.current=this._getDefaultState(),this._states=[]}_getDefaultState(){return{opacity:1,z:0,tint:N.White,material:null}}_cloneState(){return{opacity:this.current.opacity,z:this.current.z,tint:this.current.tint.clone(),material:this.current.material}}save(){this._states.push(this.current),this.current=this._cloneState()}restore(){this.current=this._states.pop()}}const vt={Complete:"complete",Load:"load",LoadStart:"loadstart",Progress:"progress",Error:"error"};class ee{constructor(t,i,n=!1){this.path=t,this.responseType=i,this.bustCache=n,this.data=null,this.logger=K.getInstance(),this.events=new y}isLoaded(){return this.data!==null}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise((t,i)=>{if(this.data!==null){this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),t(this.data);return}const n=new XMLHttpRequest;n.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),n.responseType=this.responseType,n.addEventListener("loadstart",o=>this.events.emit("loadstart",o)),n.addEventListener("progress",o=>this.events.emit("progress",o)),n.addEventListener("error",o=>this.events.emit("error",o)),n.addEventListener("load",o=>this.events.emit("load",o)),n.addEventListener("load",()=>{if(n.status!==0&&n.status!==200){this.logger.error("Failed to load resource ",this.path," server responded with error code",n.status),this.events.emit("error",n.response),i(new Error(n.statusText));return}this.data=n.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)}),n.send()})}}function Mt(c,t){return c&&(c.__isProxy===void 0?new Proxy(c,{set:(i,n,o)=>(i[n]!==o&&(i[n]=o,typeof n=="string"&&n[0]!=="_"&&t(i)),!0),get:(i,n)=>n!=="__isProxy"?i[n]:!0}):c)}const cr=(c=[],t,i)=>({get:(n,o)=>o==="__isProxy"?!0:typeof n[o]=="object"&&n[o]!=null?new Proxy(n[o],cr([...c,o],t,i)):n[o],set:(n,o,l)=>(typeof o=="string"&&o[0]!=="_"&&t(i),n[o]=l,!0)});function kl(c,t){return c&&(c.__isProxy===void 0?new Proxy(c,cr([],t,c)):c)}function wo(c,t){return c&&(c.__isProxy===void 0?new Proxy(c,{set:(i,n,o)=>(i[n]=o,typeof n=="string"&&n[0]!=="_"&&t(i),!0),get:(i,n)=>n!=="__isProxy"?i[n]:!0}):c)}class Lt{isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=Mt(t,()=>{this._transformStale=!0}),this._transformStale=!0}get origin(){return this._origin}set origin(t){this._origin=Mt(t,()=>{this._transformStale=!0}),this._transformStale=!0}constructor(t){var i,n,o,l,d,f,g;this.id=Lt._ID++,this.transform=gt.identity(),this.tint=null,this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=C.One,this._origin=null,this._width=0,this._height=0,t&&(this.origin=(i=t.origin)!==null&&i!==void 0?i:this.origin,this.flipHorizontal=(n=t.flipHorizontal)!==null&&n!==void 0?n:this.flipHorizontal,this.flipVertical=(o=t.flipVertical)!==null&&o!==void 0?o:this.flipVertical,this.rotation=(l=t.rotation)!==null&&l!==void 0?l:this.rotation,this.opacity=(d=t.opacity)!==null&&d!==void 0?d:this.opacity,this.scale=(f=t.scale)!==null&&f!==void 0?f:this.scale,this.tint=(g=t.tint)!==null&&g!==void 0?g:this.tint)}cloneGraphicOptions(){return{width:this.width/this.scale.x,height:this.height/this.scale.y,origin:this.origin?this.origin.clone():null,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():null,tint:this.tint?this.tint.clone():null}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return tt.fromDimension(this.width,this.height,C.Zero)}draw(t,i,n){this._preDraw(t,i,n),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,i,n){t.save(),t.translate(i,n),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity,this.tint&&(t.tint=this.tint)}_rotate(t){var i;const n=this.scale.x>0?1:-1,o=this.scale.y>0?1:-1,l=(i=this.origin)!==null&&i!==void 0?i:D(this.width/2,this.height/2);t.translate(l.x,l.y),t.rotate(this.rotation),t.scale(n,o),t.translate(-l.x,-l.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}Lt._ID=0;class Gi extends Lt{static from(t){return new Gi({image:t})}constructor(t){var i,n;super(t),this._logger=K.getInstance(),this._dirty=!0,this.image=t.image;const{width:o,height:l}=t;this.sourceView=(i=t.sourceView)!==null&&i!==void 0?i:{x:0,y:0,width:o??0,height:l??0},this.destSize=(n=t.destSize)!==null&&n!==void 0?n:{width:o??0,height:l??0},this._updateSpriteDimensions(),this.image.ready.then(()=>{this._updateSpriteDimensions()})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,i,n,o,l,d;const{width:f,height:g}=this.image;this.sourceView.width=((t=this.sourceView)===null||t===void 0?void 0:t.width)||f,this.sourceView.height=((i=this.sourceView)===null||i===void 0?void 0:i.height)||g,this.destSize.width=((n=this.destSize)===null||n===void 0?void 0:n.width)||((o=this.sourceView)===null||o===void 0?void 0:o.width)||f,this.destSize.height=((l=this.destSize)===null||l===void 0?void 0:l.height)||((d=this.sourceView)===null||d===void 0?void 0:d.height)||g,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,i,n){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,i,n)}_drawImage(t,i,n){this.image.isLoaded()?t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,i,n,this.destSize.width,this.destSize.height):this._logger.warnOnce(`ImageSource ${this.image.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`)}clone(){return new Gi({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}var Kt;(function(c){c.Pixel="Pixel",c.Blended="Blended"})(Kt||(Kt={}));function xo(c){switch(c){case Kt.Pixel:return Kt.Pixel;case Kt.Blended:return Kt.Blended;default:return null}}var Xt;(function(c){c.Clamp="Clamp",c.Repeat="Repeat",c.Mirror="Mirror"})(Xt||(Xt={}));function ks(c){switch(c){case Xt.Clamp:return Xt.Clamp;case Xt.Repeat:return Xt.Repeat;case Xt.Mirror:return Xt.Mirror;default:return Xt.Clamp}}class Jt{constructor(t){this._textureMap=new Map,this._gl=t,Jt._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE)}dispose(){for(const[t]of this._textureMap)this.delete(t);this._textureMap.clear(),this._gl=null}get(t){return this._textureMap.get(t)}has(t){return this._textureMap.has(t)}load(t,i,n=!1){const o=this._gl;if(!o)return null;const{filtering:l,wrapping:d}={...i};let f=null;if(this.has(t)&&(f=this.get(t)),f)return n&&(o.bindTexture(o.TEXTURE_2D,f),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t)),f;f=o.createTexture(),Jt.checkImageSizeSupportedAndLog(t),o.bindTexture(o.TEXTURE_2D,f),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);let g;d&&(typeof d=="string"?g={x:d,y:d}:g={x:d.x,y:d.y});const{x:v,y:w}=g??Jt.wrapping;switch(v){case Xt.Clamp:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE);break;case Xt.Repeat:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT);break;case Xt.Mirror:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.MIRRORED_REPEAT);break;default:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE)}switch(w){case Xt.Clamp:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);break;case Xt.Repeat:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT);break;case Xt.Mirror:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.MIRRORED_REPEAT);break;default:o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE)}const x=l??Jt.filtering;return o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,x===Kt.Pixel?o.NEAREST:o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,x===Kt.Pixel?o.NEAREST:o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t),this._textureMap.set(t,f),f}delete(t){const i=this._gl;if(!i)return null;let n=null;this.has(t)&&(n=this.get(t),i.deleteTexture(n))}static checkImageSizeSupportedAndLog(t){var i;const n=(i=t.dataset.originalSrc)!==null&&i!==void 0?i:"internal canvas bitmap";return t.width>Jt._MAX_TEXTURE_SIZE||t.height>Jt._MAX_TEXTURE_SIZE?(Jt._LOGGER.error(`The image [${n}] provided to Excalibur is too large for the device's maximum texture size of (${Jt._MAX_TEXTURE_SIZE}x${Jt._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.

Images will likely render as black rectangles.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&Jt._LOGGER.warn(`The image [${n}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).

Images will likely render as black rectangles on some mobile platforms.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}}Jt._LOGGER=K.getInstance(),Jt.filtering=Kt.Blended,Jt.wrapping={x:Xt.Clamp,y:Xt.Clamp},Jt._MAX_TEXTURE_SIZE=4096;const ie={Filtering:"filtering",WrappingX:"wrapping-x",WrappingY:"wrapping-y"};class fn{get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}constructor(t,i,n){this._logger=K.getInstance(),this.data=new Image,this._readyFuture=new _,this.ready=this._readyFuture.promise,this.path=t;let o=!1,l;typeof i=="boolean"?o=i:{filtering:n,wrapping:l,bustCache:o}={...i},this._resource=new ee(t,"blob",o),this.filtering=n??this.filtering,typeof l=="string"?this.wrapping={x:l,y:l}:this.wrapping=l??this.wrapping,(t.endsWith(".svg")||t.endsWith(".gif"))&&this._logger.warn(`Image type is not fully supported, you may have mixed results ${t}. Fully supported: jpg, bmp, and png`)}static fromHtmlImageElement(t,i){const n=new fn("");if(n._src="image-element",n.data=t,n.data.setAttribute("data-original-src","image-element"),i!=null&&i.filtering?n.data.setAttribute(ie.Filtering,i==null?void 0:i.filtering):n.data.setAttribute(ie.Filtering,Kt.Blended),i!=null&&i.wrapping){let o;typeof i.wrapping=="string"?o={x:i.wrapping,y:i.wrapping}:o={x:i.wrapping.x,y:i.wrapping.y},n.data.setAttribute(ie.WrappingX,o.x),n.data.setAttribute(ie.WrappingY,o.y)}else n.data.setAttribute(ie.WrappingX,Xt.Clamp),n.data.setAttribute(ie.WrappingY,Xt.Clamp);return Jt.checkImageSizeSupportedAndLog(t),n._readyFuture.resolve(t),n}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){var t,i,n,o;if(this.isLoaded())return this.data;try{let l;if(this.path.includes("data:image/"))l=this.path;else{const g=await this._resource.load();l=URL.createObjectURL(g)}const d=new Image,f=new _;d.onload=()=>f.resolve(),d.src=l,d.setAttribute("data-original-src",this.path),await f.promise,this.data=d,Jt.checkImageSizeSupportedAndLog(this.data)}catch(l){throw`Error loading ImageSource from path '${this.path}' with error [${l.message}]`}return this.data.setAttribute(ie.Filtering,this.filtering),this.data.setAttribute(ie.WrappingX,(i=(t=this.wrapping)===null||t===void 0?void 0:t.x)!==null&&i!==void 0?i:Xt.Clamp),this.data.setAttribute(ie.WrappingY,(o=(n=this.wrapping)===null||n===void 0?void 0:n.y)!==null&&o!==void 0?o:Xt.Clamp),this._readyFuture.resolve(this.data),this.data}toSprite(){return Gi.from(this)}unload(){this.data=new Image}}class Co extends Lt{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=null,this.caseInsensitive=!1,this.spacing=0,this.lineHeight=void 0,this._logger=K.getInstance();const{alphabet:i,spriteSheet:n,caseInsensitive:o,spacing:l,shadow:d,lineHeight:f}=t;this.alphabet=i,this.spriteSheet=n,this.caseInsensitive=o??this.caseInsensitive,this.spacing=l??this.spacing,this.shadow=d??this.shadow,this.lineHeight=f??this.lineHeight}_getCharacterSprites(t){const i=[],n=this.caseInsensitive?t.toLocaleLowerCase():t,o=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let l=0;l<n.length;l++){const d=n[l];let f=o.indexOf(d);f===-1&&(f=0,this._logger.warnOnce(`SpriteFont - Cannot find letter '${d}' in configured alphabet '${o}'.`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."));const g=this.spriteSheet.sprites[f];g?i.push(g):(this._logger.warnOnce(`SpriteFont - Cannot find sprite for '${d}' at index '${f}' in configured SpriteSheet`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."))}return i}measureText(t,i){const n=this._getLinesFromText(t,i),o=n.reduce((g,v)=>g.length>v.length?g:v),l=this._getCharacterSprites(o);let d=0,f=0;for(const g of l)d+=g.width+this.spacing,f=Math.max(f,g.height);return tt.fromDimension(d,f*n.length,C.Zero)}_drawImage(t,i,n,o){var l;let d=0,f=0,g=0;const v=this._getLinesFromText(this._text,o);for(const w of v){for(const x of this._getCharacterSprites(w))x.draw(t,i+d,n+f),d+=x.width+this.spacing,g=Math.max(g,x.height);d=0,f+=(l=this.lineHeight)!==null&&l!==void 0?l:g}}render(t,i,n,o,l,d){this._text=i;const f=this.measureText(i,d);this.width=f.width,this.height=f.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this._preDraw(t,o,l),this._drawImage(t,0,0,d),this._postDraw(t),t.restore()),this._preDraw(t,o,l),this._drawImage(t,0,0,d),this._postDraw(t)}clone(){return new Co({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}_getLinesFromText(t,i){if(this._cachedText===t&&this._cachedRenderWidth===i)return this._cachedLines;const n=t.split(`
`);if(i==null)return n;for(let o=0;o<n.length;o++){let l=n[o],d="";if(this.measureText(l).width>i){for(;this.measureText(l).width>i;)d=l[l.length-1]+d,l=l.slice(0,-1);n[o]=l,n[o+1]=d}}return this._cachedText=t,this._cachedLines=n,this._cachedRenderWidth=i,n}}class Fs{constructor(t){this.sprites=[];const{sprites:i,rows:n,columns:o}=t;this.sprites=i,this.rows=n??1,this.columns=o??this.sprites.length}getSprite(t,i,n){var o,l,d,f,g,v,w,x,T;if(t>=this.columns||t<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${i}), x: ${t} should be between 0 and ${this.columns-1}`);if(i>=this.rows||i<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${i}), y: ${i} should be between 0 and ${this.rows-1}`);const k=t+i*this.columns,B=this.sprites[k];if(B){if(n){const O=B.clone();return O.flipHorizontal=(o=n.flipHorizontal)!==null&&o!==void 0?o:O.flipHorizontal,O.flipVertical=(l=n.flipVertical)!==null&&l!==void 0?l:O.flipVertical,O.width=(d=n.width)!==null&&d!==void 0?d:O.width,O.height=(f=n.height)!==null&&f!==void 0?f:O.height,O.rotation=(g=n.rotation)!==null&&g!==void 0?g:O.rotation,O.scale=(v=n.scale)!==null&&v!==void 0?v:O.scale,O.opacity=(w=n.opacity)!==null&&w!==void 0?w:O.opacity,O.tint=(x=n.tint)!==null&&x!==void 0?x:O.tint,O.origin=(T=n.origin)!==null&&T!==void 0?T:O.origin,O}return B}throw Error(`Invalid sprite coordinates (${t}, ${i}`)}static fromImageSourceWithSourceViews(t){const i=t.sourceViews.map(n=>new Gi({image:t.image,sourceView:n}));return new Fs({sprites:i})}static fromImageSource(t){var i;const n=[];t.spacing=(i=t.spacing)!==null&&i!==void 0?i:{};const{image:o,grid:{rows:l,columns:d,spriteWidth:f,spriteHeight:g},spacing:{originOffset:v,margin:w}}=t,x={x:0,y:0,...v},T={x:0,y:0,...w};for(let k=0;k<d;k++)for(let B=0;B<l;B++)n[k+B*d]=new Gi({image:o,sourceView:{x:k*f+T.x*k+x.x,y:B*g+T.y*B+x.y,width:f,height:g},destSize:{height:g,width:f}});return new Fs({sprites:n,rows:l,columns:d})}clone(){return new Fs({sprites:this.sprites.map(t=>t.clone()),rows:this.rows,columns:this.columns})}}const pv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABACAYAAAD1Xam+AAAAAXNSR0IArs4c6QAABlFJREFUeJztndmy4yoMRcWt/v9fdr8EWoDAaDD4JntVpeqcxBrMIGQDNhEAAAAAAAAAAAAAAOCrSbMfr+u6yoEpTY+906GV57YtPkjyXj9WZZ+wHWHfo2N3/bU6Tte9Rv6ptruqRyMvKvvIX/zY3I/vjLeqsg6l/CWdp0KHKO/1Y1H2EdsR9j06Ntdfp+N03SvkH2u7i3pu5XkQ+DNTkgNJSok+/183xpcdWZHjgUzpQ2pGD67vaf//KRAGAq3tdhCy2tcMQKPyXyz7iPqrdBjbX5h9g7xbtvWf4ZJvM4D/BKG24Sd+IkQ0TC9aW5NM5FbO2HgrPVzW2vmN50DZNv/QWtl5bfPy85SBtdy9dFmjsf2F2SehTBVE+u+tkE5+lAGcJlFwGuodwRRU2Qe3rx0FhPNflc3HWC7BEh8EDGVR5IMCiLnDONtPp87qhxVH/S/LvzUAuDs/kyGimA5oSONKR1w8vsLpv+v+S9vhmS71JRiX1xB5CWZNw7m6rMrllMag/RJyWb67BEgpDVMWSydc+K47pr35w05kWd7ReEq6116KaG4CsbJ7OmV9PdZLEKkONiC1/7ZONVgDsajLIJPYp2OUAXRpnPcGmnIE6eSK4nv5YQqqSYO52JqnYfYj/PdQXQIY7XszuMofMgZRT/1LdeC5h2I5/0EdWDMY2Yb05WDE1RodVdpSA5r85slArAVnSf+89iP896St0f5bZKVA7Gk/3ja8q+152/+wrLqBWZTem3IBADbRBoDuHgAA4HdAAADgh0EAAOCHQQAA4IdBAADgh0EAAOCHuVsKbJ3P9M7jjuxHzGfv8j9iDt47Dx7hP8cjq5F/o/0T62Aer//ZOgDrajBp6aNlOWTEajKLjgj/Pcs/vfZD/a++3Pc8hNfZ966EVeh5vP75luDRJUAl0KzJfnopaqbaTuzZiulc2BS5lltFXntu3dcQsXadl59Wn1H+dfYNtrt2d6D/LDF9HkCQw6eXFbr8P9X5W/un5Ol8gz1t39p5pWOPn0vLynbgdnfe8maEQw+UIPJdfxdOd/4oTtVD0IYg8wDywGas0I04T5O3P8/qf2UWwPpkn1PbOT1bN2tFe59EM7TvKf+TRFw+erZ2ey4hpS3hp9qBkqq/tjsSU1OYqucBWB1yynt5QxC42Mdk30pAEIio//zRG3feBzLUX+TTjCKwlH83aI/KbpQBVEHgUGF0j/SitcLofHem8q6AyH0wBhFv4WszuOjy0yK2vc/oRWQoP2X9ve78jfaLnpncbBqQSC6s0HnIRT0a2yNZjfxT8+ir8t+yDsDTWaS6X70GP33+d77stp+I5HtBdwEAAPBl8ECApcAA/DBvfSowAGAB7/05ZAAA/DAIAADMMU3fOuS2ggAAwBjrorKoxWiPBxHMAgAg490Ts0VeePdA+ZfJDKcCh7sBqY88mmjklZeOt9iXPrvx2I2QPRnN2/qzyJ84h4gNcbtfasq5mM1rZr+bBWh2A+bIIX13Z9wqL+nQvFno7v3oq4tJItCed7isUT6C/I7BUn9KP95wDicYBYpcjncrO2c/dmW4tBtw4RiRld1IDxDyYsoXMHxF1w3dyz0Nne8033AOFsT6VgRCafl89fenTZUfbm8CGhrgdDcS7anAsvnkkP0IeCfQ+JzYunky6jhNYj5bl7++4fJvN9WDSKS/292A0wyANyKDI91bfkm3kcH7ckaP/SKW/VHKRZAcI14pP3beu0fPyn/DuZQbWMogNnsc16sziE96f7H/iai7uTf0/3N8lwFz/e13T00Djt4OrInCnkeChXT+qOcKOLA21tJpsv/G8/COnGnw97J9QwbTvd6djYSv7fxEVTuV/LzNhj7nOawv6bfbAGCYEpQ6HxFtuxs6sq9tzOYHobQ6Nje+6vo5BwFrPZ4OgMayS4PPt1NlzdLfbRCYBoBc+NaO4JWPwLEf33oN3unY3InKPQBW6Z7nEZzEmrl4iZjC804lqgePPEOguQcwWghUphxm343wyt/pWpWR0OrR+jvyxavHajfb9pTjbt9bH07Z5/expM4TLWfwb7QQqMoC+UDWXZo/4RgA38LOgUvLJAAQ1Td9y9//0ylxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+g79apuVUsS5ZmwAAAABJRU5ErkJggg==";class Fl{constructor(){this.fontSheet=pv,this.size=16,this.load()}load(){return this._imageSource=new fn(this.fontSheet),this._imageSource.load().then(()=>{this._spriteSheet=Fs.fromImageSource({image:this._imageSource,grid:{rows:4,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new Co({alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&."?-()+# `,caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})})}write(t,i,n){this._imageSource.isLoaded()&&this._spriteFont.render(t,i,null,n.x,n.y)}}class gv{constructor(t,i){this._gl=t,this._texture=i}use(){const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class bo{constructor(t){var i,n;this.antialias=!1,this.samples=1,this._gl=t.gl,this.width=t.width,this.height=t.height,this.transparency=t.transparency,this.antialias=(i=t.antialias)!==null&&i!==void 0?i:this.antialias,this.samples=(n=t.samples)!==null&&n!==void 0?n:this._gl.getParameter(this._gl.MAX_SAMPLES);const o=this._gl;o.drawingBufferFormat?this.bufferFormat=o.drawingBufferFormat:this.transparency?this.bufferFormat=o.RGBA8:this.bufferFormat=o.RGB8,this._setupRenderBuffer(),this._setupFramebuffer()}setResolution(t,i){const n=this._gl;this.width=t,this.height=i,n.bindTexture(n.TEXTURE_2D,this._frameTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null),this._renderBuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,this._renderBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,Math.min(this.samples,n.getParameter(n.MAX_SAMPLES)),this.bufferFormat,this.width,this.height))}get renderBuffer(){return this._renderBuffer}get renderFrameBuffer(){return this._renderFrameBuffer}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupRenderBuffer(){if(this.antialias){const t=this._gl;this._renderBuffer=t.createRenderbuffer(),this._renderFrameBuffer=t.createFramebuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._renderBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,Math.min(this.samples,t.getParameter(t.MAX_SAMPLES)),this.bufferFormat,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,this._renderBuffer)}}_setupFramebuffer(){const t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const i=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,i,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return this.renderBuffer&&this.blitRenderBufferToFrameBuffer(),new gv(this._gl,this._frameTexture)}blitToScreen(){const t=this._gl;this._renderBuffer?(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)):(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR))}blitRenderBufferToFrameBuffer(){if(this._renderBuffer){const t=this._gl;t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.frameBuffer),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)}}copyToTexture(t){const i=this._gl;this._renderBuffer&&this.blitRenderBufferToFrameBuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this._frameBuffer),i.bindTexture(i.TEXTURE_2D,t),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,this.width,this.height,0)}use(){const t=this._gl;this.antialias?t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}const mv=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
\r
out lowp vec4 v_color;\r
\r
uniform mat4 u_matrix;\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Passthrough the color\r
   v_color = a_color;\r
}`,_v=`#version 300 es\r
precision mediump float;\r
\r
// Color\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  fragColor = v_color;\r
}`;function Bl(c,t){switch(t){case c.FLOAT:return 4;case c.SHORT:return 2;case c.UNSIGNED_SHORT:return 2;case c.BYTE:return 1;case c.UNSIGNED_BYTE:return 1;default:return 1}}function xd(c,t){const i=`(?<type>[a-z0-9]+)\\s+${t};`,o=new RegExp(i,"g").exec(c);return(o==null?void 0:o.length)>0}function Cd(c,t,i){var n;const o=`(?<type>[a-z0-9]+)\\s+${i};`,d=new RegExp(o,"g").exec(t);switch((n=d==null?void 0:d.groups)===null||n===void 0?void 0:n.type){case"float":case"vec2":case"vec3":case"vec4":return c.FLOAT;case"int":case"ivec2":case"ivec3":case"ivec4":return c.INT;case"uint":case"uvec2":case"uvec3":case"uvec4":return c.UNSIGNED_INT;case"bool":case"bvec2":case"bvec3":case"bvec4":return c.BOOL;case"short":return c.SHORT;case"ushort":return c.UNSIGNED_SHORT;case"ubyte":return c.UNSIGNED_BYTE;case"byte":return c.BYTE;default:return c.FLOAT}}function bd(c,t){switch(t){case c.LOW_FLOAT:case c.HIGH_FLOAT:case c.FLOAT:return 1;case c.FLOAT_VEC2:return 2;case c.FLOAT_VEC3:return 3;case c.FLOAT_VEC4:return 4;case c.BYTE:return 1;case c.UNSIGNED_BYTE:return 1;case c.UNSIGNED_SHORT:case c.SHORT:return 1;default:return 1}}function Ad(c,t){switch(t){case c.LOW_FLOAT:case c.HIGH_FLOAT:case c.FLOAT:case c.FLOAT_VEC2:case c.FLOAT_VEC3:case c.FLOAT_VEC4:return c.FLOAT;case c.BYTE:return c.BYTE;case c.UNSIGNED_BYTE:return c.UNSIGNED_BYTE;case c.SHORT:return c.SHORT;case c.UNSIGNED_SHORT:return c.UNSIGNED_SHORT;default:return c.FLOAT}}class Je{get compiled(){return this._compiled}constructor(t){this._logger=K.getInstance(),this.uniforms={},this.attributes={},this._compiled=!1;const{gl:i,vertexSource:n,fragmentSource:o}=t;this._gl=i,this.vertexSource=n,this.fragmentSource=o}dispose(){this._gl.deleteProgram(this.program),this._gl=null}use(){this._gl.useProgram(this.program),Je._ACTIVE_SHADER_INSTANCE=this}isCurrentlyBound(){return Je._ACTIVE_SHADER_INSTANCE===this}compile(){const t=this._gl,i=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),n=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,i,n);const o=this.getAttributes();for(const d of o)this.attributes[d.name]=d;const l=this.getUniforms();for(const d of l)this.uniforms[d.name]=d;return this._compiled=!0,this.program}getUniforms(){const t=this._gl,i=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),n=[];for(let o=0;o<i;o++){const l=t.getActiveUniform(this.program,o),d=t.getUniformLocation(this.program,l.name);n.push({name:l.name,glType:l.type,location:d})}return n}getAttributes(){const t=this._gl,i=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),n=[];for(let o=0;o<i;o++){const l=t.getActiveAttrib(this.program,o),d=t.getAttribLocation(this.program,l.name);n.push({name:l.name,glType:Ad(t,l.type),size:bd(t,l.type),location:d,normalized:!1})}return n}setTexture(t,i){const n=this._gl;n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,i)}setUniformInt(t,i){this.setUniform("uniform1i",t,~~i)}trySetUniformInt(t,i){return this.trySetUniform("uniform1i",t,~~i)}setUniformIntArray(t,i){this.setUniform("uniform1iv",t,i)}trySetUniformIntArray(t,i){return this.trySetUniform("uniform1iv",t,i)}setUniformBoolean(t,i){this.setUniform("uniform1i",t,i?1:0)}trySetUniformBoolean(t,i){return this.trySetUniform("uniform1i",t,i?1:0)}setUniformFloat(t,i){this.setUniform("uniform1f",t,i)}trySetUniformFloat(t,i){return this.trySetUniform("uniform1f",t,i)}setUniformFloatArray(t,i){this.setUniform("uniform1fv",t,i)}trySetUniformFloatArray(t,i){return this.trySetUniform("uniform1fv",t,i)}setUniformFloatVector(t,i){this.setUniform("uniform2f",t,i.x,i.y)}trySetUniformFloatVector(t,i){return this.trySetUniform("uniform2f",t,i.x,i.y)}setUniformFloatColor(t,i){this.setUniform("uniform4f",t,i.r/255,i.g/255,i.b/255,i.a)}trySetUniformFloatColor(t,i){return this.trySetUniform("uniform4f",t,i.r/255,i.g/255,i.b/255,i.a)}setUniformMatrix(t,i){this.setUniform("uniformMatrix4fv",t,!1,i.data)}trySetUniformMatrix(t,i){return this.trySetUniform("uniformMatrix4fv",t,!1,i.data)}setUniform(t,i,...n){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${i}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const l=this._gl.getUniformLocation(this.program,i);if(l){const d=[l,...n];this._gl[t].apply(this._gl,d)}else throw Error(`Uniform ${t}:${i} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`)}trySetUniform(t,i,...n){if(!this._compiled)return this._logger.warn(`Must compile shader before setting a uniform ${t}:${i}`),!1;if(!this.isCurrentlyBound())return this._logger.warn("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms"),!1;const l=this._gl.getUniformLocation(this.program,i);if(l){const d=[l,...n];this._gl[t].apply(this._gl,d)}else return!1;return!0}_createProgram(t,i,n){const o=t.createProgram();if(o===null)throw Error("Could not create graphics shader program");if(t.attachShader(o,i),t.attachShader(o,n),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(o)}]`);return o}_compileShader(t,i,n){const o=t.VERTEX_SHADER===n?"vertex":"fragment",l=t.createShader(n);if(l===null)throw Error(`Could not build shader: [${i}]`);if(t.shaderSource(l,i),t.compileShader(l),!t.getShaderParameter(l,t.COMPILE_STATUS)){const f=t.getShaderInfoLog(l);throw Error(`Could not compile ${o} shader:

${f}${this._processSourceForError(i,f)}`)}return l}_processSourceForError(t,i){if(!t)return i;const n=t.split(`
`),o=i.search(/\d:\d/),l=i.indexOf(" ",o),[d,f]=i.slice(o,l).split(":").map(g=>Number(g));for(let g=0;g<n.length;g++)n[g]=`${g+1}: ${n[g]}${f===g+1?" <----- ERROR!":""}`;return`

Source:
`+n.join(`
`)}}Je._ACTIVE_SHADER_INSTANCE=null;class Vi{constructor(t){this.type="dynamic";const{gl:i,size:n,type:o,data:l}=t;if(this._gl=i,this.buffer=this._gl.createBuffer(),!l&&!n)throw Error("Must either provide data or a size to the VertexBuffer");l?this.bufferData=l:this.bufferData=new Float32Array(n),this.type=o??this.type,i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.bufferData(i.ARRAY_BUFFER,this.bufferData,this.type==="static"?i.STATIC_DRAW:i.DYNAMIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}unbind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,null)}upload(t){const i=this._gl;i.bindBuffer(i.ARRAY_BUFFER,this.buffer),t?i.bufferSubData(i.ARRAY_BUFFER,0,this.bufferData,0,t):i.bufferData(i.ARRAY_BUFFER,this.bufferData,this.type==="static"?i.STATIC_DRAW:i.DYNAMIC_DRAW)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}class Xi{get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}constructor(t){this._logger=K.getInstance(),this._suppressWarnings=!1,this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0,this._initialized=!1;const{gl:i,shader:n,vertexBuffer:o,attributes:l,suppressWarnings:d}=t;this._gl=i,this._vertexBuffer=o,this._attributes=l,this._shader=n,this._suppressWarnings=d,n&&this.initialize()}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}set shader(t){t&&this._shader!==t&&(this._shader=t,this.initialize())}get shader(){return this._shader}initialize(){if(this._initialized||!this._shader)return;if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._vertexTotalSizeBytes=0,this._layout.length=0;const t=this._shader.attributes;for(const l of this._attributes){const d=t[l[0]];if(!d){if(!xd(this._shader.vertexSource,l[0]))throw Error(`The attribute named: ${l[0]} size ${l[1]} not found in the shader source code:
 ${this._shader.vertexSource}`);this._suppressWarnings||this._logger.warn(`The attribute named: ${l[0]} size ${l[1]} not found in the compiled shader. This is possibly a bug:
 1. Not a bug, but should remove unused code - attribute "${l[0]}" is unused in vertex/fragment and has been automatically removed by glsl compiler.
 2. Definitely a bug, attribute "${l[0]}" in layout has been mistyped or is missing in shader, check vertex/fragment source.`);const f=Cd(this._gl,this._shader.vertexSource,l[0]);this._layout.push({name:l[0],glType:f,size:l[1],location:-1,normalized:!1})}if(d){if(d.size!==l[1])throw Error(`VertexLayout size definition for attribute: [${l[0]}, ${l[1]}], doesn't match shader source size ${d.size}:
 ${this._shader.vertexSource}`);this._layout.push(d)}}let i=0;for(const l of this._layout){const d=Bl(this._gl,l.glType);this._vertexTotalSizeBytes+=d*l.size,i+=l.size}this._vertexBuffer.bufferData.length%i!==0&&this._logger.warn(`The vertex component size (${i})  does NOT divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`);const n=this._gl;this._vao=n.createVertexArray(),n.bindVertexArray(this._vao),this._vertexBuffer.bind();let o=0;for(const l of this._layout)l.location!==-1&&(n.vertexAttribPointer(l.location,l.size,l.glType,l.normalized,this.totalVertexSizeBytes,o),n.enableVertexAttribArray(l.location)),o+=Bl(n,l.glType)*l.size;n.bindVertexArray(null),this._vertexBuffer.unbind(),this._initialized=!0}use(t=!1,i){if(!this._shader)throw Error("No shader is associated with this vertex layout, a shader must be set");const n=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload(i),n.bindVertexArray(this._vao)}}class Nt{static clear(){Nt.DrawCallCount=0,Nt.DrawnImagesCount=0}}Nt.DrawCallCount=0,Nt.DrawnImagesCount=0;class vv{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0}initialize(t,i){this._gl=t,this._context=i,this._shader=new Je({gl:t,vertexSource:mv,fragmentSource:_v}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new Vi({gl:t,size:6*2*this._maxLines,type:"dynamic"}),this._layout=new Xi({gl:t,vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}dispose(){this._vertexBuffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,i,n){this._isFull()&&this.flush(),this._lineCount++;const o=this._context.getTransform(),l=o.multiply(t),d=o.multiply(i),f=this._vertexBuffer.bufferData;f[this._vertexIndex++]=l.x,f[this._vertexIndex++]=l.y,f[this._vertexIndex++]=n.r/255,f[this._vertexIndex++]=n.g/255,f[this._vertexIndex++]=n.b/255,f[this._vertexIndex++]=n.a,f[this._vertexIndex++]=d.x,f[this._vertexIndex++]=d.y,f[this._vertexIndex++]=n.r/255,f[this._vertexIndex++]=n.g/255,f[this._vertexIndex++]=n.b/255,f[this._vertexIndex++]=n.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return this._lineCount!==0}flush(){if(this._lineCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,this._lineCount*2),Nt.DrawnImagesCount+=this._lineCount,Nt.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}const yv=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
in float a_size;\r
out lowp vec4 v_color;\r
uniform mat4 u_matrix;\r
\r
void main() {\r
  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
  gl_PointSize = a_size * 2.0;\r
  v_color = a_color;\r
}`,wv=`#version 300 es\r
\r
precision mediump float;\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  float r = 0.0, delta = 0.0, alpha = 1.0;\r
  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\r
  r = dot(cxy, cxy);\r
\r
  delta = fwidth(r);\r
  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\r
  // "premultiply" the color by alpha\r
  vec4 color = v_color;\r
  color.a = color.a * alpha;\r
  color.rgb = color.rgb * color.a;\r
  fragColor = color;\r
}`;class xv{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,i){this._gl=t,this._context=i,this._shader=new Je({gl:t,vertexSource:yv,fragmentSource:wv}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new Vi({gl:t,size:7*this._maxPoints,type:"dynamic"}),this._layout=new Xi({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}dispose(){this._buffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,i,n){this._isFull()&&this.flush(),this._pointCount++;const o=this._context.getTransform(),l=this._context.opacity,d=this._context.snapToPixel,f=o.multiply(t);d&&(f.x=~~(f.x+wt),f.y=~~(f.y+wt));const g=this._buffer.bufferData;g[this._vertexIndex++]=f.x,g[this._vertexIndex++]=f.y,g[this._vertexIndex++]=i.r/255,g[this._vertexIndex++]=i.g/255,g[this._vertexIndex++]=i.b/255,g[this._vertexIndex++]=i.a*l,g[this._vertexIndex++]=n*Math.max(o.getScaleX(),o.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return this._pointCount!==0}flush(){if(this._pointCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),Nt.DrawnImagesCount+=this._pointCount,Nt.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}const Cv=`#version 300 es\r
in vec2 a_position;\r
\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
void main() {\r
  gl_Position = vec4(a_position, 0.0, 1.0);\r
\r
  // Pass the texcoord to the fragment shader.\r
  v_texcoord = a_texcoord;\r
}`,bv=`#version 300 es\r
precision mediump float;\r
\r
// Passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// The texture.\r
uniform sampler2D u_texture;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
   fragColor = texture(u_texture, v_texcoord);\r
}`;class Av{constructor(t){this._gl=t,this._shader=new Je({gl:t,vertexSource:Cv,fragmentSource:bv}),this._shader.compile(),this._buffer=new Vi({gl:t,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Xi({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){const i=this._gl;t.getShader().use(),t.getLayout().use(),i.drawArrays(i.TRIANGLES,0,6)}renderToScreen(){const t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}class ur{constructor(t,i,n){this._logger=K.getInstance(),this._gl=t,this.buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer);const o=i*6;if(!n)this.bufferData=new Uint32Array(o);else{const f=Math.floor(16383.5);this.bufferGlType=t.UNSIGNED_SHORT,this.bufferData=new Uint16Array(o),i>f&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${f}) requested quads(${i})`)}let l=0;for(let d=0;d<o;d+=6)this.bufferData[d+0]=l+0,this.bufferData[d+1]=l+1,this.bufferData[d+2]=l+2,this.bufferData[d+3]=l+2,this.bufferData[d+4]=l+1,this.bufferData[d+5]=l+3,l+=4;t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}const Sv=`#version 300 es\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_texcoord;\r
\r
// Texture index\r
in lowp float v_textureIndex;\r
\r
// Textures in the current draw\r
uniform sampler2D u_textures[%%count%%];\r
\r
uniform bool u_pixelart;\r
\r
// Opacity\r
in float v_opacity;\r
\r
in vec4 v_tint;\r
\r
in vec2 v_res;\r
\r
out vec4 fragColor;\r
\r
// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\r
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {\r
  vec2 pixel = uv * texture_size;\r
  \r
  vec2 seam=floor(pixel+.5);\r
  vec2 dudv=fwidth(pixel);\r
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\r
  \r
  return pixel/texture_size;\r
}\r
\r
void main(){\r
  // In order to support the most efficient sprite batching, we have multiple\r
  // textures loaded into the gpu (usually 8) this picker logic skips over textures\r
  // that do not apply to a particular sprite.\r
  \r
  vec4 color=vec4(1.,0,0,1.);\r
  \r
  // GLSL is templated out to pick the right texture and set the vec4 color\r
  %%texture_picker%%\r
  \r
  color.rgb=color.rgb*v_opacity;\r
  color.a=color.a*v_opacity;\r
  fragColor=color*v_tint;\r
}`,Ev=`#version 300 es\r
in vec2 a_position;\r
\r
// Opacity\r
in float a_opacity;\r
out float v_opacity;\r
\r
// UV coordinate\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
// Texture res\r
in vec2 a_res;\r
out vec2 v_res;\r
\r
// Texture number\r
in lowp float a_textureIndex;\r
out lowp float v_textureIndex;\r
\r
in vec4 a_tint;\r
out vec4 v_tint;\r
\r
uniform mat4 u_matrix;\r
\r
void main(){\r
  // Set the vertex position using the ortho transform matrix\r
  gl_Position=u_matrix*vec4(a_position,0.,1.);\r
  \r
  // Pass through the Opacity to the fragment shader\r
  v_opacity=a_opacity;\r
  // Pass through the UV coord to the fragment shader\r
  v_texcoord=a_texcoord;\r
\r
  v_res = a_res;\r
\r
  // Pass through the texture number to the fragment shader\r
  v_textureIndex=a_textureIndex;\r
  // Pass through the tint\r
  v_tint=a_tint;\r
}`;class Tv{constructor(t){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._quad=[0,0,0,0,0,0,0,0],this.pixelArtSampler=t.pixelArtSampler,this.uvPadding=t.uvPadding}initialize(t,i){this._gl=t,this._context=i,this._maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),125);const n=this._transformFragmentSource(Sv,this._maxTextures);this._shader=new Je({gl:t,fragmentSource:n,vertexSource:Ev}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",i.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((o,l)=>l)),this._buffer=new Vi({gl:t,size:12*4*this._maxImages,type:"dynamic"}),this._layout=new Xi({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_res",2],["a_texcoord",2],["a_textureIndex",1],["a_tint",4]]}),this._quads=new ur(t,this._maxImages,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(t,i){let n=t.replace("%%count%%",i.toString()),o="";for(let l=0;l<i;l++)l===0?o+=`if (v_textureIndex <= ${l}.5) {
`:o+=`   else if (v_textureIndex <= ${l}.5) {
`,o+=`      vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;
`,o+=`      color = texture(u_textures[${l}], uv);
`,o+=`   }
`;return n=n.replace("%%texture_picker%%",o),n}_addImageAsTexture(t){if(this._images.has(t))return;const i=t.getAttribute(ie.Filtering),n=i?xo(i):null,o=ks(t.getAttribute(ie.WrappingX)),l=ks(t.getAttribute(ie.WrappingY)),d=t.getAttribute("forceUpload")==="true",f=this._context.textureLoader.load(t,{filtering:n,wrapping:{x:o,y:l}},d);t.removeAttribute("forceUpload"),this._textures.indexOf(f)===-1&&(this._textures.push(f),this._textureToIndex.set(f,this._textureIndex++),this._images.add(t))}_bindTextures(t){for(let i=0;i<this._maxTextures;i++)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,this._textures[i]||this._textures[0])}_getTextureIdForImage(t){var i;if(t){const n=this._context.textureLoader.get(t);return(i=this._textureToIndex.get(n))!==null&&i!==void 0?i:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(t){let i=this._imageToWidth.get(t);return i===void 0&&(i=t.width,this._imageToWidth.set(t,i)),i}_getImageHeight(t){let i=this._imageToHeight.get(t);return i===void 0&&(i=t.height,this._imageToHeight.set(t,i)),i}draw(t,i,n,o,l,d,f,g,v){var w,x,T,k;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);const B=this._getImageWidth(t),O=this._getImageHeight(t);let G=B||o||0,L=O||l||0;this._view[0]=0,this._view[1]=0,this._view[2]=(w=o??B)!==null&&w!==void 0?w:0,this._view[3]=(x=l??O)!==null&&x!==void 0?x:0,this._dest[0]=i??1,this._dest[1]=n??1,d!==void 0&&f!==void 0&&g!==void 0&&v!==void 0&&(this._view[0]=i??1,this._view[1]=n??1,this._view[2]=(T=o??B)!==null&&T!==void 0?T:0,this._view[3]=(k=l??O)!==null&&k!==void 0?k:0,this._dest[0]=d,this._dest[1]=f,G=g,L=v),i=this._view[0],n=this._view[1];const z=this._view[2],V=this._view[3],H=this._context.getTransform(),st=this._context.opacity,mt=this._context.snapToPixel;this._quad[0]=this._dest[0],this._quad[1]=this._dest[1],this._quad[2]=this._dest[0]+G,this._quad[3]=this._dest[1],this._quad[4]=this._dest[0],this._quad[5]=this._dest[1]+L,this._quad[6]=this._dest[0]+G,this._quad[7]=this._dest[1]+L,H.multiplyQuadInPlace(this._quad),mt&&(this._quad[0]=~~(this._quad[0]+U(this._quad[0])*wt),this._quad[1]=~~(this._quad[1]+U(this._quad[1])*wt),this._quad[2]=~~(this._quad[2]+U(this._quad[2])*wt),this._quad[3]=~~(this._quad[3]+U(this._quad[3])*wt),this._quad[4]=~~(this._quad[4]+U(this._quad[4])*wt),this._quad[5]=~~(this._quad[5]+U(this._quad[5])*wt),this._quad[6]=~~(this._quad[6]+U(this._quad[6])*wt),this._quad[7]=~~(this._quad[7]+U(this._quad[7])*wt));const X=this._context.tint,_t=this._getTextureIdForImage(t),Wt=B||G,ce=O||L,je=(i+this.uvPadding)/Wt,Ge=(n+this.uvPadding)/ce,Ve=(i+z-this.uvPadding)/Wt,Fe=(n+V-this.uvPadding)/ce,ve=B,ye=O,ct=this._layout.vertexBuffer.bufferData;ct[this._vertexIndex++]=this._quad[0],ct[this._vertexIndex++]=this._quad[1],ct[this._vertexIndex++]=st,ct[this._vertexIndex++]=ve,ct[this._vertexIndex++]=ye,ct[this._vertexIndex++]=je,ct[this._vertexIndex++]=Ge,ct[this._vertexIndex++]=_t,ct[this._vertexIndex++]=X.r/255,ct[this._vertexIndex++]=X.g/255,ct[this._vertexIndex++]=X.b/255,ct[this._vertexIndex++]=X.a,ct[this._vertexIndex++]=this._quad[4],ct[this._vertexIndex++]=this._quad[5],ct[this._vertexIndex++]=st,ct[this._vertexIndex++]=ve,ct[this._vertexIndex++]=ye,ct[this._vertexIndex++]=je,ct[this._vertexIndex++]=Fe,ct[this._vertexIndex++]=_t,ct[this._vertexIndex++]=X.r/255,ct[this._vertexIndex++]=X.g/255,ct[this._vertexIndex++]=X.b/255,ct[this._vertexIndex++]=X.a,ct[this._vertexIndex++]=this._quad[2],ct[this._vertexIndex++]=this._quad[3],ct[this._vertexIndex++]=st,ct[this._vertexIndex++]=ve,ct[this._vertexIndex++]=ye,ct[this._vertexIndex++]=Ve,ct[this._vertexIndex++]=Ge,ct[this._vertexIndex++]=_t,ct[this._vertexIndex++]=X.r/255,ct[this._vertexIndex++]=X.g/255,ct[this._vertexIndex++]=X.b/255,ct[this._vertexIndex++]=X.a,ct[this._vertexIndex++]=this._quad[6],ct[this._vertexIndex++]=this._quad[7],ct[this._vertexIndex++]=st,ct[this._vertexIndex++]=ve,ct[this._vertexIndex++]=ye,ct[this._vertexIndex++]=Ve,ct[this._vertexIndex++]=Fe,ct[this._vertexIndex++]=_t,ct[this._vertexIndex++]=X.r/255,ct[this._vertexIndex++]=X.g/255,ct[this._vertexIndex++]=X.b/255,ct[this._vertexIndex++]=X.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0,4*12*this._imageCount),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,this._imageCount*6,this._quads.bufferGlType,0),Nt.DrawnImagesCount+=this._imageCount,Nt.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const Pv=`#version 300 es\r
\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
in vec2 v_size; // in pixels\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness; // in pixels\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r
    vec2 uv = v_uv;\r
    vec2 fragCoord = uv * v_size;\r
    float maxX = v_size.x - v_strokeThickness;\r
    float minX = v_strokeThickness;\r
    float maxY = v_size.y - v_strokeThickness;\r
    float minY = v_strokeThickness;\r
\r
    if (fragCoord.x < maxX && fragCoord.x > minX &&\r
        fragCoord.y < maxY && fragCoord.y > minY) {\r
      fragColor = v_color;\r
    } else {\r
      fragColor = v_strokeColor;\r
    }\r
    fragColor.a *= v_opacity;\r
    fragColor.rgb *= fragColor.a;\r
\r
    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\r
    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\r
\r
    // float fHalfBorderDist      = 0.0;\r
    // float fHalfBorderThickness = 0.0;\r
\r
    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \r
    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \r
    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else\r
    // {\r
    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\r
    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\r
    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\r
        \r
    //     float ellipse_ab    = v_radius-v_strokeThickness;\r
    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\r
    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \r
            \r
    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\r
    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\r
    // }\r
\r
    // vec4 v4FromColor = v_strokeColor;\r
    // v4FromColor.rgb *= v4FromColor.a;\r
    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\r
    // if (fHalfBorderDist < 0.0) {\r
    //     v4ToColor = v_color;\r
    //     v4ToColor.rgb *= v4ToColor.a;\r
    // }\r
\r
    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\r
\r
    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\r
    // gl_FragColor = finalColor;\r
}`,Iv=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
in vec2 a_size;\r
out vec2 v_size;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through size\r
   v_size = a_size;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class Rv{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0}initialize(t,i){this._gl=t,this._context=i,this._shader=new Je({gl:t,fragmentSource:Pv,vertexSource:Iv}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",i.ortho),this._buffer=new Vi({gl:t,size:16*4*this._maxRectangles,type:"dynamic"}),this._layout=new Xi({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new ur(t,this._maxRectangles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof C&&t[1]instanceof C?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,i,n,o=1){this._isFull()&&this.flush(),this._rectangleCount++;const l=this._context.getTransform(),d=this._context.opacity,f=this._context.snapToPixel,g=i.sub(t),v=g.size,w=g.normalize().perpendicular(),x=o/2,T=l.multiply(w.scale(x).add(t)),k=l.multiply(w.scale(-x).add(t)),B=l.multiply(w.scale(x).add(i)),O=l.multiply(w.scale(-x).add(i));f&&(T.x=~~(T.x+wt),T.y=~~(T.y+wt),B.x=~~(B.x+wt),B.y=~~(B.y+wt),k.x=~~(k.x+wt),k.y=~~(k.y+wt),O.x=~~(O.x+wt),O.y=~~(O.y+wt));const G=0,L=0,z=1,V=1,H=N.Transparent,st=0,mt=1,X=this._layout.vertexBuffer.bufferData;X[this._vertexIndex++]=T.x,X[this._vertexIndex++]=T.y,X[this._vertexIndex++]=G,X[this._vertexIndex++]=L,X[this._vertexIndex++]=v,X[this._vertexIndex++]=o,X[this._vertexIndex++]=d,X[this._vertexIndex++]=n.r/255,X[this._vertexIndex++]=n.g/255,X[this._vertexIndex++]=n.b/255,X[this._vertexIndex++]=n.a,X[this._vertexIndex++]=H.r/255,X[this._vertexIndex++]=H.g/255,X[this._vertexIndex++]=H.b/255,X[this._vertexIndex++]=H.a,X[this._vertexIndex++]=st/mt,X[this._vertexIndex++]=k.x,X[this._vertexIndex++]=k.y,X[this._vertexIndex++]=G,X[this._vertexIndex++]=V,X[this._vertexIndex++]=v,X[this._vertexIndex++]=o,X[this._vertexIndex++]=d,X[this._vertexIndex++]=n.r/255,X[this._vertexIndex++]=n.g/255,X[this._vertexIndex++]=n.b/255,X[this._vertexIndex++]=n.a,X[this._vertexIndex++]=H.r/255,X[this._vertexIndex++]=H.g/255,X[this._vertexIndex++]=H.b/255,X[this._vertexIndex++]=H.a,X[this._vertexIndex++]=st/mt,X[this._vertexIndex++]=B.x,X[this._vertexIndex++]=B.y,X[this._vertexIndex++]=z,X[this._vertexIndex++]=L,X[this._vertexIndex++]=v,X[this._vertexIndex++]=o,X[this._vertexIndex++]=d,X[this._vertexIndex++]=n.r/255,X[this._vertexIndex++]=n.g/255,X[this._vertexIndex++]=n.b/255,X[this._vertexIndex++]=n.a,X[this._vertexIndex++]=H.r/255,X[this._vertexIndex++]=H.g/255,X[this._vertexIndex++]=H.b/255,X[this._vertexIndex++]=H.a,X[this._vertexIndex++]=st/mt,X[this._vertexIndex++]=O.x,X[this._vertexIndex++]=O.y,X[this._vertexIndex++]=z,X[this._vertexIndex++]=V,X[this._vertexIndex++]=v,X[this._vertexIndex++]=o,X[this._vertexIndex++]=d,X[this._vertexIndex++]=n.r/255,X[this._vertexIndex++]=n.g/255,X[this._vertexIndex++]=n.b/255,X[this._vertexIndex++]=n.a,X[this._vertexIndex++]=H.r/255,X[this._vertexIndex++]=H.g/255,X[this._vertexIndex++]=H.b/255,X[this._vertexIndex++]=H.a,X[this._vertexIndex++]=st/mt}drawRectangle(t,i,n,o,l=N.Transparent,d=0){this._isFull()&&this.flush(),this._rectangleCount++;const f=this._context.getTransform(),g=this._context.opacity,v=this._context.snapToPixel,w=f.multiply(t.add(D(0,0))),x=f.multiply(t.add(D(i,0))),T=f.multiply(t.add(D(i,n))),k=f.multiply(t.add(D(0,n)));v&&(w.x=~~(w.x+wt),w.y=~~(w.y+wt),x.x=~~(x.x+wt),x.y=~~(x.y+wt),k.x=~~(k.x+wt),k.y=~~(k.y+wt),T.x=~~(T.x+wt),T.y=~~(T.y+wt));const B=0,O=0,G=1,L=1,z=this._layout.vertexBuffer.bufferData;z[this._vertexIndex++]=w.x,z[this._vertexIndex++]=w.y,z[this._vertexIndex++]=B,z[this._vertexIndex++]=O,z[this._vertexIndex++]=i,z[this._vertexIndex++]=n,z[this._vertexIndex++]=g,z[this._vertexIndex++]=o.r/255,z[this._vertexIndex++]=o.g/255,z[this._vertexIndex++]=o.b/255,z[this._vertexIndex++]=o.a,z[this._vertexIndex++]=l.r/255,z[this._vertexIndex++]=l.g/255,z[this._vertexIndex++]=l.b/255,z[this._vertexIndex++]=l.a,z[this._vertexIndex++]=d,z[this._vertexIndex++]=k.x,z[this._vertexIndex++]=k.y,z[this._vertexIndex++]=B,z[this._vertexIndex++]=L,z[this._vertexIndex++]=i,z[this._vertexIndex++]=n,z[this._vertexIndex++]=g,z[this._vertexIndex++]=o.r/255,z[this._vertexIndex++]=o.g/255,z[this._vertexIndex++]=o.b/255,z[this._vertexIndex++]=o.a,z[this._vertexIndex++]=l.r/255,z[this._vertexIndex++]=l.g/255,z[this._vertexIndex++]=l.b/255,z[this._vertexIndex++]=l.a,z[this._vertexIndex++]=d,z[this._vertexIndex++]=x.x,z[this._vertexIndex++]=x.y,z[this._vertexIndex++]=G,z[this._vertexIndex++]=O,z[this._vertexIndex++]=i,z[this._vertexIndex++]=n,z[this._vertexIndex++]=g,z[this._vertexIndex++]=o.r/255,z[this._vertexIndex++]=o.g/255,z[this._vertexIndex++]=o.b/255,z[this._vertexIndex++]=o.a,z[this._vertexIndex++]=l.r/255,z[this._vertexIndex++]=l.g/255,z[this._vertexIndex++]=l.b/255,z[this._vertexIndex++]=l.a,z[this._vertexIndex++]=d,z[this._vertexIndex++]=T.x,z[this._vertexIndex++]=T.y,z[this._vertexIndex++]=G,z[this._vertexIndex++]=L,z[this._vertexIndex++]=i,z[this._vertexIndex++]=n,z[this._vertexIndex++]=g,z[this._vertexIndex++]=o.r/255,z[this._vertexIndex++]=o.g/255,z[this._vertexIndex++]=o.b/255,z[this._vertexIndex++]=o.a,z[this._vertexIndex++]=l.r/255,z[this._vertexIndex++]=l.g/255,z[this._vertexIndex++]=l.b/255,z[this._vertexIndex++]=l.a,z[this._vertexIndex++]=d}hasPendingDraws(){return this._rectangleCount!==0}flush(){if(this._rectangleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._rectangleCount*6,this._quads.bufferGlType,0),Nt.DrawnImagesCount+=this._rectangleCount,Nt.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}const Dv=`#version 300 es\r
precision highp float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness;\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  // make (0, 0) the center the uv \r
  vec2 uv = v_uv * 2.0 - 1.0;\r
\r
  vec4 color = v_color;\r
  vec4 strokeColor = v_strokeColor;\r
\r
  // circle border is at radius 1.0 \r
  // dist is > 0 when inside the circle \r
  float d = length(uv);\r
  float dist = 1.0 - length(uv);\r
\r
  // Fade based on fwidth\r
  float fade = fwidth(dot(uv, uv));\r
\r
  // if dist is greater than 0 step to 1;\r
  // when we cross this 0 threshold add a smooth fade\r
  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\r
\r
  // if dist is greater than the stroke thickness step to 1\r
  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\r
\r
  strokeColor.a *= fill * stroke;\r
  strokeColor.rgb *= strokeColor.a;\r
\r
  color.a *= fill * (1.0 - stroke);\r
  color.rgb *= color.a;\r
\r
  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\r
  finalColor.rgb = finalColor.rgb * v_opacity;\r
  finalColor.a = finalColor.a * v_opacity;\r
  fragColor = finalColor;\r
}`,kv=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class Fv{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,i){this._gl=t,this._context=i,this._shader=new Je({gl:t,fragmentSource:Dv,vertexSource:kv}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",i.ortho),this._buffer=new Vi({gl:t,size:14*4*this._maxCircles,type:"dynamic"}),this._layout=new Xi({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new ur(t,this._maxCircles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._circleCount>=this._maxCircles}draw(t,i,n,o=N.Transparent,l=0){this._isFull()&&this.flush(),this._circleCount++;const d=this._context.getTransform(),f=this._context.opacity,g=this._context.snapToPixel,v=d.multiply(t.add(D(-i,-i))),w=d.multiply(t.add(D(i,-i))),x=d.multiply(t.add(D(i,i))),T=d.multiply(t.add(D(-i,i)));g&&(v.x=~~(v.x+wt),v.y=~~(v.y+wt),w.x=~~(w.x+wt),w.y=~~(w.y+wt),T.x=~~(T.x+wt),T.y=~~(T.y+wt),x.x=~~(x.x+wt),x.y=~~(x.y+wt));const k=0,B=0,O=1,G=1,L=this._layout.vertexBuffer.bufferData;L[this._vertexIndex++]=v.x,L[this._vertexIndex++]=v.y,L[this._vertexIndex++]=k,L[this._vertexIndex++]=B,L[this._vertexIndex++]=f,L[this._vertexIndex++]=n.r/255,L[this._vertexIndex++]=n.g/255,L[this._vertexIndex++]=n.b/255,L[this._vertexIndex++]=n.a,L[this._vertexIndex++]=o.r/255,L[this._vertexIndex++]=o.g/255,L[this._vertexIndex++]=o.b/255,L[this._vertexIndex++]=o.a,L[this._vertexIndex++]=l/i,L[this._vertexIndex++]=T.x,L[this._vertexIndex++]=T.y,L[this._vertexIndex++]=k,L[this._vertexIndex++]=G,L[this._vertexIndex++]=f,L[this._vertexIndex++]=n.r/255,L[this._vertexIndex++]=n.g/255,L[this._vertexIndex++]=n.b/255,L[this._vertexIndex++]=n.a,L[this._vertexIndex++]=o.r/255,L[this._vertexIndex++]=o.g/255,L[this._vertexIndex++]=o.b/255,L[this._vertexIndex++]=o.a,L[this._vertexIndex++]=l/i,L[this._vertexIndex++]=w.x,L[this._vertexIndex++]=w.y,L[this._vertexIndex++]=O,L[this._vertexIndex++]=B,L[this._vertexIndex++]=f,L[this._vertexIndex++]=n.r/255,L[this._vertexIndex++]=n.g/255,L[this._vertexIndex++]=n.b/255,L[this._vertexIndex++]=n.a,L[this._vertexIndex++]=o.r/255,L[this._vertexIndex++]=o.g/255,L[this._vertexIndex++]=o.b/255,L[this._vertexIndex++]=o.a,L[this._vertexIndex++]=l/i,L[this._vertexIndex++]=x.x,L[this._vertexIndex++]=x.y,L[this._vertexIndex++]=O,L[this._vertexIndex++]=G,L[this._vertexIndex++]=f,L[this._vertexIndex++]=n.r/255,L[this._vertexIndex++]=n.g/255,L[this._vertexIndex++]=n.b/255,L[this._vertexIndex++]=n.a,L[this._vertexIndex++]=o.r/255,L[this._vertexIndex++]=o.g/255,L[this._vertexIndex++]=o.b/255,L[this._vertexIndex++]=o.a,L[this._vertexIndex++]=l/i}hasPendingDraws(){return this._circleCount!==0}flush(){if(this._circleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._circleCount*6,this._quads.bufferGlType,0),Nt.DrawnImagesCount+=this._circleCount,Nt.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class Sd{constructor(t,i,n=100){this.builder=t,this.recycler=i,this.maxObjects=n,this.totalAllocations=0,this.index=0,this.objects=[],this.disableWarnings=!1,this._logger=K.getInstance()}dispose(){this.objects.length=0}preallocate(){for(let t=0;t<this.maxObjects;t++)this.objects[t]=this.builder()}using(t){const i=t(this);return i?this.done(...i):this.done()}borrow(t){const i=this.get();t(i),this.index--}get(){return this.index===this.maxObjects&&(this.disableWarnings||this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=this.maxObjects*2),this.objects[this.index]?this.recycler(this.objects[this.index++]):(this.totalAllocations++,this.objects[this.index++]=this.builder())}done(...t){this.index=0;for(const i of t){const n=this.objects.indexOf(i);this.objects[n]=this.builder(),this.totalAllocations++}return t}}class Bv{constructor(){this.z=0,this.priority=0,this.transform=gt.identity(),this.state={z:0,opacity:1,tint:N.White,material:null}}}const Mv=`#version 300 es
in vec2 a_position;

in vec2 a_uv;
out vec2 v_uv;

in vec2 a_screenuv;
out vec2 v_screenuv;

uniform mat4 u_matrix;
uniform mat4 u_transform;

void main() {
  // Set the vertex position using the ortho & transform matrix
  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);

  // Pass through the UV coord to the fragment shader
  v_uv = a_uv;
  v_screenuv = a_screenuv;
}
`;class Ed{constructor(t){this._logger=K.getInstance(),this._color=N.Transparent,this._initialized=!1,this._images=new Map,this._textures=new Map;const{color:i,name:n,vertexSource:o,fragmentSource:l,graphicsContext:d,images:f}=t;if(this._name=n??"anonymous material",this._vertexSource=o??Mv,this._fragmentSource=l,this._color=i??this._color,!d)throw Error(`Material ${n} must be provided an excalibur webgl graphics context`);if(d instanceof $i?(this._graphicsContext=d,this._initialize(d)):this._logger.warn(`Material ${n} was created in 2D Canvas mode, currently only WebGL is supported`),f)for(const g in f)this.addImageSource(g,f[g])}_initialize(t){if(this._initialized)return;const i=t.__gl;this._maxTextureSlots=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS)-2,this._shader=t.createShader({vertexSource:this._vertexSource,fragmentSource:this._fragmentSource}),this._shader.compile(),this._initialized=!0}get name(){var t;return(t=this._name)!==null&&t!==void 0?t:"anonymous material"}get isUsingScreenTexture(){return this._fragmentSource.includes("u_screen_texture")}update(t){this._shader&&(this._shader.use(),t(this._shader))}getShader(){return this._shader}addImageSource(t,i){this._images.size<this._maxTextureSlots?this._images.set(t,i):this._logger.warn(`Max number texture slots ${this._maxTextureSlots} have been reached for material "${this.name}", no more textures will be uploaded due to hardware constraints.`)}removeImageSource(t){const i=this._images.get(t);this._graphicsContext.textureLoader.delete(i.image),this._images.delete(t)}_loadImageSource(t){const i=t.image,n=i.getAttribute(ie.Filtering),o=n?xo(n):null,l=ks(i.getAttribute(ie.WrappingX)),d=ks(i.getAttribute(ie.WrappingY)),f=i.getAttribute("forceUpload")==="true",g=this._graphicsContext.textureLoader.load(i,{filtering:o,wrapping:{x:l,y:d}},f);return i.removeAttribute("forceUpload"),this._textures.has(t)||this._textures.set(t,g),g}uploadAndBind(t,i=2){let n=i;for(const[o,l]of this._images.entries()){if(!l.isLoaded()){this._logger.warnOnce(`Image named ${o} in material ${this.name} not loaded, nothing will be uploaded to the shader. Did you forget to add this to a loader? https://excaliburjs.com/docs/loaders/`);continue}const d=this._loadImageSource(l);t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,d),this._shader.trySetUniformInt(o,n),n++}}use(){if(this._initialized)this._shader.use(),this._shader.trySetUniformFloatColor("u_color",this._color);else throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`)}}class Td{constructor(){this.type="ex.material",this.priority=0,this._textures=[]}initialize(t,i){this._gl=t,this._context=i,this._buffer=new Vi({gl:t,size:6*4,type:"dynamic"}),this._layout=new Xi({gl:t,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_screenuv",2]],suppressWarnings:!0}),this._quads=new ur(t,1,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._textures.length=0,this._context=null,this._gl=null}draw(t,i,n,o,l,d,f,g,v){var w,x,T,k;const B=this._gl,O=this._context.material,G=this._context.getTransform(),L=this._context.opacity,z=O.getShader(),V=this._layout.vertexBuffer.bufferData;let H=0,st=(t==null?void 0:t.width)||o||0,mt=(t==null?void 0:t.height)||l||0,X=[0,0,(w=o??(t==null?void 0:t.width))!==null&&w!==void 0?w:0,(x=l??(t==null?void 0:t.height))!==null&&x!==void 0?x:0],_t=[i??1,n??1];d!==void 0&&f!==void 0&&g!==void 0&&v!==void 0&&(X=[i??1,n??1,(T=o??(t==null?void 0:t.width))!==null&&T!==void 0?T:0,(k=l??(t==null?void 0:t.height))!==null&&k!==void 0?k:0],_t=[d,f],st=g,mt=v),i=X[0],n=X[1];const Wt=X[2],ce=X[3],je=D(_t[0],_t[1]),Ge=D(_t[0]+st,_t[1]),Ve=D(_t[0],_t[1]+mt),Fe=D(_t[0]+st,_t[1]+mt),ve=t.width||st,ye=t.height||mt,ct=i/ve,$s=n/ye,Ys=(i+Wt-.01)/ve,Qs=(n+ce-.01)/ye,Dn=G.getPosition(),Vf=Dn.add(Fe),Xf=Dn.x/this._context.width,$f=Dn.y/this._context.height,Yf=Vf.x/this._context.width,Qf=Vf.y/this._context.height;V[H++]=je.x,V[H++]=je.y,V[H++]=ct,V[H++]=$s,V[H++]=Xf,V[H++]=$f,V[H++]=Ve.x,V[H++]=Ve.y,V[H++]=ct,V[H++]=Qs,V[H++]=Xf,V[H++]=Qf,V[H++]=Ge.x,V[H++]=Ge.y,V[H++]=Ys,V[H++]=$s,V[H++]=Yf,V[H++]=$f,V[H++]=Fe.x,V[H++]=Fe.y,V[H++]=Ys,V[H++]=Qs,V[H++]=Yf,V[H++]=Qf;const U0=this._addImageAsTexture(t);O.use(),this._layout.shader=z,this._layout.use(!0),z.trySetUniformFloat("u_time_ms",performance.now()),z.trySetUniformFloat("u_opacity",L),z.trySetUniformFloatVector("u_resolution",D(this._context.width,this._context.height)),z.trySetUniformFloatVector("u_graphic_resolution",D(ve,ye)),z.trySetUniformFloatVector("u_size",D(Wt,ce)),z.trySetUniformMatrix("u_matrix",this._context.ortho),z.trySetUniformMatrix("u_transform",G.to4x4()),B.activeTexture(B.TEXTURE0+0),B.bindTexture(B.TEXTURE_2D,U0),z.trySetUniformInt("u_graphic",0),B.activeTexture(B.TEXTURE0+1),B.bindTexture(B.TEXTURE_2D,this._context.materialScreenTexture),z.trySetUniformInt("u_screen_texture",1),O.uploadAndBind(B),this._quads.bind(),B.drawElements(B.TRIANGLES,6,this._quads.bufferGlType,0),Nt.DrawnImagesCount++,Nt.DrawCallCount++}_addImageAsTexture(t){const i=t.getAttribute(ie.Filtering),n=i?xo(i):null,o=ks(t.getAttribute(ie.WrappingX)),l=ks(t.getAttribute(ie.WrappingY)),d=t.getAttribute("forceUpload")==="true",f=this._context.textureLoader.load(t,{filtering:n,wrapping:{x:o,y:l}},d);return t.removeAttribute("forceUpload"),this._textures.indexOf(f)===-1&&this._textures.push(f),f}hasPendingDraws(){return!1}flush(){}}const wt=1e-4;class Lv{constructor(t){this._webglCtx=t,this._debugText=new Fl}drawRect(t,i,n,o,l={color:N.Black}){this.drawLine(D(t,i),D(t+n,i),{...l}),this.drawLine(D(t+n,i),D(t+n,i+o),{...l}),this.drawLine(D(t+n,i+o),D(t,i+o),{...l}),this.drawLine(D(t,i+o),D(t,i),{...l})}drawLine(t,i,n={color:N.Black}){this._webglCtx.draw("ex.line",t,i,n.color)}drawPoint(t,i={color:N.Black,size:5}){this._webglCtx.draw("ex.point",t,i.color,i.size)}drawText(t,i){this._debugText.write(this._webglCtx,t,i)}}class $i{get z(){return this._state.current.z}set z(t){this._state.current.z=t}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let i=!0;return(t.width>4096||t.height>4096)&&(i=!1),i}constructor(t){this._logger=K.getInstance(),this._renderers=new Map,this._isDrawLifecycle=!1,this.useDrawSorting=!0,this._drawCallPool=new Sd(()=>new Bv,O=>(O.priority=0,O.z=0,O.renderer=void 0,O.args=void 0,O),4e3),this._drawCallIndex=0,this._drawCalls=new Array(4e3).fill(null),this._postProcessTargets=[],this._postprocessors=[],this._transform=new Zt,this._state=new Ke,this.snapToPixel=!1,this.smoothing=!1,this.pixelArtSampler=!1,this.uvPadding=.01,this.backgroundColor=N.ExcaliburBlue,this.multiSampleAntialiasing=!0,this.transparency=!0,this._isContextLost=!1,this._disposed=!1,this._imageToWidth=new Map,this._imageToHeight=new Map,this.debug=new Lv(this),this._totalPostProcessorTime=0;const{canvasElement:i,context:n,enableTransparency:o,antialiasing:l,uvPadding:d,multiSampleAntialiasing:f,pixelArtSampler:g,powerPreference:v,snapToPixel:w,backgroundColor:x,useDrawSorting:T,handleContextLost:k,handleContextRestored:B}=t;if(this.__gl=n??i.getContext("webgl2",{antialias:l??this.smoothing,premultipliedAlpha:!1,alpha:o??this.transparency,depth:!1,powerPreference:v??"high-performance"}),!this.__gl)throw Error("Failed to retrieve webgl context from browser");k&&this.__gl.canvas.addEventListener("webglcontextlost",k,!1),B&&this.__gl.canvas.addEventListener("webglcontextrestored",B,!1),this.__gl.canvas.addEventListener("webglcontextlost",()=>{this._isContextLost=!0}),this.__gl.canvas.addEventListener("webglcontextrestored",()=>{this._isContextLost=!1}),this.textureLoader=new Jt(this.__gl),this.snapToPixel=w??this.snapToPixel,this.smoothing=l??this.smoothing,this.transparency=o??this.transparency,this.pixelArtSampler=g??this.pixelArtSampler,this.uvPadding=d??this.uvPadding,this.multiSampleAntialiasing=typeof f=="boolean"?f:this.multiSampleAntialiasing,this.samples=typeof f=="object"?f.samples:void 0,this.backgroundColor=x??this.backgroundColor,this.useDrawSorting=T??this.useDrawSorting,this._drawCallPool.disableWarnings=!0,this._drawCallPool.preallocate(),this._init()}dispose(){if(!this._disposed){this._disposed=!0,this.textureLoader.dispose();for(const t of this._renderers.values())t.dispose();this._renderers.clear(),this._drawCallPool.dispose(),this._drawCalls.length=0,this.__gl=null}}_init(){const t=this.__gl;this._ortho=bt.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.register(new Tv({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.register(new Td),this.register(new Rv),this.register(new Fv),this.register(new xv),this.register(new vv),this.materialScreenTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.materialScreenTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this._screenRenderer=new Av(t),this._renderTarget=new bo({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new bo({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),new bo({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height})],this._msaaTarget=new bo({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height,antialias:this.multiSampleAntialiasing,samples:this.samples})}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}get(t){return this._renderers.get(t)}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...i){if(this._isDrawLifecycle||this._logger.warnOnce(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.
If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`),this._isContextLost){this._logger.errorOnce(`Unable to draw ${t}, the webgl context is lost`);return}const n=this._renderers.get(t);if(n)if(this.useDrawSorting){const o=this._drawCallPool.get();o.z=this._state.current.z,o.priority=n.priority,o.renderer=t,this.getTransform().clone(o.transform),o.state.z=this._state.current.z,o.state.opacity=this._state.current.opacity,o.state.tint=this._state.current.tint,o.state.material=this._state.current.material,o.args=i,this._drawCalls[this._drawCallIndex++]=o}else this._currentRenderer||(this._currentRenderer=n),this._isCurrentRenderer(n)||this._currentRenderer.flush(),n.draw(...i),this._currentRenderer=n;else throw Error(`No renderer with name ${t} has been registered`)}resetTransform(){this._transform.current=gt.identity()}updateViewport(t){const i=this.__gl;this._ortho=this._ortho=bt.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(i.canvas.width,i.canvas.height),this._msaaTarget.setResolution(i.canvas.width,i.canvas.height),this._postProcessTargets[0].setResolution(i.canvas.width,i.canvas.height),this._postProcessTargets[1].setResolution(i.canvas.width,i.canvas.height)}_getImageWidth(t){let i=this._imageToWidth.get(t);return i===void 0&&(i=t.width,this._imageToWidth.set(t,i)),i}_getImageHeight(t){let i=this._imageToHeight.get(t);return i===void 0&&(i=t.height,this._imageToHeight.set(t,i)),i}drawImage(t,i,n,o,l,d,f,g,v){if(!(o===0||l===0)){{if(g===0||v===0)return;if(this._getImageWidth(t)===0||this._getImageHeight(t)===0)return}if(!t){K.getInstance().warn("Cannot draw a null or undefined image"),console.trace&&console.trace();return}this._state.current.material?this.draw("ex.material",t,i,n,o,l,d,f,g,v):this.draw("ex.image",t,i,n,o,l,d,f,g,v)}}drawLine(t,i,n,o=1){this.draw("ex.rectangle",t,i,n,o)}drawRectangle(t,i,n,o,l,d){this.draw("ex.rectangle",t,i,n,o,l,d)}drawCircle(t,i,n,o,l){this.draw("ex.circle",t,i,n,o,l)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,i){this._transform.translate(this.snapToPixel?~~(t+wt):t,this.snapToPixel?~~(i+wt):i)}rotate(t){this._transform.rotate(t)}scale(t,i){this._transform.scale(t,i)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current.multiply(t,this._transform.current)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this.__gl)}removePostProcessor(t){const i=this._postprocessors.indexOf(t);i!==-1&&this._postprocessors.splice(i,1)}clearPostProcessors(){this._postprocessors.length=0}updatePostProcessors(t){for(const i of this._postprocessors){const n=i.getShader();n.use();const o=n.getUniforms();this._totalPostProcessorTime+=t,o.find(l=>l.name==="u_time_ms")&&n.setUniformFloat("u_time_ms",this._totalPostProcessorTime),o.find(l=>l.name==="u_elapsed_ms")&&n.setUniformFloat("u_elapsed_ms",t),o.find(l=>l.name==="u_resolution")&&n.setUniformFloatVector("u_resolution",D(this.width,this.height)),i.onUpdate&&i.onUpdate(t)}}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return new Ed({...t,graphicsContext:this})}createShader(t){const i=this.__gl,{vertexSource:n,fragmentSource:o}=t,l=new Je({gl:i,vertexSource:n,fragmentSource:o});return l.compile(),l}clear(){const t=this.__gl;(this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget).use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){if(this._isContextLost){this._logger.errorOnce("Unable to flush the webgl context is lost");return}let t=this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget;if(t.use(),this.useDrawSorting){for(let l=this._drawCallIndex;l<this._drawCalls.length;l++)this._drawCalls[l]=null;const i=new Map;for(const[l]of this._renderers){let d=0;for(d=0;d<this._drawCallIndex&&this._drawCalls[d].renderer!==l;d++);i.set(l,d)}this._drawCalls.sort((l,d)=>{if(l===null||d===null)return 0;const f=l.z-d.z,g=i.get(l.renderer)-i.get(d.renderer),v=l.priority-d.priority;return f===0?v===0?g:v:f});const n=this._transform.current,o=this._state.current;if(this._drawCalls.length&&this._drawCallIndex){let l=this._drawCalls[0].renderer,d=this._renderers.get(l);for(let f=0;f<this._drawCallIndex;f++)this._transform.current=this._drawCalls[f].transform,this._state.current=this._drawCalls[f].state,this._drawCalls[f].renderer!==l&&(d.flush(),l=this._drawCalls[f].renderer,d=this._renderers.get(l)),d instanceof Td&&this.material.isUsingScreenTexture&&(t.copyToTexture(this.materialScreenTexture),t.use()),d.draw(...this._drawCalls[f].args);d.hasPendingDraws()&&d.flush()}this._transform.current=n,this._state.current=o,this._drawCallPool.done(),this._drawCallIndex=0,this._imageToHeight.clear(),this._imageToWidth.clear()}else for(const i of this._renderers.values())i.hasPendingDraws()&&i.flush();t.disable(),this._postprocessors.length>0&&t.toRenderSource().use();for(let i=0;i<this._postprocessors.length;i++)t=this._postProcessTargets[i%2],this._postProcessTargets[i%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]),this._postProcessTargets[i%2].toRenderSource().use();t.blitToScreen()}}const $t=1e-4;class zv{constructor(t){this._ex=t,this._debugText=new Fl}drawRect(t,i,n,o){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~(t+$t):t,this._ex.snapToPixel?~~(i+$t):i,this._ex.snapToPixel?~~(n+$t):n,this._ex.snapToPixel?~~(o+$t):o),this._ex.__ctx.restore()}drawLine(t,i,n={color:N.Black}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=n.color.toString(),this._ex.__ctx.moveTo(this._ex.snapToPixel?~~(t.x+$t):t.x,this._ex.snapToPixel?~~(t.y+$t):t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~(i.x+$t):i.x,this._ex.snapToPixel?~~(i.y+$t):i.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,i={color:N.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=i.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~(t.x+$t):t.x,this._ex.snapToPixel?~~(t.y+$t):t.y,i.size,0,Math.PI*2),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,i){this._debugText.write(this._ex,t,i)}}class Ao{get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}constructor(t){this.useDrawSorting=!1,this.z=0,this.backgroundColor=N.ExcaliburBlue,this._state=new Ke,this.snapToPixel=!1,this.debug=new zv(this);const{canvasElement:i,context:n,enableTransparency:o,snapToPixel:l,antialiasing:d,backgroundColor:f}=t;if(this.__ctx=n??i.getContext("2d",{alpha:o??!0}),!this.__ctx)throw new Error("Cannot build new ExcaliburGraphicsContext2D for some reason!");this.backgroundColor=f??this.backgroundColor,this.snapToPixel=l??this.snapToPixel,this.smoothing=d??this.smoothing}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,i,n,o,l,d,f,g,v){if(o===0||l===0)return;if(g===0||v===0)return;if(t.width===0||t.height===0)return;this.__ctx.globalAlpha=this.opacity;const w=[t,i,n,o,l,d,f,g,v].filter(x=>x!==void 0).map(x=>typeof x=="number"&&this.snapToPixel?~~x:x);this.__ctx.drawImage.apply(this.__ctx,w),Nt.DrawCallCount++,Nt.DrawnImagesCount=1}drawLine(t,i,n,o=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=n.toString(),this.__ctx.moveTo(this.snapToPixel?~~(t.x+$t):t.x,this.snapToPixel?~~(t.y+$t):t.y),this.__ctx.lineTo(this.snapToPixel?~~(i.x+$t):i.x,this.snapToPixel?~~(i.y+$t):i.y),this.__ctx.lineWidth=o,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,i,n,o){this.__ctx.save(),this.__ctx.fillStyle=o.toString(),this.__ctx.fillRect(this.snapToPixel?~~(t.x+$t):t.x,this.snapToPixel?~~(t.y+$t):t.y,this.snapToPixel?~~(i+$t):i,this.snapToPixel?~~(n+$t):n),this.__ctx.restore()}drawCircle(t,i,n,o,l){this.__ctx.save(),this.__ctx.beginPath(),o&&(this.__ctx.strokeStyle=o.toString()),l&&(this.__ctx.lineWidth=l),this.__ctx.fillStyle=n.toString(),this.__ctx.arc(this.snapToPixel?~~(t.x+$t):t.x,this.snapToPixel?~~(t.y+$t):t.y,i,0,Math.PI*2),this.__ctx.fill(),o&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save(),this._state.save()}restore(){this.__ctx.restore(),this._state.restore()}translate(t,i){this.__ctx.translate(this.snapToPixel?~~(t+$t):t,this.snapToPixel?~~(i+$t):i)}rotate(t){this.__ctx.rotate(t)}scale(t,i){this.__ctx.scale(t,i)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){}removePostProcessor(t){}clearPostProcessors(){}updatePostProcessors(t){}beginDrawLifecycle(){}endDrawLifecycle(){}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return null}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),Nt.clear()}flush(){}dispose(){this.__ctx=null}}var se;(function(c){c.Fixed="Fixed",c.FitContainerAndFill="FitContainerAndFill",c.FitScreenAndFill="FitScreenAndFill",c.FitContainerAndZoom="FitContainerAndZoom",c.FitScreenAndZoom="FitScreenAndZoom",c.FitScreen="FitScreen",c.FillScreen="FillScreen",c.FitContainer="FitContainer",c.FillContainer="FillContainer"})(se||(se={}));class Ml{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}const Ov={ScreenResize:"resize",PixelRatioChange:"pixelratio",FullScreenChange:"fullscreen"};class Ll{constructor(t){var i,n,o,l;this.events=new y,this._antialiasing=!0,this._canvasImageRendering="auto",this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=K.getInstance(),this._fullscreenChangeHandler=()=>{this._isDisposed||(this._isFullScreen=!this._isFullScreen,this._logger.debug("Fullscreen Change",this._isFullScreen),this.events.emit("fullscreen",{fullscreen:this.isFullScreen}))},this._pixelRatioChangeHandler=()=>{this._isDisposed||(this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport(),this.events.emit("pixelratio",{pixelRatio:this.pixelRatio}))},this._resizeHandler=()=>{if(this._isDisposed)return;const d=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(d),this.applyResolutionAndViewport(),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._contentArea=new tt,this._unsafeArea=new tt,this.viewport=t.viewport,this.resolution=(i=t.resolution)!==null&&i!==void 0?i:{...this.viewport},this._contentResolution=this.resolution,this._displayMode=(n=t.displayMode)!==null&&n!==void 0?n:se.Fixed,this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=(o=t.antialiasing)!==null&&o!==void 0?o:this._antialiasing,this._canvasImageRendering=(l=t.canvasImageRendering)!==null&&l!==void 0?l:this._canvasImageRendering,this._browser=t.browser,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this.events.clear(),this._browser.window.off("resize",this._resizeHandler),this._browser.window.clear(),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler),this._canvas=null)}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get pixelRatioOverride(){return this._pixelRatioOverride}set pixelRatioOverride(t){this._pixelRatioOverride=t}get isHiDpi(){return this.pixelRatio!==1}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){switch(this.displayMode){case se.FillContainer:case se.FitContainer:case se.FitContainerAndFill:case se.FitContainerAndZoom:return this.canvas.parentElement||document.body;default:return window}}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this._resolutionStack.length&&this._viewportStack.length&&(this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop())}applyResolutionAndViewport(){if(this.graphicsContext instanceof $i&&!this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})&&(this._logger.warnOnce(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio}) are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`),!this.pixelRatioOverride)){let o=Math.max(1,this.pixelRatio-.5),l=!1;for(;o>1&&!l;){o=Math.max(1,o-.5);const d=this._resolution.width*o,f=this._resolution.height*o;l=this.graphicsContext.checkIfResolutionSupported({width:d,height:f})}this.pixelRatioOverride=o,this._logger.warnOnce(`Scaled resolution too big attempted recovery! Pixel ratio was automatically reduced to (${this.pixelRatio}) to avoid 4k texture limit. Setting \`ex.Engine({pixelRatio: ...}) will override any automatic recalculation, do so at your own risk.\`  (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`)}this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._canvasImageRendering==="auto"?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",this._canvas.style.imageRendering===""&&(this._canvas.style.imageRendering="crisp-edges"));const t=this.viewport.widthUnit==="percent"?"%":"px",i=this.viewport.heightUnit==="percent"?"%":"px";this._canvas.style.width=this.viewport.width+t,this._canvas.style.height=this.viewport.height+i,this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing,this.graphicsContext instanceof Ao&&this.graphicsContext.scale(this.pixelRatio,this.pixelRatio)}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullScreen}goFullScreen(t){if(t){const i=document.getElementById(t);if(i)return i.getAttribute("ex-fullscreen-listener")||(i.setAttribute("ex-fullscreen-listener","true"),i.addEventListener("fullscreenchange",this._fullscreenChangeHandler)),i.requestFullscreen()}return this._canvas.requestFullscreen()}exitFullScreen(){return document.exitFullscreen()}_viewportToPixels(t){return{width:t.widthUnit==="percent"?this.canvas.offsetWidth:t.width,height:t.heightUnit==="percent"?this.canvas.offsetHeight:t.height}}pageToScreenCoordinates(t){let i=t.x,n=t.y;this._isFullScreen||(i-=Pe(this._canvas).x,n-=Pe(this._canvas).y);const o=this._viewportToPixels(this.viewport);if(this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const l=window.innerWidth/this.aspectRatio,d=(window.innerHeight-l)/2;n=(n-d)/l*o.height,i=i/window.innerWidth*o.width}else{const l=window.innerHeight*this.aspectRatio,d=(window.innerWidth-l)/2;i=(i-d)/l*o.width,n=n/window.innerHeight*o.height}return i=i/o.width*this.resolution.width,n=n/o.height*this.resolution.height,i=i-this.contentArea.left,n=n-this.contentArea.top,new C(i,n)}screenToPageCoordinates(t){let i=t.x,n=t.y;const o=this._viewportToPixels(this.viewport);if(i=i/this.resolution.width*o.width,n=n/this.resolution.height*o.height,this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const l=window.innerWidth/this.aspectRatio,d=(window.innerHeight-l)/2;n=n/o.height*l+d,i=i/o.width*window.innerWidth}else{const l=window.innerHeight*this.aspectRatio,d=(window.innerWidth-l)/2;i=i/o.width*l+d,n=n/o.height*window.innerHeight}return this._isFullScreen||(i+=Pe(this._canvas).x,n+=Pe(this._canvas).y),new C(i,n)}screenToWorldCoordinates(t){return t=t.add(D(this.contentArea.left,this.contentArea.top)),this._camera?this._camera.inverse.multiply(t):t.sub(D(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(D(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){const i=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(i)}worldToPageCoordinates(t){const i=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(i)}getWorldBounds(){return tt.fromDimension(this.resolution.width,this.resolution.height,C.Half).scale(D(1/this._camera.zoom,1/this._camera.zoom)).rotate(this._camera.rotation).translate(this._camera.drawPos)}getScreenBounds(){return tt.fromDimension(this.resolution.width,this.resolution.height,C.Zero,C.Zero)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return D(this.halfDrawWidth,this.halfDrawHeight)}get contentArea(){return this._contentArea}get unsafeArea(){return this._unsafeArea}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let i=0,n=0;window.innerWidth/t<window.innerHeight?(i=window.innerWidth,n=window.innerWidth/t):(i=window.innerHeight*t,n=window.innerHeight),this.viewport={width:i,height:n},this._contentArea=tt.fromDimension(this.resolution.width,this.resolution.height,C.Zero),this._unsafeArea=tt.fromDimension(this.resolution.width,this.resolution.height,C.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitScreenAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=window.innerWidth,i=window.innerHeight;this._computeFitAndFill(t,i),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndFill(){this.canvas.style.width="100%",this.canvas.style.height="100%",this._computeFitAndFill(this.canvas.offsetWidth,this.canvas.offsetHeight,{width:100,widthUnit:"percent",height:100,heightUnit:"percent"}),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndFill(t,i,n){if(this.viewport=n??{width:t,height:i},t/i<=this._contentResolution.width/this._contentResolution.height){this.resolution={width:t*this._contentResolution.width/t,height:t*this._contentResolution.width/t*i/t};const o=(this.resolution.height-this._contentResolution.height)/2;this._contentArea=new tt({top:o,left:0,right:this._contentResolution.width,bottom:this.resolution.height-o}),this._unsafeArea=new tt({top:-o,left:0,right:this._contentResolution.width,bottom:this.resolution.height+o})}else{this.resolution={width:i*this._contentResolution.height/i*t/i,height:i*this._contentResolution.height/i};const o=(this.resolution.width-this._contentResolution.width)/2;this._contentArea=new tt({top:0,left:o,right:this.resolution.width-o,bottom:this._contentResolution.height}),this._unsafeArea=new tt({top:0,left:-o,right:this.resolution.width+o,bottom:this._contentResolution.height})}}_computeFitScreenAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const t=window.innerWidth,i=window.innerHeight;this._computeFitAndZoom(t,i),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndZoom(){this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="relative";const t=this.canvas.parentElement;t.style.overflow="hidden";const{offsetWidth:i,offsetHeight:n}=this.canvas;this._computeFitAndZoom(i,n),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndZoom(t,i){const n=this.aspectRatio;let o=0,l=0;t/n<i?(o=t,l=t/n):(o=i*n,l=i);const d=t/o,f=i/l,g=Math.max(d,f),v=o*g,w=l*g;v>t?this.canvas.style.left=-(v-t)/2+"px":this.canvas.style.left="",w>i?this.canvas.style.top=-(w-i)/2+"px":this.canvas.style.top="",this.viewport={width:v,height:w};const x=tt.fromDimension(this.viewport.width,this.viewport.height,C.Zero);if(this.viewport.width>t){const T=(this.viewport.width-t)/this.viewport.width*this.resolution.width;x.top=0,x.left=T/2,x.right=this.resolution.width-T/2,x.bottom=this.resolution.height}if(this.viewport.height>i){const T=(this.viewport.height-i)/this.viewport.height*this.resolution.height;x.top=T/2,x.left=0,x.bottom=this.resolution.height-T/2,x.right=this.resolution.width}this._contentArea=x}_computeFitContainer(){const t=this.aspectRatio;let i=0,n=0,o="pixel",l="pixel";const d=this.canvas.parentElement;d.clientWidth/t<d.clientHeight?(this.canvas.style.width="100%",i=100,o="percent",n=this.canvas.offsetWidth/t):(this.canvas.style.height="100%",n=100,l="percent",i=this.canvas.offsetHeight*t),this.viewport={width:i,widthUnit:o,height:n,heightUnit:l},this._contentArea=tt.fromDimension(this.resolution.width,this.resolution.height,C.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_applyDisplayMode(){this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver(()=>{this._resizeHandler()}),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler)}_setResolutionAndViewportByDisplayMode(t){this.displayMode===se.FillContainer&&(this.canvas.style.width="100%",this.canvas.style.height="100%",this.viewport={width:100,widthUnit:"percent",height:100,heightUnit:"percent"},this.resolution={width:this.canvas.offsetWidth,height:this.canvas.offsetHeight}),this.displayMode===se.FillScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this._contentArea=tt.fromDimension(this.resolution.width,this.resolution.height,C.Zero),this.displayMode===se.FitScreen&&this._computeFit(),this.displayMode===se.FitContainer&&this._computeFitContainer(),this.displayMode===se.FitScreenAndFill&&this._computeFitScreenAndFill(),this.displayMode===se.FitContainerAndFill&&this._computeFitContainerAndFill(),this.displayMode===se.FitScreenAndZoom&&this._computeFitScreenAndZoom(),this.displayMode===se.FitContainerAndZoom&&this._computeFitContainerAndZoom()}}class pn{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}pn._INSTANCE=null;function Uv(c){return!!c.playbackState}class Bs{static unlock(){return new Promise((i,n)=>{if(Bs._UNLOCKED||!pn.create())return i(!0);const o=setTimeout(()=>{K.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),i(!1)},200),l=pn.create();l.resume().then(()=>{const d=l.createBuffer(1,1,22050),f=l.createBufferSource();let g=!1;f.buffer=d,f.connect(l.destination),f.onended=()=>g=!0,f.start(0),setTimeout(()=>{Uv(f)?(f.playbackState===f.PLAYING_STATE||f.playbackState===f.FINISHED_STATE)&&(Bs._UNLOCKED=!0):(l.currentTime>0||g)&&(Bs._UNLOCKED=!0)},0),clearTimeout(o),i(!0)},()=>{n()})})}static isUnlocked(){return this._UNLOCKED}}Bs._UNLOCKED=!1;class gn extends Lt{constructor(t){var i,n,o,l,d,f,g,v,w,x;super(Ct(t,["width","height"])),this.filtering=null,this.lineCap="butt",this.quality=1,this._dirty=!0,this._smoothing=!1,this._color=Mt(N.Black,()=>this.flagDirty()),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.quality=(i=t.quality)!==null&&i!==void 0?i:this.quality,this.color=(n=t.color)!==null&&n!==void 0?n:N.Black,this.strokeColor=t==null?void 0:t.strokeColor,this.smoothing=(o=t.smoothing)!==null&&o!==void 0?o:this.smoothing,this.lineWidth=(l=t.lineWidth)!==null&&l!==void 0?l:this.lineWidth,this.lineDash=(d=t.lineDash)!==null&&d!==void 0?d:this.lineDash,this.lineCap=(f=t.lineCap)!==null&&f!==void 0?f:this.lineCap,this.padding=(g=t.padding)!==null&&g!==void 0?g:this.padding,this.filtering=(v=t.filtering)!==null&&v!==void 0?v:this.filtering),this._bitmap=document.createElement("canvas");const T=(w=t==null?void 0:t.width)!==null&&w!==void 0?w:this._bitmap.width,k=(x=t==null?void 0:t.height)!==null&&x!==void 0?x:this._bitmap.height;this.width=T,this.height=k;const B=this._bitmap.getContext("2d");if(B)this._ctx=B;else throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic")}cloneRasterOptions(){return{color:this.color?this.color.clone():null,strokeColor:this.strokeColor?this.strokeColor.clone():null,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,lineCap:this.lineCap,quality:this.quality,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(((t=this._originalWidth)!==null&&t!==void 0?t:this._bitmap.width)+this.padding*2)*1}_getTotalHeight(){var t;return(((t=this._originalHeight)!==null&&t!==void 0?t:this._bitmap.height)+this.padding*2)*1}get localBounds(){return tt.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,C.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=Mt(t,()=>this.flagDirty())}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),this._strokeColor=Mt(t,()=>this.flagDirty())}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore()}_applyRasterProperties(t){var i,n,o;this._bitmap.width=this._getTotalWidth()*this.quality,this._bitmap.height=this._getTotalHeight()*this.quality,this._bitmap.setAttribute("filtering",this.filtering),this._bitmap.setAttribute("forceUpload","true"),t.scale(this.quality,this.quality),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash((i=this.lineDash)!==null&&i!==void 0?i:t.getLineDash()),t.lineCap=this.lineCap,t.strokeStyle=(n=this.strokeColor)===null||n===void 0?void 0:n.toString(),t.fillStyle=(o=this.color)===null||o===void 0?void 0:o.toString()}_drawImage(t,i,n){this._dirty&&this.rasterize(),t.scale(1/this.quality,1/this.quality),t.drawImage(this._bitmap,i,n)}}class So extends gn{get ctx(){return this._ctx}constructor(t){super(t),this._options=t}clone(){return new So({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var i,n;!((i=this._options)===null||i===void 0)&&i.draw&&((n=this._options)===null||n===void 0||n.draw(t)),this._options.cache||this.flagDirty()}}class zl{}zl.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class Eo{constructor(){this.states=new Map}get currentState(){return this._currentState}set currentState(t){this._currentState=t}static create(t,i){const n=new Eo;n.data=i;for(const o in t.states)n.states.set(o,{name:o,...t.states[o]});for(const o of n.states.values())for(const l of o.transitions)if(l!=="*"&&!n.states.has(l))throw Error(`Invalid state machine, state [${o.name}] has a transition to another state that doesn't exist [${l}]`);return n.currentState=n.startState=n.states.get(t.start),n}in(t){return this.currentState.name===t}go(t,i){var n,o;if(this.currentState.transitions.includes(t)||this.currentState.transitions.includes("*")){const l=this.states.get(t);return this.currentState.onExit&&((n=this.currentState)===null||n===void 0?void 0:n.onExit({to:l.name,data:this.data}))===!1||l!=null&&l.onEnter&&(l==null?void 0:l.onEnter({from:this.currentState.name,eventData:i,data:this.data}))===!1?!1:(this.currentState=l,!((o=this.currentState)===null||o===void 0)&&o.onState&&this.currentState.onState(),!0)}return!1}update(t){this.currentState.onUpdate&&this.currentState.onUpdate(this.data,t)}save(t){localStorage.setItem(t,JSON.stringify({currentState:this.currentState.name,data:this.data}))}restore(t){const i=JSON.parse(localStorage.getItem(t));this.currentState=this.states.get(i.currentState),this.data=i.data}}class Pd{_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.value=this._playbackRate,this._instance.connect(this._volumeNode),this._volumeNode.connect(this._audioContext.destination)}_handleEnd(){this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)})}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)}))}get loop(){return this._loop}set volume(t){t=$(t,0,1),this._volume=t,this._stateMachine.in("PLAYING")&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}get duration(){var t;return(t=this._duration)!==null&&t!==void 0?t:this.getTotalPlaybackDuration()}set duration(t){this._duration=t}constructor(t){this._src=t,this._audioContext=pn.create(),this._volumeNode=this._audioContext.createGain(),this._playingFuture=new _,this._stateMachine=Eo.create({start:"STOPPED",states:{PLAYING:{onEnter:({data:i})=>{this._createNewBufferSource(),this._handleEnd(),this.loop?this._instance.start(0,i.pausedAt*this._playbackRate):this._instance.start(0,i.pausedAt*this._playbackRate,this.duration),i.startedAt=this._audioContext.currentTime-i.pausedAt,i.pausedAt=0},onState:()=>this._playStarted(),onExit:({to:i})=>{i==="STOPPED"&&this._playingFuture.resolve(!0),this._instance.onended=null,this._instance.disconnect(),this._instance.stop(0),this._instance=null},transitions:["STOPPED","PAUSED","SEEK"]},SEEK:{onEnter:({eventData:i,data:n})=>{n.pausedAt=(i??0)/this._playbackRate,n.startedAt=0},transitions:["*"]},STOPPED:{onEnter:({data:i})=>{i.pausedAt=0,i.startedAt=0,this._playingFuture.resolve(!0)},transitions:["PLAYING","PAUSED","SEEK"]},PAUSED:{onEnter:({data:i})=>{i.pausedAt=this._audioContext.currentTime-i.startedAt},transitions:["PLAYING","STOPPED","SEEK"]}}},{startedAt:0,pausedAt:0}),this._volume=1,this._loop=!1,this._playStarted=()=>{},this._playbackRate=1,this._createNewBufferSource()}isPlaying(){return this._stateMachine.in("PLAYING")}isPaused(){return this._stateMachine.in("PAUSED")||this._stateMachine.in("SEEK")}isStopped(){return this._stateMachine.in("STOPPED")}play(t=()=>{}){return this._playStarted=t,this._stateMachine.go("PLAYING"),this._playingFuture.promise}pause(){this._stateMachine.go("PAUSED")}stop(){this._stateMachine.go("STOPPED")}seek(t){this._stateMachine.go("PAUSED"),this._stateMachine.go("SEEK",t)}getTotalPlaybackDuration(){return this._src.duration}getPlaybackPosition(){const{pausedAt:t,startedAt:i}=this._stateMachine.data;return t?t*this._playbackRate:i?(this._audioContext.currentTime-i)*this._playbackRate:0}set playbackRate(t){this._instance.playbackRate.value=this._playbackRate=t}get playbackRate(){return this._instance.playbackRate.value}}var To;(function(c){c.Kill="kill",c.PreKill="prekill",c.PostKill="postkill",c.PreDraw="predraw",c.PostDraw="postdraw",c.PreDebugDraw="predebugdraw",c.PostDebugDraw="postdebugdraw",c.PreUpdate="preupdate",c.PostUpdate="postupdate",c.PreFrame="preframe",c.PostFrame="postframe",c.PreCollision="precollision",c.CollisionStart="collisionstart",c.CollisionEnd="collisionend",c.PostCollision="postcollision",c.Initialize="initialize",c.Activate="activate",c.Deactivate="deactivate",c.ExitViewport="exitviewport",c.EnterViewport="enterviewport",c.ExitTrigger="exit",c.EnterTrigger="enter",c.Connect="connect",c.Disconnect="disconnect",c.Button="button",c.Axis="axis",c.Visible="visible",c.Hidden="hidden",c.Start="start",c.Stop="stop",c.PointerUp="pointerup",c.PointerDown="pointerdown",c.PointerMove="pointermove",c.PointerEnter="pointerenter",c.PointerLeave="pointerleave",c.PointerCancel="pointercancel",c.PointerWheel="pointerwheel",c.Up="up",c.Down="down",c.Move="move",c.Enter="enter",c.Leave="leave",c.Cancel="cancel",c.Wheel="wheel",c.Press="press",c.Release="release",c.Hold="hold",c.PointerDragStart="pointerdragstart",c.PointerDragEnd="pointerdragend",c.PointerDragEnter="pointerdragenter",c.PointerDragLeave="pointerdragleave",c.PointerDragMove="pointerdragmove",c.ActionStart="actionstart",c.ActionComplete="actioncomplete"})(To||(To={}));class yt{constructor(){this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class Po extends yt{constructor(t){super(),this.target=t}}class Ol extends yt{constructor(t){super(),this.target=t}}class Ul extends yt{constructor(t){super(),this.target=t}}class Nl extends yt{constructor(t){super(),this.target=t}}class Hl extends yt{constructor(t){super(),this.target=t}}class mn extends yt{constructor(t,i,n){super(),this.ctx=t,this.delta=i,this.target=n}}class _n extends yt{constructor(t,i,n){super(),this.ctx=t,this.delta=i,this.target=n}}class Wl extends yt{constructor(t,i,n){super(),this.ctx=t,this.delta=i,this.target=n}}class jl extends yt{constructor(t,i,n){super(),this.ctx=t,this.delta=i,this.target=n}}class Gl extends yt{constructor(t,i){super(),this.ctx=t,this.target=i}}class Vl extends yt{constructor(t,i){super(),this.ctx=t,this.target=i}}class os extends yt{constructor(t,i,n){super(),this.engine=t,this.delta=i,this.target=n}}class as extends yt{constructor(t,i,n){super(),this.engine=t,this.delta=i,this.target=n}}class Xl extends yt{constructor(t,i){super(),this.engine=t,this.prevStats=i,this.target=t}}class $l extends yt{constructor(t,i){super(),this.engine=t,this.stats=i,this.target=t}}class Yl extends yt{constructor(t,i){super(),this.index=t,this.gamepad=i,this.target=i}}class Ql extends yt{constructor(t,i){super(),this.index=t,this.gamepad=i,this.target=i}}class Zl extends yt{constructor(t,i,n){super(),this.button=t,this.value=i,this.target=n}}class ql extends yt{constructor(t,i,n){super(),this.axis=t,this.value=i,this.target=n}}class Kl extends yt{constructor(t){super(),this.target=t}}class Jl extends yt{constructor(t){super(),this.target=t}}class Ms extends yt{constructor(t,i,n,o,l){super(),this.other=i,this.side=n,this.intersection=o,this.contact=l,this.target=t}}class Ls extends yt{constructor(t,i,n,o,l){super(),this.other=i,this.side=n,this.intersection=o,this.contact=l,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Io{constructor(t,i,n,o){this.target=t,this.other=i,this.side=n,this.contact=o}}class Ro{constructor(t,i,n,o){this.target=t,this.other=i,this.side=n,this.lastContact=o}}class Do{constructor(t,i,n,o,l){this.target=t,this.other=i,this.side=n,this.intersection=o,this.contact=l}}class ko{constructor(t,i,n,o,l){this.target=t,this.other=i,this.side=n,this.intersection=o,this.contact=l}}class dr extends yt{constructor(t,i,n,o){super(),this.other=i,this.side=n,this.contact=o,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class fr extends yt{constructor(t,i,n,o){super(),this.other=i,this.side=n,this.lastContact=o,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class vn extends yt{constructor(t,i){super(),this.engine=t,this.target=i}}class th extends yt{constructor(t,i){super(),this.context=t,this.target=i}}class eh extends yt{constructor(t,i){super(),this.context=t,this.target=i}}class ih extends yt{constructor(t){super(),this.target=t}}class sh extends yt{constructor(t){super(),this.target=t}}class nh extends yt{constructor(t,i){super(),this.target=t,this.actor=i}}class rh extends yt{constructor(t,i){super(),this.target=t,this.actor=i}}class oh extends yt{constructor(t,i){super(),this.action=t,this.target=i}}class ah extends yt{constructor(t,i){super(),this.action=t,this.target=i}}class lh extends yt{set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}constructor(t,i="MediaEvent"){super(),this.target=t,this._name=i}stopPropagation(){}action(){}propagate(){}layPath(t){}}class zs extends lh{constructor(t,i){super(t,"NativeSoundEvent"),this.track=i}}class Id extends lh{constructor(t,i){super(t,"NativeSoundProcessedEvent"),this._processedData=i,this.data=this._processedData}}function Nv(c){try{const t=new Audio,i=/.*\.([A-Za-z0-9]+)(?:(?:\?|\#).*)*$/,n=c.match(i)[1];return!!t.canPlayType("audio/"+n)}catch(t){return K.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}const Hv={VolumeChange:"volumechange",Processed:"processed",Pause:"pause",Stop:"stop",PlaybackEnd:"playbackend",Resume:"resume",PlaybackStart:"playbackstart"};class Rd{set loop(t){this._loop=t;for(const i of this._tracks)i.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const i of this._tracks)i.volume=this._volume;this.events.emit("volumechange",new zs(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}set duration(t){this._duration=t}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}constructor(...t){this.events=new y,this.logger=K.getInstance(),this._loop=!1,this._volume=1,this._isStopped=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._playbackRate=1,this._audioContext=pn.create(),this._resource=new ee("",zl.type.arraybuffer);for(const i of t)if(Nv(i)){this.path=i;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}isLoaded(){return!!this.data}async load(){var t,i;if(this.data)return this.data;const n=await this._resource.load(),o=await this.decodeAudio(n.slice(0));return this._duration=(i=(t=this._duration)!==null&&t!==void 0?t:o==null?void 0:o.duration)!==null&&i!==void 0?i:void 0,this.events.emit("processed",new Id(this,o)),this.data=o}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch{return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(t=>t.isPlaying())}isPaused(){return this._tracks.some(t=>t.isPaused())}isStopped(){return this._tracks.some(t=>t.isStopped())}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this.isPaused()?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this.events.emit("pause",new zs(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.events.emit("stop",new zs(this)),this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._tracks.forEach(i=>{i.playbackRate=this._playbackRate})}seek(t,i=0){this._tracks.length===0&&this._getTrackInstance(this.data),this._tracks[i].seek(t)}getTotalPlaybackDuration(){return this.isLoaded()?this.data.duration:(this.logger.warnOnce(`Sound from ${this.path} is not loaded, cannot return total playback duration.Did you forget to add Sound to a loader? https://excaliburjs.com/docs/loaders/`),0)}getPlaybackPosition(t=0){return this._tracks.length?this._tracks[t].getPlaybackPosition():0}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this.isPaused){const t=[];for(const i of this._tracks)t.push(i.play().then(()=>(this._tracks.splice(this.getTrackId(i),1),!0)));this.events.emit("resume",new zs(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){const t=this._getTrackInstance(this.data),i=await t.play(()=>{this.events.emit("playbackstart",new zs(this,t)),this.logger.debug("Playing new instance for sound",this.path)});this.events.emit("playbackend",new zs(this,t));const n=this.getTrackId(t);return n!==-1&&this._tracks.splice(n,1),i}_getTrackInstance(t){const i=new Pd(t);return i.loop=this.loop,i.volume=this.volume,i.duration=this.duration,i.playbackRate=this._playbackRate,this._tracks.push(i),i}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}}const Wv={BeforeLoad:"beforeload",AfterLoad:"afterload",UserAction:"useraction",LoadResourceStart:"loadresourcestart",LoadResourceEnd:"loadresourceend"};function hh(c){var t,i;return!!(c!=null&&c.prototype)&&!!(!((i=(t=c==null?void 0:c.prototype)===null||t===void 0?void 0:t.constructor)===null||i===void 0)&&i.name)}class pr{get resources(){return this._resources}constructor(t){var i;this.events=new y,this.canvas=new So({filtering:Kt.Blended,smoothing:!0,cache:!1,draw:this.onDraw.bind(this)}),this._resources=[],this._numLoaded=0,this._totalTimeMs=0,this._loadingFuture=new _,t&&(!((i=t.loadables)===null||i===void 0)&&i.length)&&this.addResources(t.loadables)}onInitialize(t){this.engine=t,this.canvas.width=this.engine.screen.resolution.width,this.canvas.height=this.engine.screen.resolution.height}async onUserAction(){return await Promise.resolve()}async onBeforeLoad(){}async onAfterLoad(){await at(500,this.engine.clock)}addResource(t){this._resources.push(t)}addResources(t){let i=0;const n=t.length;for(i;i<n;i++)this.addResource(t[i])}markResourceComplete(){this._numLoaded++}get progress(){const t=this._resources.length;return t>0?$(this._numLoaded,0,t)/t:1}isLoaded(){return this._numLoaded===this._resources.length}onUpdate(t,i){this._totalTimeMs+=i}onDraw(t){const i=this._totalTimeMs/1e3;t.fillStyle=N.Black.toRGBA(),t.fillRect(0,0,this.engine.screen.resolution.width,this.engine.screen.resolution.height),t.save(),t.translate(this.engine.screen.resolution.width/2,this.engine.screen.resolution.height/2);const n=i*10;t.strokeStyle="white",t.lineWidth=10,t.lineCap="round",t.arc(0,0,40,n,n+Math.PI*3/2),t.stroke(),t.fillStyle="white",t.font="16px sans-serif";const o=(this.progress*100).toFixed(0)+"%",l=t.measureText(o),d=Math.abs(l.actualBoundingBoxLeft)+Math.abs(l.actualBoundingBoxRight),f=Math.abs(l.actualBoundingBoxAscent)+Math.abs(l.actualBoundingBoxDescent);t.fillText(o,-d/2,f/2),t.restore()}areResourcesLoaded(){return this._loadingFuture.promise}async load(){await this.onBeforeLoad(),this.events.emit("beforeload"),this.canvas.flagDirty(),await Promise.all(this._resources.map(async t=>{this.events.emit("loadresourcestart",t),await t.load().finally(()=>{this._numLoaded++,this.canvas.flagDirty(),this.events.emit("loadresourceend",t)})}));for(const t of this._resources)t instanceof Rd&&t.wireEngine(this.engine);return this._loadingFuture.resolve(),this.canvas.flagDirty(),await this.onUserAction(),this.events.emit("useraction"),await Bs.unlock(),await this.onAfterLoad(),this.events.emit("afterload"),this.data=this._resources}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}}function ch(c,t=N.Red,i,n,o,l,d=1,f="butt"){c.save(),c.beginPath(),c.lineWidth=d,c.lineCap=f,c.strokeStyle=t.toString(),c.moveTo(i,n),c.lineTo(o,l),c.closePath(),c.stroke(),c.restore()}function jv(c,t=N.Red,i){c.beginPath(),c.strokeStyle=t.toString(),c.arc(i.x,i.y,5,0,Math.PI*2),c.closePath(),c.stroke()}function Gv(c,t,i,n,o=1){const l=t?t.toString():"blue",d=n.scale(o);c.beginPath(),c.strokeStyle=l,c.moveTo(i.x,i.y),c.lineTo(i.x+d.x,i.y+d.y),c.closePath(),c.stroke()}function uh(c,t,i,n,o,l=5,d=N.White,f=null){let g;if(typeof l=="number")g={tl:l,tr:l,br:l,bl:l};else{const v={tl:0,tr:0,br:0,bl:0};for(const w in v)if(v.hasOwnProperty(w)){const x=w;g[x]=l[x]||v[x]}}c.beginPath(),c.moveTo(t+g.tl,i),c.lineTo(t+n-g.tr,i),c.quadraticCurveTo(t+n,i,t+n,i+g.tr),c.lineTo(t+n,i+o-g.br),c.quadraticCurveTo(t+n,i+o,t+n-g.br,i+o),c.lineTo(t+g.bl,i+o),c.quadraticCurveTo(t,i+o,t,i+o-g.bl),c.lineTo(t,i+g.tl),c.quadraticCurveTo(t,i,t+g.tl,i),c.closePath(),f&&(c.fillStyle=f.toString(),c.fill()),d&&(c.strokeStyle=d.toString(),c.stroke())}function Vv(c,t,i,n,o=N.White,l=null){c.beginPath(),c.arc(t,i,n,0,Math.PI*2),c.closePath(),l&&(c.fillStyle=l.toString(),c.fill()),o&&(c.strokeStyle=o.toString(),c.stroke())}const Xv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=";var $v=Ot(8851);class Os extends pr{get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.onload=()=>this._imageLoaded.resolve(),this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}constructor(t){const i=Array.isArray(t)?{loadables:t}:t;super(i),this._logger=K.getInstance(),this._originalOptions={loadables:[]},this.events=new y,this._playButtonShown=!1,this.logo=Xv,this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=N.White,this.backgroundColor="#176BAA",this._imageLoaded=new _,this.suppressPlayButton=!1,this._playButtonStyles=$v.A.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let n=document.getElementById("excalibur-play");return n||(n=document.createElement("button")),n.id="excalibur-play",n.textContent=this.playButtonText,n.style.display="none",n},this._configuredPixelRatio=null,this._originalOptions={...Os._DEFAULT_LOADER_OPTIONS,...i}}onInitialize(t){this.engine=t,this.screen=t.screen,this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height,this.screen.events.on("resize",()=>{this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height})}async showPlayButton(){var t,i;if(this.suppressPlayButton)this.hidePlayButton(),await at(500,(t=this.engine)===null||t===void 0?void 0:t.clock);else{const n=()=>{try{this._positionPlayButton()}catch{}};return!((i=this.engine)===null||i===void 0)&&i.browser&&this.engine.browser.window.on("resize",n),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",l=>{l.key==="Enter"&&this._playButton.click()}),this._positionPlayButton(),await new Promise(l=>{const d=f=>{var g;if(f.stopPropagation(),this.hidePlayButton(),!((g=this.engine)===null||g===void 0)&&g.browser&&this.engine.browser.window.off("resize",n),this._originalOptions.fullscreenAfterLoad)try{this._logger.info("requesting fullscreen"),this._originalOptions.fullscreenContainer instanceof HTMLElement?this._originalOptions.fullscreenContainer.requestFullscreen():this.engine.screen.goFullScreen(this._originalOptions.fullscreenContainer)}catch(v){this._logger.error("could not go fullscreen",v)}l()};this._playButton.addEventListener("click",d),this._playButton.addEventListener("touchend",d),this._playButton.addEventListener("pointerup",d)})}}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}async onUserAction(){var t;await at(200,(t=this.engine)===null||t===void 0?void 0:t.clock),this.canvas.flagDirty(),await this.showPlayButton()}async onBeforeLoad(){const t=this._image;await this._imageLoaded.promise,await(t==null?void 0:t.decode())}async onAfterLoad(){this.screen.pixelRatioOverride=this._configuredPixelRatio,this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport(),this.dispose()}_positionPlayButton(){if(this.engine){const{x:t,y:i,width:n,height:o}=this.engine.canvas.getBoundingClientRect();if(this._playButtonRootElement){const l=this._playButton.clientWidth,d=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${t+n/2-l/2}px`,this._playButtonRootElement.style.top=`${i+o/2-d/2+100}px`)}}}onDraw(t){const i=this.engine.canvasHeight/this.engine.pixelRatio,n=this.engine.canvasWidth/this.engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,n,i);let o=i/2;const l=Math.min(this.logoWidth,n*.75);let d=n/2-l/2;this.logoPosition&&(d=this.logoPosition.x,o=this.logoPosition.y);const f=Math.floor(l*(this.logoHeight/this.logoWidth)),g=this.engine.getAntialiasing();if(this.engine.setAntialiasing(!0),this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,d,o,l,f):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,d,o-f-20,l,f),!this.suppressPlayButton&&this._playButtonShown){this.engine.setAntialiasing(g);return}let v=d,w=o;this.loadingBarPosition&&(v=this.loadingBarPosition.x,w=this.loadingBarPosition.y),t.lineWidth=2,uh(t,v,w,l,20,10,this.loadingBarColor);const x=l*this.progress,T=5,k=x-T*2,B=20-T*2;uh(t,v+T,w+T,k>10?k:10,B,5,null,this.loadingBarColor),this.engine.setAntialiasing(g)}}Os._DEFAULT_LOADER_OPTIONS={loadables:[],fullscreenAfterLoad:!1,fullscreenContainer:void 0};const Dd={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class kd{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch{return!1}return t.responseType==="arraybuffer"},dataUrlSupport:function(){return document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return this._features===null&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t=`%cSUPPORTED BROWSER FEATURES
==========================%c
`;const i=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],n=this.getBrowserFeatures();for(const o of Object.keys(Dd))n[o]?(t+="(%c✓%c)",i.push("font-weight: bold; color: green"),i.push("font-weight: normal; color: inherit")):(t+="(%c✗%c)",i.push("font-weight: bold; color: red"),i.push("font-weight: normal; color: inherit")),t+=" "+Dd[o]+`
`;i.unshift(t),console.log.apply(console,i)}_loadBrowserFeatures(){return{canvas:this._criticalTests.canvasSupport(),arraybuffer:this._criticalTests.arrayBufferSupport(),dataurl:this._criticalTests.dataUrlSupport(),objecturl:this._criticalTests.objectUrlSupport(),rgba:this._criticalTests.rgbaSupport(),webaudio:this._warningTest.webAudioSupport(),webgl:this._warningTest.webglSupport(),gamepadapi:!!navigator.getGamepads}}test(){let t=!1;for(const i in this._criticalTests)this._criticalTests[i].call(this)||(this.failedTests.push(i),K.getInstance().error("Critical browser feature missing, Excalibur requires:",i),t=!0);if(t)return!1;for(const i in this._warningTest)this._warningTest[i]()||K.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",i);return!0}}var pt;(function(c){c.PreventCollision="PreventCollision",c.Passive="Passive",c.Active="Active",c.Fixed="Fixed"})(pt||(pt={}));var ne;(function(c){c.World="world",c.Screen="screen"})(ne||(ne={}));class dh extends C{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class Fo extends C{constructor(t,i){super(t.x,t.y),this.original=t,this.change=i}get x(){return this._x=this.original.x}set x(t){this.change(t,this._y),this._x=this.original.x=t}get y(){return this._y=this.original.y}set y(t){this.change(this._x,t),this._y=this.original.y=t}}class Us{constructor(){this._parent=null,this._children=[],this._pos=D(0,0),this._rotation=0,this._scale=D(1,1),this._isDirty=!1,this._isInverseDirty=!1,this._matrix=gt.identity(),this._inverse=gt.identity()}get parent(){return this._parent}set parent(t){if(this._parent){const i=this._parent._children.indexOf(this);i>-1&&this._parent._children.splice(i,1)}this._parent=t,this._parent&&this._parent._children.push(this),this.flagDirty()}get children(){return this._children}set pos(t){t.equals(this._pos)||(this._pos.x=t.x,this._pos.y=t.y,this.flagDirty())}get pos(){return new Fo(this._pos,(t,i)=>{(t!==this._pos.x||i!==this._pos.y)&&this.flagDirty()})}set globalPos(t){let i=t.clone();this.parent&&(i=this.parent.inverse.multiply(t)),i.equals(this._pos)||(this._pos=i,this.flagDirty())}get globalPos(){return new dh({getX:()=>this.matrix.data[4],getY:()=>this.matrix.data[5],setX:t=>{if(this.parent){const{x:i}=this.parent.inverse.multiply(D(t,this.pos.y));this.pos.x=i}else this.pos.x=t;t!==this.matrix.data[4]&&this.flagDirty()},setY:t=>{if(this.parent){const{y:i}=this.parent.inverse.multiply(D(this.pos.x,t));this.pos.y=i}else this.pos.y=t;t!==this.matrix.data[5]&&this.flagDirty()}})}set rotation(t){const i=I(t);i!==this._rotation&&this.flagDirty(),this._rotation=i}get rotation(){return this._rotation}set globalRotation(t){let i=0;this.parent&&(i=this.parent.globalRotation);const n=I(t+i);n!==this._rotation&&this.flagDirty(),this._rotation=n}get globalRotation(){return this.parent?this.matrix.getRotation():this.rotation}set scale(t){(t.x!==this._scale.x||t.y!==this._scale.y)&&(this._scale.x=t.x,this._scale.y=t.y,this.flagDirty())}get scale(){return new Fo(this._scale,(t,i)=>{(t!==this._scale.x||i!==this._scale.y)&&this.flagDirty()})}set globalScale(t){let i=D(1,1);this.parent&&(i=this.parent.globalScale),this.scale=t.scale(D(1/i.x,1/i.y))}get globalScale(){return new dh({getX:()=>this.parent?this.matrix.getScaleX():this.scale.x,getY:()=>this.parent?this.matrix.getScaleY():this.scale.y,setX:t=>{if(this.parent){const i=this.parent.globalScale.x;this.scale.x=t/i}else this.scale.x=t},setY:t=>{if(this.parent){const i=this.parent.globalScale.y;this.scale.y=t/i}else this.scale.y=t}})}get matrix(){return this._isDirty&&(this.parent===null?this._matrix=this._calculateMatrix():this._matrix=this.parent.matrix.multiply(this._calculateMatrix()),this._isDirty=!1),this._matrix}get inverse(){return this._isInverseDirty&&(this._inverse=this.matrix.inverse(),this._isInverseDirty=!1),this._inverse}_calculateMatrix(){return gt.identity().translate(this.pos.x,this.pos.y).rotate(this.rotation).scale(this.scale.x,this.scale.y)}flagDirty(){this._isDirty=!0,this._isInverseDirty=!0;for(let t=0;t<this._children.length;t++)this._children[t].flagDirty()}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.inverse.multiply(t)}setTransform(t,i,n){this._pos.x=t.x,this._pos.y=t.y,this._rotation=I(i),this._scale.x=n.x,this._scale.y=n.y,this.flagDirty()}clone(t){const i=t??new Us;return this._pos.clone(i._pos),i._rotation=this._rotation,this._scale.clone(i._scale),i.flagDirty(),i}}function Fd(c){return!!c&&!!c.prototype&&!!c.prototype.constructor}function Yv(c){return!!(c!=null&&c.clone)}class yi{constructor(){this.owner=void 0}clone(){const t=new this.constructor;for(const i in this)if(this.hasOwnProperty(i)){const n=this[i];Yv(n)&&i!=="owner"&&i!=="clone"?t[i]=n.clone():t[i]=n}return t}}class be{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){const i=this.observers.indexOf(t);i!==-1&&this.observers.splice(i,1)}unsubscribe(t){const i=this.subscriptions.indexOf(t);i!==-1&&this.subscriptions.splice(i,1)}notifyAll(t){const i=this.observers.length;for(let o=0;o<i;o++)this.observers[o].notify(t);const n=this.subscriptions.length;for(let o=0;o<n;o++)this.subscriptions[o](t)}clear(){this.observers.length=0,this.subscriptions.length=0}}class nt extends yi{constructor(){super(...arguments),this._logger=K.getInstance(),this._parentComponent=null,this._transform=new Us,this._addChildTransform=t=>{const i=t.get(nt);i&&(i._transform.parent=this._transform,i._parentComponent=this)},this.zIndexChanged$=new be,this._z=0,this._coordPlane=ne.World}get(){return this._transform}onAdd(t){for(const i of t.children)this._addChildTransform(i);t.childrenAdded$.subscribe(i=>this._addChildTransform(i)),t.childrenRemoved$.subscribe(i=>{const n=i.get(nt);n&&(n._transform.parent=null,n._parentComponent=null)})}onRemove(t){this._transform.parent=null,this._parentComponent=null}get z(){return this._z}set z(t){const i=this._z;this._z=t,i!==t&&this.zIndexChanged$.notifyAll(t)}get coordPlane(){return this._parentComponent?this._parentComponent.coordPlane:this._coordPlane}set coordPlane(t){var i;this._parentComponent?this._logger.warn(`Cannot set coordinate plane on child entity ${(i=this.owner)===null||i===void 0?void 0:i.name}, children inherit their coordinate plane from their parents.`):this._coordPlane=t}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get globalPos(){return this._transform.globalPos}set globalPos(t){this._transform.globalPos=t}get rotation(){return this._transform.rotation}set rotation(t){this._transform.rotation=t}get globalRotation(){return this._transform.globalRotation}set globalRotation(t){this._transform.globalRotation=t}get scale(){return this._transform.scale}set scale(t){this._transform.scale=t}get globalScale(){return this._transform.globalScale}set globalScale(t){this._transform.globalScale=t}applyInverse(t){return this._transform.applyInverse(t)}apply(t){return this._transform.apply(t)}clone(){const t=new nt;return t._transform=this._transform.clone(),t._z=this._z,t}}class Ht extends yi{constructor(){super(...arguments),this.vel=C.Zero,this.acc=C.Zero,this.scaleFactor=C.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}class Ii{static create(t,i){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t)){const o=this._GROUPS.get(t);if(o.mask===i)return o;throw new Error(`Collision group ${t} already exists with a different mask!`)}const n=new Ns(t,this._CURRENT_BIT,i!==void 0?i:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,n),n}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}Ii._STARTING_BIT=1,Ii._MAX_GROUPS=32,Ii._CURRENT_GROUP=1,Ii._CURRENT_BIT=Ii._STARTING_BIT,Ii._GROUPS=new Map;class Ns{constructor(t,i,n){this._name=t,this._category=i,this._mask=n}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){const i=this.category&t.mask,n=this.mask&t.category;return i!==0&&n!==0}invert(){const t=Ii.create("~("+this.name+")",~this.mask|0);return t._category=~this.category,t}static combine(t){const i=t.map(l=>l.name).join("+"),o=~t.reduce((l,d)=>d.category|l,0);return Ii.create(i,o)}static collidesWith(t){const i=`collidesWith(${t.map(o=>o.name).join("+")})`,n=t.reduce((o,l)=>l.category|o,0);return Ii.create(i,n)}toString(){return`
category: ${this.category.toString(2).padStart(32,"0")}
mask:     ${(this.mask>>>0).toString(2).padStart(32,"0")}
    `}}Ns.All=new Ns("Collide with all groups",-1,-1);class ti{constructor(t,i){this.colliderA=t,this.colliderB=i,this.id=null,this.id=ti.calculatePairHash(t.id,i.id)}static canCollide(t,i){var n,o;const l=(n=t==null?void 0:t.owner)===null||n===void 0?void 0:n.get(dt),d=(o=i==null?void 0:i.owner)===null||o===void 0?void 0:o.get(dt);return!(t.id===i.id||t.owner&&i.owner&&t.owner.id===i.owner.id||t.localBounds.hasZeroDimensions()||i.localBounds.hasZeroDimensions()||!l||!d||!l.group.canCollide(d.group)||l.collisionType===pt.Fixed&&d.collisionType===pt.Fixed||d.collisionType===pt.PreventCollision||l.collisionType===pt.PreventCollision||!l.active||!d.active)}get canCollide(){const t=this.colliderA,i=this.colliderB;return ti.canCollide(t,i)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,i){return t.value<i.value?`#${t.value}+${i.value}`:`#${i.value}+${t.value}`}}class gr{constructor(t,i){this.min=t,this.max=i}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class fh{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new tt,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class ph{constructor(t,i=new tt(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this._config=t,this.worldBounds=i,this.root=null,this.nodes={}}_insert(t){if(this.root===null){this.root=t,this.root.parent=null;return}const i=t.bounds;let n=this.root;for(;!n.isLeaf();){const f=n.left,g=n.right,v=n.bounds.getPerimeter(),x=n.bounds.combine(i).getPerimeter(),T=2*x,k=2*(x-v);let B=0;const O=i.combine(f.bounds);let G,L;f.isLeaf()?B=O.getPerimeter()+k:(L=f.bounds.getPerimeter(),G=O.getPerimeter(),B=G-L+k);let z=0;const V=i.combine(g.bounds);if(g.isLeaf()?z=V.getPerimeter()+k:(L=g.bounds.getPerimeter(),G=V.getPerimeter(),z=G-L+k),T<B&&T<z)break;B<z?n=f:n=g}const o=n.parent,l=new fh(o);l.bounds=i.combine(n.bounds),l.height=n.height+1,o!==null?(o.left===n?o.left=l:o.right=l,l.left=n,l.right=t,n.parent=l,t.parent=l):(l.left=n,l.right=t,n.parent=l,t.parent=l,this.root=l);let d=t.parent;for(;d;){if(d=this._balance(d),!d.left)throw new Error("Parent of current leaf cannot have a null left child"+d);if(!d.right)throw new Error("Parent of current leaf cannot have a null right child"+d);d.height=1+Math.max(d.left.height,d.right.height),d.bounds=d.left.bounds.combine(d.right.bounds),d=d.parent}}_remove(t){if(t===this.root){this.root=null;return}const i=t.parent,n=i.parent;let o;if(i.left===t?o=i.right:o=i.left,n){n.left===i?n.left=o:n.right=o,o.parent=n;let l=n;for(;l;)l=this._balance(l),l.bounds=l.left.bounds.combine(l.right.bounds),l.height=1+Math.max(l.left.height,l.right.height),l=l.parent}else this.root=o,o.parent=null}trackCollider(t){const i=new fh;i.data=t,i.bounds=t.bounds,i.bounds.left-=2,i.bounds.top-=2,i.bounds.right+=2,i.bounds.bottom+=2,this.nodes[t.id.value]=i,this._insert(i)}updateCollider(t){var i;const n=this.nodes[t.id.value];if(!n)return!1;const o=t.bounds;if(!this.worldBounds.contains(o))return K.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(n.bounds.contains(o))return!1;if(this._remove(n),o.left-=this._config.boundsPadding,o.top-=this._config.boundsPadding,o.right+=this._config.boundsPadding,o.bottom+=this._config.boundsPadding,t.owner){const l=(i=t.owner)===null||i===void 0?void 0:i.get(dt);if(l){const d=l.vel.x*32/1e3*this._config.velocityMultiplier,f=l.vel.y*32/1e3*this._config.velocityMultiplier;d<0?o.left+=d:o.right+=d,f<0?o.top+=f:o.bottom+=f}}return n.bounds=o,this._insert(n),!0}untrackCollider(t){const i=this.nodes[t.id.value];i&&(this._remove(i),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(t===null)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const i=t.left,n=t.right,o=t,l=i,d=n,f=i.left,g=i.right,v=n.left,w=n.right,x=d.height-l.height;if(x>1)return d.left=o,d.parent=o.parent,o.parent=d,d.parent?d.parent.left===o?d.parent.left=d:d.parent.right=d:this.root=d,v.height>w.height?(d.right=v,o.right=w,w.parent=o,o.bounds=l.bounds.combine(w.bounds),d.bounds=o.bounds.combine(v.bounds),o.height=1+Math.max(l.height,w.height),d.height=1+Math.max(o.height,v.height)):(d.right=w,o.right=v,v.parent=o,o.bounds=l.bounds.combine(v.bounds),d.bounds=o.bounds.combine(w.bounds),o.height=1+Math.max(l.height,v.height),d.height=1+Math.max(o.height,w.height)),d;if(x<-1){if(l.left=o,l.parent=o.parent,o.parent=l,l.parent)if(l.parent.left===o)l.parent.left=l;else{if(l.parent.right!==o)throw"Error rotating Dynamic Tree";l.parent.right=l}else this.root=l;return f.height>g.height?(l.right=f,o.left=g,g.parent=o,o.bounds=d.bounds.combine(g.bounds),l.bounds=o.bounds.combine(f.bounds),o.height=1+Math.max(d.height,g.height),l.height=1+Math.max(o.height,f.height)):(l.right=g,o.left=f,f.parent=o,o.bounds=d.bounds.combine(f.bounds),l.bounds=o.bounds.combine(g.bounds),o.height=1+Math.max(d.height,f.height),l.height=1+Math.max(o.height,g.height)),l}return t}getHeight(){return this.root===null?0:this.root.height}query(t,i){const n=t.bounds,o=l=>{if(l&&l.bounds.overlaps(n))if(l.isLeaf()&&l.data!==t){if(i.call(t,l.data))return!0}else return o(l.left)||o(l.right);return!1};o(this.root)}rayCastQuery(t,i=1/0,n){const o=l=>{if(l&&l.bounds.rayCast(t,i))if(l.isLeaf()){if(n.call(t,l.data))return!0}else return o(l.left)||o(l.right);return!1};o(this.root)}getNodes(){const t=i=>i?[i].concat(t(i.left),t(i.right)):[];return t(this.root)}debug(t){const i=n=>{n&&(n.isLeaf()?n.bounds.draw(t,N.Green):n.bounds.draw(t,N.White),n.left&&i(n.left),n.right&&i(n.right))};i(this.root)}}class Yi{constructor(t,i){this.pos=t,this.dir=i.normalize()}intersect(t){const i=t.begin.sub(this.pos);if(this.dir.cross(t.getSlope())===0&&i.cross(this.dir)!==0)return-1;const n=this.dir.cross(t.getSlope());if(n===0)return-1;const o=i.cross(t.getSlope())/n;if(o>=0){const l=i.cross(this.dir)/n/t.getLength();if(l>=0&&l<=1)return o}return-1}intersectPoint(t){const i=this.intersect(t);return i<0?null:this.getPoint(i)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class Bo{constructor(t){this._config=t,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[],this._dynamicCollisionTree=new ph(t.dynamicTree)}getColliders(){return this._colliders}rayCast(t,i){var n,o,l;const d=[],f=(n=i==null?void 0:i.maxDistance)!==null&&n!==void 0?n:1/0,g=i==null?void 0:i.collisionGroup,v=g?g.category:(o=i==null?void 0:i.collisionMask)!==null&&o!==void 0?o:Ns.All.category,w=(l=i==null?void 0:i.searchAllColliders)!==null&&l!==void 0?l:!1;return this._dynamicCollisionTree.rayCastQuery(t,f,x=>{const k=x.owner.get(dt);if(i!=null&&i.ignoreCollisionGroupAll&&k.group===Ns.All)return!1;const B=(v&k.group.category)!==0;if(k!=null&&k.group&&!B)return!1;const O=x.rayCast(t,f);if(O){if(i!=null&&i.filter){if(i.filter(O)&&(d.push(O),!w))return!0}else if(d.push(O),!w)return!0}return!1}),d}track(t){if(!t){K.getInstance().warn("Cannot track null collider");return}if(t instanceof pe){const i=t.getColliders();for(const n of i)n.owner=t.owner,this._colliders.push(n),this._dynamicCollisionTree.trackCollider(n)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t)}untrack(t){if(!t){K.getInstance().warn("Cannot untrack a null collider");return}if(t instanceof pe){const i=t.getColliders();for(const n of i){const o=this._colliders.indexOf(n);o!==-1&&this._colliders.splice(o,1),this._dynamicCollisionTree.untrackCollider(n)}}else{const i=this._colliders.indexOf(t);i!==-1&&this._colliders.splice(i,1),this._dynamicCollisionTree.untrackCollider(t)}}_pairExists(t,i){const n=ti.calculatePairHash(t.id,i.id);return this._pairs.has(n)}broadphase(t,i,n){const o=i/1e3,l=t.filter(f=>{var g,v;const w=(g=f.owner)===null||g===void 0?void 0:g.get(dt);return((v=f.owner)===null||v===void 0?void 0:v.active)&&w.collisionType!==pt.PreventCollision});this._collisionPairCache=[],this._pairs.clear();let d;for(let f=0,g=l.length;f<g;f++)d=l[f],this._dynamicCollisionTree.query(d,v=>{if(!this._pairExists(d,v)&&ti.canCollide(d,v)){const w=new ti(d,v);this._pairs.add(w.id),this._collisionPairCache.push(w)}return!1});if(n&&(n.physics.pairs=this._collisionPairCache.length),this._config.continuous.checkForFastBodies)for(const f of l){const g=f.owner.get(dt);if(g.collisionType!==pt.Active)continue;const v=g.vel.size*o+g.acc.size*.5*o*o,w=Math.min(f.bounds.height,f.bounds.width);if(this._config.continuous.disableMinimumSpeedForFastBody||v>w/2){n&&n.physics.fastBodies++;const x=g.globalPos.sub(g.oldPos),T=f.center,k=f.getFurthestPoint(g.vel),B=k.sub(x),O=new Yi(B,g.vel);O.pos=O.pos.add(O.dir.scale(-2*this._config.continuous.surfaceEpsilon));let G,L=new C(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(O,v+this._config.continuous.surfaceEpsilon*2,z=>{if(!this._pairExists(f,z)&&ti.canCollide(f,z)){const V=z.rayCast(O,v+this._config.continuous.surfaceEpsilon*10);if(V){const H=V.point.sub(B);H.size<L.size&&(L=H,G=z)}}return!1}),G&&C.isValid(L)){const z=new ti(f,G);this._pairs.has(z.id)||(this._pairs.add(z.id),this._collisionPairCache.push(z));const V=T.sub(k);g.globalPos=B.add(V).add(L).add(O.dir.scale(10*this._config.continuous.surfaceEpsilon)),f.update(g.transform.get()),n&&n.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,i){let n=[];for(let o=0;o<t.length;o++){const l=t[o].collide();if(n=n.concat(l),i&&l.length>0)for(const d of l)i.physics.contacts.set(d.id,d)}return i&&(i.physics.collisions+=n.length),n}update(t){let i=0;const n=t.length;for(let o=0;o<n;o++)this._dynamicCollisionTree.updateCollider(t[o])&&i++;return i}debug(t){this._dynamicCollisionTree.debug(t)}}class ls{constructor(){this.id=m("collider",ls._ID++),this.composite=null,this.events=new y,this.offset=C.Zero}touching(t){return!!this.collide(t)}}ls._ID=0;var hs;(function(c){c.Arcade="arcade",c.Realistic="realistic"})(hs||(hs={}));var Mo;(function(c){c[c.DynamicAABBTree=0]="DynamicAABBTree"})(Mo||(Mo={}));var Lo;(function(c){c[c.Euler=0]="Euler"})(Lo||(Lo={}));class ft{static get gravity(){return ft.acc}static set gravity(t){ft.acc=t}static useArcadePhysics(){ft.collisionResolutionStrategy=hs.Arcade}static useRealisticPhysics(){ft.collisionResolutionStrategy=hs.Realistic}}ft.acc=new C(0,0),ft.enabled=!0,ft.broadphaseStrategy=Mo.DynamicAABBTree,ft.collisionResolutionStrategy=hs.Arcade,ft.defaultMass=10,ft.integrator=Lo.Euler,ft.dynamicTreeVelocityMultiplier=2,ft.boundsPadding=5,ft.positionIterations=3,ft.velocityIterations=8,ft.slop=1,ft.steeringFactor=.2,ft.warmStart=!0,ft.bodiesCanSleepByDefault=!1,ft.surfaceEpsilon=.1,ft.sleepEpsilon=.07,ft.wakeThreshold=ft.sleepEpsilon*3,ft.sleepBias=.9,ft.checkForFastBodies=!0,ft.disableMinimumSpeedForFastBody=!1;var Hs;(function(c){c.None="none",c.VerticalFirst="vertical-first",c.HorizontalFirst="horizontal-first"})(Hs||(Hs={}));const Bd={vertical:1,horizontal:2},Md={horizontal:1,vertical:2},Ld={horizontal:0,vertical:0},Ri={enabled:!0,gravity:D(0,0),solver:hs.Arcade,colliders:{compositeStrategy:"together"},continuous:{checkForFastBodies:!0,disableMinimumSpeedForFastBody:!1,surfaceEpsilon:.1},bodies:{canSleepByDefault:!1,sleepEpsilon:.07,wakeThreshold:.07*3,sleepBias:.9,defaultMass:10},dynamicTree:{boundsPadding:5,velocityMultiplier:2},arcade:{contactSolveBias:Hs.None},realistic:{positionIterations:3,velocityIterations:8,slop:1,steeringFactor:.2,warmStart:!0}};function gh(){return{enabled:ft.enabled,gravity:ft.gravity,solver:ft.collisionResolutionStrategy,continuous:{checkForFastBodies:ft.checkForFastBodies,disableMinimumSpeedForFastBody:ft.disableMinimumSpeedForFastBody,surfaceEpsilon:ft.surfaceEpsilon},colliders:{compositeStrategy:"together"},bodies:{canSleepByDefault:ft.bodiesCanSleepByDefault,sleepEpsilon:ft.sleepEpsilon,wakeThreshold:ft.wakeThreshold,sleepBias:ft.sleepBias,defaultMass:ft.defaultMass},dynamicTree:{boundsPadding:ft.boundsPadding,velocityMultiplier:ft.dynamicTreeVelocityMultiplier},arcade:{contactSolveBias:Hs.None},realistic:{positionIterations:ft.positionIterations,velocityIterations:ft.velocityIterations,slop:ft.slop,steeringFactor:ft.steeringFactor,warmStart:ft.warmStart}}}class pe extends ls{set compositeStrategy(t){this._compositeStrategy=t}get compositeStrategy(){return this._compositeStrategy}constructor(t){super(),this._collisionProcessor=new Bo(Ri),this._dynamicAABBTree=new ph(Ri.dynamicTree),this._colliders=[];for(const i of t)this.addCollider(i)}clearColliders(){this._colliders=[]}addCollider(t){let i;t instanceof pe?(i=t.getColliders(),i.forEach(n=>n.offset.addEqual(t.offset))):i=[t];for(const n of i)n.events.pipe(this.events),n.composite=this,this._colliders.push(n),this._collisionProcessor.track(n),this._dynamicAABBTree.trackCollider(n)}removeCollider(t){t.events.pipe(this.events),t.composite=null,q(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,i;return((i=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&i!==void 0?i:C.Zero).add(this.offset)}get center(){var t,i;return((i=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&i!==void 0?i:C.Zero).add(this.offset)}get bounds(){var t,i;const n=this.getColliders();return n.reduce((l,d)=>l.combine(d.bounds),(i=(t=n[0])===null||t===void 0?void 0:t.bounds)!==null&&i!==void 0?i:new tt().translate(this.worldPos)).translate(this.offset)}get localBounds(){var t,i;const n=this.getColliders();return n.reduce((l,d)=>l.combine(d.localBounds),(i=(t=n[0])===null||t===void 0?void 0:t.localBounds)!==null&&i!==void 0?i:new tt)}get axes(){const t=this.getColliders();let i=[];for(const n of t)i=i.concat(n.axes);return i}getFurthestPoint(t){const i=this.getColliders(),n=[];for(const d of i)n.push(d.getFurthestPoint(t));let o=n[0],l=-Number.MAX_VALUE;for(const d of n){const f=d.dot(t);f>l&&(o=d,l=f)}return o}getInertia(t){const i=this.getColliders();let n=0;for(const o of i)n+=o.getInertia(t);return n}collide(t){let i=[t];t instanceof pe&&(i=t.getColliders());const n=[];for(const l of i)this._dynamicAABBTree.query(l,d=>(n.push(new ti(l,d)),!1));let o=[];for(const l of n)o=o.concat(l.collide());return o}getClosestLineBetween(t){const i=this.getColliders(),n=[];if(t instanceof pe){const o=t.getColliders();for(const l of i)for(const d of o){const f=l.getClosestLineBetween(d);f&&n.push(f)}}else for(const o of i){const l=t.getClosestLineBetween(o);l&&n.push(l)}if(n.length){let o=n[0].getLength(),l=n[0];for(const d of n){const f=d.getLength();f<o&&(o=f,l=d)}return l}return null}contains(t){const i=this.getColliders();for(const n of i)if(n.contains(t))return!0;return!1}rayCast(t,i){const n=this.getColliders(),o=[];for(const l of n){const d=l.rayCast(t,i);d&&o.push(d)}if(o.length){let l=o[0],d=l.point.dot(t.dir);for(const f of o){const g=t.dir.dot(f.point);g<d&&(l=f,d=g)}return l}return null}project(t){const i=this.getColliders(),n=[];for(const o of i){const l=o.project(t);l&&n.push(l)}if(n.length){const o=new gr(n[0].min,n[0].max);for(const l of n)o.min=Math.min(l.min,o.min),o.max=Math.max(l.max,o.max);return o}return null}update(t){if(t){const i=this.getColliders();for(const n of i)n.owner=this.owner,n.update(t)}}debug(t,i,n){const o=this.getColliders();t.save(),t.translate(this.offset.x,this.offset.y);for(const l of o)l.debug(t,i,n);t.restore()}clone(){const t=new pe(this._colliders.map(i=>i.clone()));return t.offset=this.offset.clone(),t}}class Ie{constructor(t,i){this.begin=t,this.end=i}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this._normal?this._normal:this._normal=this.end.sub(this.begin).normal()}dir(){return this._dir?this._dir:this._dir=this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){if(this._slope)return this._slope;const t=this.begin,i=this.end,n=t.distance(i);return this._slope=i.sub(t).scale(1/n)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){if(this._length)return this._length;const t=this.begin,i=this.end,n=t.distance(i);return this._length=n}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new Ie(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,i){let n=t;n=n.normalize();const o=n.dot(this.begin)-i,l=n.dot(this.end)-i,d=[];if(o<=0&&d.push(this.begin),l<=0&&d.push(this.end),o*l<0){const f=o/(o-l);d.push(this.begin.add(this.end.sub(this.begin).scale(f)))}return d.length!==2?null:new Ie(d[0],d[1])}distanceToPoint(t,i=!1){const n=t.x,o=t.y,l=this.getLength(),d=this.end.y-this.begin.y,f=this.end.x-this.begin.x,g=(d*n-f*o+this.end.x*this.begin.y-this.end.y*this.begin.x)/l;return i?g:Math.abs(g)}findVectorToPoint(t){const i=this.begin.sub(t),n=this.getSlope();return i.sub(n.scale(i.dot(n)))}findPoint(t=null,i=null){const n=this.slope,o=this.intercept;if(t!==null)return new C(t,n*t+o);if(i!==null)return new C((i-o)/n,i);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,i=0;if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")t=new C(arguments[0],arguments[1]),i=arguments[2]||0;else if(arguments[0]instanceof C)t=arguments[0],i=arguments[1]||0;else throw"Could not determine the arguments for Vector.hasPoint";const n=t.x-this.begin.x,o=t.y-this.begin.y,l=this.end.x-this.begin.x,d=this.end.y-this.begin.y,f=n*d-o*l;return Math.abs(f)>i?!1:Math.abs(l)>=Math.abs(d)?l>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:d>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y}}function zo(c,t,i,n){const o=c.sub(i),l=t.dot(t),d=t.dot(n),f=n.dot(n),g=t.dot(o),v=n.dot(o),w=l*f-d*d;let x=w,T=w;if(w===0||w<=.01){const O=g/d;return new Ie(c,i.add(n.scale(O)))}let k=d*v-f*g,B=l*v-d*g;return k<0?(k=0,B=v,T=f):k>x&&(k=x,B=v+d,T=f),B<0?(B=0,-g<0?k=0:-g>l?k=x:(k=-g,x=l)):B>T&&(B=T,-g+d<0?k=0:-g+d>l?k=x:(k=-g+d,x=l)),k=Math.abs(k)<.001?0:k/x,B=Math.abs(B)<.001?0:B/T,new Ie(c.add(t.scale(k)),i.add(n.scale(B)))}const Di={PolygonPolygonClosestLine(c,t){const i=t.worldPos,n=i.sub(c.worldPos),o=n.negate(),l=new Yi(c.worldPos,n),d=new Yi(i,o),f=c.rayCast(l).point.add(l.dir.scale(.1)),g=t.rayCast(d).point.add(d.dir.scale(.1)),v=c.getClosestFace(f),w=t.getClosestFace(g),x=v.face.begin,T=v.face.getEdge(),k=w.face.begin,B=w.face.getEdge();return zo(x,T,k,B)},PolygonEdgeClosestLine(c,t){const n=t.worldPos.sub(c.worldPos),o=new Yi(c.worldPos,n),l=c.rayCast(o).point.add(o.dir.scale(.1)),d=c.getClosestFace(l),f=d.face.begin,g=d.face.getEdge(),v=t.asLine(),w=v.begin,x=v.getEdge();return zo(f,g,w,x)},PolygonCircleClosestLine(c,t){const i=t.worldPos,n=i.sub(c.worldPos),o=new Yi(c.worldPos,n.normalize()),l=c.rayCast(o).point.add(o.dir.scale(.1)),d=c.getClosestFace(l),f=d.face.begin,g=d.face.getEdge();let v=(g.x*(i.x-f.x)+g.y*(i.y-f.y))/(g.x*g.x+g.y*g.y);v>1?v=1:v<0&&(v=0);const w=Math.sqrt(Math.pow(f.x+g.x*v-i.x,2)+Math.pow(f.y+g.y*v-i.y,2))-t.radius,x=(f.x+g.x*v-i.x)*t.radius/(t.radius+w),T=(f.y+g.y*v-i.y)*t.radius/(t.radius+w);return new Ie(g.scale(v).add(f),new C(i.x+x,i.y+T))},CircleCircleClosestLine(c,t){const n=t.worldPos.sub(c.worldPos),l=c.worldPos.sub(t.worldPos),d=new Yi(c.worldPos,n),f=new Yi(t.worldPos,l),g=c.rayCast(d),v=t.rayCast(f);return new Ie(g.point,v.point)},CircleEdgeClosestLine(c,t){const i=c.worldPos,n=t.asLine(),o=n.begin,l=n.getEdge(),d=o,f=l;let g=(f.x*(i.x-d.x)+f.y*(i.y-d.y))/(f.x*f.x+f.y*f.y);g>1?g=1:g<0&&(g=0);const v=Math.sqrt(Math.pow(d.x+f.x*g-i.x,2)+Math.pow(d.y+f.y*g-i.y,2))-c.radius,w=(d.x+f.x*g-i.x)*c.radius/(c.radius+v),x=(d.y+f.y*g-i.y)*c.radius/(c.radius+v);return new Ie(f.scale(g).add(d),new C(i.x+w,i.y+x))},EdgeEdgeClosestLine(c,t){const i=c.asLine(),n=i.begin,o=i.getEdge(),l=n,d=o,f=t.asLine(),g=f.begin,v=f.getEdge();return zo(l,d,g,v)}};class ge extends ls{get worldPos(){return this._globalMatrix.getPosition()}get radius(){var t;const i=this._transform,n=(t=i==null?void 0:i.globalScale)!==null&&t!==void 0?t:C.One;return this._naturalRadius*Math.min(n.x,n.y)}set radius(t){var i;const n=this._transform,o=(i=n==null?void 0:n.globalScale)!==null&&i!==void 0?i:C.One;this._naturalRadius=t/Math.min(o.x,o.y)}constructor(t){super(),this.offset=C.Zero,this._globalMatrix=gt.identity(),this.offset=t.offset||C.Zero,this.radius=t.radius||0,this._globalMatrix.translate(this.offset.x,this.offset.y)}clone(){return new ge({offset:this.offset.clone(),radius:this.radius})}get center(){return this._globalMatrix.getPosition()}contains(t){var i,n;return((n=(i=this._transform)===null||i===void 0?void 0:i.pos)!==null&&n!==void 0?n:this.offset).distance(t)<=this.radius}rayCast(t,i=1/0){var n,o;const l=this.center,d=t.dir,f=t.pos,g=Math.sqrt(Math.pow(d.dot(f.sub(l)),2)-Math.pow(f.sub(l).distance(),2)+Math.pow(this.radius,2));if(g<0)return null;{let v=0;if(g===0){if(v=-d.dot(f.sub(l)),v>0&&v<i){const w=t.getPoint(v);return{point:w,normal:w.sub(l).normalize(),collider:this,body:(n=this.owner)===null||n===void 0?void 0:n.get(dt),distance:v}}return null}else{const w=-d.dot(f.sub(l))+g,x=-d.dot(f.sub(l))-g,T=[];w>=0&&T.push(w),x>=0&&T.push(x);const k=Math.min(...T);if(k<=i){const B=t.getPoint(k);return{point:B,normal:B.sub(l).normalize(),collider:this,body:(o=this.owner)===null||o===void 0?void 0:o.get(dt),distance:k}}return null}}}getClosestLineBetween(t){if(t instanceof ge)return Di.CircleCircleClosestLine(this,t);if(t instanceof he)return Di.PolygonCircleClosestLine(t,this).flip();if(t instanceof Ne)return Di.CircleEdgeClosestLine(this,t).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof ge)return wi.CollideCircleCircle(this,t);if(t instanceof he)return wi.CollideCirclePolygon(this,t);if(t instanceof Ne)return wi.CollideCircleEdge(this,t);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){var t,i,n;const o=this._transform,l=(t=o==null?void 0:o.globalScale)!==null&&t!==void 0?t:C.One,d=(i=o==null?void 0:o.globalRotation)!==null&&i!==void 0?i:0,f=(n=o==null?void 0:o.globalPos)!==null&&n!==void 0?n:C.Zero;return new tt(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius).rotate(d).scale(l).translate(f)}get localBounds(){return new tt(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius)}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){var i;this._transform=t,((i=t.matrix)!==null&&i!==void 0?i:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const i=[],o=this.center.dot(t);return i.push(o),i.push(o+this.radius),i.push(o-this.radius),new gr(Math.min.apply(Math,i),Math.max.apply(Math,i))}debug(t,i,n){var o,l,d,f;const{lineWidth:g}={lineWidth:1,...n},v=this._transform,w=(o=v==null?void 0:v.globalScale)!==null&&o!==void 0?o:C.One,x=(l=v==null?void 0:v.globalRotation)!==null&&l!==void 0?l:0,T=(d=v==null?void 0:v.globalPos)!==null&&d!==void 0?d:C.Zero;t.save(),t.translate(T.x,T.y),t.rotate(x),t.scale(w.x,w.y),t.drawCircle((f=this.offset)!==null&&f!==void 0?f:C.Zero,this._naturalRadius,N.Transparent,i,g),t.restore()}}class Ws{constructor(t,i,n,o,l,d,f,g){var v,w,x,T,k,B;if(this._canceled=!1,this.colliderA=t,this.colliderB=i,this.mtv=n,this.normal=o,this.tangent=l,this.points=d,this.localPoints=f,this.info=g,this.id=ti.calculatePairHash(t.id,i.id),t.composite||i.composite){const O=((v=t.composite)===null||v===void 0?void 0:v.compositeStrategy)==="separate"?t.id:(x=(w=t.composite)===null||w===void 0?void 0:w.id)!==null&&x!==void 0?x:t.id,G=((T=i.composite)===null||T===void 0?void 0:T.compositeStrategy)==="separate"?i.id:(B=(k=i.composite)===null||k===void 0?void 0:k.id)!==null&&B!==void 0?B:i.id;this.id+="|"+ti.calculatePairHash(O,G)}}matchAwake(){const t=this.colliderA.owner.get(dt),i=this.colliderB.owner.get(dt);t&&i&&t.sleeping!==i.sleeping&&(t.sleeping&&t.collisionType!==pt.Fixed&&i.sleepMotion>=t.wakeThreshold&&t.setSleeping(!1),i.sleeping&&i.collisionType!==pt.Fixed&&t.sleepMotion>=i.wakeThreshold&&i.setSleeping(!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}}class mh{static findPolygonPolygonSeparation(t,i){let n=-Number.MAX_VALUE,o=null,l=null,d=-1,f=null;const g=t.getSides(),v=t.getLocalSides();for(let w=0;w<g.length;w++){const x=g[w],T=x.normal(),k=i.getFurthestPoint(T.negate()),B=x.distanceToPoint(k,!0);B>n&&(n=B,o=x,l=T,d=w,f=k)}return{collider:t,separation:l?n:99,axis:l,side:o,localSide:v[d],sideId:d,point:f,localPoint:l?i.getFurthestLocalPoint(l.negate()):null}}static findCirclePolygonSeparation(t,i){const n=i.axes,l=i.center.sub(t.worldPos),d=i.getFurthestPoint(l.negate());n.push(d.sub(t.worldPos).normalize());let f=Number.MAX_VALUE,g=null,v=-1;for(let w=0;w<n.length;w++){const x=i.project(n[w]),T=t.project(n[w]),k=x.getOverlap(T);if(k<=0)return null;k<f&&(f=k,g=n[w],v=w)}return v<0?null:g.normalize().scale(f)}}const wi={CollideCircleCircle(c,t){const i=c.worldPos,n=t.worldPos,o=c.radius+t.radius,l=i.distance(n);if(l>o)return[];const d=o-l,f=n.sub(i).normalize(),g=f.perpendicular(),v=f.scale(d),w=c.getFurthestPoint(f),x=c.getFurthestLocalPoint(f),T={collider:c,separation:d,axis:f,point:w};return[new Ws(c,t,v,f,g,[w],[x],T)]},CollideCirclePolygon(c,t){var i,n;let o=mh.findCirclePolygonSeparation(c,t);if(!o)return[];o=o.dot(t.center.sub(c.center))<0?o.negate():o;const d=c.getFurthestPoint(o),g=((n=(i=c.owner)===null||i===void 0?void 0:i.get(nt))!==null&&n!==void 0?n:new nt).applyInverse(d),v=o.normalize(),w={collider:c,separation:-o.size,axis:v,point:d,localPoint:g,side:t.findSide(v.negate()),localSide:t.findLocalSide(v.negate())};return[new Ws(c,t,o,v,v.perpendicular(),[d],[g],w)]},CollideCircleEdge(c,t){const i=c.center,n=t.asLine(),o=n.end.sub(n.begin),l=o.dot(n.end.sub(i)),d=o.dot(i.sub(n.begin)),f=t.asLine(),g=t.asLocalLine();if(d<=0){const L=n.begin.sub(i),z=L.dot(L);if(z>c.radius*c.radius)return[];const V=L.normalize(),H=c.radius-Math.sqrt(z),st={collider:c,separation:H,axis:V,point:f.begin,side:f,localSide:g};return[new Ws(c,t,V.scale(H),V,V.perpendicular(),[f.begin],[g.begin],st)]}if(l<=0){const L=n.end.sub(i),z=L.dot(L);if(z>c.radius*c.radius)return[];const V=L.normalize(),H=c.radius-Math.sqrt(z),st={collider:c,separation:H,axis:V,point:f.end,side:f,localSide:g};return[new Ws(c,t,V.scale(H),V,V.perpendicular(),[f.end],[g.end],st)]}const v=o.dot(o),w=n.begin.scale(l).add(n.end.scale(d)).scale(1/v),x=i.sub(w),T=x.dot(x);if(T>c.radius*c.radius)return[];let k=o.perpendicular();k.dot(i.sub(n.begin))<0&&(k.x=-k.x,k.y=-k.y),k=k.normalize();const B=c.radius-Math.sqrt(T),O=k.scale(B),G={collider:c,separation:B,axis:k,point:w,side:f,localSide:g};return[new Ws(c,t,O,k.negate(),k.negate().perpendicular(),[w],[w.sub(t.worldPos)],G)]},CollideEdgeEdge(){return[]},CollidePolygonEdge(c,t){var i;const n=c.center,l=t.center.sub(n).normalize(),d=new he({points:[t.begin,t.end,t.end.add(l.scale(100)),t.begin.add(l.scale(100))],offset:t.offset});d.owner=t.owner,((i=t.owner)===null||i===void 0?void 0:i.get(nt))&&d.update(t.owner.get(nt).get());const g=this.CollidePolygonPolygon(c,d);return g.length&&(g[0].colliderB=t,g[0].id=ti.calculatePairHash(c.id,t.id)),g},CollidePolygonPolygon(c,t){var i,n,o,l;const d=mh.findPolygonPolygonSeparation(c,t);if(d.separation>0)return[];const f=mh.findPolygonPolygonSeparation(t,c);if(f.separation>0)return[];const g=d.separation>f.separation?d:f,w=(g.collider===c?t:c).findSide(g.axis.negate()),x=g.side,T=x.dir().normalize(),k=w.clip(T.negate(),-T.dot(x.begin));let B=null;if(k&&(B=k.clip(T,T.dot(x.end))),B){const O=B.getPoints().filter(V=>x.below(V));let G=g.axis,L=G.perpendicular();t.center.sub(c.center).dot(G)<0&&(G=G.negate(),L=G.perpendicular());let z=[];if(g.collider===c){const V=(n=(i=t.owner)===null||i===void 0?void 0:i.get(nt))!==null&&n!==void 0?n:new nt;z=O.map(H=>V.applyInverse(H))}else{const V=(l=(o=c.owner)===null||o===void 0?void 0:o.get(nt))!==null&&l!==void 0?l:new nt;z=O.map(H=>V.applyInverse(H))}return[new Ws(c,t,G.scale(-g.separation),G,L,O,z,g)]}return[]},FindContactSeparation(c,t){var i,n,o,l;const d=c.colliderA,f=(n=(i=c.colliderA.owner)===null||i===void 0?void 0:i.get(nt))!==null&&n!==void 0?n:new nt,g=c.colliderB,v=(l=(o=c.colliderB.owner)===null||o===void 0?void 0:o.get(nt))!==null&&l!==void 0?l:new nt;if(d instanceof ge&&g instanceof ge){const w=d.radius+g.radius,x=f.pos.distance(v.pos);return-(w-x)}if(d instanceof he&&g instanceof he&&c.info.localSide){let w,x;return c.info.collider===d?(w=new Ie(f.apply(c.info.localSide.begin),f.apply(c.info.localSide.end)),x=v.apply(t)):(w=new Ie(v.apply(c.info.localSide.begin),v.apply(c.info.localSide.end)),x=f.apply(t)),w.distanceToPoint(x,!0)}if(d instanceof he&&g instanceof ge||g instanceof he&&d instanceof ge){const w=f.apply(t);if(c.info.side)return c.info.side.distanceToPoint(w,!0)}if(d instanceof Ne&&g instanceof he||g instanceof Ne&&d instanceof he){let w;if(c.info.collider===d?w=v.apply(t):w=f.apply(t),c.info.side)return c.info.side.distanceToPoint(w,!0)}if(d instanceof ge&&g instanceof Ne||g instanceof ge&&d instanceof Ne){const w=v.apply(t);let x;d instanceof ge&&(x=d.getFurthestPoint(c.normal));const T=w.distance(x);if(c.info.side)return T>0?-T:0}return 0}};class Ne extends ls{constructor(t){var i;super(),this._globalMatrix=gt.identity(),this.begin=t.begin||C.Zero,this.end=t.end||C.Zero,this.offset=(i=t.offset)!==null&&i!==void 0?i:C.Zero}clone(){return new Ne({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;const i=this._transform;return(t=i==null?void 0:i.globalPos.add(this.offset))!==null&&t!==void 0?t:this.offset}get center(){const t=this._getTransformedBegin(),i=this._getTransformedEnd();return t.average(i)}_getTransformedBegin(){return this._globalMatrix.multiply(this.begin)}_getTransformedEnd(){return this._globalMatrix.multiply(this.end)}getSlope(){const t=this._getTransformedBegin(),i=this._getTransformedEnd(),n=t.distance(i);return i.sub(t).scale(1/n)}getLength(){const t=this._getTransformedBegin(),i=this._getTransformedEnd();return t.distance(i)}contains(){return!1}rayCast(t,i=1/0){var n;const o=this._getTransformedBegin().sub(t.pos);if(t.dir.cross(this.getSlope())===0&&o.cross(t.dir)!==0)return null;const l=t.dir.cross(this.getSlope());if(l===0)return null;const d=o.cross(this.getSlope())/l;if(d>=0&&d<=i){const f=o.cross(t.dir)/l/this.getLength();if(f>=0&&f<=1)return{distance:d,normal:this.asLine().normal(),collider:this,body:(n=this.owner)===null||n===void 0?void 0:n.get(dt),point:t.getPoint(d)}}return null}getClosestLineBetween(t){if(t instanceof ge)return Di.CircleEdgeClosestLine(t,this);if(t instanceof he)return Di.PolygonEdgeClosestLine(t,this).flip();if(t instanceof Ne)return Di.EdgeEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof ge)return wi.CollideCircleEdge(t,this);if(t instanceof he)return wi.CollidePolygonEdge(t,this);if(t instanceof Ne)return wi.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const i=this._getTransformedBegin(),n=this._getTransformedEnd();return t.dot(i)>0?i:n}_boundsFromBeginEnd(t,i,n=10){return new tt(Math.min(t.x,i.x)-n,Math.min(t.y,i.y)-n,Math.max(t.x,i.x)+n,Math.max(t.y,i.y)+n)}get bounds(){const t=this._getTransformedBegin(),i=this._getTransformedEnd();return this._boundsFromBeginEnd(t,i)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new Ie(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new Ie(this.begin,this.end)}get axes(){const i=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),n=[];return n.push(i),n.push(i.negate()),n.push(i.normal()),n.push(i.normal().negate()),n}getInertia(t){const i=this.end.sub(this.begin).distance()/2;return t*i*i}update(t){var i;this._transform=t,((i=t.matrix)!==null&&i!==void 0?i:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const i=[],n=[this._getTransformedBegin(),this._getTransformedEnd()],o=n.length;for(let l=0;l<o;l++)i.push(n[l].dot(t));return new gr(Math.min.apply(Math,i),Math.max.apply(Math,i))}debug(t,i){const n=this._getTransformedBegin(),o=this._getTransformedEnd();t.drawLine(n,o,i,2),t.drawCircle(n,2,i),t.drawCircle(o,2,i)}}class re{static registerGraphicsContext(t){re._ctx=t}static draw(t){this._drawCalls.push(t)}static drawPoint(t,i){re.draw(n=>{n.debug.drawPoint(t,i)})}static drawLine(t,i,n){re.draw(o=>{o.debug.drawLine(t,i,n)})}static drawLines(t,i){t.length>1&&re.draw(n=>{for(let o=0;o<t.length-1;o++)n.debug.drawLine(t[o],t[o+1],i)})}static drawText(t,i){re.draw(n=>{n.debug.drawText(t,i)})}static drawPolygon(t,i){t.length>1&&re.draw(n=>{const o=t[0],l=[...t,o];for(let d=0;d<l.length-1;d++)n.debug.drawLine(l[d],l[d+1],i)})}static drawCircle(t,i,n){const{color:o,strokeColor:l,width:d}={color:N.Black,strokeColor:void 0,width:void 0,...n};re.draw(f=>{f.drawCircle(t,i,o,l,d)})}static drawBounds(t,i){re.draw(n=>{n.debug.drawRect(t.left,t.top,t.width,t.height,i)})}static drawRay(t,i){const{distance:n,color:o}={color:N.Blue,distance:10,...i};re.draw(l=>{const d=t.pos,f=t.pos.add(t.dir.scale(n));l.debug.drawLine(d,f,{color:o})})}static flush(t){t.save(),t.z=re.z;for(const i of re._drawCalls)i(t);t.restore(),re.clear()}static clear(){re._drawCalls.length=0}}re._drawCalls=[],re.z=1/0;class he extends ls{flagDirty(){this._localBoundsDirty=!0,this._localSidesDirty=!0,this._transformedPointsDirty=!0,this._sidesDirty=!0}set points(t){this._points=t,this.flagDirty()}get points(){return this._points}constructor(t){var i,n;super(),this._logger=K.getInstance(),this._transformedPoints=[],this._sides=[],this._localSides=[],this._globalMatrix=gt.identity(),this._transformedPointsDirty=!0,this._sidesDirty=!0,this._localSidesDirty=!0,this._localBoundsDirty=!0,this.offset=(i=t.offset)!==null&&i!==void 0?i:C.Zero,this._globalMatrix.translate(this.offset.x,this.offset.y),this.points=(n=t.points)!==null&&n!==void 0?n:[],this._isCounterClockwiseWinding(this.points)||this.points.reverse(),this.isConvex()||t.suppressConvexWarning||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}_isCounterClockwiseWinding(t){let i=0;for(let n=0;n<t.length;n++)i+=(t[(n+1)%t.length].x-t[n].x)*(t[(n+1)%t.length].y+t[n].y);return i<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],i=this.points[this.points.length-1],n=Math.atan2(i.y-t.y,i.x-t.x),o=0,l=0,d=0;for(const[f,g]of this.points.entries()){if(t=i,o=n,i=g,n=Math.atan2(i.y-t.y,i.x-t.x),t.equals(i))return!1;let v=n-o;if(v<=-Math.PI?v+=Math.PI*2:v>Math.PI&&(v-=Math.PI*2),f===0){if(v===0)return!1;l=v>0?1:-1}else if(l*v<=0)return!1;d+=v}return Math.abs(Math.round(d/(Math.PI*2)))===1}tessellate(){const t=[];for(let i=1;i<this.points.length-2;i++)t.push([this.points[0],this.points[i+1],this.points[i+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new pe(t.map(i=>me.Polygon(i)))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");const t=[],i=[...this.points].reverse();let n=i.length;function o(x){return x===0?n-1:x-1}function l(x){return x===n-1?0:x+1}function d(x){const T=o(x),k=l(x),B=i[T],O=i[x],G=i[k],L=B.sub(O),z=G.sub(O);return!(L.cross(z)<0)}const f=i.map((x,T)=>d(T));function g(x,T,k,B){const O=k.sub(T),G=B.sub(k),L=T.sub(B),z=x.sub(T),V=x.sub(k),H=x.sub(B),st=O.cross(z),mt=G.cross(V),X=L.cross(H);return!(st>0||mt>0||X>0)}function v(){for(let x=0;x<n;x++)if(f[x]){const T=o(x),k=l(x),B=i[T],O=i[x],G=i[k];let L=!0;for(let z=0;z<n;z++){if(z===x||z===T||z===k)continue;const V=i[z];if(g(V,B,O,G)){L=!1;break}}if(L)return x}for(let x=0;x<n;x++)if(f[x])return x;return 0}function w(x){const T=o(x),k=l(x),B=i[T],O=i[x],G=i[k];t.push([B,O,G]),i.splice(x,1),f.splice(x,1),n--}for(;n>3;){const x=v();w(x);for(let T=0;T<n;T++)f[T]=d(T)}return t.push([i[0],i[1],i[2]]),new pe(t.map(x=>me.Polygon(x,C.Zero,!0)))}clone(){return new he({offset:this.offset.clone(),points:this.points.map(t=>t.clone())})}get worldPos(){return this._transform?this._transform.pos.add(this.offset):this.offset}get center(){return this.bounds.center}_calculateTransformation(){const t=this.points,i=t.length;this._transformedPoints.length=0;for(let n=0;n<i;n++)this._transformedPoints[n]=this._globalMatrix.multiply(t[n].clone())}getTransformedPoints(){return this._transformedPointsDirty&&(this._calculateTransformation(),this._transformedPointsDirty=!1),this._transformedPoints}getSides(){if(this._sidesDirty){const t=[],i=this.getTransformedPoints(),n=i.length;for(let o=0;o<n;o++)t.push(new Ie(i[o],i[(o+1)%n]));this._sides=t,this._sidesDirty=!1}return this._sides}getLocalSides(){if(this._localSidesDirty){const t=[],i=this.points,n=i.length;for(let o=0;o<n;o++)t.push(new Ie(i[o],i[(o+1)%n]));this._localSides=t,this._localSidesDirty=!1}return this._localSides}findSide(t){const i=this.getSides();let n=i[0],o=-Number.MAX_VALUE;for(let l=0;l<i.length;l++){const d=i[l],g=d.normal().dot(t);g>o&&(n=d,o=g)}return n}findLocalSide(t){const i=this.getLocalSides();let n=i[0],o=-Number.MAX_VALUE;for(let l=0;l<i.length;l++){const d=i[l],g=d.normal().dot(t);g>o&&(n=d,o=g)}return n}get axes(){const t=[],i=this.getSides();for(let n=0;n<i.length;n++)t.push(i[n].normal());return t}update(t){var i;t&&(this._transform=t,this._transformedPointsDirty=!0,this._sidesDirty=!0,((i=t.matrix)!==null&&i!==void 0?i:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y))}contains(t){const i=new Yi(t,new C(1,0));return this.getSides().reduce(function(o,l){return i.intersect(l)>=0?o+1:o},0)%2!==0}getClosestLineBetween(t){if(t instanceof ge)return Di.PolygonCircleClosestLine(this,t);if(t instanceof he)return Di.PolygonPolygonClosestLine(this,t);if(t instanceof Ne)return Di.PolygonEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof ge)return wi.CollideCirclePolygon(t,this);if(t instanceof he)return wi.CollidePolygonPolygon(this,t);if(t instanceof Ne)return wi.CollidePolygonEdge(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const i=this.getTransformedPoints();let n=null,o=-Number.MAX_VALUE;for(let l=0;l<i.length;l++){const d=t.dot(i[l]);d>o&&(o=d,n=i[l])}return n}getFurthestLocalPoint(t){const i=this.points;let n=i[0],o=-Number.MAX_VALUE;for(let l=0;l<i.length;l++){const d=t.dot(i[l]);d>o&&(o=d,n=i[l])}return n}getClosestFace(t){const i=this.getSides();let n=Number.POSITIVE_INFINITY,o=-1,l=-1;for(let d=0;d<i.length;d++){const f=i[d].distanceToPoint(t);f<n&&(n=f,o=d,l=f)}return o!==-1?{distance:i[o].normal().scale(l),face:i[o]}:null}get bounds(){return this.localBounds.transform(this._globalMatrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=tt.fromPoints(this.points),this._localBoundsDirty=!1),this._localBounds}getInertia(t){if(this._cachedMass===t&&this._cachedInertia)return this._cachedInertia;let i=0,n=0;const o=this.points;for(let l=0;l<o.length;l++){const d=(l+1)%o.length,f=o[d].cross(o[l]);i+=f*(o[l].dot(o[l])+o[l].dot(o[d])+o[d].dot(o[d])),n+=f}return this._cachedMass=t,this._cachedInertia=t/6*(i/n)}rayCast(t,i=1/0){var n;const o=this.getSides(),l=o.length;let d=Number.MAX_VALUE,f,g=-1;for(let v=0;v<l;v++){const w=t.intersect(o[v]);w>=0&&w<d&&w<=i&&(d=w,f=o[v],g=v)}return g>=0?{collider:this,distance:d,body:(n=this.owner)===null||n===void 0?void 0:n.get(dt),point:t.getPoint(d),normal:f.normal()}:null}project(t){const i=this.getTransformedPoints(),n=i.length;let o=Number.MAX_VALUE,l=-Number.MAX_VALUE;for(let d=0;d<n;d++){const f=i[d].dot(t);o=Math.min(o,f),l=Math.max(l,f)}return new gr(o,l)}debug(t,i,n){const o=this.getTransformedPoints();re.drawPolygon(o,{color:i})}}class me{static Box(t,i,n=C.Half,o=C.Zero){return new he({points:new tt(-t*n.x,-i*n.y,t-t*n.x,i-i*n.y).getPoints(),offset:o})}static Polygon(t,i=C.Zero,n=!1){return new he({points:t,offset:i,suppressConvexWarning:n})}static Circle(t,i=C.Zero){return new ge({radius:t,offset:i})}static Edge(t,i){return new Ne({begin:t,end:i})}static Capsule(t,i,n=C.Zero){const o=K.getInstance();return t===i&&o.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),i>=t?new pe([me.Circle(t/2,D(0,-i/2+t/2).add(n)),me.Box(t,i-t,C.Half,n),me.Circle(t/2,D(0,i/2-t/2).add(n))]):new pe([me.Circle(i/2,D(-t/2+i/2,0).add(n)),me.Box(t-i,i,C.Half,n),me.Circle(i/2,D(t/2-i/2,0).add(n))])}}class Yt extends yi{constructor(t){super(),this.events=new y,this.$colliderAdded=new be,this.$colliderRemoved=new be,this._collidersToRemove=[],this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,t.events.pipe(this.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this._collidersToRemove.push(this._collider),this._collider=null)}processColliderRemoval(){for(const t of this._collidersToRemove)t.events.unpipe(this.events),this.$colliderRemoved.notifyAll(t),t.owner=null}clone(){return new Yt(this._collider.clone())}get bounds(){var t,i;return(i=(t=this._collider)===null||t===void 0?void 0:t.bounds)!==null&&i!==void 0?i:new tt}get localBounds(){var t,i;return(i=(t=this._collider)===null||t===void 0?void 0:t.localBounds)!==null&&i!==void 0?i:new tt}update(){var t;const i=(t=this.owner)===null||t===void 0?void 0:t.get(nt);this._collider&&(this._collider.owner=this.owner,i&&this._collider.update(i.get()))}collide(t){let i=this._collider,n=t._collider;if(!i||!n)return[];let o=!1;if(n instanceof pe&&(i=n,n=this._collider,o=!0),this._collider){const l=i.collide(n);return l?(o&&l.forEach(d=>{d.mtv=d.mtv.negate(),d.normal=d.normal.negate(),d.tangent=d.normal.perpendicular(),d.colliderA=this._collider,d.colliderB=t._collider}),l):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",i=>{const n=i;t.events.emit("precollision",new Ms(n.target.owner,n.other.owner,n.side,n.intersection,n.contact)),t instanceof He&&t.onPreCollisionResolve(n.target,n.other,n.side,n.contact)}),this.events.on("postcollision",i=>{const n=i;t.events.emit("postcollision",new Ls(n.target.owner,n.other.owner,n.side,n.intersection,n.contact)),t instanceof He&&t.onPostCollisionResolve(n.target,n.other,n.side,n.contact)}),this.events.on("collisionstart",i=>{const n=i;t.events.emit("collisionstart",new dr(n.target.owner,n.other.owner,n.side,n.contact)),t instanceof He&&t.onCollisionStart(n.target,n.other,n.side,n.contact)}),this.events.on("collisionend",i=>{const n=i;t.events.emit("collisionend",new fr(n.target.owner,n.other.owner,n.side,n.lastContact)),t instanceof He&&t.onCollisionEnd(n.target,n.other,n.side,n.lastContact)})}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,i,n=C.Half,o=C.Zero){const l=me.Box(t,i,n,o);return this.set(l)}usePolygonCollider(t,i=C.Zero){const n=me.Polygon(t,i);return this.set(n)}useCircleCollider(t,i=C.Zero){const n=me.Circle(t,i);return this.set(n)}useEdgeCollider(t,i){const n=me.Edge(t,i);return this.set(n)}useCompositeCollider(t){return this.set(new pe(t))}}var Re;(function(c){c.Rotation="rotation",c.X="x",c.Y="y"})(Re||(Re={}));class dt extends yi{constructor(t){var i,n,o;super(),this.dependencies=[nt,Ht],this.id=m("body",dt._ID++),this.events=new y,this.oldTransform=new Us,this.__oldTransformCaptured=!1,this.enableFixedUpdateInterpolate=!0,this.collisionType=pt.PreventCollision,this.group=Ns.All,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this.oldVel=new C(0,0),this.oldAcc=C.Zero,t?(this.collisionType=(i=t.type)!==null&&i!==void 0?i:this.collisionType,this.group=(n=t.group)!==null&&n!==void 0?n:this.group,this.useGravity=(o=t.useGravity)!==null&&o!==void 0?o:this.useGravity,this._bodyConfig={...Ri.bodies,...t.config}):this._bodyConfig={...Ri.bodies},this.updatePhysicsConfig(this._bodyConfig),this._mass=dt._DEFAULT_CONFIG.defaultMass}get matrix(){return this.transform.get().matrix}updatePhysicsConfig(t){this._bodyConfig={...Ri.bodies,...t},this.canSleep=this._bodyConfig.canSleepByDefault,this.sleepMotion=this._bodyConfig.sleepEpsilon*5,this.wakeThreshold=this._bodyConfig.wakeThreshold}static updateDefaultPhysicsConfig(t){dt._DEFAULT_CONFIG=t}get mass(){return this._mass}set mass(t){this._mass=t,this._cachedInertia=void 0,this._cachedInverseInertia=void 0}get inverseMass(){return this.collisionType===pt.Fixed?0:1/this.mass}get sleeping(){return this._sleeping}setSleeping(t){this._sleeping=t,t?(this.vel=C.Zero,this.acc=C.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=this._bodyConfig.sleepEpsilon*5}updateMotion(){this._sleeping&&this.setSleeping(!0);const t=this.vel.size*this.vel.size+Math.abs(this.angularVelocity*this.angularVelocity),i=this._bodyConfig.sleepBias;this.sleepMotion=i*this.sleepMotion+(1-i)*t,this.sleepMotion=$(this.sleepMotion,0,10*this._bodyConfig.sleepEpsilon),this.canSleep&&this.sleepMotion<this._bodyConfig.sleepEpsilon&&this.setSleeping(!0)}get inertia(){if(this._cachedInertia)return this._cachedInertia;const t=this.owner.get(Yt);if(t){t.$colliderAdded.subscribe(()=>{this._cachedInertia=null}),t.$colliderRemoved.subscribe(()=>{this._cachedInertia=null});const i=t.get();if(i)return this._cachedInertia=i.getInertia(this.mass)}return 0}get inverseInertia(){return this._cachedInverseInertia?this._cachedInverseInertia:this._cachedInverseInertia=this.collisionType===pt.Fixed?0:1/this.inertia}get active(){var t;return!!(!((t=this.owner)===null||t===void 0)&&t.active)}get center(){return this.globalPos}get transform(){var t;return(t=this.owner)===null||t===void 0?void 0:t.get(nt)}get motion(){var t;return(t=this.owner)===null||t===void 0?void 0:t.get(Ht)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get globalPos(){return this.transform.globalPos}set globalPos(t){this.transform.globalPos=t}get oldPos(){return this.oldTransform.pos}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get oldRotation(){return this.oldTransform.rotation}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get oldScale(){return this.oldTransform.scale}get scaleFactor(){return this.motion.scaleFactor}set scaleFactor(t){this.motion.scaleFactor=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,i){if(this.collisionType!==pt.Active)return;const n=i.scale(this.inverseMass);if(this.limitDegreeOfFreedom.includes(Re.X)&&(n.x=0),this.limitDegreeOfFreedom.includes(Re.Y)&&(n.y=0),this.vel.addEqual(n),!this.limitDegreeOfFreedom.includes(Re.Rotation)){const o=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*o.cross(i)}}applyLinearImpulse(t){if(this.collisionType!==pt.Active)return;const i=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes(Re.X)&&(i.x=0),this.limitDegreeOfFreedom.includes(Re.Y)&&(i.y=0),this.vel=this.vel.add(i)}applyAngularImpulse(t,i){if(this.collisionType===pt.Active&&!this.limitDegreeOfFreedom.includes(Re.Rotation)){const n=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*n.cross(i)}}captureOldTransform(){this.__oldTransformCaptured=!0;const t=this.transform.get();t.clone(this.oldTransform),this.oldTransform.parent=t.parent,this.oldVel.setTo(this.vel.x,this.vel.y),this.oldAcc.setTo(this.acc.x,this.acc.y)}clone(){return super.clone()}}dt._ID=0,dt._DEFAULT_CONFIG={...Ri.bodies};class Qv{constructor(t){this.data=t,this.type="Component Added"}}function Zv(c){return!!c&&c.type==="Component Added"}class qv{constructor(t){this.data=t,this.type="Component Removed"}}function Kv(c){return!!c&&c.type==="Component Removed"}const Jv={Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate",Kill:"kill"};class _e{constructor(t,i){this.id=_e._ID++,this.name=`Entity#${this.id}`,this.events=new y,this._tags=new Set,this.componentAdded$=new be,this.componentRemoved$=new be,this.tagAdded$=new be,this.tagRemoved$=new be,this.components=new Map,this._componentsToRemove=[],this._instanceOfComponentCacheDirty=!0,this._instanceOfComponentCache=new Map,this.scene=null,this.active=!0,this._parent=null,this.childrenAdded$=new be,this.childrenRemoved$=new be,this._children=[],this._isInitialized=!1;let n,o;if(Array.isArray(t))n=t,o=i;else if(t&&typeof t=="object"){const{components:l,name:d}=t;n=l??[],o=d}if(o&&(this.name=o),n)for(const l of n)this.addComponent(l)}kill(){this.active&&(this.active=!1,this.unparent()),this.emit("kill",new Po(this))}isKilled(){return!this.active}get tags(){return this._tags}hasTag(t){return this._tags.has(t)}addTag(t){return this._tags.add(t),this.tagAdded$.notifyAll(t),this}removeTag(t){return this._tags.delete(t),this.tagRemoved$.notifyAll(t),this}get types(){return Array.from(this.components.keys())}getComponents(){return Array.from(this.components.values())}hasAll(t){for(let i=0;i<t.length;i++)if(!this.components.has(t[i]))return!1;return!0}hasAllTags(t){for(let i=0;i<t.length;i++)if(!this.tags.has(t[i]))return!1;return!0}_getCachedInstanceOfType(t){if(this._instanceOfComponentCacheDirty&&(this._instanceOfComponentCacheDirty=!1,this._instanceOfComponentCache.clear()),this._instanceOfComponentCache.has(t))return this._instanceOfComponentCache.get(t);for(const i of this.components.values())if(i instanceof t)return this._instanceOfComponentCache.set(t,i),i}get(t){const i=this._getCachedInstanceOfType(t);return i??this.components.get(t)}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(t.parent===null){if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t)}else throw new Error("Entity already has a parent, cannot add without unparenting");return this}removeChild(t){return t.parent===this&&(q(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}getAncestors(){const t=[this];let i=this.parent;for(;i;)t.push(i),i=i.parent;return t.reverse()}getDescendants(){let t=[this],i=[this];for(;i.length>0;){const n=i.pop();n&&(i=i.concat(n.children),t=t.concat(n.children))}return t}clone(){const t=new _e;for(const i of this.types){const n=this.get(i);n&&t.addComponent(n.clone())}for(const i of this.children)t.addChild(i.clone());return t}addTemplate(t,i=!1){for(const n of t.getComponents())this.addComponent(n.clone(),i);for(const n of t.children)this.addChild(n.clone().addTemplate(n));return this}addComponent(t,i=!1){if(this._instanceOfComponentCacheDirty=!0,this.has(t.constructor))if(i)this.removeComponent(t.constructor,!0);else return this;if(t.dependencies&&t.dependencies.length)for(const n of t.dependencies)this.addComponent(new n);return t.owner=this,this.components.set(t.constructor,t),t.onAdd&&t.onAdd(this),this.componentAdded$.notifyAll(t),this}removeComponent(t,i=!1){let n;if(Fd(t)?n=t:n=t.constructor,i){const o=this.components.get(n);o&&(this.componentRemoved$.notifyAll(o),o.owner=void 0,o.onRemove&&o.onRemove(this)),this.components.delete(n),this._instanceOfComponentCacheDirty=!0}else this._componentsToRemove.push(n);return this}clearComponents(){const t=this.types;for(const i of t)this.removeComponent(i)}processComponentRemoval(){for(const t of this._componentsToRemove)this.removeComponent(t,!0);this._componentsToRemove.length=0}has(t){return this.components.has(t)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),this.events.emit("initialize",new vn(t,this)),this._isInitialized=!0)}_preupdate(t,i){this.events.emit("preupdate",new os(t,i,this)),this.onPreUpdate(t,i)}_postupdate(t,i){this.events.emit("postupdate",new as(t,i,this)),this.onPostUpdate(t,i)}onInitialize(t){}onPreUpdate(t,i){}onPostUpdate(t,i){}update(t,i){this._initialize(t),this._preupdate(t,i);for(const n of this.children)n.update(t,i);this._postupdate(t,i)}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){i?this.events.off(t,i):this.events.off(t)}}_e._ID=0;var mr;(function(c){c.Forward="forward",c.Backward="backward"})(mr||(mr={}));var xi;(function(c){c.End="end",c.Loop="loop",c.PingPong="pingpong",c.Freeze="freeze"})(xi||(xi={}));const t0={Frame:"frame",Loop:"loop",End:"end"};class ki extends Lt{constructor(t){var i,n,o;super(t),this.events=new y,this.frames=[],this.strategy=xi.Loop,this.frameDuration=100,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._pingPongDirection=1,this._done=!1,this._playing=!0,this._speed=1,this._reversed=!1,this.frames=t.frames,this.speed=(i=t.speed)!==null&&i!==void 0?i:this.speed,this.strategy=(n=t.strategy)!==null&&n!==void 0?n:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:(o=t.frameDuration)!==null&&o!==void 0?o:this.frameDuration,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){return new ki({frames:this.frames.map(t=>({...t})),frameDuration:this.frameDuration,speed:this.speed,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const t=this.currentFrame;return t?Math.abs(t.graphic.width*this.scale.x):0}get height(){const t=this.currentFrame;return t?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,i,n,o=xi.Loop){const l=t.sprites.length-1,d=i.filter(f=>f<0||f>l);return d.length&&ki._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${d.join(",")} no frame will be shown`),new ki({frames:t.sprites.filter((f,g)=>i.indexOf(g)>-1).map(f=>({graphic:f,duration:n})),strategy:o})}static fromSpriteSheetCoordinates(t){const{spriteSheet:i,frameCoordinates:n,durationPerFrameMs:o,speed:l,strategy:d,reverse:f}=t,g=o??100,v=[];for(const w of n){const{x,y:T,duration:k,options:B}=w,O=i.getSprite(x,T,B);O?v.push({graphic:O,duration:k??g}):ki._LOGGER.warn(`Skipping frame! SpriteSheet does not have coordinate (${x}, ${T}), please check your SpriteSheet to confirm that sprite exists`)}return new ki({frames:v,strategy:d,speed:l,reverse:f})}get speed(){return this._speed}set speed(t){this._speed=$(Math.abs(t),0,1/0)}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get currentFrameTimeLeft(){return this._timeLeftInFrame}get isPlaying(){return this._playing}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return!!(this._reversed&&this._pingPongDirection===1)?mr.Backward:mr.Forward}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=this.frameDuration;const t=this.frames[this._currentFrame];t&&(this._timeLeftInFrame=(t==null?void 0:t.duration)||this.frameDuration)}get canFinish(){switch(this.strategy){case xi.End:case xi.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(t,i){this._currentFrame=t,this._timeLeftInFrame=i??this.frameDuration;const n=this.frames[this._currentFrame];n&&!this._done&&(this._timeLeftInFrame=i??((n==null?void 0:n.duration)||this.frameDuration),this.events.emit("frame",{...n,frameIndex:this.currentFrameIndex}))}_nextFrame(){const t=this._currentFrame;if(this._done)return t;let i=-1;switch(this.strategy){case xi.Loop:{i=(t+1)%this.frames.length,i===0&&this.events.emit("loop",this);break}case xi.End:{i=t+1,i>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break}case xi.Freeze:{i=$(t+1,0,this.frames.length-1),i>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break}case xi.PingPong:{t+this._pingPongDirection>=this.frames.length&&(this._pingPongDirection=-1,this.events.emit("loop",this)),t+this._pingPongDirection<0&&(this._pingPongDirection=1,this.events.emit("loop",this)),i=t+this._pingPongDirection%this.frames.length;break}}return i}tick(t,i=0){this._idempotencyToken!==i&&(this._idempotencyToken=i,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",{...this.currentFrame,frameIndex:this.currentFrameIndex})),this._timeLeftInFrame-=t*this._speed,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,i,n){this.currentFrame&&this.currentFrame.graphic.draw(t,i,n)}}ki._LOGGER=K.getInstance();class yn extends Lt{constructor(t){var i;super(t),this._logger=K.getInstance(),this.useAnchor=!0,this.members=[],this.members=t.members,this.useAnchor=(i=t.useAnchor)!==null&&i!==void 0?i:this.useAnchor,this._updateDimensions()}clone(){return new yn({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){const t=this.localBounds;return this.width=t.width,this.height=t.height,t}get localBounds(){let t=new tt;for(const i of this.members)if(i instanceof Lt)t=i.localBounds.combine(t);else{const{graphic:n,offset:o,useBounds:l}=i;n?(l===void 0?!0:l)&&(t=n.localBounds.translate(o).combine(t)):this._logger.warnOnce(`Graphics group member has an null or undefined graphic, member definition: ${JSON.stringify(i)}.`)}return t}_isAnimationOrGroup(t){return t instanceof ki||t instanceof yn}tick(t,i){for(const n of this.members){let o;n instanceof Lt?o=n:o=n.graphic,this._isAnimationOrGroup(o)&&o.tick(t,i)}}reset(){for(const t of this.members){let i;t instanceof Lt?i=t:i=t.graphic,this._isAnimationOrGroup(i)&&i.reset()}}_preDraw(t,i,n){this._updateDimensions(),super._preDraw(t,this.useAnchor?i:0,this.useAnchor?n:0)}_drawImage(t,i,n){const o=C.Zero;for(const l of this.members){let d;l instanceof Lt?d=l:(d=l.graphic,l.offset.clone(o)),d&&(t.save(),t.translate(i,n),d.draw(t,o.x,o.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore())}}}function _h(c){return!!c.tick}class oe extends yi{get offset(){return new Fo(this._offset,()=>{this.recalculateBounds()})}set offset(t){this._offset=t,this.recalculateBounds()}get anchor(){return new Fo(this._anchor,()=>{this.recalculateBounds()})}set anchor(t){this._anchor=t,this.recalculateBounds()}constructor(t){super(),this._logger=K.getInstance(),this._current="default",this._graphics={},this._options={},this.material=null,this.visible=!0,this.opacity=1,this._offset=C.Zero,this._anchor=C.Half,this.flipHorizontal=!1,this.flipVertical=!1,this.copyGraphics=!1,this._localBounds=null,t={visible:this.visible,graphics:{},...t};const{current:i,anchor:n,opacity:o,visible:l,graphics:d,offset:f,copyGraphics:g,onPreDraw:v,onPostDraw:w,onPreTransformDraw:x,onPostTransformDraw:T}=t;for(const[k,B]of Object.entries(d))B instanceof Lt?this._graphics[k]=B:(this._graphics[k]=B.graphic,this._options[k]=B.options);this.offset=f??this.offset,this.opacity=o??this.opacity,this.anchor=n??this.anchor,this.copyGraphics=g??this.copyGraphics,this.onPreDraw=v??this.onPreDraw,this.onPostDraw=w??this.onPostDraw,this.onPreDraw=x??this.onPreTransformDraw,this.onPostTransformDraw=T??this.onPostTransformDraw,this.visible=!!l,this._current=i??this._current,i&&this._graphics[i]&&this.use(i)}getGraphic(t){return this._graphics[t]}getOptions(t){return this._options[t]}getNames(){return Object.keys(this._graphics)}get current(){return this._graphics[this._current]}get currentOptions(){return this._options[this._current]}get graphics(){return this._graphics}get options(){return this._options}add(t,i,n){let o="default",l=null,d;return typeof t=="string"&&i instanceof Lt&&(o=t,l=i,d=n),t instanceof Lt&&!(i instanceof Lt)&&(l=t,d=i),this._graphics[o]=this.copyGraphics?l.clone():l,this._options[o]=this.copyGraphics?{...d}:d,o==="default"&&this.use("default"),l}remove(t){delete this._graphics[t],delete this._options[t],this._current===t&&(this._current="default",this.recalculateBounds())}show(t,i){return this.use(t,i)}use(t,i){var n;if(t instanceof Lt){let o=t;this.copyGraphics&&(o=t.clone()),this._current="default",this._graphics[this._current]=o,this._options[this._current]=i}else this._current=t,this._options[this._current]=i,this._current in this._graphics||this._logger.warn(`Graphic ${this._current} is not registered with the graphics component owned by ${(n=this.owner)===null||n===void 0?void 0:n.name}. Nothing will be drawn.`);return this.recalculateBounds(),this.current}hide(){this._current="ex.none"}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new tt;const i=this._graphics[this._current],n=this._options[this._current];if(!i){this._localBounds=t;return}let o=this.anchor,l=this.offset;n!=null&&n.anchor&&(o=n.anchor),n!=null&&n.offset&&(l=n.offset);const d=i.localBounds,f=-d.width*o.x+l.x,g=-d.height*o.y+l.y;i instanceof yn&&!i.useAnchor?t=i==null?void 0:i.localBounds.combine(t):t=i==null?void 0:i.localBounds.translate(D(f,g)).combine(t),this._localBounds=t}get localBounds(){return(!this._localBounds||this._localBounds.hasZeroDimensions())&&this.recalculateBounds(),this._localBounds}get bounds(){let t=this.localBounds;if(this.owner){const i=this.owner.get(nt);i&&(t=t.transform(i.get().matrix))}return t}update(t,i=0){const n=this.current;n&&_h(n)&&n.tick(t,i)}clone(){const t=new oe;return t._graphics={...this._graphics},t._options={...this._options},t.offset=this.offset.clone(),t.opacity=this.opacity,t.anchor=this.anchor.clone(),t.copyGraphics=this.copyGraphics,t.onPreDraw=this.onPreDraw,t.onPostDraw=this.onPostDraw,t.visible=this.visible,t}}class _r extends gn{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new _r({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class Oo extends gn{get radius(){return this._radius}set radius(t){this._radius=t,this.width=this._radius*2,this.height=this._radius*2,this.flagDirty()}constructor(t){var i,n,o;super(t),this._radius=0;const l=(i=t.lineWidth)!==null&&i!==void 0?i:t.strokeColor?1:0;this.padding=(n=t.padding)!==null&&n!==void 0?n:2+l/2,this.radius=t.radius,this.filtering=(o=t.filtering)!==null&&o!==void 0?o:Kt.Blended,this.rasterize()}clone(){return new Oo({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class Fi extends yi{constructor(t){var i,n;super(),this.useColliderShape=!0,this.useGraphicsBounds=!0,this.useColliderShape=(i=t==null?void 0:t.useColliderShape)!==null&&i!==void 0?i:this.useColliderShape,this.useGraphicsBounds=(n=t==null?void 0:t.useGraphicsBounds)!==null&&n!==void 0?n:this.useGraphicsBounds,this.localBounds=t==null?void 0:t.localBounds}}class zt{static CreateReversibleEasingFunction(t){return(i,n,o,l)=>o<n?n-(t(i,o,n,l)-o):t(i,n,o,l)}static CreateVectorEasingFunction(t){return(i,n,o,l)=>new C(t(i,n.x,o.x,l),t(i,n.y,o.y,l))}}zt.Linear=zt.CreateReversibleEasingFunction((c,t,i,n)=>(i=i-t,i*c/n+t)),zt.EaseInQuad=zt.CreateReversibleEasingFunction((c,t,i,n)=>(i=i-t,c/=n,i*c*c+t)),zt.EaseOutQuad=zt.CreateReversibleEasingFunction((c,t,i,n)=>(i=i-t,c/=n,-i*c*(c-2)+t)),zt.EaseInOutQuad=zt.CreateReversibleEasingFunction((c,t,i,n)=>(i=i-t,c/=n/2,c<1?i/2*c*c+t:(c--,-i/2*(c*(c-2)-1)+t))),zt.EaseInCubic=zt.CreateReversibleEasingFunction((c,t,i,n)=>(i=i-t,c/=n,i*c*c*c+t)),zt.EaseOutCubic=zt.CreateReversibleEasingFunction((c,t,i,n)=>(i=i-t,c/=n,c--,i*(c*c*c+1)+t)),zt.EaseInOutCubic=zt.CreateReversibleEasingFunction((c,t,i,n)=>(i=i-t,c/=n/2,c<1?i/2*c*c*c+t:(c-=2,i/2*(c*c*c+2)+t)));class zd{constructor(t){this._actions=[],this._currentAction=null,this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){const i=this._actions.indexOf(t);this._actions.splice(i,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}hasNext(){return this._actions.length>0}isComplete(){return this._actions.length===0}reset(){this._actions=this.getActions();const t=this._actions.length;for(let i=0;i<t;i++)this._actions[i].reset();this._completedActions=[]}update(t){if(this._actions.length>0&&(this._currentAction!==this._actions[0]&&(this._currentAction=this._actions[0],this._entity.emit("actionstart",new oh(this._currentAction,this._entity))),this._currentAction.update(t),this._currentAction.isComplete(this._entity))){this._entity.emit("actioncomplete",new ah(this._currentAction,this._entity));const i=this._actions.shift();i&&this._completedActions.push(i)}}}class Od{constructor(t,i,n){this._stopped=!1,this._repeatBuilder=i,this._repeatContext=new vr(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=n,this._originalRepeat=n,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class Ud{constructor(t,i){this._stopped=!1,this._repeatBuilder=i,this._repeatContext=new vr(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}class Nd{constructor(t,i,n,o){if(this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get(nt),this._motion=t.get(Ht),this._speed=o,this._offset=new C(i,n),o<=0)throw K.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+o),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new C(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=D(this._end.x,this._end.y),this._motion.vel=D(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){const i=t.get(nt);return this._stopped||i.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=D(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Hd{constructor(t,i,n,o){this.entity=t,this._started=!1,this._stopped=!1,this._tx=t.get(nt),this._motion=t.get(Ht),this._end=new C(i,n),this._speed=o}update(t){this._started||(this._started=!0,this._start=new C(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const i=this._dir.scale(this._speed);this._motion.vel=D(i.x,i.y),this.isComplete(this.entity)&&(this._tx.pos=D(this._end.x,this._end.y),this._motion.vel=D(0,0))}isComplete(t){const i=t.get(nt);return this._stopped||new C(i.pos.x,i.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=D(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}var ei;(function(c){c[c.ShortestPath=0]="ShortestPath",c[c.LongestPath=1]="LongestPath",c[c.Clockwise=2]="Clockwise",c[c.CounterClockwise=3]="CounterClockwise"})(ei||(ei={}));class Wd{constructor(t,i,n,o){this._started=!1,this._stopped=!1,this._tx=t.get(nt),this._motion=t.get(Ht),this._end=i,this._speed=n,this._rotationType=o||ei.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const i=Math.abs(this._end-this._start),n=R-i;switch(i>n?(this._shortDistance=n,this._longDistance=i):(this._shortDistance=i,this._longDistance=n),this._shortestPathIsPositive=(this._start-this._end+R)%R>=Math.PI,this._rotationType){case ei.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ei.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ei.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ei.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class jd{constructor(t,i,n,o){this._started=!1,this._stopped=!1,this._tx=t.get(nt),this._motion=t.get(Ht),this._speed=n,this._offset=i,this._rotationType=o||ei.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const i=Math.abs(this._end-this._start),n=R-i;switch(i>n?(this._shortDistance=n,this._longDistance=i):(this._shortDistance=i,this._longDistance=n),this._shortestPathIsPositive=(this._start-this._end+R)%R>=Math.PI,this._rotationType){case ei.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ei.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ei.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ei.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._start=void 0,this._currentNonCannonAngle=void 0,this._distance=void 0}}class Gd{constructor(t,i,n,o,l){this._started=!1,this._stopped=!1,this._tx=t.get(nt),this._motion=t.get(Ht),this._endX=i,this._endY=n,this._speedX=o,this._speedY=l}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const i=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*i}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const i=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*i}this.isComplete()&&(this._tx.scale=D(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startX)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Vd{constructor(t,i,n,o){this._started=!1,this._stopped=!1,this._tx=t.get(nt),this._motion=t.get(Ht),this._offset=new C(i,n),this._speedX=this._speedY=o}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Xd{constructor(t){this._method=null,this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class $d{constructor(t,i,n,o,l){this.easingFcn=l,this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new C(0,0),this._lerpEnd=new C(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(nt),this._motion=t.get(Ht),this._lerpDuration=o,this._lerpEnd=new C(i,n)}_initialize(){this._lerpStart=new C(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let i=this._tx.pos.x,n=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?i=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):i=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?n=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):n=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=D((i-this._tx.pos.x)/(t/1e3),(n-this._tx.pos.y)/(t/1e3))):(this._tx.pos=D(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=C.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=D(0,0),this._stopped=!0}}class Yd{constructor(t,i,n,o,l){this.easingFcn=l,this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new C(0,0),this._lerpEnd=new C(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(nt),this._motion=t.get(Ht),this._lerpDuration=o,this._offset=new C(i,n)}_initialize(){this._lerpStart=new C(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._lerpEnd=this._lerpStart.add(this._offset)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let i=this._tx.pos.x,n=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?i=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):i=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?n=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):n=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=D((i-this._tx.pos.x)/(t/1e3),(n-this._tx.pos.y)/(t/1e3))):(this._tx.pos=D(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=C.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=D(0,0),this._stopped=!0}}class Qd{constructor(t,i,n,o=1){this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(oe),this._timeVisible=i,this._timeNotVisible=n,this._duration=(i+n)*o}update(t){this._started||(this._started=!0,this._elapsedTime=0,this._totalTime=0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.visible&&this._elapsedTime>=this._timeVisible&&(this._graphics.visible=!1,this._elapsedTime=0),!this._graphics.visible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.visible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.visible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._elapsedTime=0,this._totalTime=0}}class Zd{constructor(t,i,n){this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(oe),this._endOpacity=i,this._speed=this._ogspeed=n}update(t){this._graphics&&(this._started||(this._started=!0,this._speed=this._ogspeed,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),K.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||Math.abs(this._graphics.opacity-this._endOpacity)<.05}stop(){this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class qd{constructor(t){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1,this._stopped=!1}}class Kd{constructor(t){this._stopped=!1,this._entity=t}update(t){this._entity.get(wn).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class vh{constructor(t,i,n){this._started=!1,this._stopped=!1,this._tx=t.get(nt),this._motion=t.get(Ht),this._followTx=i.get(nt),this._followMotion=i.get(Ht),this._current=new C(this._tx.pos.x,this._tx.pos.y),this._end=new C(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=n!==void 0?n:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const i=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(i!==0&&(this._speed=i),this._current=D(this._tx.pos.x,this._tx.pos.y),this._end=D(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const n=this._dir.scale(this._speed);this._motion.vel=D(n.x,n.y)}else this._motion.vel=D(0,0);this.isComplete()&&(this._tx.pos=D(this._end.x,this._end.y),this._motion.vel=D(0,0))}stop(){this._motion.vel=D(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1,this._stopped=!1}}class yh{constructor(t,i,n){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tx=t.get(nt),this._motion=t.get(Ht),this._meetTx=i.get(nt),this._meetMotion=i.get(Ht),this._current=new C(this._tx.pos.x,this._tx.pos.y),this._end=new C(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=n||0,n!==void 0&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const i=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));i!==0&&!this._speedWasSpecified&&(this._speed=i),this._current=D(this._tx.pos.x,this._tx.pos.y),this._end=D(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const n=this._dir.scale(this._speed);this._motion.vel=D(n.x,n.y),this.isComplete()&&(this._tx.pos=D(this._end.x,this._end.y),this._motion.vel=D(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._motion.vel=D(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._distanceBetween=void 0}}class vr{constructor(t){this._entity=t,this._queue=new zd(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}runAction(t){return t.reset(),this._queue.add(t),this}easeTo(...t){var i,n;let o=0,l=0,d=0,f=zt.Linear;return t[0]instanceof C?(o=t[0].x,l=t[0].y,d=t[1],f=(i=t[2])!==null&&i!==void 0?i:f):(o=t[0],l=t[1],d=t[2],f=(n=t[3])!==null&&n!==void 0?n:f),this._queue.add(new $d(this._entity,o,l,d,f)),this}easeBy(...t){var i,n;let o=0,l=0,d=0,f=zt.Linear;return t[0]instanceof C?(o=t[0].x,l=t[0].y,d=t[1],f=(i=t[2])!==null&&i!==void 0?i:f):(o=t[0],l=t[1],d=t[2],f=(n=t[3])!==null&&n!==void 0?n:f),this._queue.add(new Yd(this._entity,o,l,d,f)),this}moveTo(t,i,n){let o=0,l=0,d=0;return t instanceof C?(o=t.x,l=t.y,d=i):(o=t,l=i,d=n),this._queue.add(new Hd(this._entity,o,l,d)),this}moveBy(t,i,n){let o=0,l=0,d=0;return t instanceof C?(o=t.x,l=t.y,d=i):(o=t,l=i,d=n),this._queue.add(new Nd(this._entity,o,l,d)),this}rotateTo(t,i,n){return this._queue.add(new Wd(this._entity,t,i,n)),this}rotateBy(t,i,n){return this._queue.add(new jd(this._entity,t,i,n)),this}scaleTo(t,i,n,o){let l=1,d=1,f=0,g=0;return t instanceof C&&i instanceof C&&(l=t.x,d=t.y,f=i.x,g=i.y),typeof t=="number"&&typeof i=="number"&&(l=t,d=i,f=n,g=o),this._queue.add(new Gd(this._entity,l,d,f,g)),this}scaleBy(t,i,n){let o=1,l=1;return t instanceof C&&(o=t.x,l=t.y,n=i),typeof t=="number"&&typeof i=="number"&&(o=t,l=i),this._queue.add(new Vd(this._entity,o,l,n)),this}blink(t,i,n=1){return this._queue.add(new Qd(this._entity,t,i,n)),this}fade(t,i){return this._queue.add(new Zd(this._entity,t,i)),this}delay(t){return this._queue.add(new qd(t)),this}die(){return this._queue.add(new Kd(this._entity)),this}callMethod(t){return this._queue.add(new Xd(t)),this}repeat(t,i){return i?(this._queue.add(new Od(this._entity,t,i)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new Ud(this._entity,t)),this}follow(t,i){return i===void 0?this._queue.add(new vh(this._entity,t)):this._queue.add(new vh(this._entity,t,i)),this}meet(t,i){return i===void 0?this._queue.add(new yh(this._entity,t)):this._queue.add(new yh(this._entity,t,i)),this}toPromise(){return new Promise(i=>{this._queue.add(new Xd(()=>{i()}))})}}class wn extends yi{constructor(){super(...arguments),this.dependencies=[nt,Ht],this._ctx=null}onAdd(t){this._ctx=new vr(t)}onRemove(){this._ctx=null}_getCtx(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no context available");return this._ctx}getQueue(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no queue available");return this._ctx.getQueue()}runAction(t){if(!this._ctx)throw new Error("Actions component not attached to an entity, cannot run action");return this._ctx.runAction(t)}update(t){var i;return(i=this._ctx)===null||i===void 0?void 0:i.update(t)}clearActions(){var t;(t=this._ctx)===null||t===void 0||t.clearActions()}easeTo(...t){return this._getCtx().easeTo.apply(this._ctx,t)}easeBy(...t){return this._getCtx().easeBy.apply(this._ctx,t)}moveTo(t,i,n){return this._getCtx().moveTo.apply(this._ctx,[t,i,n])}moveBy(t,i,n){return this._getCtx().moveBy.apply(this._ctx,[t,i,n])}rotateTo(t,i,n){return this._getCtx().rotateTo(t,i,n)}rotateBy(t,i,n){return this._getCtx().rotateBy(t,i,n)}scaleTo(t,i,n,o){return this._getCtx().scaleTo.apply(this._ctx,[t,i,n,o])}scaleBy(t,i,n){return this._getCtx().scaleBy.apply(this._ctx,[t,i,n])}blink(t,i,n){return this._getCtx().blink(t,i,n)}fade(t,i){return this._getCtx().fade(t,i)}delay(t){return this._getCtx().delay(t)}die(){return this._getCtx().die()}callMethod(t){return this._getCtx().callMethod(t)}repeat(t,i){return this._getCtx().repeat(t,i)}repeatForever(t){return this._getCtx().repeatForever(t)}follow(t,i){return this._getCtx().follow(t,i)}meet(t,i){return this._getCtx().meet(t,i)}toPromise(){return this._getCtx().toPromise()}}var Uo;(function(c){c.Em="em",c.Rem="rem",c.Px="px",c.Pt="pt",c.Percent="%"})(Uo||(Uo={}));var No;(function(c){c.Left="left",c.Right="right",c.Center="center",c.Start="start",c.End="end"})(No||(No={}));var Ho;(function(c){c.Top="top",c.Hanging="hanging",c.Middle="middle",c.Alphabetic="alphabetic",c.Ideographic="ideographic",c.Bottom="bottom"})(Ho||(Ho={}));var Wo;(function(c){c.Normal="normal",c.Italic="italic",c.Oblique="oblique"})(Wo||(Wo={}));var jo;(function(c){c.LeftToRight="ltr",c.RightToLeft="rtl"})(jo||(jo={}));class xn{constructor(t,i,n,o){this.font=t,this.text=i,this.color=n,this.maxWidth=o,this._textFragments=[],this.disposed=!1,this._dirty=!0,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.dimensions=this.measureText(i),this._setDimension(this.dimensions,this.ctx),this._lastHashCode=this.getHashCode()}measureText(t,i){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);let n=null;i!=null?n=this._getLinesFromText(t,i):n=t.split(`
`);const o=n.reduce((T,k)=>T.length>k.length?T:k);this._applyFont(this.ctx);const l=this.ctx.measureText(o);let d=Math.abs(l.actualBoundingBoxAscent)+Math.abs(l.actualBoundingBoxDescent);const f=d*n.length;d=f;const g=f-Math.abs(l.actualBoundingBoxAscent),v=0,w=0;return new tt({left:v-Math.abs(l.actualBoundingBoxLeft)-this.font.padding,top:w-Math.abs(l.actualBoundingBoxAscent)-this.font.padding,bottom:w+g+this.font.padding,right:v+Math.abs(l.actualBoundingBoxRight)+this.font.padding})}_setDimension(t,i){let n=1;this.font.lineHeight&&(n=this.font.lineHeight/this.font.size),i.canvas.width=(t.width+this.font.padding*2)*2*this.font.quality,i.canvas.height=(t.height+this.font.padding*2)*2*this.font.quality*n}static getHashCode(t,i,n){var o;return i+"__hashcode__"+t.fontString+t.showDebug+t.textAlign+t.baseAlign+t.direction+t.lineHeight+JSON.stringify(t.shadow)+(t.padding.toString()+t.smoothing.toString()+t.lineWidth.toString()+t.lineDash.toString()+((o=t.strokeColor)===null||o===void 0?void 0:o.toString())+(n?n.toString():t.color.toString()))}getHashCode(t=!0){return xn.getHashCode(this.font,this.text,t?this.color:void 0)}_applyRasterProperties(t){var i,n;t.translate(this.font.padding,this.font.padding),t.imageSmoothingEnabled=this.font.smoothing,t.lineWidth=this.font.lineWidth,t.setLineDash((i=this.font.lineDash)!==null&&i!==void 0?i:t.getLineDash()),t.strokeStyle=(n=this.font.strokeColor)===null||n===void 0?void 0:n.toString(),t.fillStyle=this.color.toString()}_applyFont(t){t.resetTransform(),t.translate(this.font.padding+t.canvas.width/2,this.font.padding+t.canvas.height/2),t.scale(this.font.quality,this.font.quality),t.textAlign=this.font.textAlign,t.textBaseline=this.font.baseAlign,t.font=this.font.fontString,t.direction=this.font.direction,this.font.shadow&&(t.shadowColor=this.font.shadow.color.toString(),t.shadowBlur=this.font.shadow.blur,t.shadowOffsetX=this.font.shadow.offset.x,t.shadowOffsetY=this.font.shadow.offset.y)}_drawText(t,i,n){this._applyRasterProperties(t),this._applyFont(t);for(let o=0;o<i.length;o++){const l=i[o];this.color&&t.fillText(l,0,o*n),this.font.strokeColor&&t.strokeText(l,0,o*n)}this.font.showDebug&&(ch(t,N.Green,-t.canvas.width/2,0,t.canvas.width/2,0,2),ch(t,N.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_splitTextBitmap(t){const i=[];let n=0,o=0;const l=Math.min(4096,t.canvas.width),d=Math.min(4096,t.canvas.height);for(;n<t.canvas.width;){for(;o<t.canvas.height;){const f=document.createElement("canvas");f.width=l,f.height=d,f.getContext("2d").drawImage(t.canvas,n,o,l,d,0,0,l,d),i.push({x:n,y:o,canvas:f}),o+=d}n+=l,o=0}return i}flagDirty(){this._dirty=!0}render(t,i,n,o){var l;if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);this._ex=t;const d=this.getHashCode();if(this._lastHashCode!==d&&(this._dirty=!0),this._dirty){this.dimensions=this.measureText(this.text,o),this._setDimension(this.dimensions,this.ctx);const f=this._getLinesFromText(this.text,o),g=(l=this.font.lineHeight)!==null&&l!==void 0?l:this.dimensions.height/f.length;if(this._drawText(this.ctx,f,g),t instanceof $i)for(const v of this._textFragments)t.textureLoader.delete(v.canvas);if(this._textFragments=this._splitTextBitmap(this.ctx),t instanceof $i)for(const v of this._textFragments)t.textureLoader.load(v.canvas,{filtering:this.font.filtering},!0);this._lastHashCode=d,this._dirty=!1}for(const f of this._textFragments)t.drawImage(f.canvas,0,0,f.canvas.width,f.canvas.height,f.x/this.font.quality+i-this.ctx.canvas.width/this.font.quality/2,f.y/this.font.quality+n-this.ctx.canvas.height/this.font.quality/2,f.canvas.width/this.font.quality,f.canvas.height/this.font.quality)}dispose(){if(this.disposed=!0,this.dimensions=void 0,this.canvas=void 0,this.ctx=void 0,this._ex instanceof $i)for(const t of this._textFragments)this._ex.textureLoader.delete(t.canvas);this._textFragments.length=0}_getLinesFromText(t,i){if(this._cachedText===t&&this._cachedRenderWidth===i)return this._cachedLines;const n=t.split(`
`);if(i==null)return n;for(let o=0;o<n.length;o++){let l=n[o],d="";if(this.measureText(l).width>i){for(;this.measureText(l).width>i;)d=l[l.length-1]+d,l=l.slice(0,-1);n[o]=l,n[o+1]=d}}return this._cachedText=t,this._cachedLines=n,this._cachedRenderWidth=i,n}}class It{static measureText(t,i,n){const o=xn.getHashCode(i,t);if(It._MEASURE_CACHE.has(o))return It._MEASURE_CACHE.get(o);It._LOGGER.debug("Font text measurement cache miss");const l=i.measureTextWithoutCache(t,n);return It._MEASURE_CACHE.set(o,l),l}static getTextInstance(t,i,n){const o=xn.getHashCode(i,t,n);let l=It._TEXT_CACHE.get(o);return l||(l=new xn(i,t,n),It._TEXT_CACHE.set(o,l),It._LOGGER.debug("Font text instance cache miss")),It._TEXT_USAGE.set(l,performance.now()),l}static checkAndClearCache(){const t=[],i=new Set;for(const[o,l]of It._TEXT_USAGE.entries())if(l+It.FONT_TIMEOUT<performance.now())It._LOGGER.debug(`Text cache entry timed out ${o.text}`),t.push(o),o.dispose();else{const d=o.getHashCode(!1);i.add(d)}t.forEach(o=>{It._TEXT_USAGE.delete(o)}),this._TEXT_CACHE.clear();for(const[o]of this._TEXT_USAGE.entries())this._TEXT_CACHE.set(o.getHashCode(),o);const n=new Map;for(const o of i)It._MEASURE_CACHE.has(o)&&n.set(o,It._MEASURE_CACHE.get(o));this._MEASURE_CACHE.clear(),this._MEASURE_CACHE=n}static get cacheSize(){return It._TEXT_USAGE.size}static clearCache(){for(const[t]of It._TEXT_USAGE.entries())t.dispose();It._TEXT_USAGE.clear(),It._TEXT_CACHE.clear(),It._MEASURE_CACHE.clear()}}It.FONT_TIMEOUT=500,It._LOGGER=K.getInstance(),It._TEXT_USAGE=new Map,It._TEXT_CACHE=new Map,It._MEASURE_CACHE=new Map;class js extends Lt{constructor(t={}){var i,n,o,l,d,f,g,v,w,x,T,k,B,O,G,L,z,V,H,st;super(t),this.filtering=Kt.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=N.Black,this.family="sans-serif",this.style=Wo.Normal,this.bold=!1,this.unit=Uo.Px,this.textAlign=No.Left,this.baseAlign=Ho.Top,this.direction=jo.LeftToRight,this.lineHeight=void 0,this.size=10,this.shadow=null,this._textBounds=new tt,this._textMeasurement=new xn(this,"",N.Black),this.smoothing=(i=t==null?void 0:t.smoothing)!==null&&i!==void 0?i:this.smoothing,this.padding=(n=t==null?void 0:t.padding)!==null&&n!==void 0?n:this.padding,this.color=(o=t==null?void 0:t.color)!==null&&o!==void 0?o:this.color,this.strokeColor=(l=t==null?void 0:t.strokeColor)!==null&&l!==void 0?l:this.strokeColor,this.lineDash=(d=t==null?void 0:t.lineDash)!==null&&d!==void 0?d:this.lineDash,this.lineWidth=(f=t==null?void 0:t.lineWidth)!==null&&f!==void 0?f:this.lineWidth,this.filtering=(g=t==null?void 0:t.filtering)!==null&&g!==void 0?g:this.filtering,this.family=(v=t==null?void 0:t.family)!==null&&v!==void 0?v:this.family,this.style=(w=t==null?void 0:t.style)!==null&&w!==void 0?w:this.style,this.bold=(x=t==null?void 0:t.bold)!==null&&x!==void 0?x:this.bold,this.size=(T=t==null?void 0:t.size)!==null&&T!==void 0?T:this.size,this.unit=(k=t==null?void 0:t.unit)!==null&&k!==void 0?k:this.unit,this.textAlign=(B=t==null?void 0:t.textAlign)!==null&&B!==void 0?B:this.textAlign,this.baseAlign=(O=t==null?void 0:t.baseAlign)!==null&&O!==void 0?O:this.baseAlign,this.direction=(G=t==null?void 0:t.direction)!==null&&G!==void 0?G:this.direction,this.lineHeight=(L=t==null?void 0:t.lineHeight)!==null&&L!==void 0?L:this.lineHeight,this.quality=(z=t==null?void 0:t.quality)!==null&&z!==void 0?z:this.quality,t!=null&&t.shadow&&(this.shadow={},this.shadow.blur=(V=t.shadow.blur)!==null&&V!==void 0?V:this.shadow.blur,this.shadow.offset=(H=t.shadow.offset)!==null&&H!==void 0?H:this.shadow.offset,this.shadow.color=(st=t.shadow.color)!==null&&st!==void 0?st:this.shadow.color)}clone(){return new js({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:null})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,i,n){}_rotate(t){var i;const n=(i=this.origin)!==null&&i!==void 0?i:this._textBounds.center;t.translate(n.x,n.y),t.rotate(this.rotation),t.translate(-n.x,-n.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureTextWithoutCache(t,i){return this._textMeasurement.measureText(t,i)}measureText(t,i){return It.measureText(t,this,i)}_postDraw(t){t.restore()}render(t,i,n,o,l,d){const f=It.getTextInstance(i,this,n);this._textBounds=f.dimensions,this._preDraw(t,o,l),f.render(t,o,l,d),this._postDraw(t)}}class yr extends Lt{constructor(t){var i,n;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=(i=t.font)!==null&&i!==void 0?i:new js,this.color=(n=t.color)!==null&&n!==void 0?n:this.color,this.text=t.text,this.maxWidth=t.maxWidth}clone(){var t,i;return new yr({text:this.text.slice(),color:(i=(t=this.color)===null||t===void 0?void 0:t.clone())!==null&&i!==void 0?i:N.Black,font:this.font.clone(),maxWidth:this.maxWidth})}get text(){return this._text}set text(t){this._text=t,this._calculateDimension()}get font(){return this._font}set font(t){this._font=t}get width(){return this._textWidth===0&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return this._textHeight===0&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:t,height:i}=this.font.measureText(this._text,this.maxWidth);this._textWidth=t,this._textHeight=i}get localBounds(){return this.font.measureText(this._text,this.maxWidth).scale(this.scale)}_rotate(t){}_flip(t){}_preDraw(t,i,n){(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity),this.font.tint=this.tint,super._preDraw(t,i,n)}_drawImage(t,i,n){var o;let l=N.Black;this.font instanceof js&&(l=(o=this.color)!==null&&o!==void 0?o:this.font.color);const{width:d,height:f}=this.font.measureText(this._text,this.maxWidth);this._textWidth=d,this._textHeight=f,this.font.render(t,this._text,l,i,n,this.maxWidth),this.font.showDebug&&(t.debug.drawRect(i-d,n-f,d*2,f*2),this.maxWidth!=null&&t.debug.drawRect(i,n,this.maxWidth,this.height,{color:N.Yellow}))}}class He extends _e{get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get(nt).scale}set scale(t){this.get(nt).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=Mt(t,i=>this._handleAnchorChange(i)),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get offset(){return this._offset}set offset(t){this._offset=Mt(t,i=>this._handleOffsetChange(i)),this._handleOffsetChange(t)}_handleOffsetChange(t){this.graphics&&(this.graphics.offset=t)}get isOffScreen(){return this.hasTag("ex.offscreen")}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.events.on("pointerdragstart",this._pointerDragStartHandler),this.events.on("pointerdragend",this._pointerDragEndHandler),this.events.on("pointerdragmove",this._pointerDragMoveHandler),this.events.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.events.off("pointerdragstart",this._pointerDragStartHandler),this.events.off("pointerdragend",this._pointerDragEndHandler),this.events.off("pointerdragmove",this._pointerDragMoveHandler),this.events.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this._color}set color(t){this._color=t.clone();const i=this.graphics.current;(i instanceof gn||i instanceof yr)&&(i.color=this._color)}constructor(t){super(),this.events=new y,this._anchor=Mt(C.Half,_t=>this._handleAnchorChange(_t)),this._offset=Mt(C.Zero,_t=>this._handleOffsetChange(_t)),this.logger=K.getInstance(),this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=_t=>{this._dragging&&(this.pos=_t.worldPos)},this._pointerDragLeaveHandler=_t=>{this._dragging&&(this.pos=_t.worldPos)};const{name:i,x:n,y:o,pos:l,coordPlane:d,scale:f,width:g,height:v,radius:w,collider:x,vel:T,acc:k,rotation:B,angularVelocity:O,z:G,color:L,visible:z,opacity:V,anchor:H,offset:st,collisionType:mt,collisionGroup:X}={...t};this.name=i??this.name,this.anchor=H??He.defaults.anchor.clone(),this.offset=st??C.Zero,this.transform=new nt,this.addComponent(this.transform),this.pos=l??D(n??0,o??0),this.rotation=B??0,this.scale=f??D(1,1),this.z=G??0,this.transform.coordPlane=d??ne.World,this.pointer=new Fi,this.addComponent(this.pointer),this.graphics=new oe({anchor:this.anchor,offset:this.offset,opacity:V}),this.addComponent(this.graphics),this.motion=new Ht,this.addComponent(this.motion),this.vel=T??C.Zero,this.acc=k??C.Zero,this.angularVelocity=O??0,this.actions=new wn,this.addComponent(this.actions),this.body=new dt,this.addComponent(this.body),this.body.collisionType=mt??pt.Passive,X&&(this.body.group=X),x?(this.collider=new Yt(x),this.addComponent(this.collider)):w?(this.collider=new Yt(me.Circle(w)),this.addComponent(this.collider)):g>0&&v>0?(this.collider=new Yt(me.Box(g,v,this.anchor)),this.addComponent(this.collider)):(this.collider=new Yt,this.addComponent(this.collider)),this.graphics.visible=z??!0,L&&(this.color=L,g&&v?this.graphics.add(new _r({color:L,width:g,height:v})):w&&this.graphics.add(new Oo({color:L,radius:w})))}clone(){const t=new He({color:this.color.clone(),anchor:this.anchor.clone(),offset:this.offset.clone()});t.clearComponents(),t.processComponentRemoval(),t.addComponent(t.transform=this.transform.clone(),!0),t.addComponent(t.pointer=this.pointer.clone(),!0),t.addComponent(t.graphics=this.graphics.clone(),!0),t.addComponent(t.motion=this.motion.clone(),!0),t.addComponent(t.actions=this.actions.clone(),!0),t.addComponent(t.body=this.body.clone(),!0),t.addComponent(t.collider=this.collider.clone(),!0);const i=[this.transform,this.pointer,this.graphics,this.motion,this.actions,this.body,this.collider],n=this.getComponents();for(const o of n)i.includes(o)||t.addComponent(o.clone(),!0);return t}onInitialize(t){}_initialize(t){super._initialize(t);for(const i of this.children)i._initialize(t)}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}_prekill(t){this.events.emit("prekill",new Ol(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){this.events.emit("postkill",new Ul(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.events.emit("kill",new Po(this)),super.kill(),this._postkill(this.scene)):this.logger.warn(`Cannot kill actor named "${this.name}", it was never added to the Scene`)}unkill(){this.active=!0}isKilled(){return!this.active}get z(){return this.get(nt).z}set z(t){this.get(nt).z=t}get center(){const t=this.getGlobalPos();return new C(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new C(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(nt).globalRotation}getGlobalPos(){return this.get(nt).globalPos}getGlobalScale(){return this.get(nt).globalScale}contains(t,i,n=!1){const o=D(t,i),l=this.get(Yt);l.update();const d=l.get();if(!d)return!1;const f=d.contains(o);return n?f||this.children.some(g=>g.contains(t,i,!0)):f}within(t,i){const n=this.get(Yt),o=t.get(Yt),l=n.get(),d=o.get();return l&&d?l.getClosestLineBetween(d).getLength()<=i:!1}update(t,i){this._initialize(t),this._preupdate(t,i),this._postupdate(t,i)}onPreUpdate(t,i){}onPostUpdate(t,i){}onPreCollisionResolve(t,i,n,o){}onPostCollisionResolve(t,i,n,o){}onCollisionStart(t,i,n,o){}onCollisionEnd(t,i,n,o){}_preupdate(t,i){this.events.emit("preupdate",new os(t,i,this)),this.onPreUpdate(t,i)}_postupdate(t,i){this.events.emit("postupdate",new as(t,i,this)),this.onPostUpdate(t,i)}}He.defaults={anchor:C.Half};function Jd(c){return c instanceof wh}class wh extends He{constructor(t){var i,n;super({...t}),this.get(nt).coordPlane=ne.Screen,this.anchor=(i=t==null?void 0:t.anchor)!==null&&i!==void 0?i:D(0,0),this.body.collisionType=(n=t==null?void 0:t.collisionType)!==null&&n!==void 0?n:pt.PreventCollision,this.pointer.useGraphicsBounds=!0,this.pointer.useColliderShape=!1,!(t!=null&&t.collider)&&(t==null?void 0:t.width)>0&&(t==null?void 0:t.height)>0&&this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,i,n=!0){if(n)return super.contains(t,i);const o=this._engine.worldToScreenCoordinates(new C(t,i));return super.contains(o.x,o.y)}}class Gs{get complete(){return this._complete}constructor(t,i,n,o,l,d){if(this._logger=K.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this.randomRange=[0,0],this._baseInterval=10,this._generateRandomInterval=()=>this._baseInterval+this.random.integer(this.randomRange[0],this.randomRange[1]),this._complete=!1,this.scene=null,typeof t!="function"){const f=t;t=f.fcn,i=f.interval,n=f.repeats,o=f.numberOfRepeats,l=f.randomRange,d=f.random}if(o&&o>=0&&(this.maxNumberOfRepeats=o,!n))throw new Error("repeats must be set to true if numberOfRepeats is set");if(this.id=Gs._MAX_ID++,this._callbacks=[],this._baseInterval=this.interval=i,l){if(l[0]>l[1])throw new Error("min value must be lower than max value for range");this.random=d??new S,this.randomRange=l,this.interval=this._generateRandomInterval(),this.on(()=>{this.interval=this._generateRandomInterval()})}this.repeats=n||this.repeats,t&&this.on(t)}on(t){this._callbacks.push(t)}off(t){const i=this._callbacks.indexOf(t);this._callbacks.splice(i,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(i=>{i.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:(this._complete=!0,this._running=!1,this._elapsedTime=0)))}reset(t,i){if(t&&t>=0&&(this._baseInterval=this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=i,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}}Gs._MAX_ID=0;class Go extends yi{constructor(t){super(),this.parallaxFactor=D(1,1),this.parallaxFactor=t??this.parallaxFactor}}class Vo extends yi{constructor(t,i=!0){super(),this.draw=t,this.useTransform=i}}const e0={PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PointerUp:"pointerup",PointerDown:"pointerdown",PointerMove:"pointermove",PointerCancel:"pointercancel"};class tf extends _e{flagCollidersDirty(){this._collidersDirty=!0}flagTilesDirty(){for(let t=0;t<this.tiles.length;t++)this.tiles[t]&&this.tiles[t].flagDirty()}get x(){var t;return(t=this.transform.pos.x)!==null&&t!==void 0?t:0}set x(t){var i;!((i=this.transform)===null||i===void 0)&&i.pos&&(this.get(nt).pos=D(t,this.y))}get y(){var t,i;return(i=(t=this.transform)===null||t===void 0?void 0:t.pos.y)!==null&&i!==void 0?i:0}set y(t){var i;!((i=this.transform)===null||i===void 0)&&i.pos&&(this.transform.pos=D(this.x,t))}get z(){var t;return(t=this.transform.z)!==null&&t!==void 0?t:0}set z(t){this.transform&&(this.transform.z=t)}get rotation(){var t,i;return(i=(t=this.transform)===null||t===void 0?void 0:t.rotation)!==null&&i!==void 0?i:0}set rotation(t){this.transform&&(this.transform.rotation=t)}get scale(){var t,i;return(i=(t=this.transform)===null||t===void 0?void 0:t.scale)!==null&&i!==void 0?i:C.One}set scale(t){var i;!((i=this.transform)===null||i===void 0)&&i.scale&&(this.transform.scale=t)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}constructor(t){var i,n,o;super([],t.name),this.events=new y,this._token=0,this.logger=K.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this.renderFromTopOfGraphic=!1,this.meshingLookBehind=10,this._collidersDirty=!0,this._forwardPointerEventToTile=d=>f=>{const g=this.getTileByPoint(f.worldPos);g&&g.events.emit(d,f)},this._originalOffsets=new WeakMap,this.meshingLookBehind=(i=t.meshingLookBehind)!==null&&i!==void 0?i:this.meshingLookBehind,this.addComponent(new nt),this.addComponent(new Ht),this.addComponent(new dt({type:pt.Fixed})),this.addComponent(new oe({onPostDraw:(d,f)=>this.draw(d,f)})),this.addComponent(new Vo((d,f)=>this.debug(d,f),!1)),this.addComponent(new Yt),this.addComponent(new Fi),this.pointer=this.get(Fi),this._graphics=this.get(oe),this.transform=this.get(nt),this._motion=this.get(Ht),this.collider=this.get(Yt),this._composite=this.collider.useCompositeCollider([]),this.transform.pos=(n=t.pos)!==null&&n!==void 0?n:C.Zero,this._oldPos=this.transform.pos.clone(),this._oldScale=this.transform.scale.clone(),this.renderFromTopOfGraphic=(o=t.renderFromTopOfGraphic)!==null&&o!==void 0?o:this.renderFromTopOfGraphic,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.rows=t.rows,this.columns=t.columns,this.tiles=new Array(this.rows*this.columns),this._rows=new Array(this.rows),this._cols=new Array(this.columns);let l=[];for(let d=0;d<this.columns;d++){for(let f=0;f<this.rows;f++){const g=new ef({x:d,y:f,map:this});g.map=this,this.tiles[d+f*this.columns]=g,l.push(g),this._rows[f]||(this._rows[f]=[]),this._rows[f].push(g)}this._cols[d]=l,l=[]}this._setupPointerToTile(),this._graphics.localBounds=new tt({left:0,top:0,right:this.columns*this.tileWidth*this.scale.x,bottom:this.rows*this.tileHeight*this.scale.y})}_initialize(t){super._initialize(t),this._engine=t}_setupPointerToTile(){this.events.on("pointerup",this._forwardPointerEventToTile("pointerup")),this.events.on("pointerdown",this._forwardPointerEventToTile("pointerdown")),this.events.on("pointermove",this._forwardPointerEventToTile("pointermove")),this.events.on("pointercancel",this._forwardPointerEventToTile("pointercancel"))}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const i=t.offset;return this._originalOffsets.set(t,i),i}}_updateColliders(){this.collider.$colliderRemoved.notifyAll(this._composite),this._composite.clearColliders();const t=[];this._composite=this.collider.useCompositeCollider([]);let i;const n=(l,d)=>l&&d?l.top===d.top&&l.bottom===d.bottom&&l.right===d.left:!1,o=(l,d,f=this.meshingLookBehind)=>{if(!l)return!1;for(let g=d.length-1;g>=0;g--){if(f--<0)return!1;const v=d[g];if(n(v,l))return d[g]=v.combine(l),!0}return!1};for(let l=0;l<this.columns;l++){for(let d=0;d<this.rows;d++){const f=this.tiles[l+d*this.columns];if(f.solid)if(f.getColliders().length>0){for(const g of f.getColliders()){const v=this._getOrSetColliderOriginalOffset(g);g.offset=D(f.x*this.tileWidth*this.scale.x,f.y*this.tileHeight*this.scale.y).add(v),g.owner=this,this._composite.addCollider(g)}i&&!o(i,t)&&t.push(i),i=null}else i?i=i.combine(f.defaultGeometry):i=f.defaultGeometry;else i&&!o(i,t)&&t.push(i),i=null}i&&!o(i,t)&&t.push(i),i=null}for(const l of t){const d=me.Box(l.width,l.height,C.Zero,D(l.left-this.pos.x,l.top-this.pos.y));d.owner=this,this._composite.addCollider(d)}this.collider.update(),this.collider.$colliderAdded.notifyAll(this._composite)}getTileByIndex(t){return this.tiles[t]}getTile(t,i){return t<0||i<0||t>=this.columns||i>=this.rows?null:this.tiles[t+i*this.columns]}getTileByPoint(t){const{x:i,y:n}=this._getTileCoordinates(t),o=this.getTile(i,n);return i>=0&&n>=0&&i<this.columns&&n<this.rows&&o?o:null}_getTileCoordinates(t){t=this.transform.applyInverse(t);const i=Math.floor(t.x/this.tileWidth),n=Math.floor(t.y/this.tileHeight);return{x:i,y:n}}getRows(){return this._rows}getColumns(){return this._cols}getOnScreenTiles(){let t=this._engine.screen.getWorldBounds();const i=this.get(Go);if(i&&this.isInitialized){let k=this.pos;const B=C.One.sub(i.parallaxFactor),O=this._engine.currentScene.camera.pos.scale(B);k=k.sub(O),t=t.translate(k)}const n=this.transform.coordPlane===ne.Screen?this._engine.screen.getScreenBounds():t,o=this._getTileCoordinates(n.topLeft),l=this._getTileCoordinates(n.topRight),d=this._getTileCoordinates(n.bottomRight),f=this._getTileCoordinates(n.bottomLeft),g=Math.min($(o.x,0,this.columns-1),$(l.x,0,this.columns-1)),v=Math.min($(o.y,0,this.rows-1),$(l.y,0,this.rows-1)),w=Math.max($(d.x,0,this.columns-1),$(f.x,0,this.columns-1)),x=Math.max($(d.y,0,this.rows-1),$(f.y,0,this.rows-1)),T=[];for(let k=g;k<=w;k++)for(let B=v;B<=x;B++)T.push(this.getTile(k,B));return T}update(t,i){this._initialize(t),this.onPreUpdate(t,i),this.emit("preupdate",new os(t,i,this)),(!this._oldPos.equals(this.pos)||this._oldRotation!==this.rotation||!this._oldScale.equals(this.scale))&&(this.flagCollidersDirty(),this.flagTilesDirty()),this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._token++,this.pos.clone(this._oldPos),this._oldRotation=this.rotation,this.scale.clone(this._oldScale),this.transform.pos=this.pos,this.onPostUpdate(t,i),this.emit("postupdate",new as(t,i,this))}draw(t,i){if(!this.isInitialized)return;this.emit("predraw",new mn(t,i,this));let n,o,l;const d=this.getOnScreenTiles();for(let f=0;f<d.length;f++){const g=d[f],v=g.getGraphicsOffsets();for(n=g.getGraphics(),o=0,l=n.length;o<l;o++){const w=n[o],x=v[o];if(w){_h(w)&&(w==null||w.tick(i,this._token));const T=this.renderFromTopOfGraphic?0:w.height-this.tileHeight;w.draw(t,g.x*this.tileWidth+x.x,g.y*this.tileHeight-T+x.y)}}}this.emit("postdraw",new _n(t,i,this))}debug(t,i){const{showAll:n,showGrid:o,gridColor:l,gridWidth:d,showSolidBounds:f,solidBoundsColor:g,showColliderGeometry:v}=i.tilemap,{geometryColor:w,geometryLineWidth:x,geometryPointSize:T}=i.collider,k=this.tileWidth*this.columns*this.scale.x,B=this.tileHeight*this.rows*this.scale.y,O=this.pos;if(o||n){for(let G=0;G<this.rows+1;G++){const L=D(0,G*this.tileHeight*this.scale.y);t.drawLine(O.add(L),O.add(D(k,L.y)),l,d)}for(let G=0;G<this.columns+1;G++){const L=D(G*this.tileWidth*this.scale.x,0);t.drawLine(O.add(L),O.add(D(L.x,B)),l,d)}}if(n||f||v){const G=this._composite.getColliders();t.save(),t.translate(this.pos.x,this.pos.y),t.scale(this.scale.x,this.scale.y);for(const L of G){const z=L.localBounds,V=L.worldPos.sub(this.pos);f&&t.drawRectangle(V,z.width,z.height,g)}if(t.restore(),v)for(const L of G)L.debug(t,w,{lineWidth:x,pointSize:T})}if(n||f){if(t.save(),t.z=999,f)for(let G=0;G<this.tiles.length;G++)this.tiles[G].bounds.draw(t);t.restore()}}}class ef{get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get width(){return this._width}get height(){return this._height}get solid(){return this._solid}set solid(t){var i;(i=this.map)===null||i===void 0||i.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}getGraphicsOffsets(){return this._offsets}addGraphic(t,i){this._graphics.push(t),i!=null&&i.offset?this._offsets.push(i.offset):this._offsets.push(C.Zero)}removeGraphic(t){const i=this._graphics.indexOf(t);i>-1&&(this._graphics.splice(i,1),this._offsets.splice(i,1))}clearGraphics(){this._graphics.length=0,this._offsets.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const i=this._colliders.indexOf(t);i>-1&&this._colliders.splice(i,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}constructor(t){var i,n;this._posDirty=!1,this.events=new y,this._solid=!1,this._graphics=[],this._offsets=[],this._colliders=[],this.data=new Map,this.x=t.x,this.y=t.y,this.map=t.map,this._width=t.map.tileWidth*this.map.scale.x,this._height=t.map.tileHeight*this.map.scale.y,this.solid=(i=t.solid)!==null&&i!==void 0?i:this.solid,this._graphics=(n=t.graphics)!==null&&n!==void 0?n:[],this._recalculate()}flagDirty(){return this._posDirty=!0}_recalculate(){const t=this.map.pos.add(D(this.x*this.map.tileWidth,this.y*this.map.tileHeight));this._geometry=new tt(t.x,t.y,t.x+this.map.tileWidth,t.y+this.map.tileHeight),this._width=this.map.tileWidth*this.map.scale.x,this._height=this.map.tileHeight*this.map.scale.y,this._pos=this.map.pos.add(D(this.x*this._width,this.y*this._height)),this._bounds=new tt(this._pos.x,this._pos.y,this._pos.x+this._width,this._pos.y+this._height),this.map.rotation&&(this._bounds=this._bounds.rotate(this.map.rotation,this.map.pos)),this._posDirty=!1}get bounds(){return this._posDirty&&this._recalculate(),this._bounds}get defaultGeometry(){return this._geometry}get center(){return this._posDirty&&this._recalculate(),new C(this._pos.x+this._width/2,this._pos.y+this._height/2)}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){i?this.events.off(t,i):this.events.off(t)}}class sf{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new nf(t))}lockToActorAxis(t,i){this.camera.addStrategy(new rf(t,i))}elasticToActor(t,i,n){this.camera.addStrategy(new of(t,i,n))}radiusAroundActor(t,i){this.camera.addStrategy(new af(t,i))}limitCameraBounds(t){this.camera.addStrategy(new lf(t))}}var Xo;(function(c){c[c.X=0]="X",c[c.Y=1]="Y"})(Xo||(Xo={}));class nf{constructor(t){this.target=t,this.action=(i,n,o,l)=>i.center}}class rf{constructor(t,i){this.target=t,this.axis=i,this.action=(n,o,l,d)=>{const f=n.center,g=o.getFocus();return this.axis===Xo.X?new C(f.x,g.y):new C(g.x,f.y)}}}class of{constructor(t,i,n){this.target=t,this.cameraElasticity=i,this.cameraFriction=n,this.action=(o,l,d,f)=>{const g=o.center;let v=l.getFocus(),w=l.vel.clone();const x=g.sub(v).scale(this.cameraElasticity);w=w.add(x);const T=w.scale(-1).scale(this.cameraFriction);return w=w.add(T),v=v.add(w),v}}}class af{constructor(t,i){this.target=t,this.radius=i,this.action=(n,o,l,d)=>{const f=n.center,g=o.getFocus(),v=f.sub(g),w=v.size;if(w>=this.radius){const x=w-this.radius;return g.add(v.normalize().scale(x))}return g}}}class lf{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(i,n,o,l)=>{const d=n.getFocus();this.boundSizeChecked||((i.bottom-i.top<o.drawHeight||i.right-i.left<o.drawWidth)&&K.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let f=d.x,g=d.y;return d.x<i.left+o.halfDrawWidth?f=i.left+o.halfDrawWidth:d.x>i.right-o.halfDrawWidth&&(f=i.right-o.halfDrawWidth),d.y<i.top+o.halfDrawHeight?g=i.top+o.halfDrawHeight:d.y>i.bottom-o.halfDrawHeight&&(g=i.bottom-o.halfDrawHeight),D(f,g)}}}const i0={Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate"};class hf{constructor(){this.events=new y,this.transform=gt.identity(),this.inverse=gt.identity(),this._cameraStrategies=[],this.strategy=new sf(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this._angularVelocity=0,this._posChanged=!1,this._pos=wo(C.Zero,()=>this._posChanged=!0),this.drawPos=this.pos.clone(),this._oldPos=this.pos.clone(),this.vel=C.Zero,this.acc=C.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=zt.EaseInOutCubic,this._easing=zt.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1,this._snapPos=D(0,0)}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t}get pos(){return this._pos}set pos(t){this._pos=wo(t,()=>this._posChanged=!0),this._posChanged=!0}get x(){return this.pos.x}set x(t){!this._follow&&!this._cameraMoving&&(this.pos=D(t,this.pos.y))}get y(){return this.pos.y}set y(t){!this._follow&&!this._cameraMoving&&(this.pos=D(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=D(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=D(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=D(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=D(this.acc.x,t)}getFocus(){return this.pos}move(t,i,n=zt.EaseInOutCubic){if(typeof n!="function")throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise(o=>{this._lerpResolve=o}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=i,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=n,this._lerpPromise)}shake(t,i,n){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=i,this._shakeDuration=n}zoomOverTime(t,i=0,n=zt.EaseInOutCubic){if(this._zoomPromise=new Promise(o=>{this._zoomResolve=o}),i)this._isZooming=!0,this._zoomEasing=n,this._currentZoomTime=0,this._zoomDuration=i,this._zoomStart=this.zoom,this._zoomEnd=t;else return this._isZooming=!1,this.zoom=t,Promise.resolve(!0);return this._zoomPromise}get viewport(){return this._viewport?this._viewport:new tt(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){q(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,i){this.events.emit("preupdate",new os(t,i,this)),this.onPreUpdate(t,i)}onPreUpdate(t,i){}_postupdate(t,i){this.events.emit("postupdate",new as(t,i,this)),this.onPostUpdate(t,i)}onPostUpdate(t,i){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;const i=this._screen.contentArea;let n=D(i.width/2,i.height/2);if(!this._engine.loadingComplete){const o=this._screen.peekResolution();o&&(n=D(o.width/2,o.height/2))}this._halfWidth=n.x,this._halfHeight=n.y,this._posChanged||(this.pos=n),this.pos.clone(this.drawPos),this.updateTransform(this.pos),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(this.pos),this.pos.clone(this._oldPos),this.onInitialize(t),this.events.emit("initialize",new vn(t,this)),this._isInitialized=!0}}onInitialize(t){}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}runStrategies(t,i){for(const n of this._cameraStrategies)this.pos=n.action.call(n,n.target,this,t,i)}updateViewport(){this._viewport=new tt(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,i){if(this._initialize(t),this._preupdate(t,i),this.pos.clone(this._oldPos),this.pos=this.pos.add(this.vel.scale(i/1e3)),this.zoom+=this.dz*i/1e3,this.vel=this.vel.add(this.acc.scale(i/1e3)),this.dz+=this.az*i/1e3,this.rotation+=this.angularVelocity*i/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const n=this._zoomEasing,o=n(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=o,this._currentZoomTime+=i}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const o=zt.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=o,this._currentLerpTime+=i}else{this.pos=this._lerpEnd;const n=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(n)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=i,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1),this.runStrategies(t,i),this.updateViewport(),this.updateTransform(this.pos),this._postupdate(t,i)}draw(t){if(this.pos.clone(this.drawPos),this._engine.fixedUpdateFps){const i=this._engine.currentFrameLagMs/(1e3/this._engine.fixedUpdateFps),n=this.pos.scale(i).add(this._oldPos.scale(1-i));n.clone(this.drawPos),this.updateTransform(n)}if(t.snapToPixel){const i=this.drawPos.clone(this._snapPos);i.x=~~(i.x+wt*U(i.x)),i.y=~~(i.y+wt*U(i.y)),i.clone(this.drawPos),this.updateTransform(i)}t.multiply(this.transform)}updateTransform(t){const i=this._screen.resolution.width/this.zoom,n=this._screen.resolution.height/this.zoom,o=D(-t.x+i/2+this._xShake,-t.y+n/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(i/2,n/2),this.transform.rotate(this.rotation),this.transform.translate(-i/2,-n/2),this.transform.translate(o.x,o.y),this.transform.inverse(this.inverse)}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}const s0={ExitTrigger:"exit",EnterTrigger:"enter"},n0={pos:C.Zero,width:10,height:10,visible:!1,action:()=>{},filter:()=>!0,repeat:-1};class cf extends He{constructor(t){super({x:t.pos.x,y:t.pos.y,width:t.width,height:t.height}),this.events=new y,this.action=()=>{},this.filter=()=>!0,this.repeat=-1,t={...n0,...t},this.filter=t.filter||this.filter,this.repeat=t.repeat||this.repeat,this.action=t.action||this.action,t.target&&(this.target=t.target),this.graphics.visible=t.visible,this.body.collisionType=pt.Passive,this.events.on("collisionstart",i=>{this.filter(i.other)&&(this.events.emit("enter",new nh(this,i.other)),this._dispatchAction(),this.repeat===0&&this.kill())}),this.events.on("collisionend",i=>{this.filter(i.other)&&this.events.emit("exit",new rh(this,i.other))})}set target(t){this._target=t,this.filter=i=>i===t}get target(){return this._target}_initialize(t){super._initialize(t)}_dispatchAction(){this.repeat!==0&&(this.action.call(this),this.repeat--)}}const Bi={Highest:-1/0,Higher:-5,Average:0,Lower:5,Lowest:1/0};var We;(function(c){c.Update="update",c.Draw="draw"})(We||(We={}));class di{constructor(){this.priority=Bi.Average}}class uf{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._entitiesToRemove=[]}updateEntities(t,i){for(const n of this.entities)n.update(t.engine,i),n.active||this.removeEntity(n)}findEntitiesForRemoval(){for(const t of this.entities)t.active||this.removeEntity(t)}addEntity(t){t.active=!0,t.scene=this._world.scene,t&&!this._entityIndex[t.id]&&(this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.children.forEach(i=>{i.scene=t.scene,this.addEntity(i)}),t.childrenAdded$.register({notify:i=>{this.addEntity(i)}}),t.childrenRemoved$.register({notify:i=>{this.removeEntity(i,!1)}}))}removeEntity(t,i=!0){var n,o;let l=0;t instanceof _e?l=t.id:l=t;const d=this._entityIndex[l];if(d&&d.active&&(d.active=!1),d&&i){this._entitiesToRemove.push(d);return}delete this._entityIndex[l],d&&(d.scene=null,q(d,this.entities),this._world.queryManager.removeEntity(d),d.children.forEach(f=>{f.scene=null,this.removeEntity(f,i)}),d.childrenAdded$.clear(),d.childrenRemoved$.clear(),!((o=(n=this._world)===null||n===void 0?void 0:n.scene)===null||o===void 0)&&o.engine&&this._world.scene.engine.stats.currFrame.actors.killed++)}processEntityRemovals(){for(const t of this._entitiesToRemove)t.active||this.removeEntity(t,!1);this._entitiesToRemove.length=0}processComponentRemovals(){for(const t of this.entities)t.processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter(i=>i.name===t)}clear(){for(let t=this.entities.length-1;t>=0;t--)this.removeEntity(this.entities[t])}}class wr{constructor(t){if(this.requiredComponents=t,this.components=new Set,this.entities=[],this.entityAdded$=new be,this.entityRemoved$=new be,t.length===0)throw new Error("Cannot create query without components");for(const i of t)this.components.add(i);this.id=wr.createId(t)}static createId(t){return t.slice().map(i=>i.name).sort().join("-")}checkAndAdd(t){return!this.entities.includes(t)&&t.hasAll(Array.from(this.components))?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const i=this.entities.indexOf(t);i>-1&&(this.entities.splice(i,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class xr{constructor(t){if(this.requiredTags=t,this.tags=new Set,this.entities=[],this.entityAdded$=new be,this.entityRemoved$=new be,t.length===0)throw new Error("Cannot create tag query without tags");for(const i of t)this.tags.add(i);this.id=xr.createId(t)}static createId(t){return t.slice().sort().join("-")}checkAndAdd(t){return!this.entities.includes(t)&&t.hasAllTags(Array.from(this.tags))?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const i=this.entities.indexOf(t);i>-1&&(this.entities.splice(i,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class df{constructor(t){this._world=t,this._queries=new Map,this._addComponentHandlers=new Map,this._removeComponentHandlers=new Map,this._componentToQueriesIndex=new Map,this._tagQueries=new Map,this._addTagHandlers=new Map,this._removeTagHandlers=new Map,this._tagToQueriesIndex=new Map,this._createAddComponentHandler=i=>n=>{this.addComponent(i,n)},this._createRemoveComponentHandler=i=>n=>{this.removeComponent(i,n)},this._createAddTagHandler=i=>n=>{this.addTag(i,n)},this._createRemoveTagHandler=i=>n=>{this.removeTag(i,n)}}createQuery(t){const i=wr.createId(t);if(this._queries.has(i))return this._queries.get(i);const n=new wr(t);this._queries.set(n.id,n);for(const o of t){const l=this._componentToQueriesIndex.get(o);l?l.push(n):this._componentToQueriesIndex.set(o,[n])}for(const o of this._world.entities)this.addEntity(o);return n}createTagQuery(t){const i=xr.createId(t);if(this._tagQueries.has(i))return this._tagQueries.get(i);const n=new xr(t);this._tagQueries.set(n.id,n);for(const o of t){const l=this._tagToQueriesIndex.get(o);l?l.push(n):this._tagToQueriesIndex.set(o,[n])}for(const o of this._world.entities)this.addEntity(o);return n}addEntity(t){const i=this._addComponentHandlers.get(t),n=this._removeComponentHandlers.get(t),o=i??this._createAddComponentHandler(t),l=n??this._createRemoveComponentHandler(t);this._addComponentHandlers.set(t,o),this._removeComponentHandlers.set(t,l);const d=this._addTagHandlers.get(t),f=this._removeTagHandlers.get(t),g=d??this._createAddTagHandler(t),v=f??this._createRemoveTagHandler(t);this._addTagHandlers.set(t,g),this._removeTagHandlers.set(t,v);for(const w of this._queries.values())w.checkAndAdd(t);for(const w of this._tagQueries.values())w.checkAndAdd(t);t.componentAdded$.subscribe(o),t.componentRemoved$.subscribe(l),t.tagAdded$.subscribe(g),t.tagRemoved$.subscribe(v)}removeEntity(t){const i=this._addComponentHandlers.get(t),n=this._removeComponentHandlers.get(t);for(const d of this._queries.values())d.removeEntity(t);i&&t.componentAdded$.unsubscribe(i),n&&t.componentRemoved$.unsubscribe(n);const o=this._addTagHandlers.get(t),l=this._removeTagHandlers.get(t);for(const d of this._tagQueries.values())d.removeEntity(t);o&&t.tagAdded$.unsubscribe(o),l&&t.tagRemoved$.unsubscribe(l)}addComponent(t,i){var n;const o=(n=this._componentToQueriesIndex.get(i.constructor))!==null&&n!==void 0?n:[];for(const l of o)l.checkAndAdd(t)}removeComponent(t,i){var n;const o=(n=this._componentToQueriesIndex.get(i.constructor))!==null&&n!==void 0?n:[];for(const l of o)l.removeEntity(t)}addTag(t,i){var n;const o=(n=this._tagToQueriesIndex.get(i))!==null&&n!==void 0?n:[];for(const l of o)l.checkAndAdd(t)}removeTag(t,i){var n;const o=(n=this._tagToQueriesIndex.get(i))!==null&&n!==void 0?n:[];for(const l of o)l.removeEntity(t)}}function ff(c){var t,i;return!!(c!=null&&c.prototype)&&!!(!((i=(t=c==null?void 0:c.prototype)===null||t===void 0?void 0:t.constructor)===null||i===void 0)&&i.name)}class pf{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find(i=>i instanceof t)}addSystem(t){let i;t instanceof di?i=t:i=new t(this._world),this.systems.push(i),this.systems.sort((n,o)=>n.priority-o.priority),this.initialized&&i.initialize&&i.initialize(this._world,this._world.scene)}removeSystem(t){q(t,this.systems)}initialize(){if(!this.initialized){this.initialized=!0;for(const t of this.systems)t.initialize&&t.initialize(this._world,this._world.scene)}}updateSystems(t,i,n){const o=this.systems.filter(l=>l.systemType===t);for(const l of o)l.preupdate&&l.preupdate(i,n);for(const l of o)l.update(n);for(const l of o)l.postupdate&&l.postupdate(i,n)}clear(){for(let t=this.systems.length-1;t>=0;t--)this.removeSystem(this.systems[t])}}class gf{constructor(t){this.scene=t,this.queryManager=new df(this),this.entityManager=new uf(this),this.systemManager=new pf(this)}query(t){return this.queryManager.createQuery(t)}queryTags(t){return this.queryManager.createTagQuery(t)}update(t,i){t===We.Update&&this.entityManager.updateEntities(this.scene,i),this.systemManager.updateSystems(t,this.scene,i),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){t instanceof _e&&this.entityManager.addEntity(t),(t instanceof di||ff(t))&&this.systemManager.addSystem(t)}get(t){return this.systemManager.get(t)}remove(t,i=!0){t instanceof _e&&this.entityManager.removeEntity(t,i),t instanceof di&&this.systemManager.removeSystem(t)}get entities(){return this.entityManager.entities}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class De{static integrate(t,i,n,o){const l=o/1e3;i.vel.addEqual(n.scale(l,De._ACC)),t.pos.add(i.vel.scale(l,De._VEL),De._POS).addEqual(n.scale(.5*l*l,De._VEL_ACC)),i.angularVelocity+=i.torque*(1/i.inertia)*l;const d=t.rotation+i.angularVelocity*l;t.scale.add(i.scaleFactor.scale(l,this._SCALE_FACTOR),De._SCALE),t.get().setTransform(De._POS,d,De._SCALE)}}De._POS=new C(0,0),De._SCALE=new C(1,1),De._ACC=new C(0,0),De._VEL=new C(0,0),De._VEL_ACC=new C(0,0),De._SCALE_FACTOR=new C(0,0);class mf extends di{constructor(t,i){super(),this.world=t,this.physics=i,this.systemType=We.Update,this.priority=Bi.Higher,this._physicsConfigDirty=!1,i.$configUpdate.subscribe(()=>this._physicsConfigDirty=!0),this.query=this.world.query([nt,Ht])}update(t){let i,n;const o=this.query.entities;for(let l=0;l<o.length;l++){i=o[l].get(nt),n=o[l].get(Ht);const d=o[l].get(dt);if(this._physicsConfigDirty&&d&&d.updatePhysicsConfig(this.physics.config.bodies),d!=null&&d.sleeping)continue;const f=n.acc.clone();(d==null?void 0:d.collisionType)===pt.Active&&(d!=null&&d.useGravity)&&f.addEqual(this.physics.config.gravity),d==null||d.captureOldTransform(),De.integrate(i,n,f,t)}this._physicsConfigDirty=!1}}class xh{constructor(t){this.config=t,this.directionMap=new Map,this.distanceMap=new Map}solve(t){this.preSolve(t),t=t.filter(n=>!n.isCanceled());let i;switch(this.config.contactSolveBias){case Hs.HorizontalFirst:{i=Md;break}case Hs.VerticalFirst:{i=Bd;break}default:i=Ld}t.sort((n,o)=>{const l=this.directionMap.get(n.id),d=this.directionMap.get(o.id),f=this.distanceMap.get(n.id),g=this.distanceMap.get(o.id);return i[l]-i[d]||f-g});for(const n of t)this.solvePosition(n),this.solveVelocity(n);return this.postSolve(t),t}preSolve(t){for(const n of t){if(Math.abs(n.mtv.x)<1e-4&&Math.abs(n.mtv.y)<1e-4){n.cancel();continue}const o=ut.fromDirection(n.mtv),l=n.mtv.negate(),d=n.colliderA.worldPos.squareDistance(n.colliderB.worldPos);this.distanceMap.set(n.id,d),this.directionMap.set(n.id,o===ut.Left||o===ut.Right?"horizontal":"vertical"),n.colliderA.events.emit("precollision",new Ms(n.colliderA,n.colliderB,o,l,n)),n.colliderB.events.emit("precollision",new Ms(n.colliderB,n.colliderA,ut.getOpposite(o),l.negate(),n))}}postSolve(t){var i,n;for(const o of t){if(o.isCanceled())continue;const l=o.colliderA,d=o.colliderB,f=(i=l.owner)===null||i===void 0?void 0:i.get(dt),g=(n=d.owner)===null||n===void 0?void 0:n.get(dt);if(f&&g&&(f.collisionType===pt.Passive||g.collisionType===pt.Passive))continue;const v=ut.fromDirection(o.mtv),w=o.mtv.negate();o.colliderA.events.emit("postcollision",new Ls(o.colliderA,o.colliderB,v,w,o)),o.colliderB.events.emit("postcollision",new Ls(o.colliderB,o.colliderA,ut.getOpposite(v),w.negate(),o))}}solvePosition(t){var i,n;if(!t.colliderA.bounds.overlaps(t.colliderB.bounds,1e-4)){t.cancel();return}if(Math.abs(t.mtv.x)<1e-4&&Math.abs(t.mtv.y)<1e-4){t.cancel();return}let l=t.mtv;const d=t.colliderA,f=t.colliderB,g=(i=d.owner)===null||i===void 0?void 0:i.get(dt),v=(n=f.owner)===null||n===void 0?void 0:n.get(dt);if(g&&v){if(g.collisionType===pt.Passive||v.collisionType===pt.Passive)return;g.collisionType===pt.Active&&v.collisionType===pt.Active&&(l=l.scale(.5)),g.collisionType===pt.Active&&(g.globalPos.x-=l.x,g.globalPos.y-=l.y,d.update(g.transform.get())),v.collisionType===pt.Active&&(v.globalPos.x+=l.x,v.globalPos.y+=l.y,f.update(v.transform.get()))}}solveVelocity(t){var i,n;if(t.isCanceled())return;const o=t.colliderA,l=t.colliderB,d=(i=o.owner)===null||i===void 0?void 0:i.get(dt),f=(n=l.owner)===null||n===void 0?void 0:n.get(dt);if(d&&f){if(d.collisionType===pt.Passive||f.collisionType===pt.Passive)return;const g=t.normal,v=g.negate();if(d.collisionType===pt.Active&&d.vel.normalize().dot(v)<0){const w=g.scale(g.dot(d.vel.negate()));d.vel=d.vel.add(w)}if(f.collisionType===pt.Active&&f.vel.normalize().dot(g)<0){const w=v.scale(v.dot(f.vel.negate()));f.vel=f.vel.add(w)}}}}class _f{constructor(t,i,n){this.point=t,this.local=i,this.contact=n,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new C(0,0),this.bToContact=new C(0,0),this.originalVelocityAndRestitution=0,this.update()}update(){var t,i;const n=(t=this.contact.colliderA.owner)===null||t===void 0?void 0:t.get(dt),o=(i=this.contact.colliderB.owner)===null||i===void 0?void 0:i.get(dt);if(n&&o){const l=this.contact.normal,d=this.contact.tangent;this.aToContact=this.point.sub(n.globalPos),this.bToContact=this.point.sub(o.globalPos);const f=this.aToContact.cross(l),g=this.bToContact.cross(l);this.normalMass=n.inverseMass+o.inverseMass+n.inverseInertia*f*f+o.inverseInertia*g*g;const v=this.aToContact.cross(d),w=this.bToContact.cross(d);this.tangentMass=n.inverseMass+o.inverseMass+n.inverseInertia*v*v+o.inverseInertia*w*w}return this}getRelativeVelocity(){var t,i;const n=(t=this.contact.colliderA.owner)===null||t===void 0?void 0:t.get(dt),o=(i=this.contact.colliderB.owner)===null||i===void 0?void 0:i.get(dt);if(n&&o){const l=n.vel.add(C.cross(n.angularVelocity,this.aToContact));return o.vel.add(C.cross(o.angularVelocity,this.bToContact)).sub(l)}return C.Zero}}class Ch{constructor(t){this.config=t,this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var i;return(i=this.idToContactConstraint.get(t))!==null&&i!==void 0?i:[]}solve(t){return this.preSolve(t),t=t.filter(i=>!i.isCanceled()),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}preSolve(t){var i,n,o;for(const f of t){if(Math.abs(f.mtv.x)<1e-4&&Math.abs(f.mtv.y)<1e-4){f.cancel();continue}const g=ut.fromDirection(f.mtv);f.colliderA.events.emit("precollision",new Ms(f.colliderA,f.colliderB,g,f.mtv,f)),f.colliderA.events.emit("beforecollisionresolve",new Do(f.colliderA,f.colliderB,g,f.mtv,f)),f.colliderB.events.emit("precollision",new Ms(f.colliderB,f.colliderA,ut.getOpposite(g),f.mtv.negate(),f)),f.colliderB.events.emit("beforecollisionresolve",new Do(f.colliderB,f.colliderA,ut.getOpposite(g),f.mtv.negate(),f)),f.matchAwake()}const d=Array.from(this.idToContactConstraint.keys());for(const f of t){const g=d.indexOf(f.id);g>-1&&d.splice(g,1);const v=(i=this.idToContactConstraint.get(f.id))!==null&&i!==void 0?i:[];let w=0;const x=f.colliderA.owner.get(dt),T=f.colliderB.owner.get(dt);if(x&&T)for(const k of f.points){const B=f.normal,O=f.tangent,G=k.sub(x.globalPos),L=k.sub(T.globalPos),z=G.cross(B),V=L.cross(B),H=x.inverseMass+T.inverseMass+x.inverseInertia*z*z+T.inverseInertia*V*V,st=G.cross(O),mt=L.cross(O),X=x.inverseMass+T.inverseMass+x.inverseInertia*st*st+T.inverseInertia*mt*mt;v[w]&&((o=(n=v[w])===null||n===void 0?void 0:n.point)===null||o===void 0?void 0:o.squareDistance(k))<4?(v[w].point=k,v[w].local=f.localPoints[w]):v[w]=new _f(k,f.localPoints[w],f),v[w].aToContact=G,v[w].bToContact=L,v[w].normalMass=1/H,v[w].tangentMass=1/X;const _t=x.bounciness>T.bounciness?x.bounciness:T.bounciness,Wt=f.normal.dot(v[w].getRelativeVelocity());v[w].originalVelocityAndRestitution=0,Wt<-.1&&(v[w].originalVelocityAndRestitution=-_t*Wt),w++}this.idToContactConstraint.set(f.id,v)}for(const f of d)this.idToContactConstraint.delete(f);if(this.config.warmStart)this.warmStart(t);else for(const f of t){const g=this.getContactConstraints(f.id);for(const v of g)v.normalImpulse=0,v.tangentImpulse=0}}postSolve(t){for(const i of t){const n=i.colliderA.owner.get(dt),o=i.colliderB.owner.get(dt);if(n&&o){if(n.collisionType===pt.Passive||o.collisionType===pt.Passive)continue;n.updateMotion(),o.updateMotion()}const l=ut.fromDirection(i.mtv);i.colliderA.events.emit("postcollision",new Ls(i.colliderA,i.colliderB,l,i.mtv,i)),i.colliderA.events.emit("aftercollisionresolve",new ko(i.colliderA,i.colliderB,l,i.mtv,i)),i.colliderB.events.emit("postcollision",new Ls(i.colliderB,i.colliderA,ut.getOpposite(l),i.mtv.negate(),i)),i.colliderB.events.emit("aftercollisionresolve",new ko(i.colliderB,i.colliderA,ut.getOpposite(l),i.mtv.negate(),i))}this.lastFrameContacts.clear();for(const i of t)this.lastFrameContacts.set(i.id,i)}warmStart(t){var i,n,o;for(const l of t){const d=(i=l.colliderA.owner)===null||i===void 0?void 0:i.get(dt),f=(n=l.colliderB.owner)===null||n===void 0?void 0:n.get(dt);if(d&&f){const g=(o=this.idToContactConstraint.get(l.id))!==null&&o!==void 0?o:[];for(const v of g)if(this.config.warmStart){const w=l.normal.scale(v.normalImpulse),x=l.tangent.scale(v.tangentImpulse),T=w.add(x);d.applyImpulse(v.point,T.negate()),f.applyImpulse(v.point,T)}else v.normalImpulse=0,v.tangentImpulse=0}}}solvePosition(t){var i,n,o;for(let l=0;l<this.config.positionIterations;l++)for(const d of t){const f=(i=d.colliderA.owner)===null||i===void 0?void 0:i.get(dt),g=(n=d.colliderB.owner)===null||n===void 0?void 0:n.get(dt);if(f&&g){if(f.collisionType===pt.Passive||g.collisionType===pt.Passive)continue;const v=(o=this.idToContactConstraint.get(d.id))!==null&&o!==void 0?o:[];for(const w of v){const x=d.normal,T=wi.FindContactSeparation(d,w.local),k=this.config.steeringFactor,B=-5,O=this.config.slop,G=$(k*(T+O),B,0),L=x.scale(-G*w.normalMass);if(f.collisionType===pt.Active){const z=L.negate().scale(f.inverseMass);f.limitDegreeOfFreedom.includes(Re.X)&&(z.x=0),f.limitDegreeOfFreedom.includes(Re.Y)&&(z.y=0),f.globalPos=f.globalPos.add(z),f.limitDegreeOfFreedom.includes(Re.Rotation)||(f.rotation-=w.aToContact.cross(L)*f.inverseInertia)}if(g.collisionType===pt.Active){const z=L.scale(g.inverseMass);g.limitDegreeOfFreedom.includes(Re.X)&&(z.x=0),g.limitDegreeOfFreedom.includes(Re.Y)&&(z.y=0),g.globalPos=g.globalPos.add(z),g.limitDegreeOfFreedom.includes(Re.Rotation)||(g.rotation+=w.bToContact.cross(L)*g.inverseInertia)}}}}}solveVelocity(t){var i,n,o;for(let l=0;l<this.config.velocityIterations;l++)for(const d of t){const f=(i=d.colliderA.owner)===null||i===void 0?void 0:i.get(dt),g=(n=d.colliderB.owner)===null||n===void 0?void 0:n.get(dt);if(f&&g){if(f.collisionType===pt.Passive||g.collisionType===pt.Passive)continue;const v=Math.min(f.friction,g.friction),w=(o=this.idToContactConstraint.get(d.id))!==null&&o!==void 0?o:[];for(const x of w){let B=-x.getRelativeVelocity().dot(d.tangent)*x.tangentMass;const O=v*x.normalImpulse,G=$(x.tangentImpulse+B,-O,O);B=G-x.tangentImpulse,x.tangentImpulse=G;const L=d.tangent.scale(B);f.applyImpulse(x.point,L.negate()),g.applyImpulse(x.point,L)}for(const x of w){const k=x.getRelativeVelocity().dot(d.normal);let B=-x.normalMass*(k-x.originalVelocityAndRestitution);const O=Math.max(x.normalImpulse+B,0);B=O-x.normalImpulse,x.normalImpulse=O;const G=d.normal.scale(B);f.applyImpulse(x.point,G.negate()),g.applyImpulse(x.point,G)}}}}}class bh extends di{get _processor(){return this._physics.collisionProcessor}constructor(t,i){super(),this._physics=i,this.systemType=We.Update,this.priority=Bi.Higher,this._configDirty=!1,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._arcadeSolver=new xh(i.config.arcade),this._realisticSolver=new Ch(i.config.realistic),this._physics.$configUpdate.subscribe(()=>this._configDirty=!0),this._trackCollider=n=>this._processor.track(n),this._untrackCollider=n=>this._processor.untrack(n),this.query=t.query([nt,Ht,Yt]),this.query.entityAdded$.subscribe(n=>{const o=n.get(Yt);o.$colliderAdded.subscribe(this._trackCollider),o.$colliderRemoved.subscribe(this._untrackCollider);const l=o.get();l&&this._processor.track(l)}),this.query.entityRemoved$.subscribe(n=>{const o=n.get(Yt),l=o.get();o&&l&&this._processor.untrack(l)})}initialize(t,i){this._engine=i.engine}update(t){var i,n,o,l;if(!this._physics.config.enabled)return;let d=[];for(const w of this.query.entities){const x=w.get(Yt),T=x==null?void 0:x.get();if(x&&(!((i=x.owner)===null||i===void 0)&&i.active)&&T)if(x.update(),T instanceof pe){const k=T.getColliders();T.compositeStrategy||(T.compositeStrategy=this._physics.config.colliders.compositeStrategy),d=d.concat(k)}else d.push(T)}this._processor.update(d);const f=this._processor.broadphase(d,t);this._currentFrameContacts.clear();let g=this._processor.narrowphase(f,(l=(o=(n=this._engine)===null||n===void 0?void 0:n.debug)===null||o===void 0?void 0:o.stats)===null||l===void 0?void 0:l.currFrame);g=this.getSolver().solve(g);for(const w of g){if(w.isCanceled())continue;const x=w.id.indexOf("|");if(x>0){const T=w.id.substring(x+1);this._currentFrameContacts.set(T,w)}else this._currentFrameContacts.set(w.id,w)}this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts);for(const w of this.query.entities){const x=w.get(Yt);x&&x.processColliderRemoval()}}getSolver(){return this._configDirty&&(this._configDirty=!1,this._arcadeSolver=new xh(this._physics.config.arcade),this._realisticSolver=new Ch(this._physics.config.realistic)),this._physics.config.solver===hs.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t)}runContactStartEnd(){for(const[t,i]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){const n=i.colliderA,o=i.colliderB,l=ut.fromDirection(i.mtv),d=ut.getOpposite(l);n.events.emit("collisionstart",new dr(n,o,l,i)),n.events.emit("contactstart",new Io(n,o,l,i)),o.events.emit("collisionstart",new dr(o,n,d,i)),o.events.emit("contactstart",new Io(o,n,d,i))}for(const[t,i]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){const n=i.colliderA,o=i.colliderB,l=ut.fromDirection(i.mtv),d=ut.getOpposite(l);n.events.emit("collisionend",new fr(n,o,l,i)),n.events.emit("contactend",new Ro(n,o,l,i)),o.events.emit("collisionend",new fr(o,n,d,i)),o.events.emit("contactend",new Ro(o,n,d,i))}}}function vf(c){return class extends c{assign(t){for(const i in t)typeof this[i]!="function"&&(this[i]=t[i])}constructor(...t){super(...t),t.filter(function(n){return n!==void 0}).length===1&&t[0]&&typeof t[0]=="object"&&!(t[0]instanceof Array)&&this.assign(t[0])}}}var Cn;(function(c){c[c.Circle=0]="Circle",c[c.Rectangle=1]="Rectangle"})(Cn||(Cn={}));class r0 extends _e{constructor(t,i,n,o,l,d,f,g,v,w,x){super(),this.position=new C(0,0),this.velocity=new C(0,0),this.acceleration=new C(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=N.White,this.endColor=N.White,this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=N.White,this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.visible=!0,this.isOffscreen=!1;let T=t;if(T&&!(t instanceof yf)){const k=t;T=k.emitter,i=k.life,n=k.opacity,l=k.endColor,o=k.beginColor,d=k.position,f=k.velocity,g=k.acceleration,v=k.startSize,w=k.endSize,x=k.particleSprite}if(this.emitter=T,this.life=i||this.life,this.opacity=n||this.opacity,this.endColor=l||this.endColor.clone(),this.beginColor=o||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.particleSprite=x,this.emitter.particleTransform===bn.Global){const k=this.emitter.transform.globalPos;this.position=(d||this.position).add(k),this.velocity=(f||this.velocity).rotate(this.emitter.transform.globalRotation)}else this.velocity=f||this.velocity,this.position=d||this.position;this.acceleration=g||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=v||0,this.endSize=w||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize),this.addComponent(this.transform=new nt),this.addComponent(this.graphics=new oe),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=D(1,1),this.transform.z=this.emitter.z,this.particleSprite?(this.graphics.opacity=this.opacity,this.graphics.use(this.particleSprite)):(this.graphics.localBounds=tt.fromDimension(this.particleSize,this.particleSize,C.Half),this.graphics.onPostDraw=k=>{k.save(),this.graphics.opacity=this.opacity;const B=this._currentColor.clone();B.a=1,k.debug.drawPoint(D(0,0),{color:B,size:this.particleSize}),k.restore()})}kill(){this.emitter.removeParticle(this)}update(t,i){if(this.life=this.life-i,this.elapsedMultiplier=this.elapsedMultiplier+i,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=$(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=$(this.sizeRate*i+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=$(this._currentColor.r+this._rRate*i,0,255),this._currentColor.g=$(this._currentColor.g+this._gRate*i,0,255),this._currentColor.b=$(this._currentColor.b+this._bRate*i,0,255),this._currentColor.a=$(this.opacity,1e-4,1),this.focus){const n=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(i/1e3);this.velocity=this.velocity.add(n)}else this.velocity=this.velocity.add(this.acceleration.scale(i/1e3));this.position=this.position.add(this.velocity.scale(i/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*i/1e3)%(2*Math.PI)),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=D(1,1),this.graphics.opacity=this.opacity}}class $o extends vf(r0){constructor(t,i,n,o,l,d,f,g,v,w,x){super(t,i,n,o,l,d,f,g,v,w,x)}}var bn;(function(c){c.Global="global",c.Local="local"})(bn||(bn={}));class yf extends He{get opacity(){return this.graphics.opacity}set opacity(t){this.graphics.opacity=t}get particleSprite(){return this._sprite}set particleSprite(t){t&&(this._sprite=t)}constructor(t){var i,n;super({width:(i=t.width)!==null&&i!==void 0?i:0,height:(n=t.height)!==null&&n!==void 0?n:0}),this._particlesToEmit=0,this.numParticles=0,this.isEmitting=!0,this.particles=[],this.deadParticles=[],this.minVel=0,this.maxVel=0,this.acceleration=new C(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.fadeFlag=!1,this.focus=null,this.focusAccel=null,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=N.White,this.endColor=N.White,this._sprite=null,this.emitterType=Cn.Rectangle,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1,this.particleTransform=bn.Global;const{x:o,y:l,z:d,pos:f,isEmitting:g,minVel:v,maxVel:w,acceleration:x,minAngle:T,maxAngle:k,emitRate:B,particleLife:O,opacity:G,fadeFlag:L,focus:z,focusAccel:V,startSize:H,endSize:st,minSize:mt,maxSize:X,beginColor:_t,endColor:Wt,particleSprite:ce,emitterType:je,radius:Ge,particleRotationalVelocity:Ve,particleTransform:Fe,randomRotation:ve,random:ye}={...t};this.pos=f??D(o??0,l??0),this.z=d??0,this.isEmitting=g??this.isEmitting,this.minVel=v??this.minVel,this.maxVel=w??this.maxVel,this.acceleration=x??this.acceleration,this.minAngle=T??this.minAngle,this.maxAngle=k??this.maxAngle,this.emitRate=B??this.emitRate,this.particleLife=O??this.particleLife,this.opacity=G??this.opacity,this.fadeFlag=L??this.fadeFlag,this.focus=z??this.focus,this.focusAccel=V??this.focusAccel,this.startSize=H??this.startSize,this.endSize=st??this.endSize,this.minSize=mt??this.minSize,this.maxSize=X??this.maxSize,this.beginColor=_t??this.beginColor,this.endColor=Wt??this.endColor,this.particleSprite=ce??this.particleSprite,this.emitterType=je??this.emitterType,this.radius=Ge??this.radius,this.particleRotationalVelocity=Ve??this.particleRotationalVelocity,this.randomRotation=ve??this.randomRotation,this.particleTransform=Fe??this.particleTransform,this.body.collisionType=pt.PreventCollision,this.random=ye??new S}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){var i;for(let n=0;n<t;n++){const o=this._createParticle();this.particles.push(o),!((i=this===null||this===void 0?void 0:this.scene)===null||i===void 0)&&i.world&&(this.particleTransform===bn.Global?this.scene.world.add(o):this.addChild(o))}}clearParticles(){this.particles.length=0}_createParticle(){let t=0,i=0;const n=W(this.minAngle,this.maxAngle,this.random),o=W(this.minVel,this.maxVel,this.random),l=this.startSize||W(this.minSize,this.maxSize,this.random),d=o*Math.cos(n),f=o*Math.sin(n);if(this.emitterType===Cn.Rectangle)t=W(0,this.width,this.random),i=W(0,this.height,this.random);else if(this.emitterType===Cn.Circle){const v=W(0,this.radius,this.random);t=v*Math.cos(n),i=v*Math.sin(n)}const g=new $o(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new C(t,i),new C(d,f),this.acceleration,this.startSize,this.endSize,this.particleSprite);return g.fadeFlag=this.fadeFlag,g.particleSize=l,g.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(g.currentRotation=W(0,Math.PI*2,this.random)),this.focus&&(g.focus=this.focus.add(new C(this.pos.x,this.pos.y)),g.focusAccel=this.focusAccel),g}update(t,i){var n;super.update(t,i),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(i/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let o=0;o<this.deadParticles.length;o++)q(this.deadParticles[o],this.particles),!((n=this===null||this===void 0?void 0:this.scene)===null||n===void 0)&&n.world&&this.scene.world.remove(this.deadParticles[o],!1);this.deadParticles.length=0}}function o0(c,t,i,n){if(c.parent!==t.parent){const w=c.clone(),x=c.globalPos.clone(),T=c.globalScale.clone(),k=c.globalRotation;w.parent=t.parent,w.globalPos=x,w.globalScale=T,w.globalRotation=k,c=w}let o=t.pos,l=t.scale,d=t.rotation;o=t.pos.scale(i).add(c.pos.scale(1-i)),l=t.scale.scale(i).add(c.scale.scale(1-i));const f=(1-i)*Math.cos(c.rotation)+i*Math.cos(t.rotation),g=(1-i)*Math.sin(c.rotation)+i*Math.sin(t.rotation);d=Math.atan2(g,f);const v=n??new Us;return v.setTransform(o,d,l),v}class wf extends di{get sortedTransforms(){return this._sortedTransforms}constructor(t){super(),this.world=t,this.systemType=We.Draw,this.priority=Bi.Average,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this._targetInterpolationTransform=new Us,this.query=this.world.query([nt,oe]),this.query.entityAdded$.subscribe(i=>{const n=i.get(nt);this._sortedTransforms.push(n),n.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(i=>{const n=i.get(nt);n.zIndexChanged$.unsubscribe(this._zIndexUpdate);const o=this._sortedTransforms.indexOf(n);o>-1&&this._sortedTransforms.splice(o,1)})}initialize(t,i){this._camera=i.camera,this._engine=i.engine}preupdate(){this._graphicsContext=this._engine.graphicsContext,this._zHasChanged&&(this._sortedTransforms.sort((t,i)=>t.z-i.z),this._zHasChanged=!1)}update(t){this._token++;let i;It.checkAndClearCache(),this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(const n of this._sortedTransforms){const o=n.owner;if(o.hasTag("ex.offscreen")||(i=o.get(oe),!i.visible))continue;i.onPreTransformDraw&&i.onPreTransformDraw(this._graphicsContext,t),o.events.emit("pretransformdraw",new Wl(this._graphicsContext,t,o)),n.coordPlane===ne.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),n.coordPlane===ne.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),i.update(t,this._token);const l=o.get(Go);if(l){const f=C.One.sub(l.parallaxFactor),g=this._camera.drawPos.scale(f);this._graphicsContext.translate(g.x,g.y)}this._applyTransform(o),i.material&&(this._graphicsContext.material=i.material),i.onPreDraw&&i.onPreDraw(this._graphicsContext,t),o.events.emit("predraw",new mn(this._graphicsContext,t,o));const d=o instanceof $o?o.opacity:1;this._graphicsContext.opacity*=i.opacity*d,this._drawGraphicsComponent(i,n),i.onPostDraw&&i.onPostDraw(this._graphicsContext,t),o.events.emit("postdraw",new _n(this._graphicsContext,t,o)),this._graphicsContext.restore(),n.coordPlane===ne.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext)),i.onPostTransformDraw&&i.onPostTransformDraw(this._graphicsContext,t),o.events.emit("posttransformdraw",new jl(this._graphicsContext,t,o))}this._graphicsContext.restore()}_drawGraphicsComponent(t,i){var n,o;if(t.visible){const l=t.flipHorizontal,d=t.flipVertical,f=t.current,g=(n=t.currentOptions)!==null&&n!==void 0?n:{};if(f){let v=t.anchor,w=t.offset,x=1,T=1;g!=null&&g.anchor&&(v=g.anchor),g!=null&&g.offset&&(w=g.offset);const k=i.globalScale;x*=f.scale.x*k.x,T*=f.scale.y*k.y;const B=-f.width*v.x+w.x*x,O=-f.height*v.y+w.y*T,G=f.flipHorizontal,L=f.flipVertical;if((l||d)&&(f.flipHorizontal=l?!G:G,f.flipVertical=d?!L:L),f==null||f.draw(this._graphicsContext,B,O),(l||d)&&(f.flipHorizontal=G,f.flipVertical=L),!((o=this._engine)===null||o===void 0)&&o.isDebug&&this._engine.debug.graphics.showBounds){const z=D(B,O);if(f instanceof yn)for(const V of f.members){let H,st=C.Zero;V instanceof Lt?H=V:(H=V.graphic,st=V.offset),f.useAnchor?H==null||H.localBounds.translate(z.add(st)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor):H==null||H.localBounds.translate(st).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}else f==null||f.localBounds.translate(z).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}}_applyTransform(t){const i=t.getAncestors();for(const n of i){const o=n==null?void 0:n.get(nt),l=n==null?void 0:n.get(dt);let d=o.get();if(l&&this._engine.fixedUpdateFps&&l.__oldTransformCaptured&&l.enableFixedUpdateInterpolate){const f=this._engine.currentFrameLagMs/(1e3/this._engine.fixedUpdateFps);d=o0(l.oldTransform,o.get(),f,this._targetInterpolationTransform)}o&&(this._graphicsContext.z=o.z,this._graphicsContext.translate(d.pos.x,d.pos.y),this._graphicsContext.scale(d.scale.x,d.scale.y),this._graphicsContext.rotate(d.rotation))}}}class xf extends di{constructor(t){super(),this.world=t,this.systemType=We.Draw,this.priority=Bi.Lowest,this.query=this.world.query([nt])}initialize(t,i){this._graphicsContext=i.engine.graphicsContext,this._camera=i.camera,this._engine=i.engine,this._collisionSystem=t.systemManager.get(bh)}update(){var t;if(!this._engine.isDebug)return;const i=this._engine.debug.filter;let n,o;const l=this._engine.debug.entity;let d;const f=this._engine.debug.transform;let g;const v=this._engine.debug.motion;let w;const x=this._engine.debug.collider,T=this._engine.debug.physics;let k;const B=this._engine.debug.graphics;let O,G;const L=this._engine.debug.body,z=this._engine.debug.camera;for(const V of this.query.entities){if(V.hasTag("offscreen")||V instanceof $o||i.useFilter&&(!(i.ids.length===0||i.ids.includes(V.id))||!(i.nameQuery===""||V.name.includes(i.nameQuery))))continue;let H=C.Zero;const st=D(0,16);if(n=V.id,o=V.name,d=V.get(nt),this._pushCameraTransform(d),this._graphicsContext.save(),d.coordPlane===ne.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=f.debugZIndex,this._applyTransform(V),d&&((f.showAll||f.showPosition)&&this._graphicsContext.debug.drawPoint(C.Zero,{size:4,color:f.positionColor}),(f.showAll||f.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${d.pos.toString(2)}`,H),H=H.add(st)),(f.showAll||f.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${d.z.toFixed(1)})`,H),H=H.add(st)),(l.showAll||l.showId)&&(this._graphicsContext.debug.drawText(`id(${n}) ${V.parent?"child of id("+((t=V.parent)===null||t===void 0?void 0:t.id)+")":""}`,H),H=H.add(st)),(l.showAll||l.showName)&&(this._graphicsContext.debug.drawText(`name(${o})`,H),H=H.add(st)),(f.showAll||f.showRotation)&&(this._graphicsContext.drawLine(C.Zero,C.fromAngle(d.rotation).scale(50).add(C.Zero),f.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${P(d.rotation).toFixed(2)})`,H),H=H.add(st)),(f.showAll||f.showScale)&&this._graphicsContext.drawLine(C.Zero,d.scale.add(C.Zero),f.scaleColor,2)),k=V.get(oe),k&&(B.showAll||B.showBounds)&&k.localBounds.draw(this._graphicsContext,B.boundsColor),O=V.get(Vo),O&&(O.useTransform||this._graphicsContext.restore(),O.draw(this._graphicsContext,this._engine.debug),O.useTransform||(this._graphicsContext.save(),this._applyTransform(V))),G=V.get(dt),G&&((L.showAll||L.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${G.group.name})`,H),H=H.add(st)),(L.showAll||L.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${G.collisionType})`,H),H=H.add(st)),(L.showAll||L.showMass)&&(this._graphicsContext.debug.drawText(`mass(${G.mass})`,H),H=H.add(st)),(L.showAll||L.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${G.sleepMotion})`,H),H=H.add(st)),(L.showAll||L.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${G.canSleep?G.sleeping:"cant sleep"})`,H),H=H.add(st))),this._graphicsContext.restore(),this._graphicsContext.save(),d.coordPlane===ne.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=f.debugZIndex,g=V.get(Ht),g&&((v.showAll||v.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${g.vel.toString(2)}`,H.add(d.globalPos)),this._graphicsContext.drawLine(d.globalPos,d.globalPos.add(g.vel),v.velocityColor,2),H=H.add(st)),(v.showAll||v.showAcceleration)&&this._graphicsContext.drawLine(d.globalPos,d.globalPos.add(g.acc),v.accelerationColor,2)),w=V.get(Yt),w){const mt=w.get();if((x.showAll||x.showGeometry)&&mt&&mt.debug(this._graphicsContext,x.geometryColor,{lineWidth:x.geometryLineWidth,pointSize:x.geometryPointSize}),x.showAll||x.showBounds){if(mt instanceof pe){const X=mt.getColliders();for(const _t of X){const Wt=_t.bounds,ce=D(Wt.left,Wt.top);this._graphicsContext.debug.drawRect(ce.x,ce.y,Wt.width,Wt.height,{color:x.boundsColor}),(x.showAll||x.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${_t.owner.id})`,ce)}w.bounds.draw(this._graphicsContext,x.boundsColor)}else if(mt){const X=w.bounds,_t=D(X.left,X.top);this._graphicsContext.debug.drawRect(_t.x,_t.y,X.width,X.height,{color:x.boundsColor}),(x.showAll||x.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${w.owner.id})`,_t)}}}this._graphicsContext.restore(),this._popCameraTransform(d)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(T.showAll||T.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),T.showAll||T.showCollisionContacts||T.showCollisionNormals)for(const[V,H]of this._engine.debug.stats.currFrame.physics.contacts){if(T.showAll||T.showCollisionContacts)for(const st of H.points)this._graphicsContext.debug.drawPoint(st,{size:T.contactSize,color:T.collisionContactColor});if(T.showAll||T.showCollisionNormals)for(const st of H.points)this._graphicsContext.debug.drawLine(st,H.normal.scale(30).add(st),{color:T.collisionNormalColor})}this._graphicsContext.restore(),z&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(z.showAll||z.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,z.focusColor),(z.showAll||z.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}postupdate(t,i){this._engine.isDebug&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext),re.flush(this._graphicsContext),this._graphicsContext.restore())}_applyTransform(t){const i=t.getAncestors();for(const n of i){const o=n==null?void 0:n.get(nt);o&&(this._graphicsContext.translate(o.pos.x,o.pos.y),this._graphicsContext.scale(o.scale.x,o.scale.y),this._graphicsContext.rotate(o.rotation))}}_pushCameraTransform(t){t.coordPlane===ne.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===ne.World&&this._graphicsContext.restore()}}class Yo extends di{constructor(t){super(),this.world=t,this.systemType=We.Update,this.priority=Bi.Higher,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this.lastFrameEntityToPointers=new Map,this.currentFrameEntityToPointers=new Map,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this.query=this.world.query([nt,Fi]),this.query.entityAdded$.subscribe(i=>{const n=i.get(nt);this._sortedTransforms.push(n),this._sortedEntities.push(n.owner),n.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(i=>{const n=i.get(nt);n.zIndexChanged$.unsubscribe(this._zIndexUpdate);const o=this._sortedTransforms.indexOf(n);o>-1&&(this._sortedTransforms.splice(o,1),this._sortedEntities.splice(o,1))})}initialize(t,i){this._engine=i.engine,this._scene=i}preupdate(){this._receivers=[this._engine.input.pointers,this._scene.input.pointers],this._engineReceiver=this._engine.input.pointers,this._zHasChanged&&(this._sortedTransforms.sort((t,i)=>i.z-t.z),this._sortedEntities=this._sortedTransforms.map(t=>t.owner),this._zHasChanged=!1)}entityCurrentlyUnderPointer(t,i){return this.currentFrameEntityToPointers.has(t.id)&&this.currentFrameEntityToPointers.get(t.id).includes(i)}entityWasUnderPointer(t,i){return this.lastFrameEntityToPointers.has(t.id)&&this.lastFrameEntityToPointers.get(t.id).includes(i)}entered(t,i){return this.entityCurrentlyUnderPointer(t,i)&&!this.lastFrameEntityToPointers.has(t.id)}left(t,i){return!this.currentFrameEntityToPointers.has(t.id)&&this.entityWasUnderPointer(t,i)}addPointerToEntity(t,i){if(!this.currentFrameEntityToPointers.has(t.id)){this.currentFrameEntityToPointers.set(t.id,[i]);return}const n=this.currentFrameEntityToPointers.get(t.id);this.currentFrameEntityToPointers.set(t.id,n.concat(i))}update(){this._processPointerToEntity(this._sortedEntities),this._dispatchEvents(this._sortedEntities),this._receivers.forEach(t=>t.update()),this.lastFrameEntityToPointers.clear(),this.lastFrameEntityToPointers=new Map(this.currentFrameEntityToPointers),this.currentFrameEntityToPointers.clear(),this._receivers.forEach(t=>t.clear())}_processPointerToEntity(t){var i;let n,o,l,d;const f=this._engineReceiver;for(const g of t){if(n=g.get(nt),d=(i=g.get(Fi))!==null&&i!==void 0?i:new Fi,d.localBounds){const v=d.localBounds.transform(n.get().matrix);for(const[w,x]of f.currentFramePointerCoords.entries())v.contains(n.coordPlane===ne.World?x.worldPos:x.screenPos)&&this.addPointerToEntity(g,w)}if(o=g.get(Yt),o&&(d.useColliderShape||this.overrideUseColliderShape)){o.update();const v=o.get();if(v)for(const[w,x]of f.currentFramePointerCoords.entries())v.contains(n.coordPlane===ne.World?x.worldPos:x.screenPos)&&this.addPointerToEntity(g,w)}if(l=g.get(oe),l&&(d.useGraphicsBounds||this.overrideUseGraphicsBounds)){const v=l.localBounds.transform(n.get().matrix);for(const[w,x]of f.currentFramePointerCoords.entries())v.contains(n.coordPlane===ne.World?x.worldPos:x.screenPos)&&this.addPointerToEntity(g,w)}}}_processDownAndEmit(t){const i=this._engineReceiver,n=new Map;for(const o of i.currentFrameDown)o.active&&t.active&&this.entityCurrentlyUnderPointer(t,o.pointerId)&&(t.events.emit("pointerdown",o),i.isDragStart(o.pointerId)&&t.events.emit("pointerdragstart",o)),n.set(o.pointerId,o);return n}_processUpAndEmit(t){const i=this._engineReceiver,n=new Map;for(const o of i.currentFrameUp)o.active&&t.active&&this.entityCurrentlyUnderPointer(t,o.pointerId)&&(t.events.emit("pointerup",o),i.isDragEnd(o.pointerId)&&t.events.emit("pointerdragend",o)),n.set(o.pointerId,o);return n}_processMoveAndEmit(t){const i=this._engineReceiver,n=new Map;for(const o of i.currentFrameMove)o.active&&t.active&&this.entityCurrentlyUnderPointer(t,o.pointerId)&&(t.events.emit("pointermove",o),i.isDragging(o.pointerId)&&t.events.emit("pointerdragmove",o)),n.set(o.pointerId,o);return n}_processEnterLeaveAndEmit(t,i){const n=this._engineReceiver;for(const o of i){if(o.active&&t.active&&this.entered(t,o.pointerId)){t.events.emit("pointerenter",o),n.isDragging(o.pointerId)&&t.events.emit("pointerdragenter",o);break}if(o.active&&t.active&&(this.left(t,o.pointerId)||this.entityCurrentlyUnderPointer(t,o.pointerId)&&o.type==="up")){t.events.emit("pointerleave",o),n.isDragging(o.pointerId)&&t.events.emit("pointerdragleave",o);break}}}_processCancelAndEmit(t){const i=this._engineReceiver;for(const n of i.currentFrameCancel)n.active&&t.active&&this.entityCurrentlyUnderPointer(t,n.pointerId)&&t.events.emit("pointercancel",n)}_processWheelAndEmit(t){const i=this._engineReceiver;for(const n of i.currentFrameWheel)n.active&&t.active&&this.entityCurrentlyUnderPointer(t,0)&&t.events.emit("pointerwheel",n)}_dispatchEvents(t){const i=new Set(this.lastFrameEntityToPointers.keys()),n=new Set(this.currentFrameEntityToPointers.keys()),o=t.filter(g=>i.has(g.id)||n.has(g.id));let l,d,f;for(const g of o){f=this._processDownAndEmit(g),d=this._processUpAndEmit(g),l=this._processMoveAndEmit(g);const v=[...l.values(),...f.values(),...d.values()];this._processEnterLeaveAndEmit(g,v),this._processCancelAndEmit(g),this._processWheelAndEmit(g)}}}class Cf extends di{constructor(t){super(),this.world=t,this.systemType=We.Update,this.priority=Bi.Higher,this._actions=[],this.query=this.world.query([wn]),this.query.entityAdded$.subscribe(i=>this._actions.push(i.get(wn))),this.query.entityRemoved$.subscribe(i=>{const n=i.get(wn),o=this._actions.indexOf(n);o>-1&&this._actions.splice(o,1)})}update(t){for(const i of this._actions)i.update(t)}}class Cr extends yi{constructor(t){super(),this.elevation=0,this.columns=t.columns,this.rows=t.rows,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight}}class bf extends di{constructor(t){super(),this.world=t,this.systemType=We.Update,this.priority=Bi.Lower,this.query=this.world.query([nt,Cr])}update(){let t,i;for(const n of this.query.entities){t=n.get(nt),i=n.get(Cr);const l=Math.max(i.columns*i.tileWidth,i.rows*i.tileHeight)*i.elevation+t.pos.y;t.z=l}}}class Af extends di{constructor(t){super(),this.world=t,this.systemType=We.Draw,this.priority=Bi.Higher,this.query=this.world.query([nt,oe])}initialize(t,i){this._camera=i.camera,this._screen=i.engine.screen}update(){this._worldBounds=this._screen.getWorldBounds();let t,i,n;for(const o of this.query.entities){i=o.get(oe),t=o.get(nt),n=o.get(Go);let l;if(n){const f=C.One.sub(n.parallaxFactor);l=this._camera.pos.scale(f)}const d=this._isOffscreen(t,i,l);d&&!o.hasTag("ex.offscreen")&&(o.events.emit("exitviewport",new ih(o)),o.addTag("ex.offscreen")),!d&&o.hasTag("ex.offscreen")&&(o.events.emit("enterviewport",new sh(o)),o.removeTag("ex.offscreen"))}}_isOffscreen(t,i,n){if(t.coordPlane===ne.World){let o=i.localBounds;n&&(o=o.translate(n));const l=o.transform(t.get().matrix);return!this._worldBounds.overlaps(l)}else return!1}}class Sf{get config(){return kl(this._config,t=>{this.$configUpdate.notifyAll(t)})}set config(t){this._config=t,this.$configUpdate.notifyAll(t)}get collisionProcessor(){if(this._configDirty){this._configDirty=!1;const t=this._collisionProcessor.getColliders();this._collisionProcessor=new Bo(this._config);for(const i of t)this._collisionProcessor.track(i)}return this._collisionProcessor}constructor(t){this.$configUpdate=new be,this._configDirty=!1,this.config=t,this.$configUpdate.subscribe(i=>{this._configDirty=!0,dt.updateDefaultPhysicsConfig(i.bodies)}),this._collisionProcessor=new Bo(this.config)}rayCast(t,i){return this.collisionProcessor.rayCast(t,i)}}class br{constructor(){this.events=new y,this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null,this._enabled=!0}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}toggleEnabled(t){this._enabled=t}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const i=t.axes.filter(o=>typeof o!==void 0).length,n=t.buttons.filter(o=>typeof o!==void 0).length;return i>=this._minimumConfiguration.axis&&n>=this._minimumConfiguration.buttons&&t.connected}emit(t,i){this.events.emit(t,i)}on(t,i){return this._enableAndUpdate(),this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this._enableAndUpdate(),this.events.off(t,i)}update(){if(!this.enabled||!this.supported||!this._enabled)return;this.init();const t=this._navigator.getGamepads();for(let i=0;i<t.length;i++){if(t[i])!this.at(i).connected&&this._isGamepadValid(t[i])&&this.events.emit("connect",new Yl(i,this.at(i))),this.at(i).connected=!0;else{const g=this.at(i);g.connected&&this.events.emit("disconnect",new Ql(i,g)),g.connected=!1;continue}if(this.at(i).update(),t[i].timestamp&&t[i].timestamp===this._gamePadTimeStamps[i])continue;this._gamePadTimeStamps[i]=t[i].timestamp,this.at(i).navigatorGamepad=t[i];let n,o,l,d,f;for(n in An)o=An[n],typeof o=="number"&&t[i].buttons[o]&&(f=t[i].buttons[o].value,f!==this._oldPads[i].getButton(o)&&(t[i].buttons[o].pressed?(this.at(i).updateButton(o,f),this.at(i).events.emit("button",new Zl(o,f,this.at(i)))):this.at(i).updateButton(o,0)));for(l in Sn)d=Sn[l],typeof d=="number"&&(f=t[i].axes[d],f!==this._oldPads[i].getAxes(d)&&(this.at(i).updateAxes(d,f),this.at(i).events.emit("axis",new ql(d,f,this.at(i)))));this._oldPads[i]=this._clonePad(t[i])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let i=this._pads.length-1,n=t;i<n;i++)this._pads.push(new Ar),this._oldPads.push(new Ar);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let i=0;i<this._pads.length;i++)this._isGamepadValid(this.at(i).navigatorGamepad)&&this.at(i).connected&&t.push(this.at(i));return t}count(){return this._pads.filter(t=>t.connected).length}_clonePads(t){const i=[];for(let n=0,o=t.length;n<o;n++)i.push(this._clonePad(t[n]));return i}_clonePad(t){let i,n;const o=new Ar;if(!t)return o;for(i=0,n=t.buttons.length;i<n;i++)t.buttons[i]&&o.updateButton(i,t.buttons[i].value);for(i=0,n=t.axes.length;i<n;i++)o.updateAxes(i,t.axes[i]);return o}}br.MinAxisMoveThreshold=.05;class Ar{constructor(){this.events=new y,this.connected=!1,this._axes=new Array(4),this._buttons=new Array(16),this._buttonsUp=new Array(16),this._buttonsDown=new Array(16);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}update(){this._buttonsDown=new Array(16),this._buttonsUp=new Array(16)}isButtonPressed(t,i=1){return this._buttons[t]>=i}isButtonHeld(t,i=1){return this._buttons[t]>=i}wasButtonPressed(t,i=1){return this._buttonsDown[t]>=i}wasButtonReleased(t){return!!this._buttonsUp[t]}getButton(t){return this._buttons[t]}getAxes(t){const i=this._axes[t];return Math.abs(i)<br.MinAxisMoveThreshold?0:i}updateButton(t,i){i===0&&this._buttons[t]?this._buttonsUp[t]=1:this._buttonsDown[t]=i,this._buttons[t]=i}updateAxes(t,i){this._axes[t]=i}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}}var An;(function(c){c[c.Face1=0]="Face1",c[c.Face2=1]="Face2",c[c.Face3=2]="Face3",c[c.Face4=3]="Face4",c[c.LeftBumper=4]="LeftBumper",c[c.RightBumper=5]="RightBumper",c[c.LeftTrigger=6]="LeftTrigger",c[c.RightTrigger=7]="RightTrigger",c[c.Select=8]="Select",c[c.Start=9]="Start",c[c.LeftStick=10]="LeftStick",c[c.RightStick=11]="RightStick",c[c.DpadUp=12]="DpadUp",c[c.DpadDown=13]="DpadDown",c[c.DpadLeft=14]="DpadLeft",c[c.DpadRight=15]="DpadRight"})(An||(An={}));var Sn;(function(c){c[c.LeftStickX=0]="LeftStickX",c[c.LeftStickY=1]="LeftStickY",c[c.RightStickX=2]="RightStickX",c[c.RightStickY=3]="RightStickY"})(Sn||(Sn={}));class Ef{constructor(t){this.inputs=t,this._handlers=new Map}execute(){for(const[t,i]of this._handlers.entries()){const n=t(this.inputs);n&&i(n)}}on(t,i){this._handlers.set(t,i)}}function Tf(){try{const c=()=>{};window.top.addEventListener("blur",c),window.top.removeEventListener("blur",c)}catch{return!0}return!1}var En;(function(c){c.Num0="Numpad0",c.Num1="Numpad1",c.Num2="Numpad2",c.Num3="Numpad3",c.Num4="Numpad4",c.Num5="Numpad5",c.Num6="Numpad6",c.Num7="Numpad7",c.Num8="Numpad8",c.Num9="Numpad9",c.NumAdd="NumpadAdd",c.NumSubtract="NumpadSubtract",c.NumMultiply="NumpadMultiply",c.NumDivide="NumpadDivide",c.NumDecimal="NumpadDecimal",c.Numpad0="Numpad0",c.Numpad1="Numpad1",c.Numpad2="Numpad2",c.Numpad3="Numpad3",c.Numpad4="Numpad4",c.Numpad5="Numpad5",c.Numpad6="Numpad6",c.Numpad7="Numpad7",c.Numpad8="Numpad8",c.Numpad9="Numpad9",c.NumpadAdd="NumpadAdd",c.NumpadSubtract="NumpadSubtract",c.NumpadMultiply="NumpadMultiply",c.NumpadDivide="NumpadDivide",c.NumpadDecimal="NumpadDecimal",c.NumLock="NumLock",c.ShiftLeft="ShiftLeft",c.ShiftRight="ShiftRight",c.AltLeft="AltLeft",c.AltRight="AltRight",c.ControlLeft="ControlLeft",c.ControlRight="ControlRight",c.MetaLeft="MetaLeft",c.MetaRight="MetaRight",c.Key0="Digit0",c.Key1="Digit1",c.Key2="Digit2",c.Key3="Digit3",c.Key4="Digit4",c.Key5="Digit5",c.Key6="Digit6",c.Key7="Digit7",c.Key8="Digit8",c.Key9="Digit9",c.Digit0="Digit0",c.Digit1="Digit1",c.Digit2="Digit2",c.Digit3="Digit3",c.Digit4="Digit4",c.Digit5="Digit5",c.Digit6="Digit6",c.Digit7="Digit7",c.Digit8="Digit8",c.Digit9="Digit9",c.F1="F1",c.F2="F2",c.F3="F3",c.F4="F4",c.F5="F5",c.F6="F6",c.F7="F7",c.F8="F8",c.F9="F9",c.F10="F10",c.F11="F11",c.F12="F12",c.A="KeyA",c.B="KeyB",c.C="KeyC",c.D="KeyD",c.E="KeyE",c.F="KeyF",c.G="KeyG",c.H="KeyH",c.I="KeyI",c.J="KeyJ",c.K="KeyK",c.L="KeyL",c.M="KeyM",c.N="KeyN",c.O="KeyO",c.P="KeyP",c.Q="KeyQ",c.R="KeyR",c.S="KeyS",c.T="KeyT",c.U="KeyU",c.V="KeyV",c.W="KeyW",c.X="KeyX",c.Y="KeyY",c.Z="KeyZ",c.KeyA="KeyA",c.KeyB="KeyB",c.KeyC="KeyC",c.KeyD="KeyD",c.KeyE="KeyE",c.KeyF="KeyF",c.KeyG="KeyG",c.KeyH="KeyH",c.KeyI="KeyI",c.KeyJ="KeyJ",c.KeyK="KeyK",c.KeyL="KeyL",c.KeyM="KeyM",c.KeyN="KeyN",c.KeyO="KeyO",c.KeyP="KeyP",c.KeyQ="KeyQ",c.KeyR="KeyR",c.KeyS="KeyS",c.KeyT="KeyT",c.KeyU="KeyU",c.KeyV="KeyV",c.KeyW="KeyW",c.KeyX="KeyX",c.KeyY="KeyY",c.KeyZ="KeyZ",c.Semicolon="Semicolon",c.Quote="Quote",c.Comma="Comma",c.Minus="Minus",c.Period="Period",c.Slash="Slash",c.Equal="Equal",c.BracketLeft="BracketLeft",c.Backslash="Backslash",c.BracketRight="BracketRight",c.Backquote="Backquote",c.Up="ArrowUp",c.Down="ArrowDown",c.Left="ArrowLeft",c.Right="ArrowRight",c.ArrowUp="ArrowUp",c.ArrowDown="ArrowDown",c.ArrowLeft="ArrowLeft",c.ArrowRight="ArrowRight",c.Space="Space",c.Backspace="Backspace",c.Delete="Delete",c.Esc="Escape",c.Escape="Escape",c.Enter="Enter",c.NumpadEnter="NumpadEnter",c.ContextMenu="ContextMenu"})(En||(En={}));class Tn extends yt{constructor(t,i,n){super(),this.key=t,this.value=i,this.originalEvent=n}}class Ah{constructor(){this.events=new y,this._enabled=!0,this._keys=[],this._keysUp=[],this._keysDown=[],this._releaseAllKeys=t=>{for(const i of this._keys){const n=new Tn(i,t.key,t);this.events.emit("up",n),this.events.emit("release",n)}this._keysUp=Array.from(new Set(this._keys.concat(this._keysUp))),this._keys.length=0},this._handleKeyDown=t=>{if(!this._enabled)return;!t.metaKey&&(this._keys.includes(En.MetaLeft)||this._keys.includes(En.MetaRight))&&this._releaseAllKeys(t);const i=t.code;if(this._keys.indexOf(i)===-1){this._keys.push(i),this._keysDown.push(i);const n=new Tn(i,t.key,t);this.events.emit("down",n),this.events.emit("press",n)}},this._handleKeyUp=t=>{if(!this._enabled)return;const i=t.code,n=this._keys.indexOf(i);this._keys.splice(n,1),this._keysUp.push(i);const o=new Tn(i,t.key,t);this.events.emit("up",o),this.events.emit("release",o),t.key==="Meta"&&this._releaseAllKeys(t)}}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}init(t){let{global:i}=t;const{grabWindowFocus:n}=t;i||(Tf()?(i=window,n&&window.focus(),K.getInstance().warn("Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus")):i=window.top),i.addEventListener("blur",()=>{this._keys.length=0}),i.addEventListener("keyup",this._handleKeyUp),i.addEventListener("keydown",this._handleKeyDown)}toggleEnabled(t){this._enabled=t}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.events.emit("hold",new Tn(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._keysDown.indexOf(t)>-1}isHeld(t){return this._keys.indexOf(t)>-1}wasReleased(t){return this._keysUp.indexOf(t)>-1}triggerEvent(t,i,n){t==="down"&&this._handleKeyDown(new KeyboardEvent("keydown",{code:i,key:n??null})),t==="up"&&this._handleKeyUp(new KeyboardEvent("keyup",{code:i,key:n??null}))}}class Sr{static fromPagePosition(t,i,n){let o,l,d,f;arguments.length===3?(o=t,l=i,d=new C(o,l),f=n):(d=t,o=d.x,l=d.y,f=i);const g=f.screen.pageToScreenCoordinates(d),v=f.screen.screenToWorldCoordinates(g);return new Sr(v,d,g)}constructor(t,i,n){this.worldPos=t,this.pagePos=i,this.screenPos=n}}class Pn{cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}constructor(t,i,n,o,l,d){this.type=t,this.pointerId=i,this.button=n,this.pointerType=o,this.coordinates=l,this.nativeEvent=d,this.active=!0}}class Sh{cancel(){this.active=!1}constructor(t,i,n,o,l,d,f,g,v,w,x,T){this.x=t,this.y=i,this.pageX=n,this.pageY=o,this.screenX=l,this.screenY=d,this.index=f,this.deltaX=g,this.deltaY=v,this.deltaZ=w,this.deltaMode=x,this.ev=T,this.active=!0}}class Eh{constructor(){this.events=new y,this.lastPagePos=C.Zero,this.lastScreenPos=C.Zero,this.lastWorldPos=C.Zero,this._onPointerMove=t=>{this.lastPagePos=new C(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new C(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new C(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new C(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new C(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new C(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}}var Vs;(function(c){c.Pixel="Pixel",c.Line="Line",c.Page="Page"})(Vs||(Vs={}));var Qi;(function(c){c[c.NoButton=-1]="NoButton",c[c.Left=0]="Left",c[c.Middle=1]="Middle",c[c.Right=2]="Right",c[c.Unknown=3]="Unknown"})(Qi||(Qi={}));var Mi;(function(c){c.Left="Left",c.Middle="Middle",c.Right="Right",c.Unknown="Unknown",c.NoButton="NoButton"})(Mi||(Mi={}));var Li;(function(c){c.Touch="Touch",c.Mouse="Mouse",c.Pen="Pen",c.Unknown="Unknown"})(Li||(Li={}));function a0(c){return globalThis.TouchEvent&&c instanceof globalThis.TouchEvent}function l0(c){return globalThis.PointerEvent&&c instanceof globalThis.PointerEvent}class Er{constructor(t,i){this.target=t,this.engine=i,this.events=new y,this.primary=new Eh,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._enabled=!0,this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}toggleEnabled(t){this._enabled=t}recreate(t,i){const n=new Er(t,i);return n.primary=this.primary,n._pointers=this._pointers,n}at(t){if(t>=this._pointers.length)for(let i=this._pointers.length-1,n=t;i<n;i++)this._pointers.push(new Eh);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var i;return(i=this.currentFramePointerDown.get(t))!==null&&i!==void 0?i:!1}wasDown(t){var i;return(i=this.lastFramePointerDown.get(t))!==null&&i!==void 0?i:!1}isDragging(t){return this.isDown(t)}isDragStart(t){return this.isDown(t)&&!this.wasDown(t)}isDragEnd(t){return!this.isDown(t)&&this.wasDown(t)}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const t of this.currentFrameDown)this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t);for(const t of this.currentFrameUp)this.emit("up",t),this.at(t.pointerId).emit("up",t);for(const t of this.currentFrameMove)this.emit("move",t),this.at(t.pointerId).emit("move",t);for(const t of this.currentFrameCancel)this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t);for(const t of this.currentFrameWheel)this.emit("wheel",t),this.primary.emit("pointerwheel",t),this.primary.emit("wheel",t)}clear(){for(const t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);const i=this._activeNativePointerIdsToNormalized.entries();for(const[n,o]of i)o===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(n)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(t){var i;if(this.engine.isDisposed())return;this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const n={passive:!(this.engine.pageScrollPreventionMode===cs.All||this.engine.pageScrollPreventionMode===cs.Canvas)};if("onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,n):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel,n):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,n),((i=t==null?void 0:t.grabWindowFocus)!==null&&i!==void 0?i:!0)&&Tf()){const l=()=>{window.focus()};window.PointerEvent?this.target.addEventListener("pointerdown",l):(this.target.addEventListener("touchstart",l),this.target.addEventListener("mousedown",l))}}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);const n=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((o,l)=>o-l).findIndex(o=>o===t);return this._activeNativePointerIdsToNormalized.set(t,n),n}_handle(t){if(!this._enabled)return;t.preventDefault();const i=new Map;let n,o;if(a0(t)){n=Mi.Unknown,o=Li.Touch;for(let l=0;l<t.changedTouches.length;l++){const d=t.changedTouches[l],f=Sr.fromPagePosition(d.pageX,d.pageY,this.engine),g=l+1,v=this._normalizePointerId(g);this.currentFramePointerCoords.set(v,f),i.set(v,f)}}else{n=this._nativeButtonToPointerButton(t.button),o=Li.Mouse;const l=Sr.fromPagePosition(t.pageX,t.pageY,this.engine);let d=1;l0(t)&&(d=t.pointerId,o=this._stringToPointerType(t.pointerType));const f=this._normalizePointerId(d);this.currentFramePointerCoords.set(f,l),i.set(f,l)}for(const[l,d]of i.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new Pn("down",l,n,o,d,t)),this.currentFramePointerDown.set(l,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new Pn("up",l,n,o,d,t)),this.currentFramePointerDown.set(l,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new Pn("move",l,n,o,d,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new Pn("cancel",l,n,o,d,t));break}}_handleWheel(t){if(!this._enabled)return;(this.engine.pageScrollPreventionMode===cs.All||this.engine.pageScrollPreventionMode===cs.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();const i=this.engine.screen.pageToScreenCoordinates(D(t.pageX,t.pageY)),n=this.engine.screen.screenToWorldCoordinates(i),o=-1/40,l=t.deltaX||t.wheelDeltaX*o||0,d=t.deltaY||t.wheelDeltaY*o||t.wheelDelta*o||t.detail||0,f=t.deltaZ||0;let g=Vs.Pixel;t.deltaMode&&(t.deltaMode===1?g=Vs.Line:t.deltaMode===2&&(g=Vs.Page));const v=new Sh(n.x,n.y,t.pageX,t.pageY,i.x,i.y,0,l,d,f,g,t);this.currentFrameWheel.push(v)}triggerEvent(t,i){const n=this.engine.screen.worldToPageCoordinates(i);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:n.x,clientY:n.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:n.x,clientY:n.y}));const o=this.engine.currentScene.world.get(Yo);o.preupdate(this.engine.currentScene,1),o.update(1)}_nativeButtonToPointerButton(t){switch(t){case Qi.NoButton:return Mi.NoButton;case Qi.Left:return Mi.Left;case Qi.Middle:return Mi.Middle;case Qi.Right:return Mi.Right;case Qi.Unknown:return Mi.Unknown;default:return lt(t)}}_stringToPointerType(t){switch(t){case"touch":return Li.Touch;case"mouse":return Li.Mouse;case"pen":return Li.Pen;default:return Li.Unknown}}}class Th{constructor(t){this._enabled=!0;const{pointerTarget:i,grabWindowFocus:n,engine:o}=t;this.keyboard=new Ah,this.pointers=new Er(i,o),this.gamepads=new br,this.keyboard.init({grabWindowFocus:n}),this.pointers.init({grabWindowFocus:n}),this.gamepads.init(),this.inputMapper=new Ef({keyboard:this.keyboard,pointers:this.pointers,gamepads:this.gamepads})}get enabled(){return this._enabled}toggleEnabled(t){this._enabled=t,this.keyboard.toggleEnabled(this._enabled),this.pointers.toggleEnabled(this._enabled),this.gamepads.toggleEnabled(this._enabled)}update(){this._enabled&&(this.inputMapper.execute(),this.keyboard.update(),this.gamepads.update())}}class h0{}const c0={Initialize:"initialize",Activate:"activate",Deactivate:"deactivate",PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PreDebugDraw:"predebugdraw",PostDebugDraw:"postdebugdraw",PreLoad:"preload"};function zi(c){var t,i;return!!(c!=null&&c.prototype)&&!!(!((i=(t=c==null?void 0:c.prototype)===null||t===void 0?void 0:t.constructor)===null||i===void 0)&&i.name)}class ii{get actors(){return this.world.entityManager.entities.filter(t=>t instanceof He)}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter(t=>t instanceof cf)}get tileMaps(){return this.world.entityManager.entities.filter(t=>t instanceof tf)}get timers(){return this._timers}constructor(){this._logger=K.getInstance(),this.events=new y,this.camera=new hf,this.world=new gf(this),this.physics=new Sf(Ri),this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(Cf),this.world.add(new mf(this.world,this.physics)),this.world.add(new bh(this.world,this.physics)),this.world.add(Yo),this.world.add(bf),this.world.add(Af),this.world.add(wf),this.world.add(xf)}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}onPreLoad(t){}onTransition(t){}onInitialize(t){}onActivate(t){}onDeactivate(t){}onPreUpdate(t,i){}onPostUpdate(t,i){}onPreDraw(t,i){}onPostDraw(t,i){}_initializeChildren(){for(const t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}async _initialize(t){var i;if(!this.isInitialized){try{this.engine=t,this.physics.config=this.engine.physics,this.input=new Th({pointerTarget:t.pointerScope===A.Canvas?t.canvas:document,grabWindowFocus:t.grabWindowFocus,engine:t}),this.camera._initialize(t),this.world.systemManager.initialize(),await this.onInitialize(t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.events.emit("initialize",new vn(t,this))}catch(n){throw this._logger.error(`Error during scene initialization for scene ${(i=t.director)===null||i===void 0?void 0:i.getSceneName(this)}!`),n}this._isInitialized=!0}}async _activate(t){var i,n;try{this._logger.debug("Scene.onActivate",this),this.input.toggleEnabled(!0),await this.onActivate(t)}catch(o){throw this._logger.error(`Error during scene activation for scene ${(n=(i=this.engine)===null||i===void 0?void 0:i.director)===null||n===void 0?void 0:n.getSceneName(this)}!`),o}}async _deactivate(t){this._logger.debug("Scene.onDeactivate",this),this.input.toggleEnabled(!1),await this.onDeactivate(t)}_preupdate(t,i){this.emit("preupdate",new os(t,i,this)),this.onPreUpdate(t,i)}_postupdate(t,i){this.emit("postupdate",new as(t,i,this)),this.onPostUpdate(t,i)}_predraw(t,i){this.emit("predraw",new mn(t,i,this)),this.onPreDraw(t,i)}_postdraw(t,i){this.emit("postdraw",new _n(t,i,this)),this.onPostDraw(t,i)}update(t,i){var n;if(!this.isInitialized){this._logger.warnOnce(`Scene update called before initialize for scene ${(n=t.director)===null||n===void 0?void 0:n.getSceneName(this)}!`);return}this._preupdate(t,i);let o,l;for(o=0,l=this._cancelQueue.length;o<l;o++)this.removeTimer(this._cancelQueue[o]);this._cancelQueue.length=0;for(const d of this._timers)d.update(i);this.world.update(We.Update,i),this.camera&&this.camera.update(t,i),this._collectActorStats(t),this._postupdate(t,i),this.input.update()}draw(t,i){var n;if(!this.isInitialized){this._logger.warnOnce("Scene draw called before initialize!");return}this._predraw(t,i),this.world.update(We.Draw,i),!((n=this.engine)===null||n===void 0)&&n.isDebug&&this.debugDraw(t),this._postdraw(t,i)}debugDraw(t){this.emit("predebugdraw",new Gl(t,this)),this.emit("postdebugdraw",new Vl(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){if(this.emit("entityadded",{target:t}),this.world.add(t),t.scene=this,t instanceof Gs){Z(this._timers,t)||this.addTimer(t);return}}transfer(t){let i;t instanceof _e&&t.scene&&t.scene!==this&&(i=t.scene,t.scene.world.remove(t,!1)),t instanceof Gs&&t.scene&&(i=t.scene,t.scene.removeTimer(t)),i==null||i.emit("entityremoved",{target:t}),this.add(t)}remove(t){t instanceof _e&&(this.emit("entityremoved",{target:t}),t.active&&t.kill(),this.world.remove(t)),t instanceof Gs&&this.removeTimer(t)}clear(t=!0){for(let i=this.entities.length-1;i>=0;i--)this.world.remove(this.entities[i],t);for(let i=this.timers.length-1;i>=0;i--)this.removeTimer(this.timers[i])}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const i=this._timers.indexOf(t);return i!==-1&&this._timers.splice(i,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return this.engine?this.engine.currentScene===this:!1}_collectActorStats(t){const i=this.actors.filter(n=>n instanceof wh);for(const n of i)t.stats.currFrame.actors.ui++;for(const n of this.actors){t.stats.currFrame.actors.alive++;for(const o of n.children)Jd(o)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}var Xs;(function(c){c.Protanope="Protanope",c.Deuteranope="Deuteranope",c.Tritanope="Tritanope"})(Xs||(Xs={}));const u0=`#version 300 es\r
precision mediump float;\r
// our texture\r
uniform sampler2D u_image;\r
// the texCoords passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// color blind type\r
uniform int u_type;\r
\r
// simulation?\r
uniform bool u_simulate;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  vec4 o =  texture(u_image, v_texcoord);\r
  // RGB to LMS matrix conversion\r
  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\r
  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\r
  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\r
  // Simulate color blindness\r
  float l;\r
  float m;\r
  float s;\r
  //MODE CODE//\r
  if (u_type == 0) {\r
    // Protanope\r
    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;;\r
  } else if (u_type == 1) {\r
    // Deuteranope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;\r
  } else if (u_type == 2) {\r
    // Tritanope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\r
  }\r
\r
  // LMS to RGB matrix conversion\r
  vec4 error; // simulate the colors\r
  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\r
  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\r
  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\r
  error.a = 1.0;\r
  vec4 diff = o - error;\r
  vec4 correction; // correct the colors\r
  correction.r = 0.0;\r
  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\r
  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\r
  correction = o + correction;\r
  correction.a = o.a;\r
  //SIMULATE//\r
\r
  // sim \r
  if (u_simulate) {\r
    fragColor = error.rgba;\r
  } else {\r
    fragColor = correction.rgba;\r
  }\r
}`;class Pf{constructor(t,i){this._shader=new Je({gl:t,vertexSource:`#version 300 es
      in vec2 a_position;
      in vec2 a_texcoord;
      out vec2 v_texcoord;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        // Pass the texcoord to the fragment shader.
        v_texcoord = a_texcoord;
      }`,fragmentSource:i}),this._shader.compile(),this._buffer=new Vi({gl:t,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Xi({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}class If{constructor(t,i=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=i}initialize(t){this._shader=new Pf(t,u0),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){const i=this._shader.getShader();i.use(),this._colorBlindnessMode===Xs.Protanope?i.setUniformInt("u_type",0):this._colorBlindnessMode===Xs.Deuteranope?i.setUniformInt("u_type",1):this._colorBlindnessMode===Xs.Tritanope&&i.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){const i=this._shader.getShader();i.use(),i.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class Rf{constructor(t){this._engine=t,this._colorBlindPostProcessor=new If(Xs.Protanope)}correct(t){this._engine.graphicsContext instanceof $i&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof $i&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class Df{constructor(t){this.stats={currFrame:new Tr,prevFrame:new Tr},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!1,showName:!1},this.transform={showAll:!1,debugZIndex:1e7,showPosition:!1,showPositionLabel:!1,positionColor:N.Yellow,showZIndex:!1,showScale:!1,scaleColor:N.Green,showRotation:!1,rotationColor:N.Blue},this.graphics={showAll:!1,showBounds:!1,boundsColor:N.Yellow},this.collider={showAll:!1,showBounds:!1,boundsColor:N.Blue,showOwner:!1,showGeometry:!0,geometryColor:N.Green,geometryLineWidth:1,geometryPointSize:.5},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:N.Cyan,showCollisionContacts:!0,contactSize:2,collisionContactColor:N.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:N.Yellow,showAcceleration:!1,accelerationColor:N.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:N.Red,showZoom:!1},this.tilemap={showAll:!1,showGrid:!1,gridColor:N.Red,gridWidth:.5,showSolidBounds:!1,solidBoundsColor:N.fromHex("#8080807F"),showColliderGeometry:!0},this.isometric={showAll:!1,showPosition:!1,positionColor:N.Yellow,positionSize:1,showGrid:!1,gridColor:N.Red,gridWidth:1,showColliderGeometry:!0},this._engine=t,this.colorBlindMode=new Rf(this._engine)}useTestClock(){const t=this._engine.clock,i=t.isRunning();t.stop();const n=t.toTestClock();return i&&n.start(),this._engine.clock=n,n}useStandardClock(){const t=this._engine.clock,i=t.isRunning();t.stop();const n=t.toStandardClock();return i&&n.start(),this._engine.clock=n,n}}class Tr{constructor(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Qo,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new Tr;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get delta(){return this._delta}set delta(t){this._delta=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Qo{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const t=new Qo;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}class Ph{on(t,i){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(i),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,i){i||(i=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,i),this._nativeHandlers[t]=null}_decorate(t){return i=>{this._paused||t(i)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}}class kf{constructor(t,i){this._windowGlobal=t,this._documentGlobal=i,this._windowComponent=new Ph(this._windowGlobal),this._documentComponent=new Ph(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}const Ff={pixelArtSampler:!1,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:Kt.Blended,canvasImageRendering:"auto"},Bf={pixelArtSampler:!0,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:Kt.Blended,canvasImageRendering:"auto"};class Mf{constructor(t){var i;this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0,this._fps=t.initialFps,this._samplePeriod=(i=t.samplePeriod)!==null&&i!==void 0?i:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=this._frames*1e3/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class Ih{constructor(t){var i,n,o;this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._options=t,this.tick=t.tick,this._lastTime=(i=this.now())!==null&&i!==void 0?i:0,this._maxFps=(n=t.maxFps)!==null&&n!==void 0?n:this._maxFps,this._onFatalException=(o=t.onFatalException)!==null&&o!==void 0?o:this._onFatalException,this.fpsSampler=new Mf({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new Lf({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new Rh({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,i=0,n="preframe"){const o=this._totalElapsed+i;this._scheduledCbs.push([t,o,n])}__runScheduledCbs(t="preframe"){for(let i=this._scheduledCbs.length-1;i>-1;i--)t===this._scheduledCbs[i][2]&&this._scheduledCbs[i][1]<=this._totalElapsed&&(this._scheduledCbs[i][0](this._elapsed),this._scheduledCbs.splice(i,1))}update(t){try{this.fpsSampler.start();const i=this.now();let n=i-this._lastTime||1;const o=1e3/this._maxFps;if(n>=o){let l=0;o!==0&&(l=n%o,n=n-l),n>200&&(n=1),this._elapsed=t||n,this._totalElapsed+=this._elapsed,this.__runScheduledCbs("preframe"),this.tick(t||n),this.__runScheduledCbs("postframe"),o!==0?this._lastTime=i-l:this._lastTime=i,this.fpsSampler.end()}}catch(i){this._onFatalException(i),this.stop()}}}class Rh extends Ih{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(i){throw window.cancelAnimationFrame(this._requestId),i}};t()}stop(){window.cancelAnimationFrame(this._requestId),this._running=!1}}class Lf extends Ih{constructor(t){super({...t}),this._logger=K.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return(t=this._currentTime)!==null&&t!==void 0?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){const i=t??this._updateMs;this._running?(this.update(i),this._currentTime+=i):this._logger.warn("The clock is not running, no step will be performed")}run(t,i){for(let n=0;n<t;n++)this.step(i??this._updateMs)}}var d0=Ot(4296);class zf{constructor(){this._toasterCss=d0.A.toString(),this._isInitialized=!1}_initialize(){this._isInitialized||(this._container=document.createElement("div"),this._container.id="ex-toast-container",document.body.appendChild(this._container),this._isInitialized=!0,this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._toasterCss,document.head.appendChild(this._styleBlock))}dispose(){this._container.parentElement.removeChild(this._container),this._styleBlock.parentElement.removeChild(this._styleBlock),this._isInitialized=!1}_createFragment(t){const i=document.createElement("span");return i.innerText=t,i}toast(t,i,n){this._initialize();const o=document.createElement("div");o.className="ex-toast-message";const l=t.split("[LINK]").map(w=>this._createFragment(w));if(i){const w=document.createElement("a");w.href=i,n?w.innerText=n:w.innerText=i,l.splice(1,0,w)}const d=document.createElement("div");l.forEach(w=>{d.appendChild(w)}),o.appendChild(d);const f=document.createElement("button");f.innerText="x",f.addEventListener("click",()=>{this._container.removeChild(o)}),o.appendChild(f);const g=w=>{if(w.key==="Escape")try{this._container.removeChild(o)}catch{}document.removeEventListener("keydown",g)};document.addEventListener("keydown",g);const v=this._container.firstChild;this._container.insertBefore(o,v)}}const f0={NavigationStart:"navigationstart",Navigation:"navigation",NavigationEnd:"navigationend"};class Of{get isTransitioning(){return this._isTransitioning}constructor(t,i){this._engine=t,this.events=new y,this._logger=K.getInstance(),this._initialized=!1,this.scenes={},this._sceneToInstance=new Map,this._sceneToLoader=new Map,this._sceneToTransition=new Map,this._loadedScenes=new Set,this._isTransitioning=!1,this.rootScene=this.currentScene=new ii,this.add("root",this.rootScene),this.currentScene=this.rootScene,this.currentSceneName="root";for(const n in i){const o=i[n];this.add(n,o),n==="root"&&(this.rootScene=this.getSceneInstance("root"),this.currentScene=this.rootScene)}}async onInitialize(){if(!this._initialized)if(this._initialized=!0,this._deferredGoto){const t=this._deferredGoto,i=this._deferredTransition;this._deferredGoto=null,this._deferredTransition=null,await this.swapScene(t),i&&await this.playTransition(i)}else await this.swapScene("root")}get isInitialized(){return this._initialized}configureStart(t,i){const n=i==null?void 0:i.loader;n instanceof pr?this.mainLoader=n:hh(n)?this.mainLoader=new n:this.mainLoader=new Os;let o;if(i){const{inTransition:l}=i;o=l}this.startScene=t,o?this.swapScene(this.startScene).then(()=>{this.playTransition(o)}):this.swapScene(this.startScene),this.currentSceneName=this.startScene}_getLoader(t){return this._sceneToLoader.get(t)}_getInTransition(t){var i;const n=this.scenes[t];return n instanceof ii||zi(n)?null:(i=n==null?void 0:n.transitions)===null||i===void 0?void 0:i.in}_getOutTransition(t){var i;const n=this.scenes[t];return n instanceof ii||zi(n)?null:(i=n==null?void 0:n.transitions)===null||i===void 0?void 0:i.out}getDeferredScene(){const t=this.getSceneDefinition(this._deferredGoto);return this._deferredGoto&&t?t:null}getSceneDefinition(t){const i=this.scenes[t];if(i instanceof ii||zi(i))return i;if(i)return i.scene}getSceneName(t){for(const[i,n]of Object.entries(this.scenes))if(n instanceof ii){if(t===n)return i}else if(!zi(n)&&t===n.scene)return i;for(const[i,n]of Object.entries(this.scenes))if(zi(n)){if(t.constructor===n)return i}else if(!(n instanceof ii)&&t.constructor===n.scene)return i;return null}assertAdded(t){return this}assertRemoved(t){return this}add(t,i){if(!(i instanceof ii)&&!zi(i)){const{loader:n,transitions:o}=i,{in:l,out:d}=o??{};this._sceneToTransition.set(t,{in:l,out:d}),hh(n)?this._sceneToLoader.set(t,new n):this._sceneToLoader.set(t,n)}return this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=i,this.assertAdded(t)}remove(t){if(t instanceof ii||zi(t)){const i=t;for(const n in this.scenes)if(this.scenes.hasOwnProperty(n)){const o=this.scenes[n];let l;if(o instanceof ii||zi(o)?l=o:l=o.scene,l===i){if(n===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${n}`);this._sceneToInstance.delete(n),this._sceneToTransition.delete(n),this._sceneToLoader.delete(n),delete this.scenes[n]}}}if(typeof t=="string"){if(t===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${t}`);this._sceneToInstance.delete(t),this._sceneToTransition.delete(t),this._sceneToLoader.delete(t),delete this.scenes[t]}}async goto(t,i){var n,o,l,d,f,g;const v=this.getSceneInstance(t);if(!v){this._logger.warn(`Scene ${t} does not exist! Check the name, are you sure you added it?`);return}const w=this.currentSceneName,x=(o=(n=this._engine.input)===null||n===void 0?void 0:n.enabled)!==null&&o!==void 0?o:!0;this._isTransitioning=!0;const T=(l=this.getSceneInstance(w))===null||l===void 0?void 0:l.onTransition("out"),k=v==null?void 0:v.onTransition("in");i={sourceOut:(d=this._getOutTransition(this.currentSceneName))!==null&&d!==void 0?d:T,destinationIn:(f=this._getInTransition(t))!==null&&f!==void 0?f:k,...i};const{sourceOut:B,destinationIn:O,sceneActivationData:G}=i,L=B??this._getOutTransition(this.currentSceneName),z=O??this._getInTransition(t),V=(L==null?void 0:L.hideLoader)||(z==null?void 0:z.hideLoader);V&&this.maybeLoadScene(t,V),this._emitEvent("navigationstart",w,t),await this.playTransition(L),await this.maybeLoadScene(t,V),await(z==null?void 0:z.onPreviousSceneDeactivate(this.currentScene)),await this.swapScene(t,G),this._emitEvent("navigation",w,t),await this.playTransition(z),this._emitEvent("navigationend",w,t),(g=this._engine.input)===null||g===void 0||g.toggleEnabled(x),this._isTransitioning=!1}getSceneInstance(t){const i=this.getSceneDefinition(t);if(!i)return;if(this._sceneToInstance.has(t))return this._sceneToInstance.get(t);if(i instanceof ii)return this._sceneToInstance.set(t,i),i;const n=new i;return this._sceneToInstance.set(t,n),n}async maybeLoadScene(t,i=!1){var n;const o=(n=this._getLoader(t))!==null&&n!==void 0?n:new pr,l=this.getSceneDefinition(t),d=this.getSceneInstance(t);l&&d&&!this._loadedScenes.has(d)&&(d.onPreLoad(o),d.events.emit("preload",{loader:o}),i?this._engine.load(o,i):await this._engine.load(o),this._loadedScenes.add(d))}async playTransition(t){var i,n,o,l,d,f,g;if(!this.isInitialized){this._deferredTransition=t;return}if(t){this.currentTransition=t;const v=this._engine.currentScene,w=(n=(i=v.input)===null||i===void 0?void 0:i.enabled)!==null&&n!==void 0?n:!0;(o=v.input)===null||o===void 0||o.toggleEnabled(!t.blockInput),(l=this._engine.input)===null||l===void 0||l.toggleEnabled(!t.blockInput),await this.currentTransition.play(this._engine),(d=v.input)===null||d===void 0||d.toggleEnabled(w)}(f=this.currentTransition)===null||f===void 0||f.kill(),(g=this.currentTransition)===null||g===void 0||g.reset(),this.currentTransition=null}async swapScene(t,i){const n=this._engine;if(!this.isInitialized){this._deferredGoto=t;return}const o=this.getSceneInstance(t);if(o){const l=this.currentScene,d=o;if(this._logger.debug("Going to scene:",t),this.currentScene.isInitialized){const v={engine:n,previousScene:l,nextScene:d};await this.currentScene._deactivate(v),this.currentScene.events.emit("deactivate",new eh(v,this.currentScene))}const f=this._sceneToLoader.get(t);await(f==null?void 0:f.areResourcesLoaded()),this.currentScene=d,this.currentSceneName=t,n.screen.setCurrentCamera(d.camera),await this.currentScene._initialize(n);const g={engine:n,previousScene:l,nextScene:d,data:i};await this.currentScene._activate(g),this.currentScene.events.emit("activate",new th(g,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")}_emitEvent(t,i,n){const o=this.getSceneDefinition(i),l=this.getSceneDefinition(n);this.events.emit(t,{sourceScene:o,sourceName:i,destinationScene:l,destinationName:n})}}function p0(){const c={scope:(t,i)=>(c.value=t,i()),value:void 0};return c}function g0(c){return c.value}u();const m0={FallbackGraphicsContext:"fallbackgraphicscontext",Initialize:"initialize",Visible:"visible",Hidden:"hidden",Start:"start",Stop:"stop",PreUpdate:"preupdate",PostUpdate:"postupdate",PreFrame:"preframe",PostFrame:"postframe",PreDraw:"predraw",PostDraw:"postdraw"};var cs;(function(c){c[c.None=0]="None",c[c.Canvas=1]="Canvas",c[c.All=2]="All"})(cs||(cs={}));class ke{static useEngine(){const t=g0(ke.Context);if(!t)throw new Error("Cannot inject engine with `useEngine()`, `useEngine()` was called outside of Engine lifecycle scope.");return t}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get currentScene(){return this.director.currentScene}get currentSceneName(){return this.director.currentSceneName}get rootScene(){return this.director.rootScene}get scenes(){return this.director.scenes}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}emit(t,i){this.events.emit(t,i)}on(t,i){return this.events.on(t,i)}once(t,i){return this.events.once(t,i)}off(t,i){this.events.off(t,i)}constructor(t){var i,n,o,l,d,f,g,v;this.scope=V=>ke.Context.scope(this,V),this.version=Lh,this.events=new y,this.maxFps=Number.POSITIVE_INFINITY,this._inputEnabled=!0,this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.enableCanvasTransparency=!0,this.onFatalException=V=>{K.getInstance().fatal(V,V.stack)},this._toaster=new zf,this._timescale=1,this._isInitialized=!1,this._originalOptions={},this._handleWebGLContextLost=V=>{var H;V.preventDefault(),this.clock.stop(),this._logger.fatalOnce("WebGL Graphics Lost",V);const st=document.createElement("div");st.id="ex-webgl-graphics-context-lost",st.style.position="absolute",st.style.zIndex="99",st.style.left="50%",st.style.top="50%",st.style.display="flex",st.style.flexDirection="column",st.style.transform="translate(-50%, -50%)",st.style.backgroundColor="white",st.style.padding="10px",st.style.borderStyle="solid 1px";const mt=document.createElement("div");if(mt.innerHTML=`
      <h1>There was an issue rendering, please refresh the page.</h1>
      <div>
        <p>WebGL Graphics Context Lost</p>

        <button id="ex-webgl-graphics-reload">Refresh Page</button>

        <p>There are a few reasons this might happen:</p>
        <ul>
          <li>Two or more pages are placing a high demand on the GPU</li>
          <li>Another page or operation has stalled the GPU and the browser has decided to reset the GPU</li>
          <li>The computer has multiple GPUs and the user has switched between them</li>
          <li>Graphics driver has crashed or restarted</li>
          <li>Graphics driver was updated</li>
        </ul>
      </div>
    `,st.appendChild(mt),!((H=this.canvas)===null||H===void 0)&&H.parentElement){this.canvas.parentElement.appendChild(st);const X=mt.querySelector("#ex-webgl-graphics-reload");X==null||X.addEventListener("click",()=>location.reload())}},this._performanceThresholdTriggered=!1,this._fpsSamples=[],this._disposed=!1,this._isLoading=!1,this._hideLoader=!1,this._isReadyFuture=new _,this.currentFrameElapsedMs=0,this.currentFrameLagMs=0,this._lagMs=0,this._screenShotRequests=[],t={...ke._DEFAULT_ENGINE_OPTIONS,...t},this._originalOptions=t,p.freeze(),this.browser=new kf(window,document);const w=new kd;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=w.test())){const V=document.createElement("div");if(V.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(V),w.failedTests.forEach(function(H){const st=document.createElement("div");st.innerText="Browser feature missing "+H,document.body.appendChild(st)}),t.canvasElementId){const H=document.getElementById(t.canvasElementId);H&&H.parentElement.removeChild(H)}return}else this._compatible=!0;if(console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${Lh})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log(`
      /| ________________
O|===|* >________________>
      \\|`),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=K.getInstance(),this._logger.defaultLevel===rt.Debug&&w.logBrowserFeatures(),this._logger.debug("Building engine..."),this.canvasElementId=t.canvasElementId,t.canvasElementId){if(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),document.getElementById(t.canvasElementId)===null)throw new Error("Cannot find existing element in the DOM, please ensure element is created prior to engine creation.");this.canvas=document.getElementById(t.canvasElementId)}else t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));let x=(i=t.displayMode)!==null&&i!==void 0?i:se.Fixed;t.width&&t.height||t.viewport?(t.displayMode===void 0&&(x=se.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),x=se.FitScreen),this._originalDisplayMode=x;let T,k,B,O,G,L;typeof t.antialiasing=="object"?{pixelArtSampler:T,nativeContextAntialiasing:B,multiSampleAntialiasing:L,filtering:G,canvasImageRendering:O}={...t.pixelArt?Bf:Ff,...t.antialiasing}:(T=!!t.pixelArt,B=!1,L=t.antialiasing,O=t.antialiasing?"auto":"pixelated",G=t.antialiasing?Kt.Blended:Kt.Pixel),B&&L&&this._logger.warnOnce("Cannot use antialias setting nativeContextAntialiasing and multiSampleAntialiasing at the same time, they are incompatible settings. If you aren't sure use multiSampleAntialiasing"),t.pixelArt&&(k=.25),(!t.antialiasing||G===Kt.Pixel)&&(k=0),k=(o=(n=t.uvPadding)!==null&&n!==void 0?n:k)!==null&&o!==void 0?o:.01;let z=p.isEnabled("use-canvas-context");if(!z)try{this.graphicsContext=new $i({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,pixelArtSampler:T,antialiasing:B,multiSampleAntialiasing:L,uvPadding:k,powerPreference:t.powerPreference,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting,handleContextLost:(l=t.handleContextLost)!==null&&l!==void 0?l:this._handleWebGLContextLost,handleContextRestored:t.handleContextRestored})}catch(V){this._logger.warn(`Excalibur could not load webgl for some reason (${V.message}) and loaded a Canvas 2D fallback. Some features of Excalibur will not work in this mode. 

Read more about this issue at https://excaliburjs.com/docs/performance`),z=!0}z&&(this.graphicsContext=new Ao({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:B,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})),this.screen=new Ll({canvas:this.canvas,context:this.graphicsContext,antialiasing:B,canvasImageRendering:O,browser:this.browser,viewport:(d=t.viewport)!==null&&d!==void 0?d:t.width&&t.height?{width:t.width,height:t.height}:Ml.SVGA,resolution:t.resolution,displayMode:x,pixelRatio:t.suppressHiDPIScaling?1:(f=t.pixelRatio)!==null&&f!==void 0?f:null}),Jt.filtering=G,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.grabWindowFocus=t.grabWindowFocus,this.pointerScope=t.pointerScope,this.maxFps=(g=t.maxFps)!==null&&g!==void 0?g:this.maxFps,this.fixedUpdateFps=(v=t.fixedUpdateFps)!==null&&v!==void 0?v:this.fixedUpdateFps,this.clock=new Rh({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:V=>this.onFatalException(V)}),this.enableCanvasTransparency=t.enableCanvasTransparency,typeof t.physics=="boolean"?this.physics={...Ri,...gh(),enabled:t.physics}:this.physics={...Ri,...gh(),...t.physics},this.debug=new Df(this),this.director=new Of(this,t.scenes),this._initialize(t),window.___EXCALIBUR_DEVTOOL=this,ke.InstanceCount++}_monitorPerformanceThresholdAndTriggerFallback(){const{allow:t}=this._originalOptions.configurePerformanceCanvas2DFallback;let{threshold:i,showPlayerMessage:n}=this._originalOptions.configurePerformanceCanvas2DFallback;if(i===void 0&&(i=ke._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold),n===void 0&&(n=ke._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage),!p.isEnabled("use-canvas-context")&&t&&this.ready&&!this._performanceThresholdTriggered){this._fpsSamples.length===i.numberOfFrames&&this._fpsSamples.splice(0,1),this._fpsSamples.push(this.clock.fpsSampler.fps);let o=0;for(let d=0;d<this._fpsSamples.length;d++)o+=this._fpsSamples[d];const l=o/this._fpsSamples.length;this._fpsSamples.length===i.numberOfFrames&&l<=i.fps&&(this._performanceThresholdTriggered=!0,this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.
this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.

If in Chrome:
  * Visit Settings > Advanced > System, and ensure "Use Hardware Acceleration" is checked.
  * Visit chrome://flags/#ignore-gpu-blocklist and ensure "Override software rendering list" is "enabled"
If in Firefox, visit about:config
  * Ensure webgl.disabled = false
  * Ensure webgl.force-enabled = true
  * Ensure layers.acceleration.force-enabled = true

Read more about this issue at https://excaliburjs.com/docs/performance`),n&&this._toaster.toast("Excalibur is encountering performance issues. It's possible that your browser doesn't have hardware acceleration enabled. Visit [LINK] for more information and potential solutions.","https://excaliburjs.com/docs/performance"),this.useCanvas2DFallback(),this.emit("fallbackgraphicscontext",this.graphicsContext))}}useCanvas2DFallback(){var t,i,n;const o=this.canvas.cloneNode(!1);this.canvas.parentNode.replaceChild(o,this.canvas),this.canvas=o;const l={...this._originalOptions,antialiasing:this.getAntialiasing()},d=this._originalDisplayMode;this.graphicsContext=new Ao({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:l.antialiasing,backgroundColor:l.backgroundColor,snapToPixel:l.snapToPixel,useDrawSorting:l.useDrawSorting}),this.screen&&this.screen.dispose(),this.screen=new Ll({canvas:this.canvas,context:this.graphicsContext,antialiasing:(t=l.antialiasing)!==null&&t!==void 0?t:!0,browser:this.browser,viewport:(i=l.viewport)!==null&&i!==void 0?i:l.width&&l.height?{width:l.width,height:l.height}:Ml.SVGA,resolution:l.resolution,displayMode:d,pixelRatio:l.suppressHiDPIScaling?1:(n=l.pixelRatio)!==null&&n!==void 0?n:null}),this.screen.setCurrentCamera(this.currentScene.camera),this.input.pointers.detach();const f=l&&l.pointerScope===A.Document?document:this.canvas;this.input.pointers=this.input.pointers.recreate(f,this),this.input.pointers.init()}dispose(){this._disposed||(this._disposed=!0,this.stop(),this.input.toggleEnabled(!1),this.canvas.parentNode.removeChild(this.canvas),this.canvas=null,this.screen.dispose(),this.graphicsContext.dispose(),this.graphicsContext=null,ke.InstanceCount--)}isDisposed(){return this._disposed}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){if(t<=0){K.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0.");return}this._timescale=t}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,i){return this.director.add(t,i),this}removeScene(t){this.director.remove(t)}add(t){if(arguments.length===2){this.director.add(arguments[0],arguments[1]);return}const i=this.director.getDeferredScene();i instanceof ii?i.add(t):this.currentScene.add(t)}remove(t){t instanceof _e&&this.currentScene.remove(t),(t instanceof ii||zi(t))&&this.removeScene(t),typeof t=="string"&&this.removeScene(t)}async goto(t,i){await this.scope(async()=>{await this.director.goto(t,i)})}async goToScene(t,i){await this.scope(async()=>{await this.director.goto(t,i)})}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){var i,n;this.pageScrollPreventionMode=t.scrollPreventionMode;const o=t&&t.pointerScope===A.Document?document:this.canvas,l=(n=(i=this._originalOptions)===null||i===void 0?void 0:i.grabWindowFocus)!==null&&n!==void 0?n:!0;this.input=new Th({pointerTarget:o,grabWindowFocus:l,engine:this}),this.inputMapper=this.input.inputMapper,this.browser.document.on("visibilitychange",()=>{document.visibilityState==="hidden"?(this.events.emit("hidden",new Jl(this)),this._logger.debug("Window hidden")):document.visibilityState==="visible"&&(this.events.emit("visible",new Kl(this)),this._logger.debug("Window visible"))}),!this.canvasElementId&&!t.canvasElement&&document.body.appendChild(this.canvas)}toggleInputEnabled(t){this._inputEnabled=t,this.input.toggleEnabled(this._inputEnabled)}onInitialize(t){}setAntialiasing(t){this.screen.antialiasing=t}getAntialiasing(){return this.screen.antialiasing}get isInitialized(){return this._isInitialized}async _overrideInitialize(t){this.isInitialized||(await this.director.onInitialize(),await this.onInitialize(t),this.events.emit("initialize",new vn(t,this)),this._isInitialized=!0)}_update(t){var i;if(this._isLoading){(i=this._loader)===null||i===void 0||i.onUpdate(this,t),this.input.update();return}this.clock.__runScheduledCbs("preupdate"),this._preupdate(t),this.currentScene.update(this,t),this.graphicsContext.updatePostProcessors(t),this.clock.__runScheduledCbs("postupdate"),this._postupdate(t),this.input.update()}_preupdate(t){this.emit("preupdate",new os(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,i){}_postupdate(t){this.emit("postupdate",new as(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,i){}_draw(t){var i,n;if(this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this.clock.__runScheduledCbs("predraw"),this._predraw(this.graphicsContext,t),this._isLoading){this._hideLoader||((i=this._loader)===null||i===void 0||i.canvas.draw(this.graphicsContext,0,0),this.clock.__runScheduledCbs("postdraw"),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle());return}this.graphicsContext.backgroundColor=(n=this.currentScene.backgroundColor)!==null&&n!==void 0?n:this.backgroundColor,this.currentScene.draw(this.graphicsContext,t),this.clock.__runScheduledCbs("postdraw"),this._postdraw(this.graphicsContext,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,i){this.emit("predraw",new mn(t,i,this)),this.onPreDraw(t,i)}onPreDraw(t,i){}_postdraw(t,i){this.emit("postdraw",new _n(t,i,this)),this.onPostDraw(t,i)}onPostDraw(t,i){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return!this._isLoading}get ready(){return this._isReadyFuture.isCompleted}isReady(){return this._isReadyFuture.promise}async start(t,i){await this.scope(async()=>{if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");this._isLoading=!0;let n;return t instanceof pr?n=t:typeof t=="string"&&(this.director.configureStart(t,i),n=this.director.mainLoader),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this._logger.debug("Game clock started"),await this.load(n??new Os),await this._overrideInitialize(this),this._isReadyFuture.resolve(),this.emit("start",new Nl(this)),this._isReadyFuture.promise})}_mainloop(t){this.scope(()=>{this.emit("preframe",new Xl(this,this.stats.prevFrame));const i=t*this.timescale;this.currentFrameElapsedMs=i;const n=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=n,this.stats.currFrame.delta=i,this.stats.currFrame.fps=this.clock.fpsSampler.fps,Nt.clear();const o=this.clock.now(),l=1e3/this.fixedUpdateFps;if(this.fixedUpdateFps)for(this._lagMs+=i;this._lagMs>=l;)this._update(l),this._lagMs-=l;else this._update(i);const d=this.clock.now();this.currentFrameLagMs=this._lagMs,this._draw(i);const f=this.clock.now();this.stats.currFrame.duration.update=d-o,this.stats.currFrame.duration.draw=f-d,this.stats.currFrame.graphics.drawnImages=Nt.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=Nt.DrawCallCount,this.emit("postframe",new $l(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame),this._monitorPerformanceThresholdAndTriggerFallback()})}stop(){this.clock.isRunning()&&(this.emit("stop",new Hl(this)),this.browser.pause(),this.clock.stop(),this._logger.debug("Game stopped"))}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise(n=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:n})})}_checkForScreenShots(){for(const t of this._screenShotRequests){const i=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,n=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,o=document.createElement("canvas");o.width=i,o.height=n;const l=o.getContext("2d");l.imageSmoothingEnabled=this.screen.antialiasing,l.drawImage(this.canvas,0,0,i,n);const d=new Image,f=o.toDataURL("image/png");d.src=f,t.resolve(d)}this._screenShotRequests.length=0}async load(t,i=!1){await this.scope(async()=>{try{if(t.isLoaded())return;this._loader=t,this._isLoading=!0,this._hideLoader=i,t instanceof Os&&(t.suppressPlayButton=t.suppressPlayButton||this._suppressPlayButton),this._loader.onInitialize(this),await t.load()}catch(n){this._logger.error("Error loading resources, things may not behave properly",n),await Promise.resolve()}finally{this._isLoading=!1,this._hideLoader=!1,this._loader=null}})}}ke.Context=p0(),ke.InstanceCount=0,ke._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,useDrawSorting:!0,configurePerformanceCanvas2DFallback:{allow:!1,showPlayerMessage:!1,threshold:{fps:20,numberOfFrames:100}},canvasElementId:"",canvasElement:void 0,snapToPixel:!1,antialiasing:!0,pixelArt:!1,powerPreference:"high-performance",pointerScope:A.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,grabWindowFocus:!0,scrollPreventionMode:cs.Canvas,backgroundColor:N.fromHex("#2185d0")};class _0{constructor(){this._handlers={},this._wiredEventDispatchers=[],this._deferedHandlerRemovals=[]}clear(){this._handlers={},this._wiredEventDispatchers=[]}_processDeferredHandlerRemovals(){for(const t of this._deferedHandlerRemovals)this._removeHandler(t.name,t.handler);this._deferedHandlerRemovals.length=0}emit(t,i){if(this._processDeferredHandlerRemovals(),!t)return;t=t.toLowerCase(),(typeof i>"u"||i===null)&&(i=new yt);let n,o;if(this._handlers[t])for(n=0,o=this._handlers[t].length,n;n<o;n++)this._handlers[t][n](i);for(n=0,o=this._wiredEventDispatchers.length,n;n<o;n++)this._wiredEventDispatchers[n].emit(t,i)}on(t,i){this._processDeferredHandlerRemovals(),t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(i)}off(t,i){this._deferedHandlerRemovals.push({name:t,handler:i})}_removeHandler(t,i){t=t.toLowerCase();const n=this._handlers[t];if(n)if(!i)this._handlers[t].length=0;else{const o=n.indexOf(i);o>-1&&this._handlers[t].splice(o,1)}}once(t,i){this._processDeferredHandlerRemovals();const n=o=>{const l=o||new yt;this.off(t,n),i(l)};this.on(t,n)}wire(t){t._wiredEventDispatchers.push(this)}unwire(t){const i=t._wiredEventDispatchers.indexOf(this);i>-1&&t._wiredEventDispatchers.splice(i,1)}}class v0 extends He{get font(){return this._font}set font(t){this._font=t,this._text.font=t}get text(){return this._text.text}set text(t){this._text.text=t}get color(){return this._text.color}set color(t){this._text&&(this._text.color=t)}get opacity(){return this._text.opacity}set opacity(t){this._text.opacity=t}get spriteFont(){return this._spriteFont}set spriteFont(t){t&&(this._spriteFont=t,this._text.font=this._spriteFont)}constructor(t){super(t),this._font=new js,this._text=new yr({text:"",font:this._font});const{text:i,pos:n,x:o,y:l,spriteFont:d,font:f,color:g}={text:"",...t};this.pos=n??(o&&l?D(o,l):this.pos),this.text=i??this.text,this.font=f??this.font,this.spriteFont=d??this.spriteFont,this._text.color=g??this.color;const v=this.get(oe);v.anchor=C.Zero,v.use(this._text)}_initialize(t){super._initialize(t)}getTextWidth(){return this._text.width}}class Uf extends _e{getGraphics(){return this._graphics}addGraphic(t,i){this._graphics.push(t),this._gfx.visible=this.map.visible,this._gfx.opacity=this.map.opacity,i!=null&&i.offset&&(this._gfx.offset=i.offset),this._gfx.localBounds=this._recalculateBounds()}_recalculateBounds(){let t=this._tileBounds.clone();for(const i of this._graphics){const n=D(this.map.graphicsOffset.x-this.map.tileWidth/2,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:i.height-this.map.tileHeight));t=t.combine(i.localBounds.translate(n))}return t}removeGraphic(t){const i=this._graphics.indexOf(t);i>-1&&this._graphics.splice(i,1),this._gfx.localBounds=this._recalculateBounds()}clearGraphics(){this._graphics.length=0,this._gfx.visible=!1,this._gfx.localBounds=this._recalculateBounds()}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const i=this._colliders.indexOf(t);i>-1&&this._colliders.splice(i,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}get pos(){return this.map.tileToWorld(D(this.x,this.y))}get center(){return this.pos.add(D(0,this.map.tileHeight/2))}constructor(t,i,n,o){super([new nt,new oe({offset:n??C.Zero,onPostDraw:(T,k)=>this.draw(T,k)}),new Cr(o)]),this.solid=!1,this.events=new y,this._tileBounds=new tt,this._graphics=[],this._colliders=[],this.data=new Map,this.x=t,this.y=i,this.map=o,this._transform=this.get(nt),this._isometricEntityComponent=this.get(Cr);const l=this.map.tileWidth/2,d=this.map.tileHeight/2,f=(this.x-this.y)*l,g=(this.x+this.y)*d;this._transform.pos=D(f,g),this._isometricEntityComponent.elevation=o.elevation,this._gfx=this.get(oe),this._gfx.visible=!1;const v=this.map.tileWidth,w=this.map.tileHeight,x=D(0,this.map.renderFromTopOfGraphic?w:0);this._gfx.localBounds=this._tileBounds=new tt({left:-v/2,top:-w,right:v/2,bottom:w}).translate(x)}draw(t,i){const n=this.map.tileWidth/2;t.save(),t.translate(-n,0);for(const o of this._graphics)o.draw(t,this.map.graphicsOffset.x,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:o.height-this.map.tileHeight));t.restore()}}class y0 extends _e{constructor(t){super([new nt,new dt({type:pt.Fixed}),new Yt,new Fi,new Vo((w,x)=>this.debug(w,x),!1)],t.name),this.elevation=0,this.visible=!0,this.opacity=1,this.renderFromTopOfGraphic=!1,this.graphicsOffset=D(0,0),this._forwardPointerEventToTile=w=>x=>{const T=this.getTileByPoint(x.worldPos);T&&T.events.emit(w,x)},this._collidersDirty=!1,this._originalOffsets=new WeakMap;const{pos:i,tileWidth:n,tileHeight:o,columns:l,rows:d,renderFromTopOfGraphic:f,graphicsOffset:g,elevation:v}=t;this.transform=this.get(nt),i&&(this.transform.pos=i),this.collider=this.get(Yt),this.collider&&this.collider.set(this._composite=new pe([])),this.pointer=this.get(Fi),this.renderFromTopOfGraphic=f??this.renderFromTopOfGraphic,this.graphicsOffset=g??this.graphicsOffset,this.elevation=v??this.elevation,this.tileWidth=n,this.tileHeight=o,this.columns=l,this.rows=d,this.tiles=new Array(l*d);for(let w=0;w<d;w++)for(let x=0;x<l;x++){const T=new Uf(x,w,this.graphicsOffset,this);this.tiles[x+w*l]=T,this.addChild(T)}this.pointer.localBounds=tt.fromDimension(n*l*this.transform.scale.x,o*d*this.transform.scale.y,D(.5,0)),this._setupPointerToTile()}_setupPointerToTile(){this.events.on("pointerup",this._forwardPointerEventToTile("pointerup")),this.events.on("pointerdown",this._forwardPointerEventToTile("pointerdown")),this.events.on("pointermove",this._forwardPointerEventToTile("pointermove")),this.events.on("pointercancel",this._forwardPointerEventToTile("pointercancel"))}update(){this._collidersDirty&&(this.updateColliders(),this._collidersDirty=!1)}flagCollidersDirty(){this._collidersDirty=!0}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const i=t.offset;return this._originalOffsets.set(t,i),i}}updateColliders(){this._composite.clearColliders();const t=this.get(nt).pos;for(const i of this.tiles)if(i.solid)for(const n of i.getColliders()){const o=this._getOrSetColliderOriginalOffset(n);n.offset=this.tileToWorld(D(i.x,i.y)).sub(t).add(o).sub(D(this.tileWidth/2,this.tileHeight)),n.owner=this,this._composite.addCollider(n)}this.collider.update()}worldToTile(t){t=t.sub(this.transform.globalPos);const i=this.tileWidth/2,n=this.tileHeight/2;return D(~~((t.x/i+t.y/n)/2),~~((t.y/n-t.x/i)/2))}tileToWorld(t){const i=this.tileWidth/2,n=this.tileHeight/2,o=(t.x-t.y)*i,l=(t.x+t.y)*n;return D(o,l).add(this.transform.pos)}getTile(t,i){return t<0||i<0||t>=this.columns||i>=this.rows?null:this.tiles[t+i*this.columns]}getTileByPoint(t){const i=this.worldToTile(t);return this.getTile(i.x,i.y)}_getMaxZIndex(){let t=Number.NEGATIVE_INFINITY;for(const i of this.tiles){const n=i.get(nt).z;n>t&&(t=n)}return t}debug(t,i){const{showAll:n,showPosition:o,positionColor:l,positionSize:d,showGrid:f,gridColor:g,gridWidth:v,showColliderGeometry:w}=i.isometric,{geometryColor:x,geometryLineWidth:T,geometryPointSize:k}=i.collider;if(t.save(),t.z=this._getMaxZIndex()+.5,n||f){for(let B=0;B<this.rows+1;B++){const O=this.tileToWorld(D(0,B)),G=this.tileToWorld(D(this.columns,B));t.drawLine(O,G,g,v)}for(let B=0;B<this.columns+1;B++){const O=this.tileToWorld(D(B,0)),G=this.tileToWorld(D(B,this.rows));t.drawLine(O,G,g,v)}}if(n||o)for(const B of this.tiles)t.drawCircle(this.tileToWorld(D(B.x,B.y)),d,l);if(n||w){for(const B of this.tiles)if(B.solid)for(const O of B.getColliders())O.debug(t,x,{lineWidth:T,pointSize:k})}t.restore()}}class Dh{constructor(t,i){this._stopped=!1,this._sequenceBuilder=i,this._sequenceContext=new vr(t),this._actionQueue=this._sequenceContext.getQueue(),this._sequenceBuilder(this._sequenceContext)}update(t){this._actionQueue.update(t)}isComplete(){return this._stopped||this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._stopped=!1,this._actionQueue.reset()}clone(t){return new Dh(t,this._sequenceBuilder)}}class w0{constructor(t){this._actions=t}update(t){for(let i=0;i<this._actions.length;i++)this._actions[i].update(t)}isComplete(t){return this._actions.every(i=>i.isComplete(t))}reset(){this._actions.forEach(t=>t.reset())}stop(){this._actions.forEach(t=>t.stop())}}class In{constructor(t,i){this.bounds=t,this.options=i,this._defaultOptions={maxDepth:10,capacity:10,level:0},this.items=[],this._isDivided=!1,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null,this.options={...this._defaultOptions,...i},this.halfWidth=t.width/2,this.halfHeight=t.height/2}_split(){this._isDivided=!0;const t={maxDepth:this.options.maxDepth,capacity:this.options.capacity,level:this.options.level+1};this.topLeft=new In(new tt({left:this.bounds.left,top:this.bounds.top,right:this.bounds.left+this.halfWidth,bottom:this.bounds.top+this.halfHeight}),t),this.topRight=new In(new tt({left:this.bounds.left+this.halfWidth,top:this.bounds.top,right:this.bounds.right,bottom:this.bounds.top+this.halfHeight}),t),this.bottomLeft=new In(new tt({left:this.bounds.left,top:this.bounds.top+this.halfHeight,right:this.bounds.left+this.halfWidth,bottom:this.bounds.bottom}),t),this.bottomRight=new In(new tt({left:this.bounds.left+this.halfWidth,top:this.bounds.top+this.halfHeight,right:this.bounds.right,bottom:this.bounds.bottom}),t)}_insertIntoSubNodes(t){var i,n,o,l;!((i=this.topLeft)===null||i===void 0)&&i.bounds.overlaps(t.bounds)&&this.topLeft.insert(t),!((n=this.topRight)===null||n===void 0)&&n.bounds.overlaps(t.bounds)&&this.topRight.insert(t),!((o=this.bottomLeft)===null||o===void 0)&&o.bounds.overlaps(t.bounds)&&this.bottomLeft.insert(t),!((l=this.bottomRight)===null||l===void 0)&&l.bounds.overlaps(t.bounds)&&this.bottomRight.insert(t)}insert(t){if(this._isDivided){this._insertIntoSubNodes(t);return}if(this.items.push(t),this.items.length>this.options.capacity&&this.options.level<this.options.maxDepth){this._isDivided||this._split();for(const i of this.items)this._insertIntoSubNodes(i);this.items.length=0}}remove(t){var i,n,o,l;if(this.bounds.overlaps(t.bounds)){if(!this._isDivided){const d=this.items.indexOf(t);d>-1&&this.items.splice(d,1);return}!((i=this.topLeft)===null||i===void 0)&&i.bounds.overlaps(t.bounds)&&this.topLeft.remove(t),!((n=this.topRight)===null||n===void 0)&&n.bounds.overlaps(t.bounds)&&this.topRight.remove(t),!((o=this.bottomLeft)===null||o===void 0)&&o.bounds.overlaps(t.bounds)&&this.bottomLeft.remove(t),!((l=this.bottomRight)===null||l===void 0)&&l.bounds.overlaps(t.bounds)&&this.bottomRight.remove(t)}}query(t){let i=this.items;return this._isDivided&&(this.topLeft.bounds.overlaps(t)&&(i=i.concat(this.topLeft.query(t))),this.topRight.bounds.overlaps(t)&&(i=i.concat(this.topRight.query(t))),this.bottomLeft.bounds.overlaps(t)&&(i=i.concat(this.bottomLeft.query(t))),this.bottomRight.bounds.overlaps(t)&&(i=i.concat(this.bottomRight.query(t)))),i=i.filter((n,o)=>i.indexOf(n)>=o),i}clear(){this.items=[],this._isDivided=!1,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null}getAllItems(){let t=this.items;return this._isDivided&&(t=t.concat(this.topLeft.getAllItems()),t=t.concat(this.topRight.getAllItems()),t=t.concat(this.bottomLeft.getAllItems()),t=t.concat(this.bottomRight.getAllItems())),t=t.filter((i,n)=>t.indexOf(i)>=n),t}getTreeDepth(){return this._isDivided?1+Math.max(this.topLeft.getTreeDepth(),this.topRight.getTreeDepth(),this.bottomLeft.getTreeDepth(),this.bottomRight.getTreeDepth()):0}debug(t){this.bounds.draw(t,N.Yellow),this._isDivided&&(this.topLeft.bounds.draw(t,N.Yellow),this.topRight.bounds.draw(t,N.Yellow),this.bottomLeft.bounds.draw(t,N.Yellow),this.bottomRight.bounds.draw(t,N.Yellow))}}function x0(c){return!!c._initialize}function C0(c){return!!c.onInitialize}function b0(c){return!!c._preupdate}function A0(c){return!!c.onPreUpdate}function S0(c){return!!c.onPostUpdate}function E0(c){return!!c.onPostUpdate}function T0(c){return!!c.onPreDraw}function P0(c){return!!c.onPostDraw}class I0{constructor(t,i=N.Magenta,n=!1){this.path=t,this.color=i,this._stream=null,this._gif=null,this._textures=[],this._animation=null,this._transparentColor=null,this._resource=new ee(t,"arraybuffer",n),this._transparentColor=i}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){const t=await this._resource.load();this._stream=new Nf(t),this._gif=new Hf(this._stream,this._transparentColor);const i=this._gif.images.map(n=>new fn(n.src,!1));return await Promise.all(i.map(n=>n.load())),this.data=this._textures=i}isLoaded(){return!!this.data}toSprite(t=0){return this._textures[t].toSprite()}toSpriteSheet(){const t=this._textures.map(i=>i.toSprite());return new Fs({sprites:t})}toAnimation(t){const i=this.toSpriteSheet(),n=i.sprites.length;return this._animation=ki.fromSpriteSheet(i,j(0,n),t),this._animation}get readCheckBytes(){return this._gif.checkBytes}}const Zo=c=>c.reduce(function(t,i){return t*2+i},0),kh=c=>{const t=[];for(let i=7;i>=0;i--)t.push(!!(c&1<<i));return t};class Nf{constructor(t){if(this.data=null,this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=i=>{const n=[];for(let o=0;o<i;o++)n.push(this.readByte());return n},this.read=i=>{let n="";for(let o=0;o<i;o++)n+=String.fromCharCode(this.readByte());return n},this.readUnsigned=()=>{const i=this.readBytes(2);return(i[1]<<8)+i[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,this.len===0)throw new Error("No data loaded from file")}}const R0=function(c,t){let i=0;const n=function(T){let k=0;for(let B=0;B<T;B++)t.charCodeAt(i>>3)&1<<(i&7)&&(k|=1<<B),i++;return k},o=[],l=1<<c,d=l+1;let f=c+1,g=[];const v=function(){g=[],f=c+1;for(let T=0;T<l;T++)g[T]=[T];g[l]=[],g[d]=null};let w,x;for(;;){if(x=w,w=n(f),w===l){v();continue}if(w===d)break;if(w<g.length)x!==l&&g.push(g[x].concat(g[w][0]));else{if(w!==g.length)throw new Error("Invalid LZW code.");g.push(g[x].concat(g[x][0]))}o.push.apply(o,g[w]),g.length===1<<f&&f<12&&f++}return o};class Hf{constructor(t,i=N.Magenta){this._st=null,this._handler={},this._transparentColor=null,this.frames=[],this.images=[],this.globalColorTable=[],this.checkBytes=[],this.parseColorTable=n=>{const o=[];for(let l=0;l<n;l++){const f="#"+this._st.readBytes(3).map(g=>{const v=g.toString(16);return v.length===1?"0"+v:v}).join("");o.push(f)}return o},this.readSubBlocks=()=>{let n,o;o="";do n=this._st.readByte(),o+=this._st.read(n);while(n!==0);return o},this.parseHeader=()=>{const n={sig:null,ver:null,width:null,height:null,colorRes:null,globalColorTableSize:null,gctFlag:null,sorted:null,globalColorTable:[],bgColor:null,pixelAspectRatio:null};if(n.sig=this._st.read(3),n.ver=this._st.read(3),n.sig!=="GIF")throw new Error("Not a GIF file.");n.width=this._st.readUnsigned(),n.height=this._st.readUnsigned();const o=kh(this._st.readByte());n.gctFlag=o.shift(),n.colorRes=Zo(o.splice(0,3)),n.sorted=o.shift(),n.globalColorTableSize=Zo(o.splice(0,3)),n.bgColor=this._st.readByte(),n.pixelAspectRatio=this._st.readByte(),n.gctFlag&&(n.globalColorTable=this.parseColorTable(1<<n.globalColorTableSize+1),this.globalColorTable=n.globalColorTable),this._handler.hdr&&this._handler.hdr(n)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=n=>{const o=v=>{this.checkBytes.push(this._st.readByte());const w=kh(this._st.readByte());v.reserved=w.splice(0,3),v.disposalMethod=Zo(w.splice(0,3)),v.userInput=w.shift(),v.transparencyGiven=w.shift(),v.delayTime=this._st.readUnsigned(),v.transparencyIndex=this._st.readByte(),v.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(v)&&this.checkBytes.push(this._handler.gce)},l=v=>{v.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(v)&&this.checkBytes.push(this._handler.com)},d=v=>{this.checkBytes.push(this._st.readByte()),v.ptHeader=this._st.readBytes(12),v.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(v)&&this.checkBytes.push(this._handler.pte)},f=v=>{const w=T=>{this.checkBytes.push(this._st.readByte()),T.unknown=this._st.readByte(),T.iterations=this._st.readUnsigned(),T.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(T)&&this.checkBytes.push(this._handler.app)},x=T=>{T.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[T.identifier]&&this._handler.app[T.identifier](T)&&this.checkBytes.push(this._handler.app[T.identifier])};switch(this.checkBytes.push(this._st.readByte()),v.identifier=this._st.read(8),v.authCode=this._st.read(3),v.identifier){case"NETSCAPE":w(v);break;default:x(v);break}},g=v=>{v.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(v)&&this.checkBytes.push(this._handler.unknown)};switch(n.label=this._st.readByte(),n.label){case 249:n.extType="gce",o(n);break;case 254:n.extType="com",l(n);break;case 1:n.extType="pte",d(n);break;case 255:n.extType="app",f(n);break;default:n.extType="unknown",g(n);break}},this.parseImg=n=>{const o=(f,g)=>{const v=new Array(f.length),w=f.length/g,x=(O,G)=>{const L=f.slice(G*g,(G+1)*g);v.splice.apply(v,[O*g,g].concat(L))},T=[0,4,2,1],k=[8,8,4,2];let B=0;for(let O=0;O<4;O++)for(let G=T[O];G<w;G+=k[O])x(G,B),B++;return v};n.leftPos=this._st.readUnsigned(),n.topPos=this._st.readUnsigned(),n.width=this._st.readUnsigned(),n.height=this._st.readUnsigned();const l=kh(this._st.readByte());n.lctFlag=l.shift(),n.interlaced=l.shift(),n.sorted=l.shift(),n.reserved=l.splice(0,2),n.lctSize=Zo(l.splice(0,3)),n.lctFlag&&(n.lct=this.parseColorTable(1<<n.lctSize+1)),n.lzwMinCodeSize=this._st.readByte();const d=this.readSubBlocks();n.pixels=R0(n.lzwMinCodeSize,d),n.interlaced&&(n.pixels=o(n.pixels,n.width)),this.frames.push(n),this.arrayToImage(n),this._handler.img&&this._handler.img(n)&&this.checkBytes.push(this._handler)},this.parseBlock=()=>{const n={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(n.sentinel)){case"!":n.type="ext",this.parseExt(n);break;case",":n.type="img",this.parseImg(n);break;case";":n.type="eof",this._handler.eof&&this._handler.eof(n)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+n.sentinel.toString(16))}n.type!=="eof"&&this.parseBlock()},this.arrayToImage=n=>{let o=0;const l=document.createElement("canvas");l.id=o.toString(),l.width=n.width,l.height=n.height,o++;const d=l.getContext("2d"),f=1;let g=0,v=0;for(let x=0;x<n.pixels.length;x++)v%n.width===0&&(g++,v=0),this.globalColorTable[n.pixels[x]]===this._transparentColor.toHex()?d.fillStyle="rgba(0, 0, 0, 0)":d.fillStyle=this.globalColorTable[n.pixels[x]],d.fillRect(v,g,f,f),v++;const w=new Image;w.src=l.toDataURL(),this.images.push(w)},this._st=t,this._handler={},this._transparentColor=i,this.parseHeader(),this.parseBlock()}}class D0{constructor(t,i,{bustCache:n,...o}={}){this.path=t,this.family=i,this._isLoaded=!1,this._resource=new ee(t,"blob",n),this._options=o}async load(){if(this.isLoaded())return this.data;try{const t=await this._resource.load(),i=URL.createObjectURL(t);this.data||(this.data=new FontFace(this.family,`url(${i})`),document.fonts.add(this.data)),await this.data.load(),this._isLoaded=!0}catch(t){throw`Error loading FontSource from path '${this.path}' with error [${t.message}]`}return this.data}isLoaded(){return this._isLoaded}toFont(t){return new js({family:this.family,...this._options,...t})}}const k0=/^\s*(?:function)?\*/;function Wf(c){return typeof c!="function"?!1:k0.test(Function.prototype.toString.call(c))?!0:Object.getPrototypeOf?Object.getPrototypeOf(c)===Object.getPrototypeOf(new Function("return function * () {}")()):!1}function jf(...c){let t,i,n,o;Wf(c[0])&&(i=globalThis,t=c[0],n=c[1]),Wf(c[1])&&(i=c[0],t=c[1],n=c[2]),c[1]instanceof ke&&(i=c[0],o=c[1],t=c[2],n=c[3]),c[0]instanceof ke&&(i=globalThis,o=c[0],t=c[1],n=c[2]);const l=n==null?void 0:n.timing;let d;try{d=o??ke.useEngine()}catch{throw Error(`Cannot run coroutine without engine parameter outside of an excalibur lifecycle method.
Pass an engine parameter to ex.coroutine(engine, function * {...})`)}const f=t.bind(i);return new Promise((g,v)=>{const w=f(),x=T=>{try{const{done:k,value:B}=w.next(T);k&&g(),B instanceof Promise?B.then(()=>{d.clock.schedule(x,0,l)}):B===void 0||B===void 0?d.clock.schedule(x,0,l):d.clock.schedule(x,B||0,l)}catch(k){v(k)}};x(d.clock.elapsed())})}class Fh extends _e{get progress(){return this._currentProgress}get complete(){return this.direction==="out"?this.progress>=1:this.progress<=0}constructor(t){var i,n,o,l;super(),this._logger=K.getInstance(),this.transform=new nt,this.graphics=new oe,this._completeFuture=new _,this.started=!1,this._currentDistance=0,this._currentProgress=0,this.done=this._completeFuture.promise,this.name=`Transition#${this.id}`,this.duration=t.duration,this.easing=(i=t.easing)!==null&&i!==void 0?i:zt.Linear,this.direction=(n=t.direction)!==null&&n!==void 0?n:"out",this.hideLoader=(o=t.hideLoader)!==null&&o!==void 0?o:!1,this.blockInput=(l=t.blockInput)!==null&&l!==void 0?l:!1,this.transform.coordPlane=ne.Screen,this.transform.pos=C.Zero,this.transform.z=1/0,this.graphics.anchor=C.Zero,this.addComponent(this.transform),this.addComponent(this.graphics),this.direction==="out"?this._currentProgress=0:this._currentProgress=1}updateTransition(t,i){this.complete||(this._currentDistance+=$(i/this.duration,0,1),this._currentDistance>=1&&(this._currentDistance=1),this.direction==="out"?this._currentProgress=$(this.easing(this._currentDistance,0,1,1),0,1):this._currentProgress=$(this.easing(this._currentDistance,1,0,1),0,1))}async onPreviousSceneDeactivate(t){}onStart(t){}onUpdate(t){}onEnd(t){}onReset(){}reset(){this.started=!1,this._completeFuture=new _,this.done=this._completeFuture.promise,this._currentDistance=0,this.direction==="out"?this._currentProgress=0:this._currentProgress=1,this.onReset()}play(t,i){this.started&&(this.reset(),this._logger.warn(`Attempted to play a transition ${this.name} that is already playing, reset transition.`)),(i??t.currentScene).add(this);const o=this;return jf(t,function*(){for(;!o.complete;){const l=yield;o.updateTransition(t,l),o.execute()}})}execute(){this.isInitialized&&(this.started||(this.started=!0,this.onStart(this.progress)),this.onUpdate(this.progress),this.complete&&!this._completeFuture.isCompleted&&(this.onEnd(this.progress),this._completeFuture.resolve()))}}class F0 extends Fh{constructor(t){var i,n;super({...t,duration:(i=t.duration)!==null&&i!==void 0?i:2e3}),this.name=`FadeInOut#${this.id}`,this.color=(n=t.color)!==null&&n!==void 0?n:N.Black}onInitialize(t){this.transform.pos=t.screen.unsafeArea.topLeft,this.screenCover=new _r({width:t.screen.resolution.width,height:t.screen.resolution.height,color:this.color}),this.graphics.add(this.screenCover),this.graphics.opacity=this.progress}onReset(){this.graphics.opacity=this.progress}onStart(t){this.graphics.opacity=t}onEnd(t){this.graphics.opacity=t}onUpdate(t){this.graphics.opacity=t}}class B0 extends Fh{constructor(t){super({direction:"in",...t}),this.name=`CrossFade#${this.id}`}async onPreviousSceneDeactivate(t){this.image=await t.engine.screenshot(!0),await this.image.decode()}onInitialize(t){this.engine=t,this.transform.pos=t.screen.unsafeArea.topLeft,this.screenCover=fn.fromHtmlImageElement(this.image).toSprite(),this.graphics.add(this.screenCover),this.transform.scale=D(1/t.screen.pixelRatio,1/t.screen.pixelRatio),this.graphics.opacity=this.progress}onStart(t){this.graphics.opacity=this.progress}onReset(){this.graphics.opacity=this.progress}onEnd(t){this.graphics.opacity=t}onUpdate(t){this.graphics.opacity=t}}class Bh extends Lt{constructor(t){super(),this.color=N.Black,this.thickness=1;const{start:i,end:n,color:o,thickness:l}=t;this.start=i,this.end=n,this.color=o??this.color,this.thickness=l??this.thickness,this._localBounds=this._calculateBounds();const{width:d,height:f}=this._localBounds;this.width=d,this.height=f}get localBounds(){return this._localBounds}_calculateBounds(){const t=this.end.sub(this.start).normal(),i=this.thickness/2,n=[this.start.add(t.scale(i)),this.end.add(t.scale(i)),this.end.add(t.scale(-i)),this.start.add(t.scale(-i))];return tt.fromPoints(n)}_drawImage(t,i,n){t.drawLine(this.start,this.end,this.color,this.thickness)}clone(){return new Bh({start:this.start,end:this.end,color:this.color,thickness:this.thickness})}}class Mh extends gn{get points(){return this._points}set points(t){this._points=t;const i=this.minPoint;this.width=this._points.reduce((n,o)=>Math.max(o.x,n),0)-i.x,this.height=this._points.reduce((n,o)=>Math.max(o.y,n),0)-i.y,this.flagDirty()}get minPoint(){const t=this._points.reduce((n,o)=>Math.min(o.x,n),1/0),i=this._points.reduce((n,o)=>Math.min(o.y,n),1/0);return D(t,i)}constructor(t){super(t),this.points=t.points,this.filtering=Kt.Blended,this.rasterize()}clone(){return new Mh({points:this.points.map(t=>t.clone()),...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){if(this.points&&this.points.length){t.beginPath();const i=this.minPoint.negate(),n=this.points[0].add(i);t.moveTo(n.x,n.y),this.points.forEach(o=>{t.lineTo(o.x+i.x,o.y+i.y)}),t.lineTo(n.x,n.y),t.closePath(),this.color&&t.fill(),this.strokeColor&&t.stroke()}}}const Gf=5,Rn={},M0=()=>{for(const c in Rn)Rn[c]=0},qo=(c,t)=>{const i=p.isEnabled("suppress-obsolete-message");Rn[c]<Gf&&!i&&(K.getInstance().warn(c),console.trace&&t.showStackTrace&&console.trace()),Rn[c]++};function L0(c){return c={message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrace:!1,...c},function(t,i,n){if(n&&!(typeof n.value=="function"||typeof n.get=="function"||typeof n.set=="function"))throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const l=`${`${t.name||""}${t.name&&i?".":""}${i||""}`} is marked obsolete: ${c.message}`+(c.alternateMethod?` Use ${c.alternateMethod} instead`:"");Rn[l]||(Rn[l]=0);const d=n?{...n}:t;if(!n){class f extends d{constructor(...v){qo(l,c),super(...v)}}return f}return n&&n.value?(d.value=function(){return qo(l,c),n.value.apply(this,arguments)},d):(n&&n.get&&(d.get=function(){return qo(l,c),n.get.apply(this,arguments)}),n&&n.set&&(d.set=function(){return qo(l,c),n.set.apply(this,arguments)}),d)}}class z0{constructor(){this._queue=[]}get length(){return this._queue.length}enqueue(){const t=new _;return this._queue.push(t),t.promise}dequeue(t){this._queue.shift().resolve(t)}}class O0{constructor(t){this._count=t,this._waitQueue=new z0}get count(){return this._count}get waiting(){return this._waitQueue.length}async enter(){return this._count!==0?(this._count--,Promise.resolve()):this._waitQueue.enqueue()}exit(t=1){if(t!==0){for(;t!==0&&this._waitQueue.length!==0;)this._waitQueue.dequeue(null),t--;this._count+=t}}}const Lh="0.29.3";u()})();b.eKr;b.yVm;b.a7j;b.U_w;b.JF2;b.htg;b.HXL;b.mcg;var cc=b.Agj;b.u6S;b.x7M;b.X55;b.m3M;b.aE5;b.YJU;b.eZi;b.GNv;b.Y56;b._0v;b.vhs;b.Z8b;b.Yfw;b.IcQ;b.Rl2;b.kgJ;b.GTT;b.ypY;b.i7d;b.fQ3;b.HlI;b.jlt;b.VQc;b.zD7;b.I0I;b.AUF;b.JoF;b.MlA;b.PZh;b.qA;b.CrD;b.dQK;b.D3r;b.Qpo;b.D9n;b.b6v;b.mvh;var uc=b.Bpo,dc=b.Q1f;b.IKv;b.fcV;b.Glf;b.uAl;b.ElT;b.MPu;b.Z8r;b.QSL;b.sPV;b.nAn;b.zCU;b.QrV;b.fF9;b.xI8;b.yar;b.SP7;b.oRy;b.f5X;b.V1c;b.Mlx;b.ZCo;b.Vy3;b.J5p;b.mL_;b.Guw;b.VKx;b.N5j;b.pgY;b.OP3;b.rl5;b.eod;var Wx=b.q5Z;b.YUC;b.saR;b.hvr;b.Qol;b.Wf4;b.JCs;b.gJV;b.fWD;b.Va_;var jx=b.N$8;b._jQ;b.rxj;b.rhv;b.wCu;b.HAp;b.Zy1;b.Qev;b.bkB;b.wfL;b.sVA;b.$Gs;b.CJ0;b.NWh;b.tWi;b.xAj;b.zWh;b.i_4;b.iIx;b.c9e;b.KQV;b.weH;b.jXp;b.zzY;b.yRQ;b.MtE;b.rPj;b.KLc;b.Fir;b.V5f;b.Xj7;b.Wud;b.FVg;b.g5Y;b.YQB;b.KPb;b.nHK;b.TX_;b.r3n;b.vYh;b.hnk;b.D2R;b.n1o;b.RLG;b.fBU;b.Adb;b.bEs;b.wCy;b.CbD;b.x_C;var Gx=b.pde;b.pGf;b.ibQ;b.QlN;b.shR;b.Yjk;b._u1;b.OBI;b.klh;b.s3S;b.D$R;b.xth;b.JU7;b.h9x;b.N1A;b.e_k;b.aHM;b.tlv;b.Vi9;b.ieR;b.$bb;b.VyI;b.imn;b.uqu;b.QnL;b.vnc;b.wk_;b.GH0;b._1r;b.l0X;b.HHX;b.tjk;b.rWe;b.j9l;b.NVp;b.cPK;b.XoL;b.RmF;b.DXI;b.tCD;b.oGn;b.J3D;b.vCJ;b.f9l;b.AQx;b.v9m;b.yRJ;b.EU6;b.m3O;b.Ryz;b.OxP;b.LEs;b.Ec;b.Pi5;b.gmH;b.tS;b.XxX;b.bCz;b.nYS;b.yiT;b.NHl;b.mO8;b.PXI;b.bn5;b.Ywr;b.cMd;b.Bs6;b.G0k;b.pyn;b.QeM;b.aPX;b.ITP;b.BY0;b.MFw;b.sBn;b.S3L;b.XKQ;b.ESI;b.uxz;b.o8N;b.u_r;b.RlV;b.gVA;b.M_G;b.GRB;b.kM6;b.dO8;b.jgM;b.FWq;b.s3j;b.hlw;b.B7e;b.H_X;b.S_d;b.U7E;b.Z58;b.yh2;b.ff$;b.cWi;b.NBt;b.oNz;b.QlU;b.Xey;b.jft;b.Mtr;b.ypk;b.mnM;b.bAZ;b.ABN;b.VK6;b.kxk;b.DT1;b.FLG;b.qN_;b.Z37;b.FtL;b.Z6X;b.iQT;b.ziO;b.OEF;b.uuE;b.tiv;b.T$Y;b.EYj;b.nOB;b.Tap;b.FAs;b.B_P;b.aA5;var Vx=b.M4G;b.l$l;b.dLy;b.WZP;b.eB6;b.nFK;b.l9z;b.YOF;b.yhB;b.J0N;b.Miz;b.Bj4;b.Rcs;b.vJ4;b.TqC;b.nM0;b.X1u;b.SpZ;b.DX8;b.Yx$;b.HK4;b.SE$;b.qE8;b.Pz7;b.sX_;b.JuI;b.Nl$;b.OwT;b.P$G;b.mHV;b.Fx_;b.WFC;b.aDq;b.jIg;b.UH3;b.K6X;b.C1Y;b.Aw1;b.A8$;b.hsx;b.l9E;b.aSf;b.Zex;b.mXP;b.vt$;b.hCA;b.pjR;b.U43;b.pSZ;b.y17;b.jVr;b._SZ;b.xWn;b.ehJ;b.t6s;b.Eyn;function Xx(){const e=ht.useRef(null),s=ht.useRef(null),[r,a]=ht.useState(!1),h=50,u=50,p=()=>{if(e.current){const _=new jx({canvasElement:e.current,displayMode:Wx.FillContainer});s.current=_;const y=new cc({x:_.drawWidth/2,y:_.drawHeight-h/2,width:_.drawWidth+100,height:h,color:dc.fromHex("333333")});y.body.collisionType=uc.Fixed,_.add(y);const A=new cc({x:100,y:_.drawHeight-h,width:50,height:50,color:dc.fromHex("ff0000")});A.body.collisionType=uc.Active,A.body.bounciness=0,_.add(A),_.input.keyboard.on("press",R=>{R.key===Gx.Keys.Space&&A.vel.y===0&&(A.vel.y=-600)}),_.on("postupdate",()=>{A.pos.y<_.drawHeight-h-u/2?A.vel.y+=20:(A.vel.y=0,A.pos.y=_.drawHeight-h-u/2)});const E=()=>{const R=new cc({x:_.drawWidth+50,y:_.drawHeight-h,width:50,height:50,color:dc.fromHex("0000ff")});R.body.collisionType=uc.Active,R.vel.x=-200,_.add(R),R.on("exitviewport",()=>{R.pos.x+R.width<0&&_.remove(R)})},S=new Vx({fcn:()=>E(),repeats:!0,randomRange:[500,1500],interval:1e3});_.currentScene.add(S),S.start(),A.on("collisionstart",R=>{R.other===y?A.vel.y=0:(_.stop(),a(!0))}),_.start()}},m=()=>{a(!1),s.current&&(s.current.stop(),s.current=null),p()};return ht.useEffect(()=>(p(),()=>{s.current&&s.current.stop()}),[]),Q.jsx("section",{className:"flex h-full items-center p-3",children:Q.jsxs("div",{className:"flex w-full flex-col items-center justify-center",children:[Q.jsx("canvas",{ref:e}),r&&Q.jsx("div",{style:{textAlign:"center",marginTop:20},children:Q.jsx("button",{onClick:m,style:{padding:"10px 20px",fontSize:"16px"},className:"rounded-md bg-secondary px-5 py-2 text-xs",children:"Restart Game"})})]})})}const hg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAABHNCSVQICAgIfAhkiAAAATZJREFUSEtjZCAC/P//nwWoLB6IbYBYFYiVgVgCqvUzkL4CxD+BOIORkHlAwwyBatYAsRIhtUB5N7wGAg2zBCo6AMRsRBgGUoLbQKBh/EAF14FYkkjDQMrccboQaGAtUEETCYaBlHrgM/AukeGGbCd2A4GukwaqeoLHde+BcsVAfBCIHzIyMv6FqcXqQmhkHMNjoBfQkO3Y5HEZ6AxUvAeHgS+AhuGMKFwGugEN24nDwJNAAy1wuR6Xge5ADTtwaDoKNBCUY7CCIWAgMEYdsLjdBCjWjcNXoIIgF2sMMzIeYAQa+J/E3IBL+XNg2EpR08ADQAMdqWngDKCBmdQ0sBBo4ARqGugJNHAHNQ1UAhp4H2QgtZLNIaCB/4ZATsGWSoHBMJwLh1Evg0NgNJbRE8JQr/WonbABL1K4mEmaPHoAAAAASUVORK5CYII=",$x="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAsCAYAAAD8WEF4AAAABHNCSVQICAgIfAhkiAAABIxJREFUWEe1mT1oFEEUx+8UURH8AAsFwaSwEAsTFMXGXAqxUTSkE8EEi5Qq+NEIRu1UUNsgehZiIxgsVFAwCoKiaMRGUPAshFj5AaIoeP7/4e3xbnZmdmZ3MjDZze7Me7+Zee/tm7l6u92+VKvVDqGGlm9o2Fuv13mdkwKmSQjeI8Lf4NqgvjpeLMc/06hrIzRPovNQRPvgpuBpovEB6fBdQMlXq/MPGjRweaQkfsJ9y6KhD8+WyfMjAOaqJCvgOAxhF5XAfuiYBe3ACrA2B4KyYddSQ9gInl+TvnzHNrZBRQ/AkM3+o5Dd1IJmZzYr6MBRbJT/L6MxR9pVDHuaQpvBaLK8TK4YV5YmyWJdNROWnV4rWUOAobHrAVFgCzWJOWDwPaIzA70OnSO2CeiCZQN0HsfllDS2ej7a7MX720pgl22FzrQ4N2eUk8TyGKANV/8crABrc7B6vuG101DSHwqZtYOMKdwPyP+dEBULy6UhcLbULnPQIe80gLkqQcUSovqKnNU6szK7OoxYPd8S8gahkLPlLUaI6oqlvo5OWAHWy2T1fOML2EK/XMjTACEhKsoMlE0Ver44CQflDXky+KAQVQpWFGjPpzlwqTtfFQWhQ17OHGJCVGlYgdGJhdXzfSEvNkRVhTXNwer5xhewE/KM54UhqhKszG4DV53s5D4EgKJN0n47IQ/3NCOdRRWGqMqwAqyTHdotbdNMdnTI+402i0R5cIhKBUtz0B8CV7KjQ16mO5dFuaCSwDrMweX5H5XSm1iBfbFwZnvvR8El3PD8FtrZct8reH5QZCTJfUvBygzrZKeJmRs1B4dBveJA5Hnl3LcKbJncNyrZSWIGmRDDHP7i+QbM8HutJFXuS5mlZ1YBa8+fAexqizl0hbwyuW8qWO4qxhXgCcCcM2Y3KOQVRYtKM4sl3gEF91HnKUVJc189gNKwAGVK+BR1iQicwXWVz/Njc98kDgalayDohYJ7gvth1A+o3l1vyHbfZQ7RMwtlnEmCrheh73DdCjv9YXh+aO6b298lgQXMfAi6h0pbZfmCugmgnzMFxiFIdO7rc7KomQXIVQjLvlS/ZEbfagWSaLeUOUTlvklgAXEUgs6LsH+47saM3rUJt+x6bblvD/p6t/um7KCZhfJd6HgHNWs/BtAJ3yyEeL6xJS9MdgphIXAzoOjtiwXuAkCP+UD5TswhNvf1JjtF5wZcKnr+SoHj+dYwYNtFsAJsJjuu3Febg/Pc13cisxQKX6KuE7BnuA4A9E8IaNYmMPc1t/vWc1/XwdwCKHtAOFHKk3AK+BoDqoB17us66Cvc7rtgb0BRtg0h4BaA8utUqsiuN/bcNxfybOezJ0F0Vqi45Fx6mkClYvH8XsvOWJsD9dl/UxCH4Pf9llDRiehM+tC4KvCUMi2XOThz387MYuTbIIiHGAuF6DhAs49AJUhluz2493q+L+RlPy3R45+jrhDBEwAdS0JoCDHMIVTFbMjjj3YE5C6Uo2Z5iLoTL/lJnZNiJDshOlpo1E/YM7jZLj3o+fsB+jNEQtk2stQMVTGl+R/V8GS18NcxwwAAAABJRU5ErkJggg==",Yx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAw9JREFUWEetl4910zAQxusJgAlIJyCdgGQCygQ4E1AmoJ0AOgHpBLQTECagTEA6AWWC8P307vwusuTaTfSenu3T6e67v5Kbk8LY7XYzkT9oLmzZnyX2Gm2rBZ+3TdPclRibSDTF34LiKQqf4gXMVwG5jowdACmfa+GH5suKpAez6ClFrL8dYFoLxMrXEwCz/FdQ/g+0mrjufozGEo/kYgzhu8hAXUsutBMHgOUwMn7zLobH5yqugGlFJ7w+ltKxacz6P0bF8tmxlEs2iTzTxOJHfV/q/bPpuhGtBUAkXonI98FDcnHxFxN0L7lnFpKtaC+gi9YAYKN3T5qzsTHXvphoD9qH4G5o/VYf75yALt4z+nIPgDPVzLdw4cJzzbxaSFbK7MYULfQEBNZ2SZd5PAHY5ShLAMTWmktrZerb8Oh7izm85FRXSb2QBwC4cTagPGYwyYoiF4xH3oS90MnyXiVJH7zfjfcqeuCnNuC2vVHoEbj4IhcuvuhyZHRujwKNj7JnjAKwFiPlxEilU/ISNOumG72mLNc4LSQnQCcB+KsNxHJUj8hi/EkA6KjdmOSBjPlOwojf4MgaWy+shwAY3aRCYh8VQDGpSu44JoCZFPg5kdrpiBDEMusl7aQQWGZT017j1DZZXh1SEE9WGhLd8HlJaABaPb0J0VgAUbwjSDl88DOKjW2yBwwEVvvhAwhKC/dubZ1Dh9NvEYztWW+88BT7QDoeS761YxQQsd2WWJ22kqh1RVY8plMnxIrXMNcAGHKa0aXmxwHN3BvboTzJGtUqvw+8Kh0gUaE1GjI9NiWM4P64l3AVDxA+NyIdx7jKe30xbkO+nromfVx+57bvFACtPjzLN7JiOVXoWP6sAlKV+DWJzPYTrJpAYxVVXE8Okf1ufTqoHEDMTPaTbOkme4hS32uWc0F15STrHPnxzyjmAntRvtH0prPVO3PMWBgTVvPuiiFzrPPfkeTm/4YxQ8comsqD5eexk/Yaj7mrFaNXxlQlJX4UYxz/hXthLXY+l2Bg+HSXTgHjIdt6yy5t/g9cxM+6jM9e3QAAAABJRU5ErkJggg==",Qx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAuCAYAAABap1twAAAABHNCSVQICAgIfAhkiAAAAvRJREFUWEftmItV2zAUhvEEpRM0maB0gsIEhQlqNmgnwJmgZYLCBA0TECZoO0HTDWCC8H9GShVHL2NRTE/uOYpzrNen+5Lkas/IarU6099aZWLfPdNzrnlnVVX9ZP6KH8F91+P4mYBC054Icl4JrlELtDc2uRXQFMDfIzBrSDmnAK7GpjqHZ7YDHGidnQYHKlD58H8Okhuph2x/qPI2oKorvSefHUTaxLTcW4N/NNpXFbajjyonBgBQQFwBaqLyQ+VSZalSq3xSeZVp+16AMwPHlsjEc7tfxiaTC+2rnj48Fwb0Qs8PGZDZgJeCqTXZQQ5UaGL1Z2F7GmOp/2j0TQIyG/DdEDAfhAAx97cSgL8Ehz8VFWN6tBjzxywNfhYggVFcBIkvEmwhyQKc4jPF6TSgAAkezqKPBnwS87o0iY0iqcFzaY+8tSUaGAevVdAup9/2iG5F9fT7okJ+xE0wp2+chV6+D6gwCdgeu7udnclt1ULtjhw4gooEbeVW9a8DgI3eh070SUCv//muCQJo7zeI6g/1uO4AHakJ2tqQhB/GAd1J3VE9OexKbdeXLpOQuUpYuVM9O8mWBBZj20UBowGigUk9tQpaqQWwsRebRWA+3lO/4aOdBYeuHVHAGw2KqZ5cIpHcD5C9WLT7Pl/KWYUxJ3vxhi8+FvDhXrptOnyNFEKCxfeWMTizKNIIR7PGA4eVugGV5YM0wm9Off7jBAqAtHN9jICw50GiG7CL7kJMBJNPvQGk98k0Y8ds9IekvQ4EJ1HnWJdFrgFNlNtvQbH+2YB2EKspQL07TGA22hP1aNVqNmdhvQFzBi3ZZgc4VJs7Db5YDd6JPOdu3JqY1BH6MjBUA6H+3LFJUynIFrBWw9T1rzToucmLHIZjypnZj+hk+djtqjTgUjvL1Fw9FxHIB0DEnDRQe2hfLA15zNaZgPwLWHr2PuMZSKzY/V4zDkDHil1XGxegcbVGT3vLGx+ggbSZZZyABpKT+2QdxX2c+l+2vQfOkqOdRa6s+AAAAABJRU5ErkJggg==",Zx="/ais-telegram-webpages/assets/msw-6jIDzMdt.png";function qx({task:e}){return Q.jsxs("div",{className:"task-card",children:[Q.jsx(Ds,{src:e.icon}),Q.jsx("div",{className:"instruction",children:e.instruction}),Q.jsx("div",{className:"reward",children:Q.jsx("span",{children:e.reward})}),Q.jsx(ld,{className:"cta-button",children:"Go"})]})}function Kx(){const e=[{link:"/msw",icon:cd,instruction:"Join the MGG Community",reward:"1000000"},{link:"/mgg",icon:Zx,instruction:"Join the MSW Community",reward:"1000000"},{link:"/facebook",icon:hg,instruction:"Follow us on Facebook",reward:"1000000"},{link:"/x",icon:$x,instruction:"Follow us on X",reward:"1000000"},{link:"/instagram",icon:Yx,instruction:"Follow us on Instagram",reward:"1000000"},{link:"/discord-mgg",icon:Qx,instruction:"Join MGG Discord server",reward:"1000000"},{link:"/discord-msw",icon:hg,instruction:"Join MSW Discord server",reward:"1000000"}];return Q.jsx("section",{className:"flex grow items-center",children:Q.jsx("div",{className:"flex w-auto flex-col items-center gap-3 p-3",children:e.map((s,r)=>Q.jsx(qx,{task:s},r))})})}function ma(e){return e.charAt(0)==="/"}function fc(e,s){for(var r=s,a=r+1,h=e.length;a<h;r+=1,a+=1)e[r]=e[a];e.pop()}function Jx(e,s){s===void 0&&(s="");var r=e&&e.split("/")||[],a=s&&s.split("/")||[],h=e&&ma(e),u=s&&ma(s),p=h||u;if(e&&ma(e)?a=r:r.length&&(a.pop(),a=a.concat(r)),!a.length)return"/";var m;if(a.length){var _=a[a.length-1];m=_==="."||_===".."||_===""}else m=!1;for(var y=0,A=a.length;A>=0;A--){var E=a[A];E==="."?fc(a,A):E===".."?(fc(a,A),y++):y&&(fc(a,A),y--)}if(!p)for(;y--;y)a.unshift("..");p&&a[0]!==""&&(!a[0]||!ma(a[0]))&&a.unshift("");var S=a.join("/");return m&&S.substr(-1)!=="/"&&(S+="/"),S}var t1="Invariant failed";function dn(e,s){throw new Error(t1)}function Zr(e){return e.charAt(0)==="/"?e:"/"+e}function cg(e){return e.charAt(0)==="/"?e.substr(1):e}function e1(e,s){return e.toLowerCase().indexOf(s.toLowerCase())===0&&"/?#".indexOf(e.charAt(s.length))!==-1}function K_(e,s){return e1(e,s)?e.substr(s.length):e}function J_(e){return e.charAt(e.length-1)==="/"?e.slice(0,-1):e}function i1(e){var s=e||"/",r="",a="",h=s.indexOf("#");h!==-1&&(a=s.substr(h),s=s.substr(0,h));var u=s.indexOf("?");return u!==-1&&(r=s.substr(u),s=s.substr(0,u)),{pathname:s,search:r==="?"?"":r,hash:a==="#"?"":a}}function Xe(e){var s=e.pathname,r=e.search,a=e.hash,h=s||"/";return r&&r!=="?"&&(h+=r.charAt(0)==="?"?r:"?"+r),a&&a!=="#"&&(h+=a.charAt(0)==="#"?a:"#"+a),h}function ri(e,s,r,a){var h;typeof e=="string"?(h=i1(e),h.state=s):(h=Le({},e),h.pathname===void 0&&(h.pathname=""),h.search?h.search.charAt(0)!=="?"&&(h.search="?"+h.search):h.search="",h.hash?h.hash.charAt(0)!=="#"&&(h.hash="#"+h.hash):h.hash="",s!==void 0&&h.state===void 0&&(h.state=s));try{h.pathname=decodeURI(h.pathname)}catch(u){throw u instanceof URIError?new URIError('Pathname "'+h.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):u}return r&&(h.key=r),a?h.pathname?h.pathname.charAt(0)!=="/"&&(h.pathname=Jx(h.pathname,a.pathname)):h.pathname=a.pathname:h.pathname||(h.pathname="/"),h}function ud(){var e=null;function s(p){return e=p,function(){e===p&&(e=null)}}function r(p,m,_,y){if(e!=null){var A=typeof e=="function"?e(p,m):e;typeof A=="string"?typeof _=="function"?_(A,y):y(!0):y(A!==!1)}else y(!0)}var a=[];function h(p){var m=!0;function _(){m&&p.apply(void 0,arguments)}return a.push(_),function(){m=!1,a=a.filter(function(y){return y!==_})}}function u(){for(var p=arguments.length,m=new Array(p),_=0;_<p;_++)m[_]=arguments[_];a.forEach(function(y){return y.apply(void 0,m)})}return{setPrompt:s,confirmTransitionTo:r,appendListener:h,notifyListeners:u}}var tv=!!(typeof window<"u"&&window.document&&window.document.createElement);function ev(e,s){s(window.confirm(e))}function s1(){var e=window.navigator.userAgent;return(e.indexOf("Android 2.")!==-1||e.indexOf("Android 4.0")!==-1)&&e.indexOf("Mobile Safari")!==-1&&e.indexOf("Chrome")===-1&&e.indexOf("Windows Phone")===-1?!1:window.history&&"pushState"in window.history}function n1(){return window.navigator.userAgent.indexOf("Trident")===-1}function r1(){return window.navigator.userAgent.indexOf("Firefox")===-1}function o1(e){return e.state===void 0&&navigator.userAgent.indexOf("CriOS")===-1}var ug="popstate",dg="hashchange";function fg(){try{return window.history.state||{}}catch{return{}}}function a1(e){e===void 0&&(e={}),tv||dn();var s=window.history,r=s1(),a=!n1(),h=e,u=h.forceRefresh,p=u===void 0?!1:u,m=h.getUserConfirmation,_=m===void 0?ev:m,y=h.keyLength,A=y===void 0?6:y,E=e.basename?J_(Zr(e.basename)):"";function S(q){var Z=q||{},lt=Z.key,at=Z.state,Ct=window.location,Tt=Ct.pathname,bt=Ct.search,gt=Ct.hash,Zt=Tt+bt+gt;return E&&(Zt=K_(Zt,E)),ri(Zt,at,lt)}function R(){return Math.random().toString(36).substr(2,A)}var M=ud();function U(q){Le(et,q),et.length=s.length,M.notifyListeners(et.location,et.action)}function $(q){o1(q)||F(S(q.state))}function I(){F(S(fg()))}var P=!1;function F(q){if(P)P=!1,U();else{var Z="POP";M.confirmTransitionTo(q,Z,_,function(lt){lt?U({action:Z,location:q}):j(q)})}}function j(q){var Z=et.location,lt=Y.indexOf(Z.key);lt===-1&&(lt=0);var at=Y.indexOf(q.key);at===-1&&(at=0);var Ct=lt-at;Ct&&(P=!0,it(Ct))}var W=S(fg()),Y=[W.key];function C(q){return E+Xe(q)}function D(q,Z){var lt="PUSH",at=ri(q,Z,R(),et.location);M.confirmTransitionTo(at,lt,_,function(Ct){if(Ct){var Tt=C(at),bt=at.key,gt=at.state;if(r)if(s.pushState({key:bt,state:gt},null,Tt),p)window.location.href=Tt;else{var Zt=Y.indexOf(et.location.key),Ke=Y.slice(0,Zt+1);Ke.push(at.key),Y=Ke,U({action:lt,location:at})}else window.location.href=Tt}})}function N(q,Z){var lt="REPLACE",at=ri(q,Z,R(),et.location);M.confirmTransitionTo(at,lt,_,function(Ct){if(Ct){var Tt=C(at),bt=at.key,gt=at.state;if(r)if(s.replaceState({key:bt,state:gt},null,Tt),p)window.location.replace(Tt);else{var Zt=Y.indexOf(et.location.key);Zt!==-1&&(Y[Zt]=at.key),U({action:lt,location:at})}else window.location.replace(Tt)}})}function it(q){s.go(q)}function rt(){it(-1)}function K(){it(1)}var Pt=0;function St(q){Pt+=q,Pt===1&&q===1?(window.addEventListener(ug,$),a&&window.addEventListener(dg,I)):Pt===0&&(window.removeEventListener(ug,$),a&&window.removeEventListener(dg,I))}var ut=!1;function tt(q){q===void 0&&(q=!1);var Z=M.setPrompt(q);return ut||(St(1),ut=!0),function(){return ut&&(ut=!1,St(-1)),Z()}}function Pe(q){var Z=M.appendListener(q);return St(1),function(){St(-1),Z()}}var et={length:s.length,action:"POP",location:W,createHref:C,push:D,replace:N,go:it,goBack:rt,goForward:K,block:tt,listen:Pe};return et}var pg="hashchange",l1={hashbang:{encodePath:function(s){return s.charAt(0)==="!"?s:"!/"+cg(s)},decodePath:function(s){return s.charAt(0)==="!"?s.substr(1):s}},noslash:{encodePath:cg,decodePath:Zr},slash:{encodePath:Zr,decodePath:Zr}};function iv(e){var s=e.indexOf("#");return s===-1?e:e.slice(0,s)}function Lr(){var e=window.location.href,s=e.indexOf("#");return s===-1?"":e.substring(s+1)}function h1(e){window.location.hash=e}function pc(e){window.location.replace(iv(window.location.href)+"#"+e)}function c1(e){e===void 0&&(e={}),tv||dn();var s=window.history;r1();var r=e,a=r.getUserConfirmation,h=a===void 0?ev:a,u=r.hashType,p=u===void 0?"slash":u,m=e.basename?J_(Zr(e.basename)):"",_=l1[p],y=_.encodePath,A=_.decodePath;function E(){var Z=A(Lr());return m&&(Z=K_(Z,m)),ri(Z)}var S=ud();function R(Z){Le(q,Z),q.length=s.length,S.notifyListeners(q.location,q.action)}var M=!1,U=null;function $(Z,lt){return Z.pathname===lt.pathname&&Z.search===lt.search&&Z.hash===lt.hash}function I(){var Z=Lr(),lt=y(Z);if(Z!==lt)pc(lt);else{var at=E(),Ct=q.location;if(!M&&$(Ct,at)||U===Xe(at))return;U=null,P(at)}}function P(Z){if(M)M=!1,R();else{var lt="POP";S.confirmTransitionTo(Z,lt,h,function(at){at?R({action:lt,location:Z}):F(Z)})}}function F(Z){var lt=q.location,at=C.lastIndexOf(Xe(lt));at===-1&&(at=0);var Ct=C.lastIndexOf(Xe(Z));Ct===-1&&(Ct=0);var Tt=at-Ct;Tt&&(M=!0,rt(Tt))}var j=Lr(),W=y(j);j!==W&&pc(W);var Y=E(),C=[Xe(Y)];function D(Z){var lt=document.querySelector("base"),at="";return lt&&lt.getAttribute("href")&&(at=iv(window.location.href)),at+"#"+y(m+Xe(Z))}function N(Z,lt){var at="PUSH",Ct=ri(Z,void 0,void 0,q.location);S.confirmTransitionTo(Ct,at,h,function(Tt){if(Tt){var bt=Xe(Ct),gt=y(m+bt),Zt=Lr()!==gt;if(Zt){U=bt,h1(gt);var Ke=C.lastIndexOf(Xe(q.location)),vt=C.slice(0,Ke+1);vt.push(bt),C=vt,R({action:at,location:Ct})}else R()}})}function it(Z,lt){var at="REPLACE",Ct=ri(Z,void 0,void 0,q.location);S.confirmTransitionTo(Ct,at,h,function(Tt){if(Tt){var bt=Xe(Ct),gt=y(m+bt),Zt=Lr()!==gt;Zt&&(U=bt,pc(gt));var Ke=C.indexOf(Xe(q.location));Ke!==-1&&(C[Ke]=bt),R({action:at,location:Ct})}})}function rt(Z){s.go(Z)}function K(){rt(-1)}function Pt(){rt(1)}var St=0;function ut(Z){St+=Z,St===1&&Z===1?window.addEventListener(pg,I):St===0&&window.removeEventListener(pg,I)}var tt=!1;function Pe(Z){Z===void 0&&(Z=!1);var lt=S.setPrompt(Z);return tt||(ut(1),tt=!0),function(){return tt&&(tt=!1,ut(-1)),lt()}}function et(Z){var lt=S.appendListener(Z);return ut(1),function(){ut(-1),lt()}}var q={length:s.length,action:"POP",location:Y,createHref:D,push:N,replace:it,go:rt,goBack:K,goForward:Pt,block:Pe,listen:et};return q}function gg(e,s,r){return Math.min(Math.max(e,s),r)}function u1(e){e===void 0&&(e={});var s=e,r=s.getUserConfirmation,a=s.initialEntries,h=a===void 0?["/"]:a,u=s.initialIndex,p=u===void 0?0:u,m=s.keyLength,_=m===void 0?6:m,y=ud();function A(D){Le(C,D),C.length=C.entries.length,y.notifyListeners(C.location,C.action)}function E(){return Math.random().toString(36).substr(2,_)}var S=gg(p,0,h.length-1),R=h.map(function(D){return typeof D=="string"?ri(D,void 0,E()):ri(D,void 0,D.key||E())}),M=Xe;function U(D,N){var it="PUSH",rt=ri(D,N,E(),C.location);y.confirmTransitionTo(rt,it,r,function(K){if(K){var Pt=C.index,St=Pt+1,ut=C.entries.slice(0);ut.length>St?ut.splice(St,ut.length-St,rt):ut.push(rt),A({action:it,location:rt,index:St,entries:ut})}})}function $(D,N){var it="REPLACE",rt=ri(D,N,E(),C.location);y.confirmTransitionTo(rt,it,r,function(K){K&&(C.entries[C.index]=rt,A({action:it,location:rt}))})}function I(D){var N=gg(C.index+D,0,C.entries.length-1),it="POP",rt=C.entries[N];y.confirmTransitionTo(rt,it,r,function(K){K?A({action:it,location:rt,index:N}):A()})}function P(){I(-1)}function F(){I(1)}function j(D){var N=C.index+D;return N>=0&&N<C.entries.length}function W(D){return D===void 0&&(D=!1),y.setPrompt(D)}function Y(D){return y.appendListener(D)}var C={length:R.length,action:"POP",location:R[S],index:S,entries:R,createHref:M,push:U,replace:$,go:I,goBack:P,goForward:F,canGo:j,block:W,listen:Y};return C}var hr={exports:{}},d1=Array.isArray||function(e){return Object.prototype.toString.call(e)=="[object Array]"},el=d1;hr.exports=rv;hr.exports.parse=dd;hr.exports.compile=p1;hr.exports.tokensToFunction=sv;hr.exports.tokensToRegExp=nv;var f1=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function dd(e,s){for(var r=[],a=0,h=0,u="",p=s&&s.delimiter||"/",m;(m=f1.exec(e))!=null;){var _=m[0],y=m[1],A=m.index;if(u+=e.slice(h,A),h=A+_.length,y){u+=y[1];continue}var E=e[h],S=m[2],R=m[3],M=m[4],U=m[5],$=m[6],I=m[7];u&&(r.push(u),u="");var P=S!=null&&E!=null&&E!==S,F=$==="+"||$==="*",j=$==="?"||$==="*",W=m[2]||p,Y=M||U;r.push({name:R||a++,prefix:S||"",delimiter:W,optional:j,repeat:F,partial:P,asterisk:!!I,pattern:Y?_1(Y):I?".*":"[^"+Ia(W)+"]+?"})}return h<e.length&&(u+=e.substr(h)),u&&r.push(u),r}function p1(e,s){return sv(dd(e,s),s)}function g1(e){return encodeURI(e).replace(/[\/?#]/g,function(s){return"%"+s.charCodeAt(0).toString(16).toUpperCase()})}function m1(e){return encodeURI(e).replace(/[?#]/g,function(s){return"%"+s.charCodeAt(0).toString(16).toUpperCase()})}function sv(e,s){for(var r=new Array(e.length),a=0;a<e.length;a++)typeof e[a]=="object"&&(r[a]=new RegExp("^(?:"+e[a].pattern+")$",pd(s)));return function(h,u){for(var p="",m=h||{},_=u||{},y=_.pretty?g1:encodeURIComponent,A=0;A<e.length;A++){var E=e[A];if(typeof E=="string"){p+=E;continue}var S=m[E.name],R;if(S==null)if(E.optional){E.partial&&(p+=E.prefix);continue}else throw new TypeError('Expected "'+E.name+'" to be defined');if(el(S)){if(!E.repeat)throw new TypeError('Expected "'+E.name+'" to not repeat, but received `'+JSON.stringify(S)+"`");if(S.length===0){if(E.optional)continue;throw new TypeError('Expected "'+E.name+'" to not be empty')}for(var M=0;M<S.length;M++){if(R=y(S[M]),!r[A].test(R))throw new TypeError('Expected all "'+E.name+'" to match "'+E.pattern+'", but received `'+JSON.stringify(R)+"`");p+=(M===0?E.prefix:E.delimiter)+R}continue}if(R=E.asterisk?m1(S):y(S),!r[A].test(R))throw new TypeError('Expected "'+E.name+'" to match "'+E.pattern+'", but received "'+R+'"');p+=E.prefix+R}return p}}function Ia(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function _1(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function fd(e,s){return e.keys=s,e}function pd(e){return e&&e.sensitive?"":"i"}function v1(e,s){var r=e.source.match(/\((?!\?)/g);if(r)for(var a=0;a<r.length;a++)s.push({name:a,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return fd(e,s)}function y1(e,s,r){for(var a=[],h=0;h<e.length;h++)a.push(rv(e[h],s,r).source);var u=new RegExp("(?:"+a.join("|")+")",pd(r));return fd(u,s)}function w1(e,s,r){return nv(dd(e,r),s,r)}function nv(e,s,r){el(s)||(r=s||r,s=[]),r=r||{};for(var a=r.strict,h=r.end!==!1,u="",p=0;p<e.length;p++){var m=e[p];if(typeof m=="string")u+=Ia(m);else{var _=Ia(m.prefix),y="(?:"+m.pattern+")";s.push(m),m.repeat&&(y+="(?:"+_+y+")*"),m.optional?m.partial?y=_+"("+y+")?":y="(?:"+_+"("+y+"))?":y=_+"("+y+")",u+=y}}var A=Ia(r.delimiter||"/"),E=u.slice(-A.length)===A;return a||(u=(E?u.slice(0,-A.length):u)+"(?:"+A+"(?=$))?"),h?u+="$":u+=a&&E?"":"(?="+A+"|$)",fd(new RegExp("^"+u,pd(r)),s)}function rv(e,s,r){return el(s)||(r=s||r,s=[]),r=r||{},e instanceof RegExp?v1(e,s):el(e)?y1(e,s,r):w1(e,s,r)}var x1=hr.exports;const C1=sl(x1);var ov={exports:{}},Dt={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fe=typeof Symbol=="function"&&Symbol.for,gd=fe?Symbol.for("react.element"):60103,md=fe?Symbol.for("react.portal"):60106,xl=fe?Symbol.for("react.fragment"):60107,Cl=fe?Symbol.for("react.strict_mode"):60108,bl=fe?Symbol.for("react.profiler"):60114,Al=fe?Symbol.for("react.provider"):60109,Sl=fe?Symbol.for("react.context"):60110,_d=fe?Symbol.for("react.async_mode"):60111,El=fe?Symbol.for("react.concurrent_mode"):60111,Tl=fe?Symbol.for("react.forward_ref"):60112,Pl=fe?Symbol.for("react.suspense"):60113,b1=fe?Symbol.for("react.suspense_list"):60120,Il=fe?Symbol.for("react.memo"):60115,Rl=fe?Symbol.for("react.lazy"):60116,A1=fe?Symbol.for("react.block"):60121,S1=fe?Symbol.for("react.fundamental"):60117,E1=fe?Symbol.for("react.responder"):60118,T1=fe?Symbol.for("react.scope"):60119;function ui(e){if(typeof e=="object"&&e!==null){var s=e.$$typeof;switch(s){case gd:switch(e=e.type,e){case _d:case El:case xl:case bl:case Cl:case Pl:return e;default:switch(e=e&&e.$$typeof,e){case Sl:case Tl:case Rl:case Il:case Al:return e;default:return s}}case md:return s}}}function av(e){return ui(e)===El}Dt.AsyncMode=_d;Dt.ConcurrentMode=El;Dt.ContextConsumer=Sl;Dt.ContextProvider=Al;Dt.Element=gd;Dt.ForwardRef=Tl;Dt.Fragment=xl;Dt.Lazy=Rl;Dt.Memo=Il;Dt.Portal=md;Dt.Profiler=bl;Dt.StrictMode=Cl;Dt.Suspense=Pl;Dt.isAsyncMode=function(e){return av(e)||ui(e)===_d};Dt.isConcurrentMode=av;Dt.isContextConsumer=function(e){return ui(e)===Sl};Dt.isContextProvider=function(e){return ui(e)===Al};Dt.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===gd};Dt.isForwardRef=function(e){return ui(e)===Tl};Dt.isFragment=function(e){return ui(e)===xl};Dt.isLazy=function(e){return ui(e)===Rl};Dt.isMemo=function(e){return ui(e)===Il};Dt.isPortal=function(e){return ui(e)===md};Dt.isProfiler=function(e){return ui(e)===bl};Dt.isStrictMode=function(e){return ui(e)===Cl};Dt.isSuspense=function(e){return ui(e)===Pl};Dt.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===xl||e===El||e===bl||e===Cl||e===Pl||e===b1||typeof e=="object"&&e!==null&&(e.$$typeof===Rl||e.$$typeof===Il||e.$$typeof===Al||e.$$typeof===Sl||e.$$typeof===Tl||e.$$typeof===S1||e.$$typeof===E1||e.$$typeof===T1||e.$$typeof===A1)};Dt.typeOf=ui;ov.exports=Dt;var P1=ov.exports,lv=P1,I1={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},R1={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},hv={};hv[lv.ForwardRef]=I1;hv[lv.Memo]=R1;var gc=1073741823,mg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{};function D1(){var e="__global_unique_id__";return mg[e]=(mg[e]||0)+1}function k1(e,s){return e===s?e!==0||1/e===1/s:e!==e&&s!==s}function F1(e){var s=[];return{on:function(a){s.push(a)},off:function(a){s=s.filter(function(h){return h!==a})},get:function(){return e},set:function(a,h){e=a,s.forEach(function(u){return u(e,h)})}}}function B1(e){return Array.isArray(e)?e[0]:e}function M1(e,s){var r,a,h="__create-react-context-"+D1()+"__",u=function(m){ji(_,m);function _(){for(var A,E=arguments.length,S=new Array(E),R=0;R<E;R++)S[R]=arguments[R];return A=m.call.apply(m,[this].concat(S))||this,A.emitter=F1(A.props.value),A}var y=_.prototype;return y.getChildContext=function(){var E;return E={},E[h]=this.emitter,E},y.componentWillReceiveProps=function(E){if(this.props.value!==E.value){var S=this.props.value,R=E.value,M;k1(S,R)?M=0:(M=typeof s=="function"?s(S,R):gc,M|=0,M!==0&&this.emitter.set(E.value,M))}},y.render=function(){return this.props.children},_}(At.Component);u.childContextTypes=(r={},r[h]=Ks.object.isRequired,r);var p=function(m){ji(_,m);function _(){for(var A,E=arguments.length,S=new Array(E),R=0;R<E;R++)S[R]=arguments[R];return A=m.call.apply(m,[this].concat(S))||this,A.observedBits=void 0,A.state={value:A.getValue()},A.onUpdate=function(M,U){var $=A.observedBits|0;$&U&&A.setState({value:A.getValue()})},A}var y=_.prototype;return y.componentWillReceiveProps=function(E){var S=E.observedBits;this.observedBits=S??gc},y.componentDidMount=function(){this.context[h]&&this.context[h].on(this.onUpdate);var E=this.props.observedBits;this.observedBits=E??gc},y.componentWillUnmount=function(){this.context[h]&&this.context[h].off(this.onUpdate)},y.getValue=function(){return this.context[h]?this.context[h].get():e},y.render=function(){return B1(this.props.children)(this.state.value)},_}(At.Component);return p.contextTypes=(a={},a[h]=Ks.object,a),{Provider:u,Consumer:p}}var L1=At.createContext||M1,cv=function(s){var r=L1();return r.displayName=s,r},uv=cv("Router-History"),nr=cv("Router"),Dl=function(e){ji(s,e),s.computeRootMatch=function(h){return{path:"/",url:"/",params:{},isExact:h==="/"}};function s(a){var h;return h=e.call(this,a)||this,h.state={location:a.history.location},h._isMounted=!1,h._pendingLocation=null,a.staticContext||(h.unlisten=a.history.listen(function(u){h._pendingLocation=u})),h}var r=s.prototype;return r.componentDidMount=function(){var h=this;this._isMounted=!0,this.unlisten&&this.unlisten(),this.props.staticContext||(this.unlisten=this.props.history.listen(function(u){h._isMounted&&h.setState({location:u})})),this._pendingLocation&&this.setState({location:this._pendingLocation})},r.componentWillUnmount=function(){this.unlisten&&(this.unlisten(),this._isMounted=!1,this._pendingLocation=null)},r.render=function(){return At.createElement(nr.Provider,{value:{history:this.props.history,location:this.state.location,match:s.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}},At.createElement(uv.Provider,{children:this.props.children||null,value:this.props.history}))},s}(At.Component);At.Component;At.Component;var _g={},z1=1e4,vg=0;function O1(e,s){var r=""+s.end+s.strict+s.sensitive,a=_g[r]||(_g[r]={});if(a[e])return a[e];var h=[],u=C1(e,h,s),p={regexp:u,keys:h};return vg<z1&&(a[e]=p,vg++),p}function vd(e,s){s===void 0&&(s={}),(typeof s=="string"||Array.isArray(s))&&(s={path:s});var r=s,a=r.path,h=r.exact,u=h===void 0?!1:h,p=r.strict,m=p===void 0?!1:p,_=r.sensitive,y=_===void 0?!1:_,A=[].concat(a);return A.reduce(function(E,S){if(!S&&S!=="")return null;if(E)return E;var R=O1(S,{end:u,strict:m,sensitive:y}),M=R.regexp,U=R.keys,$=M.exec(e);if(!$)return null;var I=$[0],P=$.slice(1),F=e===I;return u&&!F?null:{path:S,url:S==="/"&&I===""?"/":I,isExact:F,params:U.reduce(function(j,W,Y){return j[W.name]=P[Y],j},{})}},null)}function U1(e){return At.Children.count(e)===0}var mc=function(e){ji(s,e);function s(){return e.apply(this,arguments)||this}var r=s.prototype;return r.render=function(){var h=this;return At.createElement(nr.Consumer,null,function(u){u||dn();var p=h.props.location||u.location,m=h.props.computedMatch?h.props.computedMatch:h.props.path?vd(p.pathname,h.props):u.match,_=Le({},u,{location:p,match:m}),y=h.props,A=y.children,E=y.component,S=y.render;return Array.isArray(A)&&U1(A)&&(A=null),At.createElement(nr.Provider,{value:_},_.match?A?typeof A=="function"?A(_):A:E?At.createElement(E,_):S?S(_):null:typeof A=="function"?A(_):null)})},s}(At.Component);function yd(e){return e.charAt(0)==="/"?e:"/"+e}function N1(e,s){return e?Le({},s,{pathname:yd(e)+s.pathname}):s}function H1(e,s){if(!e)return s;var r=yd(e);return s.pathname.indexOf(r)!==0?s:Le({},s,{pathname:s.pathname.substr(r.length)})}function yg(e){return typeof e=="string"?e:Xe(e)}function _c(e){return function(){dn()}}function wg(){}At.Component;var W1=function(e){ji(s,e);function s(){return e.apply(this,arguments)||this}var r=s.prototype;return r.render=function(){var h=this;return At.createElement(nr.Consumer,null,function(u){u||dn();var p=h.props.location||u.location,m,_;return At.Children.forEach(h.props.children,function(y){if(_==null&&At.isValidElement(y)){m=y;var A=y.props.path||y.props.from;_=A?vd(p.pathname,Le({},y.props,{path:A})):u.match}}),_?At.cloneElement(m,{location:p,computedMatch:_}):null})},s}(At.Component),j1=At.useContext;function G1(){return j1(uv)}var V1=function(e){ji(s,e);function s(){for(var a,h=arguments.length,u=new Array(h),p=0;p<h;p++)u[p]=arguments[p];return a=e.call.apply(e,[this].concat(u))||this,a.history=a1(a.props),a}var r=s.prototype;return r.render=function(){return At.createElement(Dl,{history:this.history,children:this.props.children})},s}(At.Component);At.Component;var du=function(s,r){return typeof s=="function"?s(r):s},fu=function(s,r){return typeof s=="string"?ri(s,null,null,r):s},wd=function(s){return s},rr=At.forwardRef;typeof rr>"u"&&(rr=wd);function X1(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}var $1=rr(function(e,s){var r=e.innerRef,a=e.navigate,h=e.onClick,u=wl(e,["innerRef","navigate","onClick"]),p=u.target,m=Le({},u,{onClick:function(y){try{h&&h(y)}catch(A){throw y.preventDefault(),A}!y.defaultPrevented&&y.button===0&&(!p||p==="_self")&&!X1(y)&&(y.preventDefault(),a())}});return wd!==rr?m.ref=s||r:m.ref=r,At.createElement("a",m)}),Y1=rr(function(e,s){var r=e.component,a=r===void 0?$1:r,h=e.replace,u=e.to,p=e.innerRef,m=wl(e,["component","replace","to","innerRef"]);return At.createElement(nr.Consumer,null,function(_){_||dn();var y=_.history,A=fu(du(u,_.location),_.location),E=A?y.createHref(A):"",S=Le({},m,{href:E,navigate:function(){var M=du(u,_.location),U=Xe(_.location)===Xe(fu(M)),$=h||U?y.replace:y.push;$(M)}});return wd!==rr?S.ref=s||p:S.innerRef=p,At.createElement(a,S)})}),dv=function(s){return s},il=At.forwardRef;typeof il>"u"&&(il=dv);function Q1(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return s.filter(function(a){return a}).join(" ")}il(function(e,s){var r=e["aria-current"],a=r===void 0?"page":r,h=e.activeClassName,u=h===void 0?"active":h,p=e.activeStyle,m=e.className,_=e.exact,y=e.isActive,A=e.location,E=e.sensitive,S=e.strict,R=e.style,M=e.to,U=e.innerRef,$=wl(e,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return At.createElement(nr.Consumer,null,function(I){I||dn();var P=A||I.location,F=fu(du(M,P),P),j=F.pathname,W=j&&j.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),Y=W?vd(P.pathname,{path:W,exact:_,sensitive:E,strict:S}):null,C=!!(y?y(Y,P):Y),D=typeof m=="function"?m(C):m,N=typeof R=="function"?R(C):R;C&&(D=Q1(D,u),N=Le({},N,p));var it=Le({"aria-current":C&&a||null,className:D,style:N,to:F},$);return dv!==il?it.ref=s||U:it.innerRef=U,At.createElement(Y1,it)})});const Z1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAgCAYAAAB6kdqOAAAABHNCSVQICAgIfAhkiAAAAVlJREFUWEft1m0RwjAMBmDqAAk4YBJACVjAwXCAA0ABEhgOkAAOhgJ4C+tuK2uT9IMf3HbXP3RNH9I2nXrimeR9jkqptT0Fpp3itxPaBv1X068yg3yYMxAFWo22NKicIA7GJKZF5QJJMH3UwJJd8EYVsa1qpH/n2DNmmVzh70MZ2iJgGQH6GtpsYArzwMBFdpAIg9OWFSTF6NRmA4VggkCugtbdOKEYMciaqFfQDCgGIwI5JuqhYjFsEDHRG4V2Q+Md7c7dZdcI1qYG6ICBK09t0igN0neT6/nUGQ9GmqEKA+aBBZOFYYP0i82yhaCcGMQs7Iyxlsw6QRKUD7NH3Lt9TYlAwkxRmDXifd2bYhATxcHoUGlABIqLSQtyoLynaeDbK12GBjb6jKozPwF1MjWjit7PQNxiOYKoTP1Nhqg/mrKfdexTTkjFGkFBGSqpURn7KxRT/TnTPi+ImnZn2O6OawAAAABJRU5ErkJggg==",q1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAXCAYAAACf+8ZRAAAABHNCSVQICAgIfAhkiAAAAmhJREFUWEfFl481BDEQh20FdOBU4FRgVcBVgApQgVUBKuAqQAVOBVwFVgWo4Py+ldzL7uXfsUfey3u7m5nJl8lkMlusRdpsNtvX8IH6QL2MyfY0NpGdWv2+KIqHkM3CNyDYQ32vDGxPPEubAb4S/Lir2YIW7IYEbox3l55lRQr3snss+A9rfw5tgB81MFzR5L8x+yLlPQvuQt9FPEx8oWjbqR7Wf0PxA13ifIReAy0vH5mw8NqScDeMKgme/2DimMqUGFafmN3mebejQJjcWuhXDQ5CFv8AGuDSjVvjTBbggteS2SrkZVIaoRFsfwDdeLALILZS3zhnbhsBjTAp7j+hOWR4tdXExu4TBW4bA93dggcZwPvZTTbIOM/ZCouCIU/7ouAJ6FnHxoWgq2UBPHZSJp6MADFbq++4MR1JwR//AQ3sgQU0IcAFQgq9Uie1EhakVe+dATSr3HTcskpPfwLkyRLLhNfUF9Ncl6x43jTJhftuTrWbipg05xwEz4ts4uHtVExpvIlptuEyJtxjyhvL1pFvLk9CCCGdAU38dNNKS6FH6IUDx0Tm0L1neBmRLXsj3uolmKt7hGZS5jpzDiKVZW6h1uyUhcbbxFSoCCIdzQsmeSZWXOU4DI9be6WeAU81DvFQHLVb5SWv85TVFY+PBExq/K7ybEtVewkoih4OdaiRkXKyg0+/dWMu/G6ZK5kVubk75cRreSEG3OjLNuAnKWPO+JueuYjcWr7taY/XAQl5hxhjcfzH1bkgJltVwKiHzhC7duWr/JjH+2PbgR/onV6a7wBS105yQUNy5pKy9hHDJrajTvgCAZ8NyvA3Y5cAAAAASUVORK5CYII=";function K1(){const[e,s]=ht.useState("/exchange"),r=[{key:"/",icon:cd,label:"Home"},{key:"/tasks",icon:Z1,label:"Tasks"},{key:"/jumping-game",icon:q1,label:"Minigames"}],a=G1(),h=u=>{s(u),a.push(u)};return Q.jsx("nav",{className:"flex flex-row gap-2 justify-center bg-violet-800 px-1 py-2",children:r.map(u=>Q.jsx(tl,{className:`basis-1/6 nav-card${e===u.key?" active":""}`,onClick:()=>h(u.key),children:Q.jsxs(tl.Body,{className:"bottomnav-card-body",children:[Q.jsx(Ds,{src:u.icon,className:"img-fluid",rounded:!0,draggable:"false"}),Q.jsx("div",{className:"text-xs align-text-bottom text-center",children:u.label})]})},u.key))})}const J1=e=>new Promise((s,r)=>{const a=document.querySelector(`script[src="${e}"]`);if(a){s(a);return}const h=document.createElement("script");h.src=e,h.async=!0,h.onload=()=>s(h),h.onerror=()=>r(new Error(`Failed to load script: ${e}`)),document.head.appendChild(h)}),fv=ht.createContext(null);function tC(){const[e,s]=ht.useState(null),r="https://telegram.org/js/telegram-web-app.js";return ht.useEffect(()=>{let a=null;return(async()=>{var u;try{a=await J1(r),console.log("Script loaded");const p=()=>window.Telegram!==void 0&&window.Telegram.WebApp!==void 0&&window.Telegram.WebApp.initData!==void 0&&window.Telegram.WebApp.initData.query_id!==void 0;let m;p()?(m=(u=window.Telegram)==null?void 0:u.WebApp,m.ready(),s(m.initDataUnsafe),console.log("Telegram initialized:",JSON.stringify(m)),m.onEvent("mainButtonClicked",()=>{console.log("Main Button Clicked")})):await px(async()=>{const{mockTelegram:_}=await import("./mockTelegramAPI-BaXyXYe0.js");return{mockTelegram:_}},[]).then(({mockTelegram:_})=>{var y;_(),m=(y=window.Telegram)==null?void 0:y.WebApp,m&&(s(m.initDataUnsafe),console.log("Using mock data:",JSON.stringify(m)))})}catch(p){console.error("Error loading Telegram Web App script:",p)}})(),()=>{var u;a&&((u=a.parentNode)==null||u.removeChild(a),console.log("Script removed"))}},[]),Q.jsx(fv.Provider,{value:{tgData:e,setTgData:s},children:Q.jsx(V1,{basename:"/ais-telegram-webpages",children:Q.jsxs("main",{className:"flex h-screen flex-col overflow-hidden bg-violet-900",children:[Q.jsx("div",{className:"flex grow flex-col overflow-hidden",children:Q.jsxs(W1,{children:[Q.jsx(mc,{exact:!0,path:"/",component:Nx}),Q.jsx(mc,{path:"/tasks",component:Kx}),Q.jsx(mc,{path:"/jumping-game",component:Xx})]})}),Q.jsx(K1,{})]})})})}vc.createRoot(document.getElementById("root")).render(Q.jsx(At.StrictMode,{children:Q.jsx(tC,{})}));
